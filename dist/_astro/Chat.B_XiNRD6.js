import{R as Dr,c as v0,g as _0,b as E0,a as Fe}from"./index.LCvdmd02.js";var La={exports:{}},vi={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jc;function T0(){if(jc)return vi;jc=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:r,type:n,key:o,ref:i!==void 0?i:null,props:s}}return vi.Fragment=e,vi.jsx=t,vi.jsxs=t,vi}var Hc;function C0(){return Hc||(Hc=1,La.exports=T0()),La.exports}var fe=C0();const I0=()=>{};var Gc={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lf=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},S0=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=r[t++];e[n++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=r[t++],o=r[t++],a=r[t++],f=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[n++]=String.fromCharCode(55296+(f>>10)),e[n++]=String.fromCharCode(56320+(f&1023))}else{const s=r[t++],o=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},hf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const s=r[i],o=i+1<r.length,a=o?r[i+1]:0,f=i+2<r.length,l=f?r[i+2]:0,g=s>>2,w=(s&3)<<4|a>>4;let y=(a&15)<<2|l>>6,p=l&63;f||(p=64,o||(y=64)),n.push(t[g],t[w],t[y],t[p])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(lf(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):S0(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const s=t[r.charAt(i++)],a=i<r.length?t[r.charAt(i)]:0;++i;const l=i<r.length?t[r.charAt(i)]:64;++i;const w=i<r.length?t[r.charAt(i)]:64;if(++i,s==null||a==null||l==null||w==null)throw new A0;const y=s<<2|a>>4;if(n.push(y),l!==64){const p=a<<4&240|l>>2;if(n.push(p),w!==64){const I=l<<6&192|w;n.push(I)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class A0 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const x0=function(r){const e=lf(r);return hf.encodeByteArray(e,!0)},ks=function(r){return x0(r).replace(/\./g,"")},ff=function(r){try{return hf.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w0(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b0=()=>w0().__FIREBASE_DEFAULTS__,R0=()=>{if(typeof process>"u"||typeof Gc>"u")return;const r=Gc.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},N0=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&ff(r[1]);return e&&JSON.parse(e)},ta=()=>{try{return I0()||b0()||R0()||N0()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},df=r=>{var e,t;return(t=(e=ta())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},P0=r=>{const e=df(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},pf=()=>{var r;return(r=ta())===null||r===void 0?void 0:r.config},gf=r=>{var e;return(e=ta())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k0(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,s=r.sub||r.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},r);return[ks(JSON.stringify(t)),ks(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function D0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ht())}function L0(){var r;const e=(r=ta())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function V0(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function O0(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function U0(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function M0(){const r=Ht();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function F0(){return!L0()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function K0(){try{return typeof indexedDB=="object"}catch{return!1}}function q0(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j0="FirebaseError";class Kr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=j0,Object.setPrototypeOf(this,Kr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ui.prototype.create)}}class Ui{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?H0(s,n):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Kr(i,a,n)}}function H0(r,e){return r.replace(G0,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const G0=/\{\$([^}]+)}/g;function z0(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function nn(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const s=r[i],o=e[i];if(zc(s)&&zc(o)){if(!nn(s,o))return!1}else if(s!==o)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function zc(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mi(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function $0(r,e){const t=new W0(r,e);return t.subscribe.bind(t)}class W0{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Q0(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=Va),i.error===void 0&&(i.error=Va),i.complete===void 0&&(i.complete=Va);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Q0(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function Va(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xt(r){return r&&r._delegate?r._delegate:r}class En{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new B0;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(J0(e))try{this.getOrInitializeService({instanceIdentifier:mn})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});n.resolve(s)}catch{}}}}clearInstance(e=mn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=mn){return this.instances.has(e)}getOptions(e=mn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);n===a&&o.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:X0(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=mn){return this.component?this.component.multipleInstances?e:mn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function X0(r){return r===mn?void 0:r}function J0(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Y0(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Le||(Le={}));const eg={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},tg=Le.INFO,rg={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},ng=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),i=rg[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class cu{constructor(e){this.name=e,this._logLevel=tg,this._logHandler=ng,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?eg[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}}const ig=(r,e)=>e.some(t=>r instanceof t);let $c,Wc;function sg(){return $c||($c=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ag(){return Wc||(Wc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const mf=new WeakMap,Do=new WeakMap,yf=new WeakMap,Oa=new WeakMap,lu=new WeakMap;function og(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{t(Jr(r.result)),i()},o=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&mf.set(t,r)}).catch(()=>{}),lu.set(e,r),e}function ug(r){if(Do.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});Do.set(r,e)}let Lo={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Do.get(r);if(e==="objectStoreNames")return r.objectStoreNames||yf.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Jr(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function cg(r){Lo=r(Lo)}function lg(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(Ua(this),e,...t);return yf.set(n,e.sort?e.sort():[e]),Jr(n)}:ag().includes(r)?function(...e){return r.apply(Ua(this),e),Jr(mf.get(this))}:function(...e){return Jr(r.apply(Ua(this),e))}}function hg(r){return typeof r=="function"?lg(r):(r instanceof IDBTransaction&&ug(r),ig(r,sg())?new Proxy(r,Lo):r)}function Jr(r){if(r instanceof IDBRequest)return og(r);if(Oa.has(r))return Oa.get(r);const e=hg(r);return e!==r&&(Oa.set(r,e),lu.set(e,r)),e}const Ua=r=>lu.get(r);function fg(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(r,e),a=Jr(o);return n&&o.addEventListener("upgradeneeded",f=>{n(Jr(o.result),f.oldVersion,f.newVersion,Jr(o.transaction),f)}),t&&o.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),a.then(f=>{s&&f.addEventListener("close",()=>s()),i&&f.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const dg=["get","getKey","getAll","getAllKeys","count"],pg=["put","add","delete","clear"],Ma=new Map;function Qc(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Ma.get(e))return Ma.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=pg.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||dg.includes(t)))return;const s=async function(o,...a){const f=this.transaction(o,i?"readwrite":"readonly");let l=f.store;return n&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),i&&f.done]))[0]};return Ma.set(e,s),s}cg(r=>({...r,get:(e,t,n)=>Qc(e,t)||r.get(e,t,n),has:(e,t)=>!!Qc(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(mg(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function mg(r){const e=r.getComponent();return e?.type==="VERSION"}const Vo="@firebase/app",Yc="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vr=new cu("@firebase/app"),yg="@firebase/app-compat",vg="@firebase/analytics-compat",_g="@firebase/analytics",Eg="@firebase/app-check-compat",Tg="@firebase/app-check",Cg="@firebase/auth",Ig="@firebase/auth-compat",Sg="@firebase/database",Ag="@firebase/data-connect",xg="@firebase/database-compat",wg="@firebase/functions",bg="@firebase/functions-compat",Rg="@firebase/installations",Ng="@firebase/installations-compat",Pg="@firebase/messaging",Bg="@firebase/messaging-compat",kg="@firebase/performance",Dg="@firebase/performance-compat",Lg="@firebase/remote-config",Vg="@firebase/remote-config-compat",Og="@firebase/storage",Ug="@firebase/storage-compat",Mg="@firebase/firestore",Fg="@firebase/vertexai",Kg="@firebase/firestore-compat",qg="firebase",jg="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo="[DEFAULT]",Hg={[Vo]:"fire-core",[yg]:"fire-core-compat",[_g]:"fire-analytics",[vg]:"fire-analytics-compat",[Tg]:"fire-app-check",[Eg]:"fire-app-check-compat",[Cg]:"fire-auth",[Ig]:"fire-auth-compat",[Sg]:"fire-rtdb",[Ag]:"fire-data-connect",[xg]:"fire-rtdb-compat",[wg]:"fire-fn",[bg]:"fire-fn-compat",[Rg]:"fire-iid",[Ng]:"fire-iid-compat",[Pg]:"fire-fcm",[Bg]:"fire-fcm-compat",[kg]:"fire-perf",[Dg]:"fire-perf-compat",[Lg]:"fire-rc",[Vg]:"fire-rc-compat",[Og]:"fire-gcs",[Ug]:"fire-gcs-compat",[Mg]:"fire-fst",[Kg]:"fire-fst-compat",[Fg]:"fire-vertex","fire-js":"fire-js",[qg]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds=new Map,Gg=new Map,Uo=new Map;function Xc(r,e){try{r.container.addComponent(e)}catch(t){Vr.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Kn(r){const e=r.name;if(Uo.has(e))return Vr.debug(`There were multiple attempts to register component ${e}.`),!1;Uo.set(e,r);for(const t of Ds.values())Xc(t,r);for(const t of Gg.values())Xc(t,r);return!0}function hu(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function hr(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Zr=new Ui("app","Firebase",zg);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new En("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Zr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jn=jg;function vf(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Oo,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw Zr.create("bad-app-name",{appName:String(i)});if(t||(t=pf()),!t)throw Zr.create("no-options");const s=Ds.get(i);if(s){if(nn(t,s.options)&&nn(n,s.config))return s;throw Zr.create("duplicate-app",{appName:i})}const o=new Z0(i);for(const f of Uo.values())o.addComponent(f);const a=new $g(t,n,o);return Ds.set(i,a),a}function _f(r=Oo){const e=Ds.get(r);if(!e&&r===Oo&&pf())return vf();if(!e)throw Zr.create("no-app",{appName:r});return e}function en(r,e,t){var n;let i=(n=Hg[r])!==null&&n!==void 0?n:r;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Vr.warn(a.join(" "));return}Kn(new En(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg="firebase-heartbeat-database",Qg=1,Ri="firebase-heartbeat-store";let Fa=null;function Ef(){return Fa||(Fa=fg(Wg,Qg,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(Ri)}catch(t){console.warn(t)}}}}).catch(r=>{throw Zr.create("idb-open",{originalErrorMessage:r.message})})),Fa}async function Yg(r){try{const t=(await Ef()).transaction(Ri),n=await t.objectStore(Ri).get(Tf(r));return await t.done,n}catch(e){if(e instanceof Kr)Vr.warn(e.message);else{const t=Zr.create("idb-get",{originalErrorMessage:e?.message});Vr.warn(t.message)}}}async function Jc(r,e){try{const n=(await Ef()).transaction(Ri,"readwrite");await n.objectStore(Ri).put(e,Tf(r)),await n.done}catch(t){if(t instanceof Kr)Vr.warn(t.message);else{const n=Zr.create("idb-set",{originalErrorMessage:t?.message});Vr.warn(n.message)}}}function Tf(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xg=1024,Jg=30;class Zg{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tm(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Zc();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Jg){const o=rm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Vr.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Zc(),{heartbeatsToSend:n,unsentEntries:i}=em(this._heartbeatsCache.heartbeats),s=ks(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Vr.warn(t),""}}}function Zc(){return new Date().toISOString().substring(0,10)}function em(r,e=Xg){const t=[];let n=r.slice();for(const i of r){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),el(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),el(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class tm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return K0()?q0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Yg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Jc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Jc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function el(r){return ks(JSON.stringify({version:2,heartbeats:r})).length}function rm(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nm(r){Kn(new En("platform-logger",e=>new gg(e),"PRIVATE")),Kn(new En("heartbeat",e=>new Zg(e),"PRIVATE")),en(Vo,Yc,r),en(Vo,Yc,"esm2017"),en("fire-js","")}nm("");function fu(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t}function Cf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const im=Cf,If=new Ui("auth","Firebase",Cf());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=new cu("@firebase/auth");function sm(r,...e){Ls.logLevel<=Le.WARN&&Ls.warn(`Auth (${Jn}): ${r}`,...e)}function Is(r,...e){Ls.logLevel<=Le.ERROR&&Ls.error(`Auth (${Jn}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(r,...e){throw pu(r,...e)}function fr(r,...e){return pu(r,...e)}function du(r,e,t){const n=Object.assign(Object.assign({},im()),{[e]:t});return new Ui("auth","Firebase",n).create(e,{appName:r.name})}function _n(r){return du(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function am(r,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&Tr(r,"argument-error"),du(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function pu(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return If.create(r,...e)}function Ee(r,e,...t){if(!r)throw pu(e,...t)}function Pr(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Is(e),new Error(e)}function Or(r,e){r||Pr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function om(){return tl()==="http:"||tl()==="https:"}function tl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function um(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(om()||O0()||"connection"in navigator)?navigator.onLine:!0}function cm(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e,t){this.shortDelay=e,this.longDelay=t,Or(t>e,"Short delay should be less than long delay!"),this.isMobile=D0()||U0()}get(){return um()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gu(r,e){Or(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Pr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Pr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Pr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hm=new Fi(3e4,6e4);function mu(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function Zn(r,e,t,n,i={}){return Af(r,i,async()=>{let s={},o={};n&&(e==="GET"?o=n:s={body:JSON.stringify(n)});const a=Mi(Object.assign({key:r.config.apiKey},o)).slice(1),f=await r._getAdditionalHeaders();f["Content-Type"]="application/json",r.languageCode&&(f["X-Firebase-Locale"]=r.languageCode);const l=Object.assign({method:e,headers:f},s);return V0()||(l.referrerPolicy="no-referrer"),Sf.fetch()(xf(r,r.config.apiHost,t,a),l)})}async function Af(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},lm),e);try{const i=new dm(r),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw ds(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[f,l]=a.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw ds(r,"credential-already-in-use",o);if(f==="EMAIL_EXISTS")throw ds(r,"email-already-in-use",o);if(f==="USER_DISABLED")throw ds(r,"user-disabled",o);const g=n[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw du(r,g,l);Tr(r,g)}}catch(i){if(i instanceof Kr)throw i;Tr(r,"network-request-failed",{message:String(i)})}}async function fm(r,e,t,n,i={}){const s=await Zn(r,e,t,n,i);return"mfaPendingCredential"in s&&Tr(r,"multi-factor-auth-required",{_serverResponse:s}),s}function xf(r,e,t,n){const i=`${e}${t}?${n}`;return r.config.emulator?gu(r.config,i):`${r.config.apiScheme}://${i}`}class dm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(fr(this.auth,"network-request-failed")),hm.get())})}}function ds(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=fr(r,e,n);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pm(r,e){return Zn(r,"POST","/v1/accounts:delete",e)}async function wf(r,e){return Zn(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gm(r,e=!1){const t=xt(r),n=await t.getIdToken(e),i=yu(n);Ee(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:n,authTime:Ii(Ka(i.auth_time)),issuedAtTime:Ii(Ka(i.iat)),expirationTime:Ii(Ka(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Ka(r){return Number(r)*1e3}function yu(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return Is("JWT malformed, contained fewer than 3 sections"),null;try{const i=ff(t);return i?JSON.parse(i):(Is("Failed to decode base64 JWT payload"),null)}catch(i){return Is("Caught error parsing JWT payload as JSON",i?.toString()),null}}function rl(r){const e=yu(r);return Ee(e,"internal-error"),Ee(typeof e.exp<"u","internal-error"),Ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ni(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Kr&&mm(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function mm({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ii(this.lastLoginAt),this.creationTime=Ii(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vs(r){var e;const t=r.auth,n=await r.getIdToken(),i=await Ni(r,wf(t,{idToken:n}));Ee(i?.users.length,t,"internal-error");const s=i.users[0];r._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?bf(s.providerUserInfo):[],a=_m(r.providerData,o),f=r.isAnonymous,l=!(r.email&&s.passwordHash)&&!a?.length,g=f?l:!1,w={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Fo(s.createdAt,s.lastLoginAt),isAnonymous:g};Object.assign(r,w)}async function vm(r){const e=xt(r);await Vs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _m(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function bf(r){return r.map(e=>{var{providerId:t}=e,n=fu(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Em(r,e){const t=await Af(r,{},async()=>{const n=Mi({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,o=xf(r,i,"/v1/token",`key=${s}`),a=await r._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Sf.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Tm(r,e){return Zn(r,"POST","/v2/accounts:revokeToken",mu(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ee(e.idToken,"internal-error"),Ee(typeof e.idToken<"u","internal-error"),Ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):rl(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ee(e.length!==0,"internal-error");const t=rl(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await Em(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,o=new On;return n&&(Ee(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),i&&(Ee(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(Ee(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new On,this.toJSON())}_performRefresh(){return Pr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gr(r,e){Ee(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Br{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=fu(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ym(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Fo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ni(this,this.stsTokenManager.getToken(this.auth,e));return Ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gm(this,e)}reload(){return vm(this)}_assign(e){this!==e&&(Ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Br(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Vs(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hr(this.auth.app))return Promise.reject(_n(this.auth));const e=await this.getIdToken();return await Ni(this,pm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,o,a,f,l,g;const w=(n=t.displayName)!==null&&n!==void 0?n:void 0,y=(i=t.email)!==null&&i!==void 0?i:void 0,p=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,I=(o=t.photoURL)!==null&&o!==void 0?o:void 0,S=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(f=t._redirectEventId)!==null&&f!==void 0?f:void 0,d=(l=t.createdAt)!==null&&l!==void 0?l:void 0,T=(g=t.lastLoginAt)!==null&&g!==void 0?g:void 0,{uid:x,emailVerified:k,isAnonymous:U,providerData:_,stsTokenManager:h}=t;Ee(x&&h,e,"internal-error");const c=On.fromJSON(this.name,h);Ee(typeof x=="string",e,"internal-error"),Gr(w,e.name),Gr(y,e.name),Ee(typeof k=="boolean",e,"internal-error"),Ee(typeof U=="boolean",e,"internal-error"),Gr(p,e.name),Gr(I,e.name),Gr(S,e.name),Gr(A,e.name),Gr(d,e.name),Gr(T,e.name);const v=new Br({uid:x,auth:e,email:y,emailVerified:k,displayName:w,isAnonymous:U,photoURL:I,phoneNumber:p,tenantId:S,stsTokenManager:c,createdAt:d,lastLoginAt:T});return _&&Array.isArray(_)&&(v.providerData=_.map(b=>Object.assign({},b))),A&&(v._redirectEventId=A),v}static async _fromIdTokenResponse(e,t,n=!1){const i=new On;i.updateFromServerResponse(t);const s=new Br({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Vs(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];Ee(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?bf(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new On;a.updateFromIdToken(n);const f=new Br({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Fo(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(f,l),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nl=new Map;function kr(r){Or(r instanceof Function,"Expected a class definition");let e=nl.get(r);return e?(Or(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,nl.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Rf.type="NONE";const il=Rf;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(r,e,t){return`firebase:${r}:${e}:${t}`}class Un{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=Ss(this.userKey,i.apiKey,s),this.fullPersistenceKey=Ss("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Br._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Un(kr(il),e,n);const i=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=i[0]||kr(il);const o=Ss(n,e.config.apiKey,e.name);let a=null;for(const l of t)try{const g=await l._get(o);if(g){const w=Br._fromJSON(e,g);l!==s&&(a=w),s=l;break}}catch{}const f=i.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!f.length?new Un(s,e,n):(s=f[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async l=>{if(l!==s)try{await l._remove(o)}catch{}})),new Un(s,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Nf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Lf(e))return"Blackberry";if(Vf(e))return"Webos";if(Pf(e))return"Safari";if((e.includes("chrome/")||Bf(e))&&!e.includes("edge/"))return"Chrome";if(Df(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if(n?.length===2)return n[1]}return"Other"}function Nf(r=Ht()){return/firefox\//i.test(r)}function Pf(r=Ht()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Bf(r=Ht()){return/crios\//i.test(r)}function kf(r=Ht()){return/iemobile/i.test(r)}function Df(r=Ht()){return/android/i.test(r)}function Lf(r=Ht()){return/blackberry/i.test(r)}function Vf(r=Ht()){return/webos/i.test(r)}function vu(r=Ht()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function Cm(r=Ht()){var e;return vu(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Im(){return M0()&&document.documentMode===10}function Of(r=Ht()){return vu(r)||Df(r)||Vf(r)||Lf(r)||/windows phone/i.test(r)||kf(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(r,e=[]){let t;switch(r){case"Browser":t=sl(Ht());break;case"Worker":t=`${sl(Ht())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Jn}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=s=>new Promise((o,a)=>{try{const f=e(s);o(f)}catch(f){a(f)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Am(r,e={}){return Zn(r,"GET","/v2/passwordPolicy",mu(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xm=6;class wm{constructor(e){var t,n,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:xm,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,o,a;const f={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,f),this.validatePasswordCharacterOptions(e,f),f.isValid&&(f.isValid=(t=f.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),f.isValid&&(f.isValid=(n=f.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),f.isValid&&(f.isValid=(i=f.containsLowercaseLetter)!==null&&i!==void 0?i:!0),f.isValid&&(f.isValid=(s=f.containsUppercaseLetter)!==null&&s!==void 0?s:!0),f.isValid&&(f.isValid=(o=f.containsNumericCharacter)!==null&&o!==void 0?o:!0),f.isValid&&(f.isValid=(a=f.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),f}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new al(this),this.idTokenSubscription=new al(this),this.beforeStateQueue=new Sm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=If,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=kr(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Un.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await wf(this,{idToken:e}),n=await Br._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(hr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i?._redirectEventId,f=await this.tryRedirectSignIn(e);(!o||o===a)&&f?.user&&(i=f.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=cm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hr(this.app))return Promise.reject(_n(this));const t=e?xt(e):null;return t&&Ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hr(this.app)?Promise.reject(_n(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hr(this.app)?Promise.reject(_n(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(kr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Am(this),t=new wm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ui("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await Tm(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&kr(e)||this._popupRedirectResolver;Ee(t,this,"argument-error"),this.redirectPersistenceManager=await Un.create(this,[kr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ee(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const f=e.addObserver(t,n,i);return()=>{o=!0,f()}}else{const f=e.addObserver(t);return()=>{o=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Uf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(hr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&sm(`Error while retrieving App Check token: ${t.error}`),t?.token}}function ra(r){return xt(r)}class al{constructor(e){this.auth=e,this.observer=null,this.addObserver=$0(t=>this.observer=t)}get next(){return Ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _u={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Rm(r){_u=r}function Nm(r){return _u.loadJS(r)}function Pm(){return _u.gapiScript}function Bm(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function km(r,e){const t=hu(r,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(nn(s,e??{}))return i;Tr(i,"already-initialized")}return t.initialize({options:e})}function Dm(r,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(kr);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e?.popupRedirectResolver)}function Lm(r,e,t){const n=ra(r);Ee(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,s=Mf(e),{host:o,port:a}=Vm(e),f=a===null?"":`:${a}`,l={url:`${s}//${o}${f}/`},g=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){Ee(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),Ee(nn(l,n.config.emulator)&&nn(g,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=g,n.settings.appVerificationDisabledForTesting=!0,Om()}function Mf(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function Vm(r){const e=Mf(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const s=i[1];return{host:s,port:ol(n.substr(s.length+1))}}else{const[s,o]=n.split(":");return{host:s,port:ol(o)}}}function ol(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function Om(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Pr("not implemented")}_getIdTokenResponse(e){return Pr("not implemented")}_linkToIdToken(e,t){return Pr("not implemented")}_getReauthenticationResolver(e){return Pr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mn(r,e){return fm(r,"POST","/v1/accounts:signInWithIdp",mu(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Um="http://localhost";class Tn extends Ff{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Tn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Tr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=fu(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new Tn(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Mn(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Mn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Mn(e,t)}buildRequest(){const e={requestUri:Um,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Mi(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki extends Eu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr extends Ki{constructor(){super("facebook.com")}static credential(e){return Tn._fromParams({providerId:Wr.PROVIDER_ID,signInMethod:Wr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wr.credentialFromTaggedObject(e)}static credentialFromError(e){return Wr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wr.credential(e.oauthAccessToken)}catch{return null}}}Wr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Wr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr extends Ki{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Tn._fromParams({providerId:Nr.PROVIDER_ID,signInMethod:Nr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Nr.credentialFromTaggedObject(e)}static credentialFromError(e){return Nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Nr.credential(t,n)}catch{return null}}}Nr.GOOGLE_SIGN_IN_METHOD="google.com";Nr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr extends Ki{constructor(){super("github.com")}static credential(e){return Tn._fromParams({providerId:Qr.PROVIDER_ID,signInMethod:Qr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qr.credentialFromTaggedObject(e)}static credentialFromError(e){return Qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qr.credential(e.oauthAccessToken)}catch{return null}}}Qr.GITHUB_SIGN_IN_METHOD="github.com";Qr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr extends Ki{constructor(){super("twitter.com")}static credential(e,t){return Tn._fromParams({providerId:Yr.PROVIDER_ID,signInMethod:Yr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Yr.credentialFromTaggedObject(e)}static credentialFromError(e){return Yr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Yr.credential(t,n)}catch{return null}}}Yr.TWITTER_SIGN_IN_METHOD="twitter.com";Yr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await Br._fromIdTokenResponse(e,n,i),o=ul(n);return new qn({user:s,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=ul(n);return new qn({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function ul(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends Kr{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Os.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Os(e,t,n,i)}}function Kf(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Os._fromErrorAndOperation(r,s,e,n):s})}async function Mm(r,e,t=!1){const n=await Ni(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return qn._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fm(r,e,t=!1){const{auth:n}=r;if(hr(n.app))return Promise.reject(_n(n));const i="reauthenticate";try{const s=await Ni(r,Kf(n,i,e,r),t);Ee(s.idToken,n,"internal-error");const o=yu(s.idToken);Ee(o,n,"internal-error");const{sub:a}=o;return Ee(r.uid===a,n,"user-mismatch"),qn._forOperation(r,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Tr(n,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Km(r,e,t=!1){if(hr(r.app))return Promise.reject(_n(r));const n="signIn",i=await Kf(r,n,e),s=await qn._fromIdTokenResponse(r,n,i);return t||await r._updateCurrentUser(s.user),s}function qm(r,e,t,n){return xt(r).onIdTokenChanged(e,t,n)}function jm(r,e,t){return xt(r).beforeAuthStateChanged(e,t)}function aT(r){return xt(r).signOut()}const Us="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Us,"1"),this.storage.removeItem(Us),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hm=1e3,Gm=10;class jf extends qf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Of(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,f)=>{this.notifyListeners(o,f)});return}const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},s=this.storage.getItem(n);Im()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Gm):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Hm)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}jf.type="LOCAL";const zm=jf;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf extends qf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Hf.type="SESSION";const Gf=Hf;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $m(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const n=new na(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(o).map(async l=>l(t.origin,s)),f=await $m(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:f})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}na.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,f)=>{const l=Tu("",20);i.port1.start();const g=setTimeout(()=>{f(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(w){const y=w;if(y.data.eventId===l)switch(y.data.status){case"ack":clearTimeout(g),s=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(y.data.response);break;default:clearTimeout(g),clearTimeout(s),f(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vr(){return window}function Qm(r){vr().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(){return typeof vr().WorkerGlobalScope<"u"&&typeof vr().importScripts=="function"}async function Ym(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Xm(){var r;return((r=navigator?.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function Jm(){return zf()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f="firebaseLocalStorageDb",Zm=1,Ms="firebaseLocalStorage",Wf="fbase_key";class qi{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ia(r,e){return r.transaction([Ms],e?"readwrite":"readonly").objectStore(Ms)}function ey(){const r=indexedDB.deleteDatabase($f);return new qi(r).toPromise()}function Ko(){const r=indexedDB.open($f,Zm);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Ms,{keyPath:Wf})}catch(i){t(i)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Ms)?e(n):(n.close(),await ey(),e(await Ko()))})})}async function cl(r,e,t){const n=ia(r,!0).put({[Wf]:e,value:t});return new qi(n).toPromise()}async function ty(r,e){const t=ia(r,!1).get(e),n=await new qi(t).toPromise();return n===void 0?null:n.value}function ll(r,e){const t=ia(r,!0).delete(e);return new qi(t).toPromise()}const ry=800,ny=3;class Qf{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ko(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>ny)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return zf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=na._getInstance(Jm()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Ym(),!this.activeServiceWorker)return;this.sender=new Wm(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Xm()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ko();return await cl(e,Us,"1"),await ll(e,Us),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>cl(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>ty(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ll(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=ia(i,!1).getAll();return new qi(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ry)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Qf.type="LOCAL";const iy=Qf;new Fi(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yf(r,e){return e?kr(e):(Ee(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu extends Ff{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Mn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Mn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Mn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function sy(r){return Km(r.auth,new Cu(r),r.bypassAuthState)}function ay(r){const{auth:e,user:t}=r;return Ee(t,e,"internal-error"),Fm(t,new Cu(r),r.bypassAuthState)}async function oy(r){const{auth:e,user:t}=r;return Ee(t,e,"internal-error"),Mm(t,new Cu(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const f={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(f))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sy;case"linkViaPopup":case"linkViaRedirect":return oy;case"reauthViaPopup":case"reauthViaRedirect":return ay;default:Tr(this.auth,"internal-error")}}resolve(e){Or(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Or(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uy=new Fi(2e3,1e4);async function cy(r,e,t){if(hr(r.app))return Promise.reject(fr(r,"operation-not-supported-in-this-environment"));const n=ra(r);am(r,e,Eu);const i=Yf(n,t);return new yn(n,"signInViaPopup",e,i).executeNotNull()}class yn extends Xf{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,yn.currentPopupAction&&yn.currentPopupAction.cancel(),yn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ee(e,this.auth,"internal-error"),e}async onExecution(){Or(this.filter.length===1,"Popup operations only handle one event");const e=Tu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,uy.get())};e()}}yn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ly="pendingRedirect",As=new Map;class hy extends Xf{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=As.get(this.auth._key());if(!e){try{const n=await fy(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}As.set(this.auth._key(),e)}return this.bypassAuthState||As.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function fy(r,e){const t=gy(e),n=py(r);if(!await n._isAvailable())return!1;const i=await n._get(t)==="true";return await n._remove(t),i}function dy(r,e){As.set(r._key(),e)}function py(r){return kr(r._redirectPersistence)}function gy(r){return Ss(ly,r.config.apiKey,r.name)}async function my(r,e,t=!1){if(hr(r.app))return Promise.reject(_n(r));const n=ra(r),i=Yf(n,e),o=await new hy(n,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy=10*60*1e3;class vy{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_y(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Jf(e)){const i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(fr(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=yy&&this.cachedEventUids.clear(),this.cachedEventUids.has(hl(e))}saveEventToCache(e){this.cachedEventUids.add(hl(e)),this.lastProcessedEventTime=Date.now()}}function hl(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function Jf({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function _y(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Jf(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ey(r,e={}){return Zn(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ty=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Cy=/^https?/;async function Iy(r){if(r.config.emulator)return;const{authorizedDomains:e}=await Ey(r);for(const t of e)try{if(Sy(t))return}catch{}Tr(r,"unauthorized-domain")}function Sy(r){const e=Mo(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!Cy.test(t))return!1;if(Ty.test(r))return n===r;const i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay=new Fi(3e4,6e4);function fl(){const r=vr().___jsl;if(r?.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function xy(r){return new Promise((e,t)=>{var n,i,s;function o(){fl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fl(),t(fr(r,"network-request-failed"))},timeout:Ay.get()})}if(!((i=(n=vr().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=vr().gapi)===null||s===void 0)&&s.load)o();else{const a=Bm("iframefcb");return vr()[a]=()=>{gapi.load?o():t(fr(r,"network-request-failed"))},Nm(`${Pm()}?onload=${a}`).catch(f=>t(f))}}).catch(e=>{throw xs=null,e})}let xs=null;function wy(r){return xs=xs||xy(r),xs}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by=new Fi(5e3,15e3),Ry="__/auth/iframe",Ny="emulator/auth/iframe",Py={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},By=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ky(r){const e=r.config;Ee(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?gu(e,Ny):`https://${r.config.authDomain}/${Ry}`,n={apiKey:e.apiKey,appName:r.name,v:Jn},i=By.get(r.config.apiHost);i&&(n.eid=i);const s=r._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${Mi(n).slice(1)}`}async function Dy(r){const e=await wy(r),t=vr().gapi;return Ee(t,r,"internal-error"),e.open({where:document.body,url:ky(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Py,dontclear:!0},n=>new Promise(async(i,s)=>{await n.restyle({setHideOnLeave:!1});const o=fr(r,"network-request-failed"),a=vr().setTimeout(()=>{s(o)},by.get());function f(){vr().clearTimeout(a),i(n)}n.ping(f).then(f,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ly={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Vy=500,Oy=600,Uy="_blank",My="http://localhost";class dl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Fy(r,e,t,n=Vy,i=Oy){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const f=Object.assign(Object.assign({},Ly),{width:n.toString(),height:i.toString(),top:s,left:o}),l=Ht().toLowerCase();t&&(a=Bf(l)?Uy:t),Nf(l)&&(e=e||My,f.scrollbars="yes");const g=Object.entries(f).reduce((y,[p,I])=>`${y}${p}=${I},`,"");if(Cm(l)&&a!=="_self")return Ky(e||"",a),new dl(null);const w=window.open(e||"",a,g);Ee(w,r,"popup-blocked");try{w.focus()}catch{}return new dl(w)}function Ky(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy="__/auth/handler",jy="emulator/auth/handler",Hy=encodeURIComponent("fac");async function pl(r,e,t,n,i,s){Ee(r.config.authDomain,r,"auth-domain-config-required"),Ee(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Jn,eventId:i};if(e instanceof Eu){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",z0(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,w]of Object.entries({}))o[g]=w}if(e instanceof Ki){const g=e.getScopes().filter(w=>w!=="");g.length>0&&(o.scopes=g.join(","))}r.tenantId&&(o.tid=r.tenantId);const a=o;for(const g of Object.keys(a))a[g]===void 0&&delete a[g];const f=await r._getAppCheckToken(),l=f?`#${Hy}=${encodeURIComponent(f)}`:"";return`${Gy(r)}?${Mi(a).slice(1)}${l}`}function Gy({config:r}){return r.emulator?gu(r,jy):`https://${r.authDomain}/${qy}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qa="webStorageSupport";class zy{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Gf,this._completeRedirectFn=my,this._overrideRedirectResult=dy}async _openPopup(e,t,n,i){var s;Or((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await pl(e,t,n,Mo(),i);return Fy(e,o,Tu())}async _openRedirect(e,t,n,i){await this._originValidation(e);const s=await pl(e,t,n,Mo(),i);return Qm(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Or(s,"If manager is not set, promise should be"),s)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Dy(e),n=new vy(e);return t.register("authEvent",i=>(Ee(i?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(qa,{type:qa},i=>{var s;const o=(s=i?.[0])===null||s===void 0?void 0:s[qa];o!==void 0&&t(!!o),Tr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Iy(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Of()||Pf()||vu()}}const $y=zy;var gl="@firebase/auth",ml="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Yy(r){Kn(new En("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=n.options;Ee(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const f={apiKey:o,authDomain:a,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Uf(r)},l=new bm(n,i,s,f);return Dm(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Kn(new En("auth-internal",e=>{const t=ra(e.getProvider("auth").getImmediate());return(n=>new Wy(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),en(gl,ml,Qy(r)),en(gl,ml,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy=5*60,Jy=gf("authIdTokenMaxAge")||Xy;let yl=null;const Zy=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Jy)return;const i=t?.token;yl!==i&&(yl=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function ev(r=_f()){const e=hu(r,"auth");if(e.isInitialized())return e.getImmediate();const t=km(r,{popupRedirectResolver:$y,persistence:[iy,zm,Gf]}),n=gf("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(n,location.origin);if(location.origin===s.origin){const o=Zy(s.toString());jm(t,o,()=>o(t.currentUser)),qm(t,a=>o(a))}}const i=df("auth");return i&&Lm(t,`http://${i}`),t}function tv(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}Rm({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{const s=fr("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",tv().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Yy("Browser");var rv="firebase",nv="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */en(rv,nv,"app");var vl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var tn,Zf;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(h,c){function v(){}v.prototype=c.prototype,h.D=c.prototype,h.prototype=new v,h.prototype.constructor=h,h.C=function(b,B,R){for(var P=Array(arguments.length-2),H=2;H<arguments.length;H++)P[H-2]=arguments[H];return c.prototype[B].apply(b,P)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(h,c,v){v||(v=0);var b=Array(16);if(typeof c=="string")for(var B=0;16>B;++B)b[B]=c.charCodeAt(v++)|c.charCodeAt(v++)<<8|c.charCodeAt(v++)<<16|c.charCodeAt(v++)<<24;else for(B=0;16>B;++B)b[B]=c[v++]|c[v++]<<8|c[v++]<<16|c[v++]<<24;c=h.g[0],v=h.g[1],B=h.g[2];var R=h.g[3],P=c+(R^v&(B^R))+b[0]+3614090360&4294967295;c=v+(P<<7&4294967295|P>>>25),P=R+(B^c&(v^B))+b[1]+3905402710&4294967295,R=c+(P<<12&4294967295|P>>>20),P=B+(v^R&(c^v))+b[2]+606105819&4294967295,B=R+(P<<17&4294967295|P>>>15),P=v+(c^B&(R^c))+b[3]+3250441966&4294967295,v=B+(P<<22&4294967295|P>>>10),P=c+(R^v&(B^R))+b[4]+4118548399&4294967295,c=v+(P<<7&4294967295|P>>>25),P=R+(B^c&(v^B))+b[5]+1200080426&4294967295,R=c+(P<<12&4294967295|P>>>20),P=B+(v^R&(c^v))+b[6]+2821735955&4294967295,B=R+(P<<17&4294967295|P>>>15),P=v+(c^B&(R^c))+b[7]+4249261313&4294967295,v=B+(P<<22&4294967295|P>>>10),P=c+(R^v&(B^R))+b[8]+1770035416&4294967295,c=v+(P<<7&4294967295|P>>>25),P=R+(B^c&(v^B))+b[9]+2336552879&4294967295,R=c+(P<<12&4294967295|P>>>20),P=B+(v^R&(c^v))+b[10]+4294925233&4294967295,B=R+(P<<17&4294967295|P>>>15),P=v+(c^B&(R^c))+b[11]+2304563134&4294967295,v=B+(P<<22&4294967295|P>>>10),P=c+(R^v&(B^R))+b[12]+1804603682&4294967295,c=v+(P<<7&4294967295|P>>>25),P=R+(B^c&(v^B))+b[13]+4254626195&4294967295,R=c+(P<<12&4294967295|P>>>20),P=B+(v^R&(c^v))+b[14]+2792965006&4294967295,B=R+(P<<17&4294967295|P>>>15),P=v+(c^B&(R^c))+b[15]+1236535329&4294967295,v=B+(P<<22&4294967295|P>>>10),P=c+(B^R&(v^B))+b[1]+4129170786&4294967295,c=v+(P<<5&4294967295|P>>>27),P=R+(v^B&(c^v))+b[6]+3225465664&4294967295,R=c+(P<<9&4294967295|P>>>23),P=B+(c^v&(R^c))+b[11]+643717713&4294967295,B=R+(P<<14&4294967295|P>>>18),P=v+(R^c&(B^R))+b[0]+3921069994&4294967295,v=B+(P<<20&4294967295|P>>>12),P=c+(B^R&(v^B))+b[5]+3593408605&4294967295,c=v+(P<<5&4294967295|P>>>27),P=R+(v^B&(c^v))+b[10]+38016083&4294967295,R=c+(P<<9&4294967295|P>>>23),P=B+(c^v&(R^c))+b[15]+3634488961&4294967295,B=R+(P<<14&4294967295|P>>>18),P=v+(R^c&(B^R))+b[4]+3889429448&4294967295,v=B+(P<<20&4294967295|P>>>12),P=c+(B^R&(v^B))+b[9]+568446438&4294967295,c=v+(P<<5&4294967295|P>>>27),P=R+(v^B&(c^v))+b[14]+3275163606&4294967295,R=c+(P<<9&4294967295|P>>>23),P=B+(c^v&(R^c))+b[3]+4107603335&4294967295,B=R+(P<<14&4294967295|P>>>18),P=v+(R^c&(B^R))+b[8]+1163531501&4294967295,v=B+(P<<20&4294967295|P>>>12),P=c+(B^R&(v^B))+b[13]+2850285829&4294967295,c=v+(P<<5&4294967295|P>>>27),P=R+(v^B&(c^v))+b[2]+4243563512&4294967295,R=c+(P<<9&4294967295|P>>>23),P=B+(c^v&(R^c))+b[7]+1735328473&4294967295,B=R+(P<<14&4294967295|P>>>18),P=v+(R^c&(B^R))+b[12]+2368359562&4294967295,v=B+(P<<20&4294967295|P>>>12),P=c+(v^B^R)+b[5]+4294588738&4294967295,c=v+(P<<4&4294967295|P>>>28),P=R+(c^v^B)+b[8]+2272392833&4294967295,R=c+(P<<11&4294967295|P>>>21),P=B+(R^c^v)+b[11]+1839030562&4294967295,B=R+(P<<16&4294967295|P>>>16),P=v+(B^R^c)+b[14]+4259657740&4294967295,v=B+(P<<23&4294967295|P>>>9),P=c+(v^B^R)+b[1]+2763975236&4294967295,c=v+(P<<4&4294967295|P>>>28),P=R+(c^v^B)+b[4]+1272893353&4294967295,R=c+(P<<11&4294967295|P>>>21),P=B+(R^c^v)+b[7]+4139469664&4294967295,B=R+(P<<16&4294967295|P>>>16),P=v+(B^R^c)+b[10]+3200236656&4294967295,v=B+(P<<23&4294967295|P>>>9),P=c+(v^B^R)+b[13]+681279174&4294967295,c=v+(P<<4&4294967295|P>>>28),P=R+(c^v^B)+b[0]+3936430074&4294967295,R=c+(P<<11&4294967295|P>>>21),P=B+(R^c^v)+b[3]+3572445317&4294967295,B=R+(P<<16&4294967295|P>>>16),P=v+(B^R^c)+b[6]+76029189&4294967295,v=B+(P<<23&4294967295|P>>>9),P=c+(v^B^R)+b[9]+3654602809&4294967295,c=v+(P<<4&4294967295|P>>>28),P=R+(c^v^B)+b[12]+3873151461&4294967295,R=c+(P<<11&4294967295|P>>>21),P=B+(R^c^v)+b[15]+530742520&4294967295,B=R+(P<<16&4294967295|P>>>16),P=v+(B^R^c)+b[2]+3299628645&4294967295,v=B+(P<<23&4294967295|P>>>9),P=c+(B^(v|~R))+b[0]+4096336452&4294967295,c=v+(P<<6&4294967295|P>>>26),P=R+(v^(c|~B))+b[7]+1126891415&4294967295,R=c+(P<<10&4294967295|P>>>22),P=B+(c^(R|~v))+b[14]+2878612391&4294967295,B=R+(P<<15&4294967295|P>>>17),P=v+(R^(B|~c))+b[5]+4237533241&4294967295,v=B+(P<<21&4294967295|P>>>11),P=c+(B^(v|~R))+b[12]+1700485571&4294967295,c=v+(P<<6&4294967295|P>>>26),P=R+(v^(c|~B))+b[3]+2399980690&4294967295,R=c+(P<<10&4294967295|P>>>22),P=B+(c^(R|~v))+b[10]+4293915773&4294967295,B=R+(P<<15&4294967295|P>>>17),P=v+(R^(B|~c))+b[1]+2240044497&4294967295,v=B+(P<<21&4294967295|P>>>11),P=c+(B^(v|~R))+b[8]+1873313359&4294967295,c=v+(P<<6&4294967295|P>>>26),P=R+(v^(c|~B))+b[15]+4264355552&4294967295,R=c+(P<<10&4294967295|P>>>22),P=B+(c^(R|~v))+b[6]+2734768916&4294967295,B=R+(P<<15&4294967295|P>>>17),P=v+(R^(B|~c))+b[13]+1309151649&4294967295,v=B+(P<<21&4294967295|P>>>11),P=c+(B^(v|~R))+b[4]+4149444226&4294967295,c=v+(P<<6&4294967295|P>>>26),P=R+(v^(c|~B))+b[11]+3174756917&4294967295,R=c+(P<<10&4294967295|P>>>22),P=B+(c^(R|~v))+b[2]+718787259&4294967295,B=R+(P<<15&4294967295|P>>>17),P=v+(R^(B|~c))+b[9]+3951481745&4294967295,h.g[0]=h.g[0]+c&4294967295,h.g[1]=h.g[1]+(B+(P<<21&4294967295|P>>>11))&4294967295,h.g[2]=h.g[2]+B&4294967295,h.g[3]=h.g[3]+R&4294967295}n.prototype.u=function(h,c){c===void 0&&(c=h.length);for(var v=c-this.blockSize,b=this.B,B=this.h,R=0;R<c;){if(B==0)for(;R<=v;)i(this,h,R),R+=this.blockSize;if(typeof h=="string"){for(;R<c;)if(b[B++]=h.charCodeAt(R++),B==this.blockSize){i(this,b),B=0;break}}else for(;R<c;)if(b[B++]=h[R++],B==this.blockSize){i(this,b),B=0;break}}this.h=B,this.o+=c},n.prototype.v=function(){var h=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);h[0]=128;for(var c=1;c<h.length-8;++c)h[c]=0;var v=8*this.o;for(c=h.length-8;c<h.length;++c)h[c]=v&255,v/=256;for(this.u(h),h=Array(16),c=v=0;4>c;++c)for(var b=0;32>b;b+=8)h[v++]=this.g[c]>>>b&255;return h};function s(h,c){var v=a;return Object.prototype.hasOwnProperty.call(v,h)?v[h]:v[h]=c(h)}function o(h,c){this.h=c;for(var v=[],b=!0,B=h.length-1;0<=B;B--){var R=h[B]|0;b&&R==c||(v[B]=R,b=!1)}this.g=v}var a={};function f(h){return-128<=h&&128>h?s(h,function(c){return new o([c|0],0>c?-1:0)}):new o([h|0],0>h?-1:0)}function l(h){if(isNaN(h)||!isFinite(h))return w;if(0>h)return A(l(-h));for(var c=[],v=1,b=0;h>=v;b++)c[b]=h/v|0,v*=4294967296;return new o(c,0)}function g(h,c){if(h.length==0)throw Error("number format error: empty string");if(c=c||10,2>c||36<c)throw Error("radix out of range: "+c);if(h.charAt(0)=="-")return A(g(h.substring(1),c));if(0<=h.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=l(Math.pow(c,8)),b=w,B=0;B<h.length;B+=8){var R=Math.min(8,h.length-B),P=parseInt(h.substring(B,B+R),c);8>R?(R=l(Math.pow(c,R)),b=b.j(R).add(l(P))):(b=b.j(v),b=b.add(l(P)))}return b}var w=f(0),y=f(1),p=f(16777216);r=o.prototype,r.m=function(){if(S(this))return-A(this).m();for(var h=0,c=1,v=0;v<this.g.length;v++){var b=this.i(v);h+=(0<=b?b:4294967296+b)*c,c*=4294967296}return h},r.toString=function(h){if(h=h||10,2>h||36<h)throw Error("radix out of range: "+h);if(I(this))return"0";if(S(this))return"-"+A(this).toString(h);for(var c=l(Math.pow(h,6)),v=this,b="";;){var B=k(v,c).g;v=d(v,B.j(c));var R=((0<v.g.length?v.g[0]:v.h)>>>0).toString(h);if(v=B,I(v))return R+b;for(;6>R.length;)R="0"+R;b=R+b}},r.i=function(h){return 0>h?0:h<this.g.length?this.g[h]:this.h};function I(h){if(h.h!=0)return!1;for(var c=0;c<h.g.length;c++)if(h.g[c]!=0)return!1;return!0}function S(h){return h.h==-1}r.l=function(h){return h=d(this,h),S(h)?-1:I(h)?0:1};function A(h){for(var c=h.g.length,v=[],b=0;b<c;b++)v[b]=~h.g[b];return new o(v,~h.h).add(y)}r.abs=function(){return S(this)?A(this):this},r.add=function(h){for(var c=Math.max(this.g.length,h.g.length),v=[],b=0,B=0;B<=c;B++){var R=b+(this.i(B)&65535)+(h.i(B)&65535),P=(R>>>16)+(this.i(B)>>>16)+(h.i(B)>>>16);b=P>>>16,R&=65535,P&=65535,v[B]=P<<16|R}return new o(v,v[v.length-1]&-2147483648?-1:0)};function d(h,c){return h.add(A(c))}r.j=function(h){if(I(this)||I(h))return w;if(S(this))return S(h)?A(this).j(A(h)):A(A(this).j(h));if(S(h))return A(this.j(A(h)));if(0>this.l(p)&&0>h.l(p))return l(this.m()*h.m());for(var c=this.g.length+h.g.length,v=[],b=0;b<2*c;b++)v[b]=0;for(b=0;b<this.g.length;b++)for(var B=0;B<h.g.length;B++){var R=this.i(b)>>>16,P=this.i(b)&65535,H=h.i(B)>>>16,z=h.i(B)&65535;v[2*b+2*B]+=P*z,T(v,2*b+2*B),v[2*b+2*B+1]+=R*z,T(v,2*b+2*B+1),v[2*b+2*B+1]+=P*H,T(v,2*b+2*B+1),v[2*b+2*B+2]+=R*H,T(v,2*b+2*B+2)}for(b=0;b<c;b++)v[b]=v[2*b+1]<<16|v[2*b];for(b=c;b<2*c;b++)v[b]=0;return new o(v,0)};function T(h,c){for(;(h[c]&65535)!=h[c];)h[c+1]+=h[c]>>>16,h[c]&=65535,c++}function x(h,c){this.g=h,this.h=c}function k(h,c){if(I(c))throw Error("division by zero");if(I(h))return new x(w,w);if(S(h))return c=k(A(h),c),new x(A(c.g),A(c.h));if(S(c))return c=k(h,A(c)),new x(A(c.g),c.h);if(30<h.g.length){if(S(h)||S(c))throw Error("slowDivide_ only works with positive integers.");for(var v=y,b=c;0>=b.l(h);)v=U(v),b=U(b);var B=_(v,1),R=_(b,1);for(b=_(b,2),v=_(v,2);!I(b);){var P=R.add(b);0>=P.l(h)&&(B=B.add(v),R=P),b=_(b,1),v=_(v,1)}return c=d(h,B.j(c)),new x(B,c)}for(B=w;0<=h.l(c);){for(v=Math.max(1,Math.floor(h.m()/c.m())),b=Math.ceil(Math.log(v)/Math.LN2),b=48>=b?1:Math.pow(2,b-48),R=l(v),P=R.j(c);S(P)||0<P.l(h);)v-=b,R=l(v),P=R.j(c);I(R)&&(R=y),B=B.add(R),h=d(h,P)}return new x(B,h)}r.A=function(h){return k(this,h).h},r.and=function(h){for(var c=Math.max(this.g.length,h.g.length),v=[],b=0;b<c;b++)v[b]=this.i(b)&h.i(b);return new o(v,this.h&h.h)},r.or=function(h){for(var c=Math.max(this.g.length,h.g.length),v=[],b=0;b<c;b++)v[b]=this.i(b)|h.i(b);return new o(v,this.h|h.h)},r.xor=function(h){for(var c=Math.max(this.g.length,h.g.length),v=[],b=0;b<c;b++)v[b]=this.i(b)^h.i(b);return new o(v,this.h^h.h)};function U(h){for(var c=h.g.length+1,v=[],b=0;b<c;b++)v[b]=h.i(b)<<1|h.i(b-1)>>>31;return new o(v,h.h)}function _(h,c){var v=c>>5;c%=32;for(var b=h.g.length-v,B=[],R=0;R<b;R++)B[R]=0<c?h.i(R+v)>>>c|h.i(R+v+1)<<32-c:h.i(R+v);return new o(B,h.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Zf=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=g,tn=o}).apply(typeof vl<"u"?vl:typeof self<"u"?self:typeof window<"u"?window:{});var ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ed,_i,td,ws,qo,rd,nd,id;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,E,N){return u==Array.prototype||u==Object.prototype||(u[E]=N.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof ps=="object"&&ps];for(var E=0;E<u.length;++E){var N=u[E];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var n=t(this);function i(u,E){if(E)e:{var N=n;u=u.split(".");for(var F=0;F<u.length-1;F++){var $=u[F];if(!($ in N))break e;N=N[$]}u=u[u.length-1],F=N[u],E=E(F),E!=F&&E!=null&&e(N,u,{configurable:!0,writable:!0,value:E})}}function s(u,E){u instanceof String&&(u+="");var N=0,F=!1,$={next:function(){if(!F&&N<u.length){var Q=N++;return{value:E(Q,u[Q]),done:!1}}return F=!0,{done:!0,value:void 0}}};return $[Symbol.iterator]=function(){return $},$}i("Array.prototype.values",function(u){return u||function(){return s(this,function(E,N){return N})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function f(u){var E=typeof u;return E=E!="object"?E:u?Array.isArray(u)?"array":E:"null",E=="array"||E=="object"&&typeof u.length=="number"}function l(u){var E=typeof u;return E=="object"&&u!=null||E=="function"}function g(u,E,N){return u.call.apply(u.bind,arguments)}function w(u,E,N){if(!u)throw Error();if(2<arguments.length){var F=Array.prototype.slice.call(arguments,2);return function(){var $=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply($,F),u.apply(E,$)}}return function(){return u.apply(E,arguments)}}function y(u,E,N){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:w,y.apply(null,arguments)}function p(u,E){var N=Array.prototype.slice.call(arguments,1);return function(){var F=N.slice();return F.push.apply(F,arguments),u.apply(this,F)}}function I(u,E){function N(){}N.prototype=E.prototype,u.aa=E.prototype,u.prototype=new N,u.prototype.constructor=u,u.Qb=function(F,$,Q){for(var se=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)se[ze-2]=arguments[ze];return E.prototype[$].apply(F,se)}}function S(u){const E=u.length;if(0<E){const N=Array(E);for(let F=0;F<E;F++)N[F]=u[F];return N}return[]}function A(u,E){for(let N=1;N<arguments.length;N++){const F=arguments[N];if(f(F)){const $=u.length||0,Q=F.length||0;u.length=$+Q;for(let se=0;se<Q;se++)u[$+se]=F[se]}else u.push(F)}}class d{constructor(E,N){this.i=E,this.j=N,this.h=0,this.g=null}get(){let E;return 0<this.h?(this.h--,E=this.g,this.g=E.next,E.next=null):E=this.i(),E}}function T(u){return/^[\s\xa0]*$/.test(u)}function x(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function k(u){return k[" "](u),u}k[" "]=function(){};var U=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function _(u,E,N){for(const F in u)E.call(N,u[F],F,u)}function h(u,E){for(const N in u)E.call(void 0,u[N],N,u)}function c(u){const E={};for(const N in u)E[N]=u[N];return E}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(u,E){let N,F;for(let $=1;$<arguments.length;$++){F=arguments[$];for(N in F)u[N]=F[N];for(let Q=0;Q<v.length;Q++)N=v[Q],Object.prototype.hasOwnProperty.call(F,N)&&(u[N]=F[N])}}function B(u){var E=1;u=u.split(":");const N=[];for(;0<E&&u.length;)N.push(u.shift()),E--;return u.length&&N.push(u.join(":")),N}function R(u){a.setTimeout(()=>{throw u},0)}function P(){var u=oe;let E=null;return u.g&&(E=u.g,u.g=u.g.next,u.g||(u.h=null),E.next=null),E}class H{constructor(){this.h=this.g=null}add(E,N){const F=z.get();F.set(E,N),this.h?this.h.next=F:this.g=F,this.h=F}}var z=new d(()=>new W,u=>u.reset());class W{constructor(){this.next=this.g=this.h=null}set(E,N){this.h=E,this.g=N,this.next=null}reset(){this.next=this.g=this.h=null}}let te,ne=!1,oe=new H,me=()=>{const u=a.Promise.resolve(void 0);te=()=>{u.then(Se)}};var Se=()=>{for(var u;u=P();){try{u.h.call(u.g)}catch(N){R(N)}var E=z;E.j(u),100>E.h&&(E.h++,u.next=E.g,E.g=u)}ne=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function we(u,E){this.type=u,this.g=this.target=E,this.defaultPrevented=!1}we.prototype.h=function(){this.defaultPrevented=!0};var ie=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,E=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const N=()=>{};a.addEventListener("test",N,E),a.removeEventListener("test",N,E)}catch{}return u}();function Te(u,E){if(we.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var N=this.type=u.type,F=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=E,E=u.relatedTarget){if(U){e:{try{k(E.nodeName);var $=!0;break e}catch{}$=!1}$||(E=null)}}else N=="mouseover"?E=u.fromElement:N=="mouseout"&&(E=u.toElement);this.relatedTarget=E,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:ae[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Te.aa.h.call(this)}}I(Te,we);var ae={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var ut="closure_listenable_"+(1e6*Math.random()|0),be=0;function C(u,E,N,F,$){this.listener=u,this.proxy=null,this.src=E,this.type=N,this.capture=!!F,this.ha=$,this.key=++be,this.da=this.fa=!1}function M(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function O(u){this.src=u,this.g={},this.h=0}O.prototype.add=function(u,E,N,F,$){var Q=u.toString();u=this.g[Q],u||(u=this.g[Q]=[],this.h++);var se=L(u,E,F,$);return-1<se?(E=u[se],N||(E.fa=!1)):(E=new C(E,this.src,Q,!!F,$),E.fa=N,u.push(E)),E};function m(u,E){var N=E.type;if(N in u.g){var F=u.g[N],$=Array.prototype.indexOf.call(F,E,void 0),Q;(Q=0<=$)&&Array.prototype.splice.call(F,$,1),Q&&(M(E),u.g[N].length==0&&(delete u.g[N],u.h--))}}function L(u,E,N,F){for(var $=0;$<u.length;++$){var Q=u[$];if(!Q.da&&Q.listener==E&&Q.capture==!!N&&Q.ha==F)return $}return-1}var j="closure_lm_"+(1e6*Math.random()|0),q={};function ee(u,E,N,F,$){if(Array.isArray(E)){for(var Q=0;Q<E.length;Q++)ee(u,E[Q],N,F,$);return null}return N=tt(N),u&&u[ut]?u.K(E,N,l(F)?!!F.capture:!!F,$):le(u,E,N,!1,F,$)}function le(u,E,N,F,$,Q){if(!E)throw Error("Invalid event type");var se=l($)?!!$.capture:!!$,ze=Ce(u);if(ze||(u[j]=ze=new O(u)),N=ze.add(E,N,F,se,Q),N.proxy)return N;if(F=ge(),N.proxy=F,F.src=u,F.listener=N,u.addEventListener)ie||($=se),$===void 0&&($=!1),u.addEventListener(E.toString(),F,$);else if(u.attachEvent)u.attachEvent(ve(E.toString()),F);else if(u.addListener&&u.removeListener)u.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return N}function ge(){function u(N){return E.call(u.src,u.listener,N)}const E=De;return u}function Y(u,E,N,F,$){if(Array.isArray(E))for(var Q=0;Q<E.length;Q++)Y(u,E[Q],N,F,$);else F=l(F)?!!F.capture:!!F,N=tt(N),u&&u[ut]?(u=u.i,E=String(E).toString(),E in u.g&&(Q=u.g[E],N=L(Q,N,F,$),-1<N&&(M(Q[N]),Array.prototype.splice.call(Q,N,1),Q.length==0&&(delete u.g[E],u.h--)))):u&&(u=Ce(u))&&(E=u.g[E.toString()],u=-1,E&&(u=L(E,N,F,$)),(N=-1<u?E[u]:null)&&ce(N))}function ce(u){if(typeof u!="number"&&u&&!u.da){var E=u.src;if(E&&E[ut])m(E.i,u);else{var N=u.type,F=u.proxy;E.removeEventListener?E.removeEventListener(N,F,u.capture):E.detachEvent?E.detachEvent(ve(N),F):E.addListener&&E.removeListener&&E.removeListener(F),(N=Ce(E))?(m(N,u),N.h==0&&(N.src=null,E[j]=null)):M(u)}}}function ve(u){return u in q?q[u]:q[u]="on"+u}function De(u,E){if(u.da)u=!0;else{E=new Te(E,this);var N=u.listener,F=u.ha||u.src;u.fa&&ce(u),u=N.call(F,E)}return u}function Ce(u){return u=u[j],u instanceof O?u:null}var $e="__closure_events_fn_"+(1e9*Math.random()>>>0);function tt(u){return typeof u=="function"?u:(u[$e]||(u[$e]=function(E){return u.handleEvent(E)}),u[$e])}function Pe(){xe.call(this),this.i=new O(this),this.M=this,this.F=null}I(Pe,xe),Pe.prototype[ut]=!0,Pe.prototype.removeEventListener=function(u,E,N,F){Y(this,u,E,N,F)};function Be(u,E){var N,F=u.F;if(F)for(N=[];F;F=F.F)N.push(F);if(u=u.M,F=E.type||E,typeof E=="string")E=new we(E,u);else if(E instanceof we)E.target=E.target||u;else{var $=E;E=new we(F,u),b(E,$)}if($=!0,N)for(var Q=N.length-1;0<=Q;Q--){var se=E.g=N[Q];$=Ge(se,F,!0,E)&&$}if(se=E.g=u,$=Ge(se,F,!0,E)&&$,$=Ge(se,F,!1,E)&&$,N)for(Q=0;Q<N.length;Q++)se=E.g=N[Q],$=Ge(se,F,!1,E)&&$}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var u=this.i,E;for(E in u.g){for(var N=u.g[E],F=0;F<N.length;F++)M(N[F]);delete u.g[E],u.h--}}this.F=null},Pe.prototype.K=function(u,E,N,F){return this.i.add(String(u),E,!1,N,F)},Pe.prototype.L=function(u,E,N,F){return this.i.add(String(u),E,!0,N,F)};function Ge(u,E,N,F){if(E=u.i.g[String(E)],!E)return!0;E=E.concat();for(var $=!0,Q=0;Q<E.length;++Q){var se=E[Q];if(se&&!se.da&&se.capture==N){var ze=se.listener,kt=se.ha||se.src;se.fa&&m(u.i,se),$=ze.call(kt,F)!==!1&&$}}return $&&!F.defaultPrevented}function We(u,E,N){if(typeof u=="function")N&&(u=y(u,N));else if(u&&typeof u.handleEvent=="function")u=y(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(E)?-1:a.setTimeout(u,E||0)}function rt(u){u.g=We(()=>{u.g=null,u.i&&(u.i=!1,rt(u))},u.l);const E=u.h;u.h=null,u.m.apply(null,E)}class Ct extends xe{constructor(E,N){super(),this.m=E,this.l=N,this.h=null,this.i=!1,this.g=null}j(E){this.h=arguments,this.g?this.i=!0:rt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nt(u){xe.call(this),this.h=u,this.g={}}I(nt,xe);var wt=[];function bt(u){_(u.g,function(E,N){this.g.hasOwnProperty(N)&&ce(E)},u),u.g={}}nt.prototype.N=function(){nt.aa.N.call(this),bt(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Pt=a.JSON.stringify,Gt=a.JSON.parse,Zt=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function zt(){}zt.prototype.h=null;function ar(u){return u.h||(u.h=u.i())}function cr(){}var er={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gr(){we.call(this,"d")}I(gr,we);function Sr(){we.call(this,"c")}I(Sr,we);var or={},ct=null;function it(){return ct=ct||new Pe}or.La="serverreachability";function lt(u){we.call(this,or.La,u)}I(lt,we);function Xe(u){const E=it();Be(E,new lt(E))}or.STAT_EVENT="statevent";function ht(u,E){we.call(this,or.STAT_EVENT,u),this.stat=E}I(ht,we);function Oe(u){const E=it();Be(E,new ht(E,u))}or.Ma="timingevent";function ft(u,E){we.call(this,or.Ma,u),this.size=E}I(ft,we);function Je(u,E){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},E)}function Ze(){this.g=!0}Ze.prototype.xa=function(){this.g=!1};function vt(u,E,N,F,$,Q){u.info(function(){if(u.g)if(Q)for(var se="",ze=Q.split("&"),kt=0;kt<ze.length;kt++){var Me=ze[kt].split("=");if(1<Me.length){var Ut=Me[0];Me=Me[1];var Mt=Ut.split("_");se=2<=Mt.length&&Mt[1]=="type"?se+(Ut+"="+Me+"&"):se+(Ut+"=redacted&")}}else se=null;else se=Q;return"XMLHTTP REQ ("+F+") [attempt "+$+"]: "+E+`
`+N+`
`+se})}function _t(u,E,N,F,$,Q,se){u.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+$+"]: "+E+`
`+N+`
`+Q+" "+se})}function Qe(u,E,N,F){u.info(function(){return"XMLHTTP TEXT ("+E+"): "+dt(u,N)+(F?" "+F:"")})}function et(u,E){u.info(function(){return"TIMEOUT: "+E})}Ze.prototype.info=function(){};function dt(u,E){if(!u.g)return E;if(!E)return null;try{var N=JSON.parse(E);if(N){for(u=0;u<N.length;u++)if(Array.isArray(N[u])){var F=N[u];if(!(2>F.length)){var $=F[1];if(Array.isArray($)&&!(1>$.length)){var Q=$[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var se=1;se<$.length;se++)$[se]=""}}}}return Pt(N)}catch{return E}}var st={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},pt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},oi;function bn(){}I(bn,zt),bn.prototype.g=function(){return new XMLHttpRequest},bn.prototype.i=function(){return{}},oi=new bn;function mr(u,E,N,F){this.j=u,this.i=E,this.l=N,this.R=F||1,this.U=new nt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ar}function Ar(){this.i=null,this.g="",this.h=!1}var es={},ui={};function ci(u,E,N){u.L=1,u.v=tr(It(E)),u.m=N,u.P=!0,ts(u,null)}function ts(u,E){u.F=Date.now(),Rn(u),u.A=It(u.v);var N=u.A,F=u.R;Array.isArray(F)||(F=[String(F)]),Tc(N.i,"t",F),u.C=0,N=u.j.J,u.h=new Ar,u.g=Mc(u.j,N?E:null,!u.m),0<u.O&&(u.M=new Ct(y(u.Y,u,u.g),u.O)),E=u.U,N=u.g,F=u.ca;var $="readystatechange";Array.isArray($)||($&&(wt[0]=$.toString()),$=wt);for(var Q=0;Q<$.length;Q++){var se=ee(N,$[Q],F||E.handleEvent,!1,E.h||E);if(!se)break;E.g[se.key]=se}E=u.H?c(u.H):{},u.m?(u.u||(u.u="POST"),E["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,E)):(u.u="GET",u.g.ea(u.A,u.u,null,E)),Xe(),vt(u.i,u.u,u.A,u.l,u.R,u.m)}mr.prototype.ca=function(u){u=u.target;const E=this.M;E&&Rr(u)==3?E.j():this.Y(u)},mr.prototype.Y=function(u){try{if(u==this.g)e:{const Mt=Rr(this.g);var E=this.g.Ba();const Bn=this.g.Z();if(!(3>Mt)&&(Mt!=3||this.g&&(this.h.h||this.g.oa()||bc(this.g)))){this.J||Mt!=4||E==7||(E==8||0>=Bn?Xe(3):Xe(2)),li(this);var N=this.g.Z();this.X=N;t:if(rs(this)){var F=bc(this.g);u="";var $=F.length,Q=Rr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){xr(this),Bt(this);var se="";break t}this.h.i=new a.TextDecoder}for(E=0;E<$;E++)this.h.h=!0,u+=this.h.i.decode(F[E],{stream:!(Q&&E==$-1)});F.length=0,this.h.g+=u,this.C=0,se=this.h.g}else se=this.g.oa();if(this.o=N==200,_t(this.i,this.u,this.A,this.l,this.R,Mt,N),this.o){if(this.T&&!this.K){t:{if(this.g){var ze,kt=this.g;if((ze=kt.g?kt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(ze)){var Me=ze;break t}}Me=null}if(N=Me)Qe(this.i,this.l,N,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hi(this,N);else{this.o=!1,this.s=3,Oe(12),xr(this),Bt(this);break e}}if(this.P){N=!0;let lr;for(;!this.J&&this.C<se.length;)if(lr=ba(this,se),lr==ui){Mt==4&&(this.s=4,Oe(14),N=!1),Qe(this.i,this.l,null,"[Incomplete Response]");break}else if(lr==es){this.s=4,Oe(15),Qe(this.i,this.l,se,"[Invalid Chunk]"),N=!1;break}else Qe(this.i,this.l,lr,null),hi(this,lr);if(rs(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Mt!=4||se.length!=0||this.h.h||(this.s=1,Oe(16),N=!1),this.o=this.o&&N,!N)Qe(this.i,this.l,se,"[Invalid Chunked Response]"),xr(this),Bt(this);else if(0<se.length&&!this.W){this.W=!0;var Ut=this.j;Ut.g==this&&Ut.ba&&!Ut.M&&(Ut.j.info("Great, no buffering proxy detected. Bytes received: "+se.length),ka(Ut),Ut.M=!0,Oe(11))}}else Qe(this.i,this.l,se,null),hi(this,se);Mt==4&&xr(this),this.o&&!this.J&&(Mt==4?Lc(this.j,this):(this.o=!1,Rn(this)))}else m0(this.g),N==400&&0<se.indexOf("Unknown SID")?(this.s=3,Oe(12)):(this.s=0,Oe(13)),xr(this),Bt(this)}}}catch{}finally{}};function rs(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function ba(u,E){var N=u.C,F=E.indexOf(`
`,N);return F==-1?ui:(N=Number(E.substring(N,F)),isNaN(N)?es:(F+=1,F+N>E.length?ui:(E=E.slice(F,F+N),u.C=F+N,E)))}mr.prototype.cancel=function(){this.J=!0,xr(this)};function Rn(u){u.S=Date.now()+u.I,ns(u,u.I)}function ns(u,E){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Je(y(u.ba,u),E)}function li(u){u.B&&(a.clearTimeout(u.B),u.B=null)}mr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(et(this.i,this.A),this.L!=2&&(Xe(),Oe(17)),xr(this),this.s=2,Bt(this)):ns(this,this.S-u)};function Bt(u){u.j.G==0||u.J||Lc(u.j,u)}function xr(u){li(u);var E=u.M;E&&typeof E.ma=="function"&&E.ma(),u.M=null,bt(u.U),u.g&&(E=u.g,u.g=null,E.abort(),E.ma())}function hi(u,E){try{var N=u.j;if(N.G!=0&&(N.g==u||K(N.h,u))){if(!u.K&&K(N.h,u)&&N.G==3){try{var F=N.Da.g.parse(E)}catch{F=null}if(Array.isArray(F)&&F.length==3){var $=F;if($[0]==0){e:if(!N.u){if(N.g)if(N.g.F+3e3<u.F)ls(N),us(N);else break e;Ba(N),Oe(18)}}else N.za=$[1],0<N.za-N.T&&37500>$[2]&&N.F&&N.v==0&&!N.C&&(N.C=Je(y(N.Za,N),6e3));if(1>=V(N.h)&&N.ca){try{N.ca()}catch{}N.ca=void 0}}else pn(N,11)}else if((u.K||N.g==u)&&ls(N),!T(E))for($=N.Da.g.parse(E),E=0;E<$.length;E++){let Me=$[E];if(N.T=Me[0],Me=Me[1],N.G==2)if(Me[0]=="c"){N.K=Me[1],N.ia=Me[2];const Ut=Me[3];Ut!=null&&(N.la=Ut,N.j.info("VER="+N.la));const Mt=Me[4];Mt!=null&&(N.Aa=Mt,N.j.info("SVER="+N.Aa));const Bn=Me[5];Bn!=null&&typeof Bn=="number"&&0<Bn&&(F=1.5*Bn,N.L=F,N.j.info("backChannelRequestTimeoutMs_="+F)),F=N;const lr=u.g;if(lr){const fs=lr.g?lr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fs){var Q=F.h;Q.g||fs.indexOf("spdy")==-1&&fs.indexOf("quic")==-1&&fs.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(G(Q,Q.h),Q.h=null))}if(F.D){const Da=lr.g?lr.g.getResponseHeader("X-HTTP-Session-Id"):null;Da&&(F.ya=Da,je(F.I,F.D,Da))}}N.G=3,N.l&&N.l.ua(),N.ba&&(N.R=Date.now()-u.F,N.j.info("Handshake RTT: "+N.R+"ms")),F=N;var se=u;if(F.qa=Uc(F,F.J?F.ia:null,F.W),se.K){J(F.h,se);var ze=se,kt=F.L;kt&&(ze.I=kt),ze.B&&(li(ze),Rn(ze)),F.g=se}else kc(F);0<N.i.length&&cs(N)}else Me[0]!="stop"&&Me[0]!="close"||pn(N,7);else N.G==3&&(Me[0]=="stop"||Me[0]=="close"?Me[0]=="stop"?pn(N,7):Pa(N):Me[0]!="noop"&&N.l&&N.l.ta(Me),N.v=0)}}Xe(4)}catch{}}var Ra=class{constructor(u,E){this.g=u,this.map=E}};function is(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function D(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function V(u){return u.h?1:u.g?u.g.size:0}function K(u,E){return u.h?u.h==E:u.g?u.g.has(E):!1}function G(u,E){u.g?u.g.add(E):u.h=E}function J(u,E){u.h&&u.h==E?u.h=null:u.g&&u.g.has(E)&&u.g.delete(E)}is.prototype.cancel=function(){if(this.i=re(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function re(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let E=u.i;for(const N of u.g.values())E=E.concat(N.D);return E}return S(u.i)}function he(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(f(u)){for(var E=[],N=u.length,F=0;F<N;F++)E.push(u[F]);return E}E=[],N=0;for(F in u)E[N++]=u[F];return E}function ue(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(f(u)||typeof u=="string"){var E=[];u=u.length;for(var N=0;N<u;N++)E.push(N);return E}E=[],N=0;for(const F in u)E[N++]=F;return E}}}function qe(u,E){if(u.forEach&&typeof u.forEach=="function")u.forEach(E,void 0);else if(f(u)||typeof u=="string")Array.prototype.forEach.call(u,E,void 0);else for(var N=ue(u),F=he(u),$=F.length,Q=0;Q<$;Q++)E.call(void 0,F[Q],N&&N[Q],u)}var gt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $t(u,E){if(u){u=u.split("&");for(var N=0;N<u.length;N++){var F=u[N].indexOf("="),$=null;if(0<=F){var Q=u[N].substring(0,F);$=u[N].substring(F+1)}else Q=u[N];E(Q,$?decodeURIComponent($.replace(/\+/g," ")):"")}}}function mt(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof mt){this.h=u.h,wr(this,u.j),this.o=u.o,this.g=u.g,Ot(this,u.s),this.l=u.l;var E=u.i,N=new di;N.i=E.i,E.g&&(N.g=new Map(E.g),N.h=E.h),Wt(this,N),this.m=u.m}else u&&(E=String(u).match(gt))?(this.h=!1,wr(this,E[1]||"",!0),this.o=br(E[2]||""),this.g=br(E[3]||"",!0),Ot(this,E[4]),this.l=br(E[5]||"",!0),Wt(this,E[6]||"",!0),this.m=br(E[7]||"")):(this.h=!1,this.i=new di(null,this.h))}mt.prototype.toString=function(){var u=[],E=this.j;E&&u.push(fi(E,vc,!0),":");var N=this.g;return(N||E=="file")&&(u.push("//"),(E=this.o)&&u.push(fi(E,vc,!0),"@"),u.push(encodeURIComponent(String(N)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),N=this.s,N!=null&&u.push(":",String(N))),(N=this.l)&&(this.g&&N.charAt(0)!="/"&&u.push("/"),u.push(fi(N,N.charAt(0)=="/"?a0:s0,!0))),(N=this.i.toString())&&u.push("?",N),(N=this.m)&&u.push("#",fi(N,u0)),u.join("")};function It(u){return new mt(u)}function wr(u,E,N){u.j=N?br(E,!0):E,u.j&&(u.j=u.j.replace(/:$/,""))}function Ot(u,E){if(E){if(E=Number(E),isNaN(E)||0>E)throw Error("Bad port number "+E);u.s=E}else u.s=null}function Wt(u,E,N){E instanceof di?(u.i=E,c0(u.i,u.h)):(N||(E=fi(E,o0)),u.i=new di(E,u.h))}function je(u,E,N){u.i.set(E,N)}function tr(u){return je(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function br(u,E){return u?E?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function fi(u,E,N){return typeof u=="string"?(u=encodeURI(u).replace(E,i0),N&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function i0(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var vc=/[#\/\?@]/g,s0=/[#\?:]/g,a0=/[#\?]/g,o0=/[#\?@]/g,u0=/#/g;function di(u,E){this.h=this.g=null,this.i=u||null,this.j=!!E}function jr(u){u.g||(u.g=new Map,u.h=0,u.i&&$t(u.i,function(E,N){u.add(decodeURIComponent(E.replace(/\+/g," ")),N)}))}r=di.prototype,r.add=function(u,E){jr(this),this.i=null,u=Nn(this,u);var N=this.g.get(u);return N||this.g.set(u,N=[]),N.push(E),this.h+=1,this};function _c(u,E){jr(u),E=Nn(u,E),u.g.has(E)&&(u.i=null,u.h-=u.g.get(E).length,u.g.delete(E))}function Ec(u,E){return jr(u),E=Nn(u,E),u.g.has(E)}r.forEach=function(u,E){jr(this),this.g.forEach(function(N,F){N.forEach(function($){u.call(E,$,F,this)},this)},this)},r.na=function(){jr(this);const u=Array.from(this.g.values()),E=Array.from(this.g.keys()),N=[];for(let F=0;F<E.length;F++){const $=u[F];for(let Q=0;Q<$.length;Q++)N.push(E[F])}return N},r.V=function(u){jr(this);let E=[];if(typeof u=="string")Ec(this,u)&&(E=E.concat(this.g.get(Nn(this,u))));else{u=Array.from(this.g.values());for(let N=0;N<u.length;N++)E=E.concat(u[N])}return E},r.set=function(u,E){return jr(this),this.i=null,u=Nn(this,u),Ec(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[E]),this.h+=1,this},r.get=function(u,E){return u?(u=this.V(u),0<u.length?String(u[0]):E):E};function Tc(u,E,N){_c(u,E),0<N.length&&(u.i=null,u.g.set(Nn(u,E),S(N)),u.h+=N.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],E=Array.from(this.g.keys());for(var N=0;N<E.length;N++){var F=E[N];const Q=encodeURIComponent(String(F)),se=this.V(F);for(F=0;F<se.length;F++){var $=Q;se[F]!==""&&($+="="+encodeURIComponent(String(se[F]))),u.push($)}}return this.i=u.join("&")};function Nn(u,E){return E=String(E),u.j&&(E=E.toLowerCase()),E}function c0(u,E){E&&!u.j&&(jr(u),u.i=null,u.g.forEach(function(N,F){var $=F.toLowerCase();F!=$&&(_c(this,F),Tc(this,$,N))},u)),u.j=E}function l0(u,E){const N=new Ze;if(a.Image){const F=new Image;F.onload=p(Hr,N,"TestLoadImage: loaded",!0,E,F),F.onerror=p(Hr,N,"TestLoadImage: error",!1,E,F),F.onabort=p(Hr,N,"TestLoadImage: abort",!1,E,F),F.ontimeout=p(Hr,N,"TestLoadImage: timeout",!1,E,F),a.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=u}else E(!1)}function h0(u,E){const N=new Ze,F=new AbortController,$=setTimeout(()=>{F.abort(),Hr(N,"TestPingServer: timeout",!1,E)},1e4);fetch(u,{signal:F.signal}).then(Q=>{clearTimeout($),Q.ok?Hr(N,"TestPingServer: ok",!0,E):Hr(N,"TestPingServer: server error",!1,E)}).catch(()=>{clearTimeout($),Hr(N,"TestPingServer: error",!1,E)})}function Hr(u,E,N,F,$){try{$&&($.onload=null,$.onerror=null,$.onabort=null,$.ontimeout=null),F(N)}catch{}}function f0(){this.g=new Zt}function d0(u,E,N){const F=N||"";try{qe(u,function($,Q){let se=$;l($)&&(se=Pt($)),E.push(F+Q+"="+encodeURIComponent(se))})}catch($){throw E.push(F+"type="+encodeURIComponent("_badmap")),$}}function ss(u){this.l=u.Ub||null,this.j=u.eb||!1}I(ss,zt),ss.prototype.g=function(){return new as(this.l,this.j)},ss.prototype.i=function(u){return function(){return u}}({});function as(u,E){Pe.call(this),this.D=u,this.o=E,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(as,Pe),r=as.prototype,r.open=function(u,E){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=E,this.readyState=1,gi(this)},r.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const E={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(E.body=u),(this.D||a).fetch(new Request(this.A,E)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pi(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,gi(this)),this.g&&(this.readyState=3,gi(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Cc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Cc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var E=u.value?u.value:new Uint8Array(0);(E=this.v.decode(E,{stream:!u.done}))&&(this.response=this.responseText+=E)}u.done?pi(this):gi(this),this.readyState==3&&Cc(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,pi(this))},r.Qa=function(u){this.g&&(this.response=u,pi(this))},r.ga=function(){this.g&&pi(this)};function pi(u){u.readyState=4,u.l=null,u.j=null,u.v=null,gi(u)}r.setRequestHeader=function(u,E){this.u.append(u,E)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],E=this.h.entries();for(var N=E.next();!N.done;)N=N.value,u.push(N[0]+": "+N[1]),N=E.next();return u.join(`\r
`)};function gi(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(as.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ic(u){let E="";return _(u,function(N,F){E+=F,E+=":",E+=N,E+=`\r
`}),E}function Na(u,E,N){e:{for(F in N){var F=!1;break e}F=!0}F||(N=Ic(N),typeof u=="string"?N!=null&&encodeURIComponent(String(N)):je(u,E,N))}function ot(u){Pe.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(ot,Pe);var p0=/^https?$/i,g0=["POST","PUT"];r=ot.prototype,r.Ha=function(u){this.J=u},r.ea=function(u,E,N,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);E=E?E.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():oi.g(),this.v=this.o?ar(this.o):ar(oi),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(E,String(u),!0),this.B=!1}catch(Q){Sc(this,Q);return}if(u=N||"",N=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var $ in F)N.set($,F[$]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const Q of F.keys())N.set(Q,F.get(Q));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from(N.keys()).find(Q=>Q.toLowerCase()=="content-type"),$=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(g0,E,void 0))||F||$||N.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,se]of N)this.g.setRequestHeader(Q,se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{wc(this),this.u=!0,this.g.send(u),this.u=!1}catch(Q){Sc(this,Q)}};function Sc(u,E){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=E,u.m=5,Ac(u),os(u)}function Ac(u){u.A||(u.A=!0,Be(u,"complete"),Be(u,"error"))}r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Be(this,"complete"),Be(this,"abort"),os(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),os(this,!0)),ot.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?xc(this):this.bb())},r.bb=function(){xc(this)};function xc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Rr(u)!=4||u.Z()!=2)){if(u.u&&Rr(u)==4)We(u.Ea,0,u);else if(Be(u,"readystatechange"),Rr(u)==4){u.h=!1;try{const se=u.Z();e:switch(se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var E=!0;break e;default:E=!1}var N;if(!(N=E)){var F;if(F=se===0){var $=String(u.D).match(gt)[1]||null;!$&&a.self&&a.self.location&&($=a.self.location.protocol.slice(0,-1)),F=!p0.test($?$.toLowerCase():"")}N=F}if(N)Be(u,"complete"),Be(u,"success");else{u.m=6;try{var Q=2<Rr(u)?u.g.statusText:""}catch{Q=""}u.l=Q+" ["+u.Z()+"]",Ac(u)}}finally{os(u)}}}}function os(u,E){if(u.g){wc(u);const N=u.g,F=u.v[0]?()=>{}:null;u.g=null,u.v=null,E||Be(u,"ready");try{N.onreadystatechange=F}catch{}}}function wc(u){u.I&&(a.clearTimeout(u.I),u.I=null)}r.isActive=function(){return!!this.g};function Rr(u){return u.g?u.g.readyState:0}r.Z=function(){try{return 2<Rr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var E=this.g.responseText;return u&&E.indexOf(u)==0&&(E=E.substring(u.length)),Gt(E)}};function bc(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function m0(u){const E={};u=(u.g&&2<=Rr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<u.length;F++){if(T(u[F]))continue;var N=B(u[F]);const $=N[0];if(N=N[1],typeof N!="string")continue;N=N.trim();const Q=E[$]||[];E[$]=Q,Q.push(N)}h(E,function(F){return F.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function mi(u,E,N){return N&&N.internalChannelParams&&N.internalChannelParams[u]||E}function Rc(u){this.Aa=0,this.i=[],this.j=new Ze,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=mi("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=mi("baseRetryDelayMs",5e3,u),this.cb=mi("retryDelaySeedMs",1e4,u),this.Wa=mi("forwardChannelMaxRetries",2,u),this.wa=mi("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new is(u&&u.concurrentRequestLimit),this.Da=new f0,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Rc.prototype,r.la=8,r.G=1,r.connect=function(u,E,N,F){Oe(0),this.W=u,this.H=E||{},N&&F!==void 0&&(this.H.OSID=N,this.H.OAID=F),this.F=this.X,this.I=Uc(this,null,this.W),cs(this)};function Pa(u){if(Nc(u),u.G==3){var E=u.U++,N=It(u.I);if(je(N,"SID",u.K),je(N,"RID",E),je(N,"TYPE","terminate"),yi(u,N),E=new mr(u,u.j,E),E.L=2,E.v=tr(It(N)),N=!1,a.navigator&&a.navigator.sendBeacon)try{N=a.navigator.sendBeacon(E.v.toString(),"")}catch{}!N&&a.Image&&(new Image().src=E.v,N=!0),N||(E.g=Mc(E.j,null),E.g.ea(E.v)),E.F=Date.now(),Rn(E)}Oc(u)}function us(u){u.g&&(ka(u),u.g.cancel(),u.g=null)}function Nc(u){us(u),u.u&&(a.clearTimeout(u.u),u.u=null),ls(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function cs(u){if(!D(u.h)&&!u.s){u.s=!0;var E=u.Ga;te||me(),ne||(te(),ne=!0),oe.add(E,u),u.B=0}}function y0(u,E){return V(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=E.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Je(y(u.Ga,u,E),Vc(u,u.B)),u.B++,!0)}r.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const $=new mr(this,this.j,u);let Q=this.o;if(this.S&&(Q?(Q=c(Q),b(Q,this.S)):Q=this.S),this.m!==null||this.O||($.H=Q,Q=null),this.P)e:{for(var E=0,N=0;N<this.i.length;N++){t:{var F=this.i[N];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(E+=F,4096<E){E=N;break e}if(E===4096||N===this.i.length-1){E=N+1;break e}}E=1e3}else E=1e3;E=Bc(this,$,E),N=It(this.I),je(N,"RID",u),je(N,"CVER",22),this.D&&je(N,"X-HTTP-Session-Id",this.D),yi(this,N),Q&&(this.O?E="headers="+encodeURIComponent(String(Ic(Q)))+"&"+E:this.m&&Na(N,this.m,Q)),G(this.h,$),this.Ua&&je(N,"TYPE","init"),this.P?(je(N,"$req",E),je(N,"SID","null"),$.T=!0,ci($,N,null)):ci($,N,E),this.G=2}}else this.G==3&&(u?Pc(this,u):this.i.length==0||D(this.h)||Pc(this))};function Pc(u,E){var N;E?N=E.l:N=u.U++;const F=It(u.I);je(F,"SID",u.K),je(F,"RID",N),je(F,"AID",u.T),yi(u,F),u.m&&u.o&&Na(F,u.m,u.o),N=new mr(u,u.j,N,u.B+1),u.m===null&&(N.H=u.o),E&&(u.i=E.D.concat(u.i)),E=Bc(u,N,1e3),N.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),G(u.h,N),ci(N,F,E)}function yi(u,E){u.H&&_(u.H,function(N,F){je(E,F,N)}),u.l&&qe({},function(N,F){je(E,F,N)})}function Bc(u,E,N){N=Math.min(u.i.length,N);var F=u.l?y(u.l.Na,u.l,u):null;e:{var $=u.i;let Q=-1;for(;;){const se=["count="+N];Q==-1?0<N?(Q=$[0].g,se.push("ofs="+Q)):Q=0:se.push("ofs="+Q);let ze=!0;for(let kt=0;kt<N;kt++){let Me=$[kt].g;const Ut=$[kt].map;if(Me-=Q,0>Me)Q=Math.max(0,$[kt].g-100),ze=!1;else try{d0(Ut,se,"req"+Me+"_")}catch{F&&F(Ut)}}if(ze){F=se.join("&");break e}}}return u=u.i.splice(0,N),E.D=u,F}function kc(u){if(!u.g&&!u.u){u.Y=1;var E=u.Fa;te||me(),ne||(te(),ne=!0),oe.add(E,u),u.v=0}}function Ba(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Je(y(u.Fa,u),Vc(u,u.v)),u.v++,!0)}r.Fa=function(){if(this.u=null,Dc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Je(y(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Oe(10),us(this),Dc(this))};function ka(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Dc(u){u.g=new mr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var E=It(u.qa);je(E,"RID","rpc"),je(E,"SID",u.K),je(E,"AID",u.T),je(E,"CI",u.F?"0":"1"),!u.F&&u.ja&&je(E,"TO",u.ja),je(E,"TYPE","xmlhttp"),yi(u,E),u.m&&u.o&&Na(E,u.m,u.o),u.L&&(u.g.I=u.L);var N=u.g;u=u.ia,N.L=1,N.v=tr(It(E)),N.m=null,N.P=!0,ts(N,u)}r.Za=function(){this.C!=null&&(this.C=null,us(this),Ba(this),Oe(19))};function ls(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function Lc(u,E){var N=null;if(u.g==E){ls(u),ka(u),u.g=null;var F=2}else if(K(u.h,E))N=E.D,J(u.h,E),F=1;else return;if(u.G!=0){if(E.o)if(F==1){N=E.m?E.m.length:0,E=Date.now()-E.F;var $=u.B;F=it(),Be(F,new ft(F,N)),cs(u)}else kc(u);else if($=E.s,$==3||$==0&&0<E.X||!(F==1&&y0(u,E)||F==2&&Ba(u)))switch(N&&0<N.length&&(E=u.h,E.i=E.i.concat(N)),$){case 1:pn(u,5);break;case 4:pn(u,10);break;case 3:pn(u,6);break;default:pn(u,2)}}}function Vc(u,E){let N=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(N*=2),N*E}function pn(u,E){if(u.j.info("Error code "+E),E==2){var N=y(u.fb,u),F=u.Xa;const $=!F;F=new mt(F||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||wr(F,"https"),tr(F),$?l0(F.toString(),N):h0(F.toString(),N)}else Oe(2);u.G=0,u.l&&u.l.sa(E),Oc(u),Nc(u)}r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Oe(2)):(this.j.info("Failed to ping google.com"),Oe(1))};function Oc(u){if(u.G=0,u.ka=[],u.l){const E=re(u.h);(E.length!=0||u.i.length!=0)&&(A(u.ka,E),A(u.ka,u.i),u.h.i.length=0,S(u.i),u.i.length=0),u.l.ra()}}function Uc(u,E,N){var F=N instanceof mt?It(N):new mt(N);if(F.g!="")E&&(F.g=E+"."+F.g),Ot(F,F.s);else{var $=a.location;F=$.protocol,E=E?E+"."+$.hostname:$.hostname,$=+$.port;var Q=new mt(null);F&&wr(Q,F),E&&(Q.g=E),$&&Ot(Q,$),N&&(Q.l=N),F=Q}return N=u.D,E=u.ya,N&&E&&je(F,N,E),je(F,"VER",u.la),yi(u,F),F}function Mc(u,E,N){if(E&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return E=u.Ca&&!u.pa?new ot(new ss({eb:N})):new ot(u.pa),E.Ha(u.J),E}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Fc(){}r=Fc.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function hs(){}hs.prototype.g=function(u,E){return new rr(u,E)};function rr(u,E){Pe.call(this),this.g=new Rc(E),this.l=u,this.h=E&&E.messageUrlParams||null,u=E&&E.messageHeaders||null,E&&E.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=E&&E.initMessageHeaders||null,E&&E.messageContentType&&(u?u["X-WebChannel-Content-Type"]=E.messageContentType:u={"X-WebChannel-Content-Type":E.messageContentType}),E&&E.va&&(u?u["X-WebChannel-Client-Profile"]=E.va:u={"X-WebChannel-Client-Profile":E.va}),this.g.S=u,(u=E&&E.Sb)&&!T(u)&&(this.g.m=u),this.v=E&&E.supportsCrossDomainXhr||!1,this.u=E&&E.sendRawJson||!1,(E=E&&E.httpSessionIdParam)&&!T(E)&&(this.g.D=E,u=this.h,u!==null&&E in u&&(u=this.h,E in u&&delete u[E])),this.j=new Pn(this)}I(rr,Pe),rr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},rr.prototype.close=function(){Pa(this.g)},rr.prototype.o=function(u){var E=this.g;if(typeof u=="string"){var N={};N.__data__=u,u=N}else this.u&&(N={},N.__data__=Pt(u),u=N);E.i.push(new Ra(E.Ya++,u)),E.G==3&&cs(E)},rr.prototype.N=function(){this.g.l=null,delete this.j,Pa(this.g),delete this.g,rr.aa.N.call(this)};function Kc(u){gr.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var E=u.__sm__;if(E){e:{for(const N in E){u=N;break e}u=void 0}(this.i=u)&&(u=this.i,E=E!==null&&u in E?E[u]:void 0),this.data=E}else this.data=u}I(Kc,gr);function qc(){Sr.call(this),this.status=1}I(qc,Sr);function Pn(u){this.g=u}I(Pn,Fc),Pn.prototype.ua=function(){Be(this.g,"a")},Pn.prototype.ta=function(u){Be(this.g,new Kc(u))},Pn.prototype.sa=function(u){Be(this.g,new qc)},Pn.prototype.ra=function(){Be(this.g,"b")},hs.prototype.createWebChannel=hs.prototype.g,rr.prototype.send=rr.prototype.o,rr.prototype.open=rr.prototype.m,rr.prototype.close=rr.prototype.close,id=function(){return new hs},nd=function(){return it()},rd=or,qo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},st.NO_ERROR=0,st.TIMEOUT=8,st.HTTP_ERROR=6,ws=st,pt.COMPLETE="complete",td=pt,cr.EventType=er,er.OPEN="a",er.CLOSE="b",er.ERROR="c",er.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,_i=cr,ot.prototype.listenOnce=ot.prototype.L,ot.prototype.getLastError=ot.prototype.Ka,ot.prototype.getLastErrorCode=ot.prototype.Ba,ot.prototype.getStatus=ot.prototype.Z,ot.prototype.getResponseJson=ot.prototype.Oa,ot.prototype.getResponseText=ot.prototype.oa,ot.prototype.send=ot.prototype.ea,ot.prototype.setWithCredentials=ot.prototype.Ha,ed=ot}).apply(typeof ps<"u"?ps:typeof self<"u"?self:typeof window<"u"?window:{});const _l="@firebase/firestore",El="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Kt.UNAUTHENTICATED=new Kt(null),Kt.GOOGLE_CREDENTIALS=new Kt("google-credentials-uid"),Kt.FIRST_PARTY=new Kt("first-party-uid"),Kt.MOCK_USER=new Kt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ei="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cn=new cu("@firebase/firestore");function kn(){return Cn.logLevel}function pe(r,...e){if(Cn.logLevel<=Le.DEBUG){const t=e.map(Iu);Cn.debug(`Firestore (${ei}): ${r}`,...t)}}function Ur(r,...e){if(Cn.logLevel<=Le.ERROR){const t=e.map(Iu);Cn.error(`Firestore (${ei}): ${r}`,...t)}}function jn(r,...e){if(Cn.logLevel<=Le.WARN){const t=e.map(Iu);Cn.warn(`Firestore (${ei}): ${r}`,...t)}}function Iu(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _e(r="Unexpected state"){const e=`FIRESTORE (${ei}) INTERNAL ASSERTION FAILED: `+r;throw Ur(e),new Error(e)}function He(r,e){r||_e()}function Ae(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class de extends Kr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Kt.UNAUTHENTICATED))}shutdown(){}}class sv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class av{constructor(e){this.t=e,this.currentUser=Kt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){He(this.o===void 0);let n=this.i;const i=f=>this.i!==n?(n=this.i,t(f)):Promise.resolve();let s=new Lr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Lr,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const f=s;e.enqueueRetryable(async()=>{await f.promise,await i(this.currentUser)})},a=f=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(f=>a(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?a(f):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Lr)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(He(typeof n.accessToken=="string"),new sd(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return He(e===null||typeof e=="string"),new Kt(e)}}class ov{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Kt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class uv{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ov(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Kt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Tl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class cv{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,hr(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){He(this.o===void 0);const n=s=>{s.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Tl(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(He(typeof t.token=="string"),this.R=t.token,new Tl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lv(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=lv(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}}function Re(r,e){return r<e?-1:r>e?1:0}function jo(r,e){let t=0;for(;t<r.length&&t<e.length;){const n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return Re(n,i);{const s=ad(),o=hv(s.encode(Cl(r,t)),s.encode(Cl(e,t)));return o!==0?o:Re(n,i)}}t+=n>65535?2:1}return Re(r.length,e.length)}function Cl(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function hv(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return Re(r[t],e[t]);return Re(r.length,e.length)}function Hn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il=-62135596800,Sl=1e6;class St{static now(){return St.fromMillis(Date.now())}static fromDate(e){return St.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Sl);return new St(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new de(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new de(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Il)throw new de(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new de(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Sl}_compareTo(e){return this.seconds===e.seconds?Re(this.nanoseconds,e.nanoseconds):Re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Il;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{static fromTimestamp(e){return new Ie(e)}static min(){return new Ie(new St(0,0))}static max(){return new Ie(new St(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Al="__name__";class yr{constructor(e,t,n){t===void 0?t=0:t>e.length&&_e(),n===void 0?n=e.length-t:n>e.length-t&&_e(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return yr.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yr?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=yr.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return Re(e.length,t.length)}static compareSegments(e,t){const n=yr.isNumericId(e),i=yr.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?yr.extractNumericId(e).compare(yr.extractNumericId(t)):jo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return tn.fromString(e.substring(4,e.length-2))}}class Ye extends yr{construct(e,t,n){return new Ye(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new de(X.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new Ye(t)}static emptyPath(){return new Ye([])}}const fv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Lt extends yr{construct(e,t,n){return new Lt(e,t,n)}static isValidIdentifier(e){return fv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Lt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Al}static keyField(){return new Lt([Al])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(n.length===0)throw new de(X.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new de(X.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new de(X.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=f,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(n+=a,i++):(s(),i++)}if(s(),o)throw new de(X.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Lt(t)}static emptyPath(){return new Lt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.path=e}static fromPath(e){return new ye(Ye.fromString(e))}static fromName(e){return new ye(Ye.fromString(e).popFirst(5))}static empty(){return new ye(Ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ye(new Ye(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pi=-1;function dv(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=Ie.fromTimestamp(n===1e9?new St(t+1,0):new St(t,n));return new sn(i,ye.empty(),e)}function pv(r){return new sn(r.readTime,r.key,Pi)}class sn{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new sn(Ie.min(),ye.empty(),Pi)}static max(){return new sn(Ie.max(),ye.empty(),Pi)}}function gv(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=ye.comparator(r.documentKey,e.documentKey),t!==0?t:Re(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ti(r){if(r.code!==X.FAILED_PRECONDITION||r.message!==mv)throw r;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&_e(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Z((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Z?t:Z.resolve(t)}catch(t){return Z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Z.reject(t)}static resolve(e){return new Z((t,n)=>{t(e)})}static reject(e){return new Z((t,n)=>{n(e)})}static waitFor(e){return new Z((t,n)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},f=>n(f))}),o=!0,s===i&&t()})}static or(e){let t=Z.resolve(!1);for(const n of e)t=t.next(i=>i?Z.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new Z((n,i)=>{const s=e.length,o=new Array(s);let a=0;for(let f=0;f<s;f++){const l=f;t(e[l]).next(g=>{o[l]=g,++a,a===s&&n(o)},g=>i(g))}})}static doWhile(e,t){return new Z((n,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}}function vv(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ri(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.oe(n),this._e=n=>t.writeSequenceNumber(n))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}sa.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Su=-1;function aa(r){return r==null}function Fs(r){return r===0&&1/r==-1/0}function _v(r){return typeof r=="number"&&Number.isInteger(r)&&!Fs(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ud="";function Ev(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=xl(e)),e=Tv(r.get(t),e);return xl(e)}function Tv(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="";break;case ud:t+="";break;default:t+=s}}return t}function xl(r){return r+ud+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function hn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function cd(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e,t){this.comparator=e,this.root=t||Dt.EMPTY}insert(e,t){return new at(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Dt.BLACK,null,null))}remove(e){return new at(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Dt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new gs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new gs(this.root,e,this.comparator,!1)}getReverseIterator(){return new gs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new gs(this.root,e,this.comparator,!0)}}class gs{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Dt{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??Dt.RED,this.left=i??Dt.EMPTY,this.right=s??Dt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Dt(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Dt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Dt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Dt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Dt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw _e();const e=this.left.check();if(e!==this.right.check())throw _e();return e+(this.isRed()?0:1)}}Dt.EMPTY=null,Dt.RED=!0,Dt.BLACK=!1;Dt.EMPTY=new class{constructor(){this.size=0}get key(){throw _e()}get value(){throw _e()}get color(){throw _e()}get left(){throw _e()}get right(){throw _e()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Dt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.comparator=e,this.data=new at(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new bl(this.data.getIterator())}getIteratorFrom(e){return new bl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class bl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this.fields=e,e.sort(Lt.comparator)}static empty(){return new ir([])}unionWith(e){let t=new At(Lt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ir(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Hn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ld("Invalid base64 string: "+s):s}}(e);return new Vt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Vt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Vt.EMPTY_BYTE_STRING=new Vt("");const Cv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function an(r){if(He(!!r),typeof r=="string"){let e=0;const t=Cv.exec(r);if(He(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:yt(r.seconds),nanos:yt(r.nanos)}}function yt(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function on(r){return typeof r=="string"?Vt.fromBase64String(r):Vt.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hd="server_timestamp",fd="__type__",dd="__previous_value__",pd="__local_write_time__";function Au(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{})[fd])===null||t===void 0?void 0:t.stringValue)===hd}function oa(r){const e=r.mapValue.fields[dd];return Au(e)?oa(e):e}function Bi(r){const e=an(r.mapValue.fields[pd].timestampValue);return new St(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(e,t,n,i,s,o,a,f,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=f,this.useFetchStreams=l}}const Ks="(default)";class ki{constructor(e,t){this.projectId=e,this.database=t||Ks}static empty(){return new ki("","")}get isDefaultDatabase(){return this.database===Ks}isEqual(e){return e instanceof ki&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gd="__type__",md="__max__",ms={mapValue:{fields:{__type__:{stringValue:md}}}},yd="__vector__",qs="value";function un(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Au(r)?4:Av(r)?9007199254740991:Sv(r)?10:11:_e()}function Cr(r,e){if(r===e)return!0;const t=un(r);if(t!==un(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Bi(r).isEqual(Bi(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=an(i.timestampValue),a=an(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return on(i.bytesValue).isEqual(on(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return yt(i.geoPointValue.latitude)===yt(s.geoPointValue.latitude)&&yt(i.geoPointValue.longitude)===yt(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return yt(i.integerValue)===yt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=yt(i.doubleValue),a=yt(s.doubleValue);return o===a?Fs(o)===Fs(a):isNaN(o)&&isNaN(a)}return!1}(r,e);case 9:return Hn(r.arrayValue.values||[],e.arrayValue.values||[],Cr);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(wl(o)!==wl(a))return!1;for(const f in o)if(o.hasOwnProperty(f)&&(a[f]===void 0||!Cr(o[f],a[f])))return!1;return!0}(r,e);default:return _e()}}function Di(r,e){return(r.values||[]).find(t=>Cr(t,e))!==void 0}function Gn(r,e){if(r===e)return 0;const t=un(r),n=un(e);if(t!==n)return Re(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Re(r.booleanValue,e.booleanValue);case 2:return function(s,o){const a=yt(s.integerValue||s.doubleValue),f=yt(o.integerValue||o.doubleValue);return a<f?-1:a>f?1:a===f?0:isNaN(a)?isNaN(f)?0:-1:1}(r,e);case 3:return Rl(r.timestampValue,e.timestampValue);case 4:return Rl(Bi(r),Bi(e));case 5:return jo(r.stringValue,e.stringValue);case 6:return function(s,o){const a=on(s),f=on(o);return a.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),f=o.split("/");for(let l=0;l<a.length&&l<f.length;l++){const g=Re(a[l],f[l]);if(g!==0)return g}return Re(a.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){const a=Re(yt(s.latitude),yt(o.latitude));return a!==0?a:Re(yt(s.longitude),yt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Nl(r.arrayValue,e.arrayValue);case 10:return function(s,o){var a,f,l,g;const w=s.fields||{},y=o.fields||{},p=(a=w[qs])===null||a===void 0?void 0:a.arrayValue,I=(f=y[qs])===null||f===void 0?void 0:f.arrayValue,S=Re(((l=p?.values)===null||l===void 0?void 0:l.length)||0,((g=I?.values)===null||g===void 0?void 0:g.length)||0);return S!==0?S:Nl(p,I)}(r.mapValue,e.mapValue);case 11:return function(s,o){if(s===ms.mapValue&&o===ms.mapValue)return 0;if(s===ms.mapValue)return 1;if(o===ms.mapValue)return-1;const a=s.fields||{},f=Object.keys(a),l=o.fields||{},g=Object.keys(l);f.sort(),g.sort();for(let w=0;w<f.length&&w<g.length;++w){const y=jo(f[w],g[w]);if(y!==0)return y;const p=Gn(a[f[w]],l[g[w]]);if(p!==0)return p}return Re(f.length,g.length)}(r.mapValue,e.mapValue);default:throw _e()}}function Rl(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return Re(r,e);const t=an(r),n=an(e),i=Re(t.seconds,n.seconds);return i!==0?i:Re(t.nanos,n.nanos)}function Nl(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Gn(t[i],n[i]);if(s)return s}return Re(t.length,n.length)}function zn(r){return Ho(r)}function Ho(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=an(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return on(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return ye.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Ho(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of n)s?s=!1:i+=",",i+=`${o}:${Ho(t.fields[o])}`;return i+"}"}(r.mapValue):_e()}function bs(r){switch(un(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=oa(r);return e?16+bs(e):16;case 5:return 2*r.stringValue.length;case 6:return on(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+bs(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return hn(n.fields,(s,o)=>{i+=s.length+bs(o)}),i}(r.mapValue);default:throw _e()}}function Pl(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Go(r){return!!r&&"integerValue"in r}function xu(r){return!!r&&"arrayValue"in r}function Bl(r){return!!r&&"nullValue"in r}function kl(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Rs(r){return!!r&&"mapValue"in r}function Sv(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{})[gd])===null||t===void 0?void 0:t.stringValue)===yd}function Si(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return hn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Si(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Si(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Av(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===md}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.value=e}static empty(){return new Yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Rs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Si(t)}setAll(e){let t=Lt.emptyPath(),n={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const f=this.getFieldsMap(t);this.applyChanges(f,n,i),n={},i=[],t=a.popLast()}o?n[a.lastSegment()]=Si(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Rs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Cr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Rs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){hn(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Yt(Si(this.value))}}function vd(r){const e=[];return hn(r.fields,(t,n)=>{const i=new Lt([t]);if(Rs(n)){const s=vd(n.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new ir(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,t,n,i,s,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new qt(e,0,Ie.min(),Ie.min(),Ie.min(),Yt.empty(),0)}static newFoundDocument(e,t,n,i){return new qt(e,1,t,Ie.min(),n,i,0)}static newNoDocument(e,t){return new qt(e,2,t,Ie.min(),Ie.min(),Yt.empty(),0)}static newUnknownDocument(e,t){return new qt(e,3,t,Ie.min(),Ie.min(),Yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,t){this.position=e,this.inclusive=t}}function Dl(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],o=r.position[i];if(s.field.isKeyField()?n=ye.comparator(ye.fromName(o.referenceValue),t.key):n=Gn(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Ll(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Cr(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e,t="asc"){this.field=e,this.dir=t}}function xv(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{}class Tt extends _d{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new bv(e,t,n):t==="array-contains"?new Pv(e,n):t==="in"?new Bv(e,n):t==="not-in"?new kv(e,n):t==="array-contains-any"?new Dv(e,n):new Tt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Rv(e,n):new Nv(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Gn(t,this.value)):t!==null&&un(this.value)===un(t)&&this.matchesComparison(Gn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return _e()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dr extends _d{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new dr(e,t)}matches(e){return Ed(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Ed(r){return r.op==="and"}function Td(r){return wv(r)&&Ed(r)}function wv(r){for(const e of r.filters)if(e instanceof dr)return!1;return!0}function zo(r){if(r instanceof Tt)return r.field.canonicalString()+r.op.toString()+zn(r.value);if(Td(r))return r.filters.map(e=>zo(e)).join(",");{const e=r.filters.map(t=>zo(t)).join(",");return`${r.op}(${e})`}}function Cd(r,e){return r instanceof Tt?function(n,i){return i instanceof Tt&&n.op===i.op&&n.field.isEqual(i.field)&&Cr(n.value,i.value)}(r,e):r instanceof dr?function(n,i){return i instanceof dr&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,a)=>s&&Cd(o,i.filters[a]),!0):!1}(r,e):void _e()}function Id(r){return r instanceof Tt?function(t){return`${t.field.canonicalString()} ${t.op} ${zn(t.value)}`}(r):r instanceof dr?function(t){return t.op.toString()+" {"+t.getFilters().map(Id).join(" ,")+"}"}(r):"Filter"}class bv extends Tt{constructor(e,t,n){super(e,t,n),this.key=ye.fromName(n.referenceValue)}matches(e){const t=ye.comparator(e.key,this.key);return this.matchesComparison(t)}}class Rv extends Tt{constructor(e,t){super(e,"in",t),this.keys=Sd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Nv extends Tt{constructor(e,t){super(e,"not-in",t),this.keys=Sd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Sd(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>ye.fromName(n.referenceValue))}class Pv extends Tt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xu(t)&&Di(t.arrayValue,this.value)}}class Bv extends Tt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Di(this.value.arrayValue,t)}}class kv extends Tt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Di(this.value.arrayValue,t)}}class Dv extends Tt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Di(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(e,t=null,n=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.le=null}}function Vl(r,e=null,t=[],n=[],i=null,s=null,o=null){return new Lv(r,e,t,n,i,s,o)}function wu(r){const e=Ae(r);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>zo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),aa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>zn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>zn(n)).join(",")),e.le=t}return e.le}function bu(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!xv(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Cd(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Ll(r.startAt,e.startAt)&&Ll(r.endAt,e.endAt)}function $o(r){return ye.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e,t=null,n=[],i=[],s=null,o="F",a=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=f,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Vv(r,e,t,n,i,s,o,a){return new ni(r,e,t,n,i,s,o,a)}function ua(r){return new ni(r)}function Ol(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Ad(r){return r.collectionGroup!==null}function Ai(r){const e=Ae(r);if(e.he===null){e.he=[];const t=new Set;for(const s of e.explicitOrderBy)e.he.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new At(Lt.comparator);return o.filters.forEach(f=>{f.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.he.push(new Li(s,n))}),t.has(Lt.keyField().canonicalString())||e.he.push(new Li(Lt.keyField(),n))}return e.he}function _r(r){const e=Ae(r);return e.Pe||(e.Pe=Ov(e,Ai(r))),e.Pe}function Ov(r,e){if(r.limitType==="F")return Vl(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Li(i.field,s)});const t=r.endAt?new js(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new js(r.startAt.position,r.startAt.inclusive):null;return Vl(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Wo(r,e){const t=r.filters.concat([e]);return new ni(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Qo(r,e,t){return new ni(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function ca(r,e){return bu(_r(r),_r(e))&&r.limitType===e.limitType}function xd(r){return`${wu(_r(r))}|lt:${r.limitType}`}function Dn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Id(i)).join(", ")}]`),aa(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>zn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>zn(i)).join(",")),`Target(${n})`}(_r(r))}; limitType=${r.limitType})`}function la(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):ye.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Ai(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,a,f){const l=Dl(o,a,f);return o.inclusive?l<=0:l<0}(n.startAt,Ai(n),i)||n.endAt&&!function(o,a,f){const l=Dl(o,a,f);return o.inclusive?l>=0:l>0}(n.endAt,Ai(n),i))}(r,e)}function Uv(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function wd(r){return(e,t)=>{let n=!1;for(const i of Ai(r)){const s=Mv(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function Mv(r,e,t){const n=r.field.isKeyField()?ye.comparator(e.key,t.key):function(s,o,a){const f=o.data.field(s),l=a.data.field(s);return f!==null&&l!==null?Gn(f,l):_e()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return _e()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){hn(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return cd(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fv=new at(ye.comparator);function Mr(){return Fv}const bd=new at(ye.comparator);function Ei(...r){let e=bd;for(const t of r)e=e.insert(t.key,t);return e}function Rd(r){let e=bd;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function vn(){return xi()}function Nd(){return xi()}function xi(){return new Sn(r=>r.toString(),(r,e)=>r.isEqual(e))}const Kv=new at(ye.comparator),qv=new At(ye.comparator);function Ve(...r){let e=qv;for(const t of r)e=e.add(t);return e}const jv=new At(Re);function Hv(){return jv}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ru(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Fs(e)?"-0":e}}function Pd(r){return{integerValue:""+r}}function Gv(r,e){return _v(e)?Pd(e):Ru(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(){this._=void 0}}function zv(r,e,t){return r instanceof Vi?function(i,s){const o={fields:{[fd]:{stringValue:hd},[pd]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Au(s)&&(s=oa(s)),s&&(o.fields[dd]=s),{mapValue:o}}(t,e):r instanceof $n?kd(r,e):r instanceof Oi?Dd(r,e):function(i,s){const o=Bd(i,s),a=Ul(o)+Ul(i.Ie);return Go(o)&&Go(i.Ie)?Pd(a):Ru(i.serializer,a)}(r,e)}function $v(r,e,t){return r instanceof $n?kd(r,e):r instanceof Oi?Dd(r,e):t}function Bd(r,e){return r instanceof Hs?function(n){return Go(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}class Vi extends ha{}class $n extends ha{constructor(e){super(),this.elements=e}}function kd(r,e){const t=Ld(e);for(const n of r.elements)t.some(i=>Cr(i,n))||t.push(n);return{arrayValue:{values:t}}}class Oi extends ha{constructor(e){super(),this.elements=e}}function Dd(r,e){let t=Ld(e);for(const n of r.elements)t=t.filter(i=>!Cr(i,n));return{arrayValue:{values:t}}}class Hs extends ha{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Ul(r){return yt(r.integerValue||r.doubleValue)}function Ld(r){return xu(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd{constructor(e,t){this.field=e,this.transform=t}}function Wv(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof $n&&i instanceof $n||n instanceof Oi&&i instanceof Oi?Hn(n.elements,i.elements,Cr):n instanceof Hs&&i instanceof Hs?Cr(n.Ie,i.Ie):n instanceof Vi&&i instanceof Vi}(r.transform,e.transform)}class Qv{constructor(e,t){this.version=e,this.transformResults=t}}class Xt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Xt}static exists(e){return new Xt(void 0,e)}static updateTime(e){return new Xt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ns(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class fa{}function Od(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Nu(r.key,Xt.none()):new ji(r.key,r.data,Xt.none());{const t=r.data,n=Yt.empty();let i=new At(Lt.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new fn(r.key,n,new ir(i.toArray()),Xt.none())}}function Yv(r,e,t){r instanceof ji?function(i,s,o){const a=i.value.clone(),f=Fl(i.fieldTransforms,s,o.transformResults);a.setAll(f),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(r,e,t):r instanceof fn?function(i,s,o){if(!Ns(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=Fl(i.fieldTransforms,s,o.transformResults),f=s.data;f.setAll(Ud(i)),f.setAll(a),s.convertToFoundDocument(o.version,f).setHasCommittedMutations()}(r,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function wi(r,e,t,n){return r instanceof ji?function(s,o,a,f){if(!Ns(s.precondition,o))return a;const l=s.value.clone(),g=Kl(s.fieldTransforms,f,o);return l.setAll(g),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(r,e,t,n):r instanceof fn?function(s,o,a,f){if(!Ns(s.precondition,o))return a;const l=Kl(s.fieldTransforms,f,o),g=o.data;return g.setAll(Ud(s)),g.setAll(l),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(w=>w.field))}(r,e,t,n):function(s,o,a){return Ns(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(r,e,t)}function Xv(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Bd(n.transform,i||null);s!=null&&(t===null&&(t=Yt.empty()),t.set(n.field,s))}return t||null}function Ml(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Hn(n,i,(s,o)=>Wv(s,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class ji extends fa{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class fn extends fa{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ud(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Fl(r,e,t){const n=new Map;He(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],o=s.transform,a=e.data.field(s.field);n.set(s.field,$v(o,a,t[i]))}return n}function Kl(r,e,t){const n=new Map;for(const i of r){const s=i.transform,o=t.data.field(i.field);n.set(i.field,zv(s,o,e))}return n}class Nu extends fa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Jv extends fa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Yv(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=wi(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=wi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Nd();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const f=Od(o,a);f!==null&&n.set(i.key,f),o.isValidDocument()||o.convertToNoDocument(Ie.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ve())}isEqual(e){return this.batchId===e.batchId&&Hn(this.mutations,e.mutations,(t,n)=>Ml(t,n))&&Hn(this.baseMutations,e.baseMutations,(t,n)=>Ml(t,n))}}class Pu{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){He(e.mutations.length===n.length);let i=function(){return Kv}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new Pu(e,t,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et,Ue;function r_(r){switch(r){case X.OK:return _e();case X.CANCELLED:case X.UNKNOWN:case X.DEADLINE_EXCEEDED:case X.RESOURCE_EXHAUSTED:case X.INTERNAL:case X.UNAVAILABLE:case X.UNAUTHENTICATED:return!1;case X.INVALID_ARGUMENT:case X.NOT_FOUND:case X.ALREADY_EXISTS:case X.PERMISSION_DENIED:case X.FAILED_PRECONDITION:case X.ABORTED:case X.OUT_OF_RANGE:case X.UNIMPLEMENTED:case X.DATA_LOSS:return!0;default:return _e()}}function Md(r){if(r===void 0)return Ur("GRPC error has no .code"),X.UNKNOWN;switch(r){case Et.OK:return X.OK;case Et.CANCELLED:return X.CANCELLED;case Et.UNKNOWN:return X.UNKNOWN;case Et.DEADLINE_EXCEEDED:return X.DEADLINE_EXCEEDED;case Et.RESOURCE_EXHAUSTED:return X.RESOURCE_EXHAUSTED;case Et.INTERNAL:return X.INTERNAL;case Et.UNAVAILABLE:return X.UNAVAILABLE;case Et.UNAUTHENTICATED:return X.UNAUTHENTICATED;case Et.INVALID_ARGUMENT:return X.INVALID_ARGUMENT;case Et.NOT_FOUND:return X.NOT_FOUND;case Et.ALREADY_EXISTS:return X.ALREADY_EXISTS;case Et.PERMISSION_DENIED:return X.PERMISSION_DENIED;case Et.FAILED_PRECONDITION:return X.FAILED_PRECONDITION;case Et.ABORTED:return X.ABORTED;case Et.OUT_OF_RANGE:return X.OUT_OF_RANGE;case Et.UNIMPLEMENTED:return X.UNIMPLEMENTED;case Et.DATA_LOSS:return X.DATA_LOSS;default:return _e()}}(Ue=Et||(Et={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n_=new tn([4294967295,4294967295],0);function ql(r){const e=ad().encode(r),t=new Zf;return t.update(e),new Uint8Array(t.digest())}function jl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new tn([t,n],0),new tn([i,s],0)]}class Bu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ti(`Invalid padding: ${t}`);if(n<0)throw new Ti(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Ti(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ti(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=tn.fromNumber(this.Ee)}Ae(e,t,n){let i=e.add(t.multiply(tn.fromNumber(n)));return i.compare(n_)===1&&(i=new tn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const t=ql(e),[n,i]=jl(t);for(let s=0;s<this.hashCount;s++){const o=this.Ae(n,i,s);if(!this.Re(o))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Bu(s,i,t);return n.forEach(a=>o.insert(a)),o}insert(e){if(this.Ee===0)return;const t=ql(e),[n,i]=jl(t);for(let s=0;s<this.hashCount;s++){const o=this.Ae(n,i,s);this.Ve(o)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Ti extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Hi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new da(Ie.min(),i,new at(Re),Mr(),Ve())}}class Hi{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Hi(n,t,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,t,n,i){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=i}}class Fd{constructor(e,t){this.targetId=e,this.ge=t}}class Kd{constructor(e,t,n=Vt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Hl{constructor(){this.pe=0,this.ye=Gl(),this.we=Vt.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Ve(),t=Ve(),n=Ve();return this.ye.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:_e()}}),new Hi(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=Gl()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,He(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class i_{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Mr(),this.$e=ys(),this.Ue=ys(),this.Ke=new at(Re)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:_e()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((n,i)=>{this.Je(i)&&t(i)})}Ze(e){const t=e.targetId,n=e.ge.count,i=this.Xe(t);if(i){const s=i.target;if($o(s))if(n===0){const o=new ye(s.path);this.ze(t,o,qt.newNoDocument(o,Ie.min()))}else He(n===1);else{const o=this.et(t);if(o!==n){const a=this.tt(e),f=a?this.nt(a,e,o):1;if(f!==0){this.Ye(t);const l=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,l)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=on(n).toUint8Array()}catch(f){if(f instanceof ld)return jn("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{a=new Bu(o,i,s)}catch(f){return jn(f instanceof Ti?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return a.Ee===0?null:a}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){const n=this.ke.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const o=this.ke.it(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.ze(t,s,null),i++)}),i}ot(e){const t=new Map;this.qe.forEach((s,o)=>{const a=this.Xe(o);if(a){if(s.current&&$o(a.target)){const f=new ye(a.target.path);this._t(f).has(o)||this.ut(o,f)||this.ze(o,f,qt.newNoDocument(f,e))}s.ve&&(t.set(o,s.Fe()),s.Me())}});let n=Ve();this.Ue.forEach((s,o)=>{let a=!0;o.forEachWhile(f=>{const l=this.Xe(f);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(n=n.add(s))}),this.Qe.forEach((s,o)=>o.setReadTime(e));const i=new da(e,t,this.Ke,this.Qe,n);return this.Qe=Mr(),this.$e=ys(),this.Ue=ys(),this.Ke=new at(Re),i}Ge(e,t){if(!this.Je(e))return;const n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const i=this.He(e);this.ut(e,t)?i.xe(t,1):i.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Hl,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new At(Re),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new At(Re),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||pe("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Hl),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function ys(){return new at(ye.comparator)}function Gl(){return new at(ye.comparator)}const s_={asc:"ASCENDING",desc:"DESCENDING"},a_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},o_={and:"AND",or:"OR"};class u_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Yo(r,e){return r.useProto3Json||aa(e)?e:{value:e}}function Gs(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qd(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function c_(r,e){return Gs(r,e.toTimestamp())}function Er(r){return He(!!r),Ie.fromTimestamp(function(t){const n=an(t);return new St(n.seconds,n.nanos)}(r))}function ku(r,e){return Xo(r,e).canonicalString()}function Xo(r,e){const t=function(i){return new Ye(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function jd(r){const e=Ye.fromString(r);return He(Wd(e)),e}function Jo(r,e){return ku(r.databaseId,e.path)}function ja(r,e){const t=jd(e);if(t.get(1)!==r.databaseId.projectId)throw new de(X.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new de(X.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new ye(Gd(t))}function Hd(r,e){return ku(r.databaseId,e)}function l_(r){const e=jd(r);return e.length===4?Ye.emptyPath():Gd(e)}function Zo(r){return new Ye(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Gd(r){return He(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function zl(r,e,t){return{name:Jo(r,e),fields:t.value.mapValue.fields}}function h_(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:_e()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,g){return l.useProto3Json?(He(g===void 0||typeof g=="string"),Vt.fromBase64String(g||"")):(He(g===void 0||g instanceof Buffer||g instanceof Uint8Array),Vt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const g=l.code===void 0?X.UNKNOWN:Md(l.code);return new de(g,l.message||"")}(o);t=new Kd(n,i,s,a||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=ja(r,n.document.name),s=Er(n.document.updateTime),o=n.document.createTime?Er(n.document.createTime):Ie.min(),a=new Yt({mapValue:{fields:n.document.fields}}),f=qt.newFoundDocument(i,s,o,a),l=n.targetIds||[],g=n.removedTargetIds||[];t=new Ps(l,g,f.key,f)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=ja(r,n.document),s=n.readTime?Er(n.readTime):Ie.min(),o=qt.newNoDocument(i,s),a=n.removedTargetIds||[];t=new Ps([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=ja(r,n.document),s=n.removedTargetIds||[];t=new Ps([],s,i,null)}else{if(!("filter"in e))return _e();{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:s}=n,o=new t_(i,s),a=n.targetId;t=new Fd(a,o)}}return t}function f_(r,e){let t;if(e instanceof ji)t={update:zl(r,e.key,e.value)};else if(e instanceof Nu)t={delete:Jo(r,e.key)};else if(e instanceof fn)t={update:zl(r,e.key,e.data),updateMask:T_(e.fieldMask)};else{if(!(e instanceof Jv))return _e();t={verify:Jo(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){const a=o.transform;if(a instanceof Vi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof $n)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Oi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Hs)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw _e()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:c_(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:_e()}(r,e.precondition)),t}function d_(r,e){return r&&r.length>0?(He(e!==void 0),r.map(t=>function(i,s){let o=i.updateTime?Er(i.updateTime):Er(s);return o.isEqual(Ie.min())&&(o=Er(s)),new Qv(o,i.transformResults||[])}(t,e))):[]}function p_(r,e){return{documents:[Hd(r,e.path)]}}function g_(r,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Hd(r,i);const s=function(l){if(l.length!==0)return $d(dr.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(l){if(l.length!==0)return l.map(g=>function(y){return{field:Ln(y.field),direction:v_(y.dir)}}(g))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Yo(r,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{ht:t,parent:i}}function m_(r){let e=l_(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){He(n===1);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(w){const y=zd(w);return y instanceof dr&&Td(y)?y.getFilters():[y]}(t.where));let o=[];t.orderBy&&(o=function(w){return w.map(y=>function(I){return new Li(Vn(I.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(y))}(t.orderBy));let a=null;t.limit&&(a=function(w){let y;return y=typeof w=="object"?w.value:w,aa(y)?null:y}(t.limit));let f=null;t.startAt&&(f=function(w){const y=!!w.before,p=w.values||[];return new js(p,y)}(t.startAt));let l=null;return t.endAt&&(l=function(w){const y=!w.before,p=w.values||[];return new js(p,y)}(t.endAt)),Vv(e,i,o,s,a,"F",f,l)}function y_(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return _e()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zd(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Vn(t.unaryFilter.field);return Tt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Vn(t.unaryFilter.field);return Tt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Vn(t.unaryFilter.field);return Tt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Vn(t.unaryFilter.field);return Tt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return _e()}}(r):r.fieldFilter!==void 0?function(t){return Tt.create(Vn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _e()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return dr.create(t.compositeFilter.filters.map(n=>zd(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return _e()}}(t.compositeFilter.op))}(r):_e()}function v_(r){return s_[r]}function __(r){return a_[r]}function E_(r){return o_[r]}function Ln(r){return{fieldPath:r.canonicalString()}}function Vn(r){return Lt.fromServerFormat(r.fieldPath)}function $d(r){return r instanceof Tt?function(t){if(t.op==="=="){if(kl(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NAN"}};if(Bl(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(kl(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NAN"}};if(Bl(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ln(t.field),op:__(t.op),value:t.value}}}(r):r instanceof dr?function(t){const n=t.getFilters().map(i=>$d(i));return n.length===1?n[0]:{compositeFilter:{op:E_(t.op),filters:n}}}(r):_e()}function T_(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Wd(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e,t,n,i,s=Ie.min(),o=Ie.min(),a=Vt.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=f}withSequenceNumber(e){return new Xr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(e){this.Tt=e}}function I_(r){const e=m_({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Qo(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(){this.Tn=new A_}addToCollectionParentIndex(e,t){return this.Tn.add(t),Z.resolve()}getCollectionParents(e,t){return Z.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return Z.resolve()}deleteFieldIndex(e,t){return Z.resolve()}deleteAllFieldIndexes(e){return Z.resolve()}createTargetIndexes(e,t){return Z.resolve()}getDocumentsMatchingTarget(e,t){return Z.resolve(null)}getIndexType(e,t){return Z.resolve(0)}getFieldIndexes(e,t){return Z.resolve([])}getNextCollectionGroupToUpdate(e){return Z.resolve(null)}getMinOffset(e,t){return Z.resolve(sn.min())}getMinOffsetFromCollectionGroup(e,t){return Z.resolve(sn.min())}updateCollectionGroup(e,t,n){return Z.resolve()}updateIndexEntries(e,t){return Z.resolve()}}class A_{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new At(Ye.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new At(Ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $l={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Qd=41943040;class Qt{static withCacheSize(e){return new Qt(e,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qt.DEFAULT_COLLECTION_PERCENTILE=10,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qt.DEFAULT=new Qt(Qd,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qt.DISABLED=new Qt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new Wn(0)}static Kn(){return new Wn(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wl="LruGarbageCollector",x_=1048576;function Ql([r,e],[t,n]){const i=Re(r,t);return i===0?Re(e,n):i}class w_{constructor(e){this.Hn=e,this.buffer=new At(Ql),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Ql(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class b_{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){pe(Wl,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ri(t)?pe(Wl,"Ignoring IndexedDB error during garbage collection: ",t):await ti(t)}await this.er(3e5)})}}class R_{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return Z.resolve(sa.ae);const n=new w_(t);return this.tr.forEachTarget(e,i=>n.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>n.Zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),Z.resolve($l)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$l):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,i,s,o,a,f,l;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(w=>(w>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),i=this.params.maximumSequenceNumbersToCollect):i=w,o=Date.now(),this.nthSequenceNumber(e,i))).next(w=>(n=w,a=Date.now(),this.removeTargets(e,n,t))).next(w=>(s=w,f=Date.now(),this.removeOrphanedDocuments(e,n))).next(w=>(l=Date.now(),kn()<=Le.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-g}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(f-a)+`ms
	Removed ${w} documents in `+(l-f)+`ms
Total Duration: ${l-g}ms`),Z.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:w})))}}function N_(r,e){return new R_(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(){this.changes=new Sn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?Z.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&wi(n.mutation,i,ir.empty(),St.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Ve()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Ve()){const i=vn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=Ei();return s.forEach((a,f)=>{o=o.insert(a,f.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=vn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ve()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,n,i){let s=Mr();const o=xi(),a=function(){return xi()}();return t.forEach((f,l)=>{const g=n.get(l.key);i.has(l.key)&&(g===void 0||g.mutation instanceof fn)?s=s.insert(l.key,l):g!==void 0?(o.set(l.key,g.mutation.getFieldMask()),wi(g.mutation,l,g.mutation.getFieldMask(),St.now())):o.set(l.key,ir.empty())}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((l,g)=>o.set(l,g)),t.forEach((l,g)=>{var w;return a.set(l,new B_(g,(w=o.get(l))!==null&&w!==void 0?w:null))}),a))}recalculateAndSaveOverlays(e,t){const n=xi();let i=new at((o,a)=>o-a),s=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(f=>{const l=t.get(f);if(l===null)return;let g=n.get(f)||ir.empty();g=a.applyToLocalView(l,g),n.set(f,g);const w=(i.get(a.batchId)||Ve()).add(f);i=i.insert(a.batchId,w)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const f=a.getNext(),l=f.key,g=f.value,w=Nd();g.forEach(y=>{if(!s.has(y)){const p=Od(t.get(y),n.get(y));p!==null&&w.set(y,p),s=s.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,w))}return Z.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return ye.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ad(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):Z.resolve(vn());let a=Pi,f=s;return o.next(l=>Z.forEach(l,(g,w)=>(a<w.largestBatchId&&(a=w.largestBatchId),s.get(g)?Z.resolve():this.remoteDocumentCache.getEntry(e,g).next(y=>{f=f.insert(g,y)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,f,l,Ve())).next(g=>({batchId:a,changes:Rd(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ye(t)).next(n=>{let i=Ei();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let o=Ei();return this.indexManager.getCollectionParents(e,s).next(a=>Z.forEach(a,f=>{const l=function(w,y){return new ni(y,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)}(t,f.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,n,i).next(g=>{g.forEach((w,y)=>{o=o.insert(w,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((f,l)=>{const g=l.getKey();o.get(g)===null&&(o=o.insert(g,qt.newInvalidDocument(g)))});let a=Ei();return o.forEach((f,l)=>{const g=s.get(f);g!==void 0&&wi(g.mutation,l,ir.empty(),St.now()),la(t,l)&&(a=a.insert(f,l))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return Z.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Er(i.createTime)}}(t)),Z.resolve()}getNamedQuery(e,t){return Z.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(i){return{name:i.name,query:I_(i.bundledQuery),readTime:Er(i.readTime)}}(t)),Z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{constructor(){this.overlays=new at(ye.comparator),this.Rr=new Map}getOverlay(e,t){return Z.resolve(this.overlays.get(t))}getOverlays(e,t){const n=vn();return Z.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.Et(e,t,s)}),Z.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Rr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Rr.delete(n)),Z.resolve()}getOverlaysForCollection(e,t,n){const i=vn(),s=t.length+1,o=new ye(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const f=a.getNext().value,l=f.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&f.largestBatchId>n&&i.set(f.getKey(),f)}return Z.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new at((l,g)=>l-g);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>n){let g=s.get(l.largestBatchId);g===null&&(g=vn(),s=s.insert(l.largestBatchId,g)),g.set(l.getKey(),l)}}const a=vn(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((l,g)=>a.set(l,g)),!(a.size()>=i)););return Z.resolve(a)}Et(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const o=this.Rr.get(i.largestBatchId).delete(n.key);this.Rr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new e_(t,n));let s=this.Rr.get(t);s===void 0&&(s=Ve(),this.Rr.set(t,s)),this.Rr.set(t,s.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(){this.sessionToken=Vt.EMPTY_BYTE_STRING}getSessionToken(e){return Z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(){this.Vr=new At(Rt.mr),this.gr=new At(Rt.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const n=new Rt(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.wr(new Rt(e,t))}Sr(e,t){e.forEach(n=>this.removeReference(n,t))}br(e){const t=new ye(new Ye([])),n=new Rt(t,e),i=new Rt(t,e+1),s=[];return this.gr.forEachInRange([n,i],o=>{this.wr(o),s.push(o.key)}),s}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new ye(new Ye([])),n=new Rt(t,e),i=new Rt(t,e+1);let s=Ve();return this.gr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Rt(e,0),n=this.Vr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Rt{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return ye.comparator(e.key,t.key)||Re(e.Cr,t.Cr)}static pr(e,t){return Re(e.Cr,t.Cr)||ye.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new At(Rt.mr)}checkEmpty(e){return Z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const s=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Zv(s,t,n,i);this.mutationQueue.push(o);for(const a of i)this.Mr=this.Mr.add(new Rt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Z.resolve(o)}lookupMutationBatch(e,t){return Z.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.Nr(n),s=i<0?0:i;return Z.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Z.resolve(this.mutationQueue.length===0?Su:this.Fr-1)}getAllMutationBatches(e){return Z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Rt(t,0),i=new Rt(t,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([n,i],o=>{const a=this.Or(o.Cr);s.push(a)}),Z.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(Re);return t.forEach(i=>{const s=new Rt(i,0),o=new Rt(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([s,o],a=>{n=n.add(a.Cr)})}),Z.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;ye.isDocumentKey(s)||(s=s.child(""));const o=new Rt(new ye(s),0);let a=new At(Re);return this.Mr.forEachWhile(f=>{const l=f.key.path;return!!n.isPrefixOf(l)&&(l.length===i&&(a=a.add(f.Cr)),!0)},o),Z.resolve(this.Br(a))}Br(e){const t=[];return e.forEach(n=>{const i=this.Or(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){He(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.Mr;return Z.forEach(t.mutations,i=>{const s=new Rt(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=n})}qn(e){}containsKey(e,t){const n=new Rt(t,0),i=this.Mr.firstAfterOrEqual(n);return Z.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Z.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_{constructor(e){this.kr=e,this.docs=function(){return new at(ye.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Z.resolve(n?n.document.mutableCopy():qt.newInvalidDocument(t))}getEntries(e,t){let n=Mr();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():qt.newInvalidDocument(i))}),Z.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Mr();const o=t.path,a=new ye(o.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(a);for(;f.hasNext();){const{key:l,value:{document:g}}=f.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||gv(pv(g),n)<=0||(i.has(g.key)||la(t,g))&&(s=s.insert(g.key,g.mutableCopy()))}return Z.resolve(s)}getAllFromCollectionGroup(e,t,n,i){_e()}qr(e,t){return Z.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new M_(this)}getSize(e){return Z.resolve(this.size)}}class M_ extends P_{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(n)}),Z.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_{constructor(e){this.persistence=e,this.Qr=new Sn(t=>wu(t),bu),this.lastRemoteSnapshotVersion=Ie.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Du,this.targetCount=0,this.Kr=Wn.Un()}forEachTarget(e,t){return this.Qr.forEach((n,i)=>t(i)),Z.resolve()}getLastRemoteSnapshotVersion(e){return Z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Z.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),Z.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new Wn(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,Z.resolve()}updateTargetData(e,t){return this.zn(t),Z.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,Z.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Qr.forEach((o,a)=>{a.sequenceNumber<=t&&n.get(a.targetId)===null&&(this.Qr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),Z.waitFor(s).next(()=>i)}getTargetCount(e){return Z.resolve(this.targetCount)}getTargetData(e,t){const n=this.Qr.get(t)||null;return Z.resolve(n)}addMatchingKeys(e,t,n){return this.Ur.yr(t,n),Z.resolve()}removeMatchingKeys(e,t,n){this.Ur.Sr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),Z.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),Z.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ur.vr(t);return Z.resolve(n)}containsKey(e,t){return Z.resolve(this.Ur.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new sa(0),this.zr=!1,this.zr=!0,this.jr=new V_,this.referenceDelegate=e(this),this.Hr=new F_(this),this.indexManager=new S_,this.remoteDocumentCache=function(i){return new U_(i)}(n=>this.referenceDelegate.Jr(n)),this.serializer=new C_(t),this.Yr=new D_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new L_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new O_(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){pe("MemoryPersistence","Starting transaction:",e);const i=new K_(this.Gr.next());return this.referenceDelegate.Zr(),n(i).next(s=>this.referenceDelegate.Xr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}ei(e,t){return Z.or(Object.values(this.Wr).map(n=>()=>n.containsKey(e,t)))}}class K_ extends yv{constructor(e){super(),this.currentSequenceNumber=e}}class Lu{constructor(e){this.persistence=e,this.ti=new Du,this.ni=null}static ri(e){return new Lu(e)}get ii(){if(this.ni)return this.ni;throw _e()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),Z.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),Z.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),Z.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach(i=>this.ii.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.ii.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Z.forEach(this.ii,n=>{const i=ye.fromPath(n);return this.si(e,i).next(s=>{s||t.removeEntry(i,Ie.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(n=>{n?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return Z.or([()=>Z.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class zs{constructor(e,t){this.persistence=e,this.oi=new Sn(n=>Ev(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=N_(this,t)}static ri(e,t){return new zs(e,t)}Zr(){}Xr(e){return Z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}sr(e){let t=0;return this.rr(e,n=>{t++}).next(()=>t)}rr(e,t){return Z.forEach(this.oi,(n,i)=>this.ar(e,n,i).next(s=>s?Z.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.qr(e,o=>this.ar(e,o,t).next(a=>{a||(n++,s.removeEntry(o,Ie.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),Z.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Z.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Z.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),Z.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=bs(e.data.value)),t}ar(e,t,n){return Z.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.oi.get(t);return Z.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=i}static Yi(e,t){let n=Ve(),i=Ve();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Vu(e,t.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return F0()?8:vv(Ht())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.rs(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ss(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new q_;return this._s(e,t,o).next(a=>{if(s.result=a,this.Xi)return this.us(e,t,o,a.size)})}).next(()=>s.result)}us(e,t,n,i){return n.documentReadCount<this.es?(kn()<=Le.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",Dn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Z.resolve()):(kn()<=Le.DEBUG&&pe("QueryEngine","Query:",Dn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ts*i?(kn()<=Le.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",Dn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,_r(t))):Z.resolve())}rs(e,t){if(Ol(t))return Z.resolve(null);let n=_r(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Qo(t,null,"F"),n=_r(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const o=Ve(...s);return this.ns.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,n).next(f=>{const l=this.cs(t,a);return this.ls(t,l,o,f.readTime)?this.rs(e,Qo(t,null,"F")):this.hs(e,l,t,f)}))})))}ss(e,t,n,i){return Ol(t)||i.isEqual(Ie.min())?Z.resolve(null):this.ns.getDocuments(e,n).next(s=>{const o=this.cs(t,s);return this.ls(t,o,n,i)?Z.resolve(null):(kn()<=Le.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dn(t)),this.hs(e,o,t,dv(i,Pi)).next(a=>a))})}cs(e,t){let n=new At(wd(e));return t.forEach((i,s)=>{la(e,s)&&(n=n.add(s))}),n}ls(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}_s(e,t,n){return kn()<=Le.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",Dn(t)),this.ns.getDocumentsMatchingQuery(e,t,sn.min(),n)}hs(e,t,n,i){return this.ns.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ou="LocalStore",H_=3e8;class G_{constructor(e,t,n,i){this.persistence=e,this.Ps=t,this.serializer=i,this.Ts=new at(Re),this.Is=new Sn(s=>wu(s),bu),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new k_(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}function z_(r,e,t,n){return new G_(r,e,t,n)}async function Xd(r,e){const t=Ae(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.As(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const o=[],a=[];let f=Ve();for(const l of i){o.push(l.batchId);for(const g of l.mutations)f=f.add(g.key)}for(const l of s){a.push(l.batchId);for(const g of l.mutations)f=f.add(g.key)}return t.localDocuments.getDocuments(n,f).next(l=>({Rs:l,removedBatchIds:o,addedBatchIds:a}))})})}function $_(r,e){const t=Ae(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.ds.newChangeBuffer({trackRemovals:!0});return function(a,f,l,g){const w=l.batch,y=w.keys();let p=Z.resolve();return y.forEach(I=>{p=p.next(()=>g.getEntry(f,I)).next(S=>{const A=l.docVersions.get(I);He(A!==null),S.version.compareTo(A)<0&&(w.applyToRemoteDocument(S,l),S.isValidDocument()&&(S.setReadTime(l.commitVersion),g.addEntry(S)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(f,w))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let f=Ve();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(f=f.add(a.batch.mutations[l].key));return f}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Jd(r){const e=Ae(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function W_(r,e){const t=Ae(r),n=e.snapshotVersion;let i=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ds.newChangeBuffer({trackRemovals:!0});i=t.Ts;const a=[];e.targetChanges.forEach((g,w)=>{const y=i.get(w);if(!y)return;a.push(t.Hr.removeMatchingKeys(s,g.removedDocuments,w).next(()=>t.Hr.addMatchingKeys(s,g.addedDocuments,w)));let p=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(w)!==null?p=p.withResumeToken(Vt.EMPTY_BYTE_STRING,Ie.min()).withLastLimboFreeSnapshotVersion(Ie.min()):g.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(g.resumeToken,n)),i=i.insert(w,p),function(S,A,d){return S.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=H_?!0:d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0}(y,p,g)&&a.push(t.Hr.updateTargetData(s,p))});let f=Mr(),l=Ve();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),a.push(Q_(s,o,e.documentUpdates).next(g=>{f=g.Vs,l=g.fs})),!n.isEqual(Ie.min())){const g=t.Hr.getLastRemoteSnapshotVersion(s).next(w=>t.Hr.setTargetsMetadata(s,s.currentSequenceNumber,n));a.push(g)}return Z.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,l)).next(()=>f)}).then(s=>(t.Ts=i,s))}function Q_(r,e,t){let n=Ve(),i=Ve();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=Mr();return t.forEach((a,f)=>{const l=s.get(a);f.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),f.isNoDocument()&&f.version.isEqual(Ie.min())?(e.removeEntry(a,f.readTime),o=o.insert(a,f)):!l.isValidDocument()||f.version.compareTo(l.version)>0||f.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(f),o=o.insert(a,f)):pe(Ou,"Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",f.version)}),{Vs:o,fs:i}})}function Y_(r,e){const t=Ae(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=Su),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function X_(r,e){const t=Ae(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Hr.getTargetData(n,e).next(s=>s?(i=s,Z.resolve(i)):t.Hr.allocateTargetId(n).next(o=>(i=new Xr(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Hr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.Ts.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(n.targetId,n),t.Is.set(e,n.targetId)),n})}async function eu(r,e,t){const n=Ae(r),i=n.Ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ri(o))throw o;pe(Ou,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ts=n.Ts.remove(e),n.Is.delete(i.target)}function Yl(r,e,t){const n=Ae(r);let i=Ie.min(),s=Ve();return n.persistence.runTransaction("Execute query","readwrite",o=>function(f,l,g){const w=Ae(f),y=w.Is.get(g);return y!==void 0?Z.resolve(w.Ts.get(y)):w.Hr.getTargetData(l,g)}(n,o,_r(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,n.Hr.getMatchingKeysForTargetId(o,a.targetId).next(f=>{s=f})}).next(()=>n.Ps.getDocumentsMatchingQuery(o,e,t?i:Ie.min(),t?s:Ve())).next(a=>(J_(n,Uv(e),a),{documents:a,gs:s})))}function J_(r,e,t){let n=r.Es.get(e)||Ie.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.Es.set(e,n)}class Xl{constructor(){this.activeTargetIds=Hv()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Z_{constructor(){this.ho=new Xl,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new Xl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jl="ConnectivityMonitor";class Zl{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){pe(Jl,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){pe(Jl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vs=null;function tu(){return vs===null?vs=function(){return 268435456+Math.round(2147483648*Math.random())}():vs++,"0x"+vs.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha="RestConnection",tE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rE{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${i}`,this.wo=this.databaseId.database===Ks?`project_id=${n}`:`project_id=${n}&database_id=${i}`}So(e,t,n,i,s){const o=tu(),a=this.bo(e,t.toUriEncodedString());pe(Ha,`Sending RPC '${e}' ${o}:`,a,n);const f={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(f,i,s),this.vo(e,a,f,n).then(l=>(pe(Ha,`Received RPC '${e}' ${o}: `,l),l),l=>{throw jn(Ha,`RPC '${e}' ${o} failed with error: `,l,"url: ",a,"request:",n),l})}Co(e,t,n,i,s,o){return this.So(e,t,n,i,s)}Do(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ei}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}bo(e,t){const n=tE[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft="WebChannelConnection";class iE extends rE{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,i){const s=tu();return new Promise((o,a)=>{const f=new ed;f.setWithCredentials(!0),f.listenOnce(td.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case ws.NO_ERROR:const g=f.getResponseJson();pe(Ft,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(g)),o(g);break;case ws.TIMEOUT:pe(Ft,`RPC '${e}' ${s} timed out`),a(new de(X.DEADLINE_EXCEEDED,"Request time out"));break;case ws.HTTP_ERROR:const w=f.getStatus();if(pe(Ft,`RPC '${e}' ${s} failed with status:`,w,"response text:",f.getResponseText()),w>0){let y=f.getResponseJson();Array.isArray(y)&&(y=y[0]);const p=y?.error;if(p&&p.status&&p.message){const I=function(A){const d=A.toLowerCase().replace(/_/g,"-");return Object.values(X).indexOf(d)>=0?d:X.UNKNOWN}(p.status);a(new de(I,p.message))}else a(new de(X.UNKNOWN,"Server responded with status "+f.getStatus()))}else a(new de(X.UNAVAILABLE,"Connection failed."));break;default:_e()}}finally{pe(Ft,`RPC '${e}' ${s} completed.`)}});const l=JSON.stringify(i);pe(Ft,`RPC '${e}' ${s} sending request:`,i),f.send(t,"POST",l,n,15)})}Wo(e,t,n){const i=tu(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=id(),a=nd(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(f.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(f.useFetchStreams=!0),this.Do(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;const g=s.join("");pe(Ft,`Creating RPC '${e}' stream ${i}: ${g}`,f);const w=o.createWebChannel(g,f);let y=!1,p=!1;const I=new nE({Fo:A=>{p?pe(Ft,`Not sending because RPC '${e}' stream ${i} is closed:`,A):(y||(pe(Ft,`Opening RPC '${e}' stream ${i} transport.`),w.open(),y=!0),pe(Ft,`RPC '${e}' stream ${i} sending:`,A),w.send(A))},Mo:()=>w.close()}),S=(A,d,T)=>{A.listen(d,x=>{try{T(x)}catch(k){setTimeout(()=>{throw k},0)}})};return S(w,_i.EventType.OPEN,()=>{p||(pe(Ft,`RPC '${e}' stream ${i} transport opened.`),I.Qo())}),S(w,_i.EventType.CLOSE,()=>{p||(p=!0,pe(Ft,`RPC '${e}' stream ${i} transport closed`),I.Uo())}),S(w,_i.EventType.ERROR,A=>{p||(p=!0,jn(Ft,`RPC '${e}' stream ${i} transport errored:`,A),I.Uo(new de(X.UNAVAILABLE,"The operation could not be completed")))}),S(w,_i.EventType.MESSAGE,A=>{var d;if(!p){const T=A.data[0];He(!!T);const x=T,k=x?.error||((d=x[0])===null||d===void 0?void 0:d.error);if(k){pe(Ft,`RPC '${e}' stream ${i} received error:`,k);const U=k.status;let _=function(v){const b=Et[v];if(b!==void 0)return Md(b)}(U),h=k.message;_===void 0&&(_=X.INTERNAL,h="Unknown error status: "+U+" with message "+k.message),p=!0,I.Uo(new de(_,h)),w.close()}else pe(Ft,`RPC '${e}' stream ${i} received:`,T),I.Ko(T)}}),S(a,rd.STAT_EVENT,A=>{A.stat===qo.PROXY?pe(Ft,`RPC '${e}' stream ${i} detected buffering proxy`):A.stat===qo.NOPROXY&&pe(Ft,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{I.$o()},0),I}}function Ga(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pa(r){return new u_(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Ti=e,this.timerId=t,this.Go=n,this.zo=i,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),i=Math.max(0,t-n);i>0&&pe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh="PersistentStream";class ep{constructor(e,t,n,i,s,o,a,f){this.Ti=e,this.n_=n,this.r_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=f,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Zd(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===X.RESOURCE_EXHAUSTED?(Ur(t.toString()),Ur("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===X.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.i_===t&&this.V_(n,i)},n=>{e(()=>{const i=new de(X.UNKNOWN,"Fetching auth token failed: "+n.message);return this.m_(i)})})}V_(e,t){const n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{n(()=>this.listener.xo())}),this.stream.No(()=>{n(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{n(()=>this.m_(i))}),this.stream.onMessage(i=>{n(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return pe(eh,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(pe(eh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sE extends ep{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=h_(this.serializer,e),n=function(s){if(!("targetChange"in s))return Ie.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?Ie.min():o.readTime?Er(o.readTime):Ie.min()}(e);return this.listener.p_(t,n)}y_(e){const t={};t.database=Zo(this.serializer),t.addTarget=function(s,o){let a;const f=o.target;if(a=$o(f)?{documents:p_(s,f)}:{query:g_(s,f).ht},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=qd(s,o.resumeToken);const l=Yo(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(Ie.min())>0){a.readTime=Gs(s,o.snapshotVersion.toTimestamp());const l=Yo(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);const n=y_(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){const t={};t.database=Zo(this.serializer),t.removeTarget=e,this.I_(t)}}class aE extends ep{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return He(!!e.streamToken),this.lastStreamToken=e.streamToken,He(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){He(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=d_(e.writeResults,e.commitTime),n=Er(e.commitTime);return this.listener.v_(n,t)}C_(){const e={};e.database=Zo(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>f_(this.serializer,n))};this.I_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{}class uE extends oE{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new de(X.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,Xo(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new de(X.UNKNOWN,s.toString())})}Co(e,t,n,i,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,Xo(t,n),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new de(X.UNKNOWN,o.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class cE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Ur(t),this.N_=!1):pe("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const In="RemoteStore";class lE{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To(o=>{n.enqueueAndForget(async()=>{An(this)&&(pe(In,"Restarting streams for network reachability change."),await async function(f){const l=Ae(f);l.W_.add(4),await Gi(l),l.j_.set("Unknown"),l.W_.delete(4),await ga(l)}(this))})}),this.j_=new cE(n,i)}}async function ga(r){if(An(r))for(const e of r.G_)await e(!0)}async function Gi(r){for(const e of r.G_)await e(!1)}function tp(r,e){const t=Ae(r);t.K_.has(e.targetId)||(t.K_.set(e.targetId,e),Ku(t)?Fu(t):ii(t).c_()&&Mu(t,e))}function Uu(r,e){const t=Ae(r),n=ii(t);t.K_.delete(e),n.c_()&&rp(t,e),t.K_.size===0&&(n.c_()?n.P_():An(t)&&t.j_.set("Unknown"))}function Mu(r,e){if(r.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ie.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ii(r).y_(e)}function rp(r,e){r.H_.Ne(e),ii(r).w_(e)}function Fu(r){r.H_=new i_({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>r.K_.get(e)||null,it:()=>r.datastore.serializer.databaseId}),ii(r).start(),r.j_.B_()}function Ku(r){return An(r)&&!ii(r).u_()&&r.K_.size>0}function An(r){return Ae(r).W_.size===0}function np(r){r.H_=void 0}async function hE(r){r.j_.set("Online")}async function fE(r){r.K_.forEach((e,t)=>{Mu(r,e)})}async function dE(r,e){np(r),Ku(r)?(r.j_.q_(e),Fu(r)):r.j_.set("Unknown")}async function pE(r,e,t){if(r.j_.set("Online"),e instanceof Kd&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.K_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.K_.delete(a),i.H_.removeTarget(a))}(r,e)}catch(n){pe(In,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await $s(r,n)}else if(e instanceof Ps?r.H_.We(e):e instanceof Fd?r.H_.Ze(e):r.H_.je(e),!t.isEqual(Ie.min()))try{const n=await Jd(r.localStore);t.compareTo(n)>=0&&await function(s,o){const a=s.H_.ot(o);return a.targetChanges.forEach((f,l)=>{if(f.resumeToken.approximateByteSize()>0){const g=s.K_.get(l);g&&s.K_.set(l,g.withResumeToken(f.resumeToken,o))}}),a.targetMismatches.forEach((f,l)=>{const g=s.K_.get(f);if(!g)return;s.K_.set(f,g.withResumeToken(Vt.EMPTY_BYTE_STRING,g.snapshotVersion)),rp(s,f);const w=new Xr(g.target,f,l,g.sequenceNumber);Mu(s,w)}),s.remoteSyncer.applyRemoteEvent(a)}(r,t)}catch(n){pe(In,"Failed to raise snapshot:",n),await $s(r,n)}}async function $s(r,e,t){if(!ri(e))throw e;r.W_.add(1),await Gi(r),r.j_.set("Offline"),t||(t=()=>Jd(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{pe(In,"Retrying IndexedDB access"),await t(),r.W_.delete(1),await ga(r)})}function ip(r,e){return e().catch(t=>$s(r,t,e))}async function ma(r){const e=Ae(r),t=cn(e);let n=e.U_.length>0?e.U_[e.U_.length-1].batchId:Su;for(;gE(e);)try{const i=await Y_(e.localStore,n);if(i===null){e.U_.length===0&&t.P_();break}n=i.batchId,mE(e,i)}catch(i){await $s(e,i)}sp(e)&&ap(e)}function gE(r){return An(r)&&r.U_.length<10}function mE(r,e){r.U_.push(e);const t=cn(r);t.c_()&&t.S_&&t.b_(e.mutations)}function sp(r){return An(r)&&!cn(r).u_()&&r.U_.length>0}function ap(r){cn(r).start()}async function yE(r){cn(r).C_()}async function vE(r){const e=cn(r);for(const t of r.U_)e.b_(t.mutations)}async function _E(r,e,t){const n=r.U_.shift(),i=Pu.from(n,e,t);await ip(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await ma(r)}async function EE(r,e){e&&cn(r).S_&&await async function(n,i){if(function(o){return r_(o)&&o!==X.ABORTED}(i.code)){const s=n.U_.shift();cn(n).h_(),await ip(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),await ma(n)}}(r,e),sp(r)&&ap(r)}async function th(r,e){const t=Ae(r);t.asyncQueue.verifyOperationInProgress(),pe(In,"RemoteStore received new credentials");const n=An(t);t.W_.add(3),await Gi(t),n&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await ga(t)}async function TE(r,e){const t=Ae(r);e?(t.W_.delete(2),await ga(t)):e||(t.W_.add(2),await Gi(t),t.j_.set("Unknown"))}function ii(r){return r.J_||(r.J_=function(t,n,i){const s=Ae(t);return s.M_(),new sE(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{xo:hE.bind(null,r),No:fE.bind(null,r),Lo:dE.bind(null,r),p_:pE.bind(null,r)}),r.G_.push(async e=>{e?(r.J_.h_(),Ku(r)?Fu(r):r.j_.set("Unknown")):(await r.J_.stop(),np(r))})),r.J_}function cn(r){return r.Y_||(r.Y_=function(t,n,i){const s=Ae(t);return s.M_(),new aE(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:yE.bind(null,r),Lo:EE.bind(null,r),D_:vE.bind(null,r),v_:_E.bind(null,r)}),r.G_.push(async e=>{e?(r.Y_.h_(),await ma(r)):(await r.Y_.stop(),r.U_.length>0&&(pe(In,`Stopping write stream with ${r.U_.length} pending writes`),r.U_=[]))})),r.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Lr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const o=Date.now()+n,a=new qu(e,t,o,i,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new de(X.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ju(r,e){if(Ur("AsyncQueue",`${e}: ${r}`),ri(r))return new de(X.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{static emptySet(e){return new Fn(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ye.comparator(t.key,n.key):(t,n)=>ye.comparator(t.key,n.key),this.keyedMap=Ei(),this.sortedSet=new at(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Fn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(){this.Z_=new at(ye.comparator)}track(e){const t=e.doc.key,n=this.Z_.get(t);n?e.type!==0&&n.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&n.type!==1?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.Z_=this.Z_.remove(t):e.type===1&&n.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):_e():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Qn{constructor(e,t,n,i,s,o,a,f,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=f,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Qn(e,t,Fn.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ca(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class IE{constructor(){this.queries=nh(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,n){const i=Ae(t),s=i.queries;i.queries=nh(),s.forEach((o,a)=>{for(const f of a.ta)f.onError(n)})})(this,new de(X.ABORTED,"Firestore shutting down"))}}function nh(){return new Sn(r=>xd(r),ca)}async function Hu(r,e){const t=Ae(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.na()&&e.ra()&&(n=2):(s=new CE,n=e.ra()?0:1);try{switch(n){case 0:s.ea=await t.onListen(i,!0);break;case 1:s.ea=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const a=ju(o,`Initialization of query '${Dn(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.ta.push(e),e.sa(t.onlineState),s.ea&&e.oa(s.ea)&&zu(t)}async function Gu(r,e){const t=Ae(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const o=s.ta.indexOf(e);o>=0&&(s.ta.splice(o,1),s.ta.length===0?i=e.ra()?0:1:!s.na()&&e.ra()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function SE(r,e){const t=Ae(r);let n=!1;for(const i of e){const s=i.query,o=t.queries.get(s);if(o){for(const a of o.ta)a.oa(i)&&(n=!0);o.ea=i}}n&&zu(t)}function AE(r,e,t){const n=Ae(r),i=n.queries.get(e);if(i)for(const s of i.ta)s.onError(t);n.queries.delete(e)}function zu(r){r.ia.forEach(e=>{e.next()})}var ru,ih;(ih=ru||(ru={}))._a="default",ih.Cache="cache";class $u{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Qn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;const n=t!=="Offline";return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Qn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==ru.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(e){this.key=e}}class up{constructor(e){this.key=e}}class xE{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Ve(),this.mutatedKeys=Ve(),this.ya=wd(e),this.wa=new Fn(this.ya)}get Sa(){return this.fa}ba(e,t){const n=t?t.Da:new rh,i=t?t.wa:this.wa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const f=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,w)=>{const y=i.get(g),p=la(this.query,w)?w:null,I=!!y&&this.mutatedKeys.has(y.key),S=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let A=!1;y&&p?y.data.isEqual(p.data)?I!==S&&(n.track({type:3,doc:p}),A=!0):this.va(y,p)||(n.track({type:2,doc:p}),A=!0,(f&&this.ya(p,f)>0||l&&this.ya(p,l)<0)&&(a=!0)):!y&&p?(n.track({type:0,doc:p}),A=!0):y&&!p&&(n.track({type:1,doc:y}),A=!0,(f||l)&&(a=!0)),A&&(p?(o=o.add(p),s=S?s.add(g):s.delete(g)):(o=o.delete(g),s=s.delete(g)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const g=this.query.limitType==="F"?o.last():o.first();o=o.delete(g.key),s=s.delete(g.key),n.track({type:1,doc:g})}return{wa:o,Da:n,ls:a,mutatedKeys:s}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const o=e.Da.X_();o.sort((g,w)=>function(p,I){const S=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _e()}};return S(p)-S(I)}(g.type,w.type)||this.ya(g.doc,w.doc)),this.Ca(n),i=i!=null&&i;const a=t&&!i?this.Fa():[],f=this.pa.size===0&&this.current&&!i?1:0,l=f!==this.ga;return this.ga=f,o.length!==0||l?{snapshot:new Qn(this.query,e.wa,s,o,e.mutatedKeys,f===0,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:a}:{Ma:a}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new rh,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Ve(),this.wa.forEach(n=>{this.xa(n.key)&&(this.pa=this.pa.add(n.key))});const t=[];return e.forEach(n=>{this.pa.has(n)||t.push(new up(n))}),this.pa.forEach(n=>{e.has(n)||t.push(new op(n))}),t}Oa(e){this.fa=e.gs,this.pa=Ve();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Qn.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Wu="SyncEngine";class wE{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class bE{constructor(e){this.key=e,this.Ba=!1}}class RE{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new Sn(a=>xd(a),ca),this.qa=new Map,this.Qa=new Set,this.$a=new at(ye.comparator),this.Ua=new Map,this.Ka=new Du,this.Wa={},this.Ga=new Map,this.za=Wn.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function NE(r,e,t=!0){const n=pp(r);let i;const s=n.ka.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Na()):i=await cp(n,e,t,!0),i}async function PE(r,e){const t=pp(r);await cp(t,e,!0,!1)}async function cp(r,e,t,n){const i=await X_(r.localStore,_r(e)),s=i.targetId,o=r.sharedClientState.addLocalQueryTarget(s,t);let a;return n&&(a=await BE(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&tp(r.remoteStore,i),a}async function BE(r,e,t,n,i){r.Ha=(w,y,p)=>async function(S,A,d,T){let x=A.view.ba(d);x.ls&&(x=await Yl(S.localStore,A.query,!1).then(({documents:h})=>A.view.ba(h,x)));const k=T&&T.targetChanges.get(A.targetId),U=T&&T.targetMismatches.get(A.targetId)!=null,_=A.view.applyChanges(x,S.isPrimaryClient,k,U);return ah(S,A.targetId,_.Ma),_.snapshot}(r,w,y,p);const s=await Yl(r.localStore,e,!0),o=new xE(e,s.gs),a=o.ba(s.documents),f=Hi.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),l=o.applyChanges(a,r.isPrimaryClient,f);ah(r,t,l.Ma);const g=new wE(e,t,o);return r.ka.set(e,g),r.qa.has(t)?r.qa.get(t).push(e):r.qa.set(t,[e]),l.snapshot}async function kE(r,e,t){const n=Ae(r),i=n.ka.get(e),s=n.qa.get(i.targetId);if(s.length>1)return n.qa.set(i.targetId,s.filter(o=>!ca(o,e))),void n.ka.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await eu(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Uu(n.remoteStore,i.targetId),nu(n,i.targetId)}).catch(ti)):(nu(n,i.targetId),await eu(n.localStore,i.targetId,!0))}async function DE(r,e){const t=Ae(r),n=t.ka.get(e),i=t.qa.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Uu(t.remoteStore,n.targetId))}async function LE(r,e,t){const n=qE(r);try{const i=await function(o,a){const f=Ae(o),l=St.now(),g=a.reduce((p,I)=>p.add(I.key),Ve());let w,y;return f.persistence.runTransaction("Locally write mutations","readwrite",p=>{let I=Mr(),S=Ve();return f.ds.getEntries(p,g).next(A=>{I=A,I.forEach((d,T)=>{T.isValidDocument()||(S=S.add(d))})}).next(()=>f.localDocuments.getOverlayedDocuments(p,I)).next(A=>{w=A;const d=[];for(const T of a){const x=Xv(T,w.get(T.key).overlayedDocument);x!=null&&d.push(new fn(T.key,x,vd(x.value.mapValue),Xt.exists(!0)))}return f.mutationQueue.addMutationBatch(p,l,d,a)}).next(A=>{y=A;const d=A.applyToLocalDocumentSet(w,S);return f.documentOverlayCache.saveOverlays(p,A.batchId,d)})}).then(()=>({batchId:y.batchId,changes:Rd(w)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,a,f){let l=o.Wa[o.currentUser.toKey()];l||(l=new at(Re)),l=l.insert(a,f),o.Wa[o.currentUser.toKey()]=l}(n,i.batchId,t),await zi(n,i.changes),await ma(n.remoteStore)}catch(i){const s=ju(i,"Failed to persist write");t.reject(s)}}async function lp(r,e){const t=Ae(r);try{const n=await W_(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Ua.get(s);o&&(He(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ba=!0:i.modifiedDocuments.size>0?He(o.Ba):i.removedDocuments.size>0&&(He(o.Ba),o.Ba=!1))}),await zi(t,n,e)}catch(n){await ti(n)}}function sh(r,e,t){const n=Ae(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.ka.forEach((s,o)=>{const a=o.view.sa(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const f=Ae(o);f.onlineState=a;let l=!1;f.queries.forEach((g,w)=>{for(const y of w.ta)y.sa(a)&&(l=!0)}),l&&zu(f)}(n.eventManager,e),i.length&&n.La.p_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function VE(r,e,t){const n=Ae(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Ua.get(e),s=i&&i.key;if(s){let o=new at(ye.comparator);o=o.insert(s,qt.newNoDocument(s,Ie.min()));const a=Ve().add(s),f=new da(Ie.min(),new Map,new at(Re),o,a);await lp(n,f),n.$a=n.$a.remove(s),n.Ua.delete(e),Qu(n)}else await eu(n.localStore,e,!1).then(()=>nu(n,e,t)).catch(ti)}async function OE(r,e){const t=Ae(r),n=e.batch.batchId;try{const i=await $_(t.localStore,e);fp(t,n,null),hp(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await zi(t,i)}catch(i){await ti(i)}}async function UE(r,e,t){const n=Ae(r);try{const i=await function(o,a){const f=Ae(o);return f.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let g;return f.mutationQueue.lookupMutationBatch(l,a).next(w=>(He(w!==null),g=w.keys(),f.mutationQueue.removeMutationBatch(l,w))).next(()=>f.mutationQueue.performConsistencyCheck(l)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(l,g,a)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,g)).next(()=>f.localDocuments.getDocuments(l,g))})}(n.localStore,e);fp(n,e,t),hp(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await zi(n,i)}catch(i){await ti(i)}}function hp(r,e){(r.Ga.get(e)||[]).forEach(t=>{t.resolve()}),r.Ga.delete(e)}function fp(r,e,t){const n=Ae(r);let i=n.Wa[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Wa[n.currentUser.toKey()]=i}}function nu(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.qa.get(e))r.ka.delete(n),t&&r.La.Ja(n,t);r.qa.delete(e),r.isPrimaryClient&&r.Ka.br(e).forEach(n=>{r.Ka.containsKey(n)||dp(r,n)})}function dp(r,e){r.Qa.delete(e.path.canonicalString());const t=r.$a.get(e);t!==null&&(Uu(r.remoteStore,t),r.$a=r.$a.remove(e),r.Ua.delete(t),Qu(r))}function ah(r,e,t){for(const n of t)n instanceof op?(r.Ka.addReference(n.key,e),ME(r,n)):n instanceof up?(pe(Wu,"Document no longer in limbo: "+n.key),r.Ka.removeReference(n.key,e),r.Ka.containsKey(n.key)||dp(r,n.key)):_e()}function ME(r,e){const t=e.key,n=t.path.canonicalString();r.$a.get(t)||r.Qa.has(n)||(pe(Wu,"New document in limbo: "+t),r.Qa.add(n),Qu(r))}function Qu(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const e=r.Qa.values().next().value;r.Qa.delete(e);const t=new ye(Ye.fromString(e)),n=r.za.next();r.Ua.set(n,new bE(t)),r.$a=r.$a.insert(t,n),tp(r.remoteStore,new Xr(_r(ua(t.path)),n,"TargetPurposeLimboResolution",sa.ae))}}async function zi(r,e,t){const n=Ae(r),i=[],s=[],o=[];n.ka.isEmpty()||(n.ka.forEach((a,f)=>{o.push(n.Ha(f,e,t).then(l=>{var g;if((l||t)&&n.isPrimaryClient){const w=l?!l.fromCache:(g=t?.targetChanges.get(f.targetId))===null||g===void 0?void 0:g.current;n.sharedClientState.updateQueryState(f.targetId,w?"current":"not-current")}if(l){i.push(l);const w=Vu.Yi(f.targetId,l);s.push(w)}}))}),await Promise.all(o),n.La.p_(i),await async function(f,l){const g=Ae(f);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",w=>Z.forEach(l,y=>Z.forEach(y.Hi,p=>g.persistence.referenceDelegate.addReference(w,y.targetId,p)).next(()=>Z.forEach(y.Ji,p=>g.persistence.referenceDelegate.removeReference(w,y.targetId,p)))))}catch(w){if(!ri(w))throw w;pe(Ou,"Failed to update sequence numbers: "+w)}for(const w of l){const y=w.targetId;if(!w.fromCache){const p=g.Ts.get(y),I=p.snapshotVersion,S=p.withLastLimboFreeSnapshotVersion(I);g.Ts=g.Ts.insert(y,S)}}}(n.localStore,s))}async function FE(r,e){const t=Ae(r);if(!t.currentUser.isEqual(e)){pe(Wu,"User change. New user:",e.toKey());const n=await Xd(t.localStore,e);t.currentUser=e,function(s,o){s.Ga.forEach(a=>{a.forEach(f=>{f.reject(new de(X.CANCELLED,o))})}),s.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await zi(t,n.Rs)}}function KE(r,e){const t=Ae(r),n=t.Ua.get(e);if(n&&n.Ba)return Ve().add(n.key);{let i=Ve();const s=t.qa.get(e);if(!s)return i;for(const o of s){const a=t.ka.get(o);i=i.unionWith(a.view.Sa)}return i}}function pp(r){const e=Ae(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=lp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=VE.bind(null,e),e.La.p_=SE.bind(null,e.eventManager),e.La.Ja=AE.bind(null,e.eventManager),e}function qE(r){const e=Ae(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=OE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=UE.bind(null,e),e}class Ws{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pa(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return z_(this.persistence,new j_,e.initialUser,this.serializer)}Xa(e){return new Yd(Lu.ri,this.serializer)}Za(e){return new Z_}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ws.provider={build:()=>new Ws};class jE extends Ws{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){He(this.persistence.referenceDelegate instanceof zs);const n=this.persistence.referenceDelegate.garbageCollector;return new b_(n,e.asyncQueue,t)}Xa(e){const t=this.cacheSizeBytes!==void 0?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new Yd(n=>zs.ri(n,t),this.serializer)}}class iu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>sh(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=FE.bind(null,this.syncEngine),await TE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new IE}()}createDatastore(e){const t=pa(e.databaseInfo.databaseId),n=function(s){return new iE(s)}(e.databaseInfo);return function(s,o,a,f){return new uE(s,o,a,f)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,s,o,a){return new lE(n,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>sh(this.syncEngine,t,0),function(){return Zl.D()?new Zl:new eE}())}createSyncEngine(e,t){return function(i,s,o,a,f,l,g){const w=new RE(i,s,o,a,f,l);return g&&(w.ja=!0),w}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const s=Ae(i);pe(In,"RemoteStore shutting down."),s.W_.add(5),await Gi(s),s.z_.shutdown(),s.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}iu.provider={build:()=>new iu};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Ur("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="FirestoreClient";class HE{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Kt.UNAUTHENTICATED,this.clientId=od.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async o=>{pe(ln,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(pe(ln,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ju(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function za(r,e){r.asyncQueue.verifyOperationInProgress(),pe(ln,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await Xd(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function oh(r,e){r.asyncQueue.verifyOperationInProgress();const t=await GE(r);pe(ln,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>th(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>th(e.remoteStore,i)),r._onlineComponents=e}async function GE(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){pe(ln,"Using user provided OfflineComponentProvider");try{await za(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===X.FAILED_PRECONDITION||i.code===X.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;jn("Error using user provided cache. Falling back to memory cache: "+t),await za(r,new Ws)}}else pe(ln,"Using default OfflineComponentProvider"),await za(r,new jE(void 0));return r._offlineComponents}async function gp(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(pe(ln,"Using user provided OnlineComponentProvider"),await oh(r,r._uninitializedComponentsProvider._online)):(pe(ln,"Using default OnlineComponentProvider"),await oh(r,new iu))),r._onlineComponents}function zE(r){return gp(r).then(e=>e.syncEngine)}async function Qs(r){const e=await gp(r),t=e.eventManager;return t.onListen=NE.bind(null,e.syncEngine),t.onUnlisten=kE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=PE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=DE.bind(null,e.syncEngine),t}function $E(r,e,t={}){const n=new Lr;return r.asyncQueue.enqueueAndForget(async()=>function(s,o,a,f,l){const g=new Yu({next:y=>{g.su(),o.enqueueAndForget(()=>Gu(s,w));const p=y.docs.has(a);!p&&y.fromCache?l.reject(new de(X.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&y.fromCache&&f&&f.source==="server"?l.reject(new de(X.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(y)},error:y=>l.reject(y)}),w=new $u(ua(a.path),g,{includeMetadataChanges:!0,Ta:!0});return Hu(s,w)}(await Qs(r),r.asyncQueue,e,t,n)),n.promise}function WE(r,e,t={}){const n=new Lr;return r.asyncQueue.enqueueAndForget(async()=>function(s,o,a,f,l){const g=new Yu({next:y=>{g.su(),o.enqueueAndForget(()=>Gu(s,w)),y.fromCache&&f.source==="server"?l.reject(new de(X.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(y)},error:y=>l.reject(y)}),w=new $u(a,g,{includeMetadataChanges:!0,Ta:!0});return Hu(s,w)}(await Qs(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mp(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(r,e,t){if(!t)throw new de(X.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function QE(r,e,t,n){if(e===!0&&n===!0)throw new de(X.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function ch(r){if(!ye.isDocumentKey(r))throw new de(X.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function lh(r){if(ye.isDocumentKey(r))throw new de(X.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ya(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":_e()}function Jt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new de(X.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ya(r);throw new de(X.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vp="firestore.googleapis.com",hh=!0;class fh{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new de(X.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vp,this.ssl=hh}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:hh;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Qd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<x_)throw new de(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}QE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mp((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new de(X.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new de(X.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new de(X.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class va{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fh({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new de(X.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new de(X.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fh(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new iv;switch(n.type){case"firstParty":return new uv(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new de(X.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=uh.get(t);n&&(pe("ComponentProvider","Removing Datastore"),uh.delete(t),n.terminate())}(this),Promise.resolve()}}function YE(r,e,t,n={}){var i;const s=(r=Jt(r,va))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:r._getEmulatorOptions()}),a=`${e}:${t}`;s.host!==vp&&s.host!==a&&jn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f=Object.assign(Object.assign({},s),{host:a,ssl:!1,emulatorOptions:n});if(!nn(f,o)&&(r._setSettings(f),n.mockUserToken)){let l,g;if(typeof n.mockUserToken=="string")l=n.mockUserToken,g=Kt.MOCK_USER;else{l=k0(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);const w=n.mockUserToken.sub||n.mockUserToken.user_id;if(!w)throw new de(X.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new Kt(w)}r._authCredentials=new sv(new sd(l,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new dn(this.firestore,e,this._query)}}class jt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new jt(this.firestore,e,this._key)}}class rn extends dn{constructor(e,t,n){super(e,t,ua(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new jt(this.firestore,null,new ye(e))}withConverter(e){return new rn(this.firestore,e,this._path)}}function bi(r,e,...t){if(r=xt(r),yp("collection","path",e),r instanceof va){const n=Ye.fromString(e,...t);return lh(n),new rn(r,null,n)}{if(!(r instanceof jt||r instanceof rn))throw new de(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Ye.fromString(e,...t));return lh(n),new rn(r.firestore,null,n)}}function sr(r,e,...t){if(r=xt(r),arguments.length===1&&(e=od.newId()),yp("doc","path",e),r instanceof va){const n=Ye.fromString(e,...t);return ch(n),new jt(r,null,new ye(n))}{if(!(r instanceof jt||r instanceof rn))throw new de(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Ye.fromString(e,...t));return ch(n),new jt(r.firestore,r instanceof rn?r.converter:null,new ye(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh="AsyncQueue";class ph{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Zd(this,"async_queue_retry"),this.Su=()=>{const n=Ga();n&&pe(dh,"Visibility state changed to "+n.visibilityState),this.a_.t_()},this.bu=e;const t=Ga();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=Ga();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const t=new Lr;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!ri(e))throw e;pe(dh,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const t=this.bu.then(()=>(this.pu=!0,e().catch(n=>{this.gu=n,this.pu=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(n);throw Ur("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.pu=!1,n))));return this.bu=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const i=qu.createAndSchedule(this,e,t,n,s=>this.Fu(s));return this.fu.push(i),i}Du(){this.gu&&_e()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}function gh(r){return function(t,n){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}class Fr extends va{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new ph,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ph(e),this._firestoreClient=void 0,await e}}}function XE(r,e){const t=typeof r=="object"?r:_f(),n=typeof r=="string"?r:Ks,i=hu(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=P0("firestore");s&&YE(i,...s)}return i}function $i(r){if(r._terminated)throw new de(X.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||JE(r),r._firestoreClient}function JE(r){var e,t,n;const i=r._freezeSettings(),s=function(a,f,l,g){return new Iv(a,f,l,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,mp(g.experimentalLongPollingOptions),g.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new HE(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(a){const f=a?._online.build();return{_offline:a?._offline.build(f),_online:f}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Yn(Vt.fromBase64String(e))}catch(t){throw new de(X.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Yn(Vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new de(X.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Lt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new de(X.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new de(X.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Re(this._lat,e._lat)||Re(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZE=/^__.*__$/;class e1{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new fn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ji(e,this.data,t,this.fieldTransforms)}}class _p{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new fn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ep(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _e()}}class _a{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new _a(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:n,Qu:!1});return i.$u(e),i}Uu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:n,Qu:!1});return i.Bu(),i}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Ys(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(Ep(this.Lu)&&ZE.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class t1{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pa(e)}ju(e,t,n,i=!1){return new _a({Lu:e,methodName:t,zu:n,path:Lt.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Yi(r){const e=r._freezeSettings(),t=pa(r._databaseId);return new t1(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Zu(r,e,t,n,i,s={}){const o=r.ju(s.merge||s.mergeFields?2:0,e,t,i);rc("Data must be an object, but it was:",o,n);const a=Ip(n,o);let f,l;if(s.merge)f=new ir(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const g=[];for(const w of s.mergeFields){const y=su(e,w,t);if(!o.contains(y))throw new de(X.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Ap(g,y)||g.push(y)}f=new ir(g),l=o.fieldTransforms.filter(w=>f.covers(w.field))}else f=null,l=o.fieldTransforms;return new e1(new Yt(a),f,l)}class Ea extends Qi{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ea}}function r1(r,e,t){return new _a({Lu:3,zu:e.settings.zu,methodName:r._methodName,Qu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ec extends Qi{_toFieldTransform(e){return new Vd(e.path,new Vi)}isEqual(e){return e instanceof ec}}class tc extends Qi{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){const t=r1(this,e,!0),n=this.Hu.map(s=>si(s,t)),i=new $n(n);return new Vd(e.path,i)}isEqual(e){return e instanceof tc&&nn(this.Hu,e.Hu)}}function Tp(r,e,t,n){const i=r.ju(1,e,t);rc("Data must be an object, but it was:",i,n);const s=[],o=Yt.empty();hn(n,(f,l)=>{const g=nc(e,f,t);l=xt(l);const w=i.Uu(g);if(l instanceof Ea)s.push(g);else{const y=si(l,w);y!=null&&(s.push(g),o.set(g,y))}});const a=new ir(s);return new _p(o,a,i.fieldTransforms)}function Cp(r,e,t,n,i,s){const o=r.ju(1,e,t),a=[su(e,n,t)],f=[i];if(s.length%2!=0)throw new de(X.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)a.push(su(e,s[y])),f.push(s[y+1]);const l=[],g=Yt.empty();for(let y=a.length-1;y>=0;--y)if(!Ap(l,a[y])){const p=a[y];let I=f[y];I=xt(I);const S=o.Uu(p);if(I instanceof Ea)l.push(p);else{const A=si(I,S);A!=null&&(l.push(p),g.set(p,A))}}const w=new ir(l);return new _p(g,w,o.fieldTransforms)}function n1(r,e,t,n=!1){return si(t,r.ju(n?4:3,e))}function si(r,e){if(Sp(r=xt(r)))return rc("Unsupported field value:",e,r),Ip(r,e);if(r instanceof Qi)return function(n,i){if(!Ep(i.Lu))throw i.Wu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(n,i){const s=[];let o=0;for(const a of n){let f=si(a,i.Ku(o));f==null&&(f={nullValue:"NULL_VALUE"}),s.push(f),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=xt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Gv(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=St.fromDate(n);return{timestampValue:Gs(i.serializer,s)}}if(n instanceof St){const s=new St(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Gs(i.serializer,s)}}if(n instanceof Xu)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Yn)return{bytesValue:qd(i.serializer,n._byteString)};if(n instanceof jt){const s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Wu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ku(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Ju)return function(o,a){return{mapValue:{fields:{[gd]:{stringValue:yd},[qs]:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Wu("VectorValues must only contain numeric values.");return Ru(a.serializer,l)})}}}}}}(n,i);throw i.Wu(`Unsupported field value: ${ya(n)}`)}(r,e)}function Ip(r,e){const t={};return cd(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):hn(r,(n,i)=>{const s=si(i,e.qu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function Sp(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof St||r instanceof Xu||r instanceof Yn||r instanceof jt||r instanceof Qi||r instanceof Ju)}function rc(r,e,t){if(!Sp(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const n=ya(t);throw n==="an object"?e.Wu(r+" a custom object"):e.Wu(r+" "+n)}}function su(r,e,t){if((e=xt(e))instanceof Wi)return e._internalPath;if(typeof e=="string")return nc(r,e);throw Ys("Field path arguments must be of type string or ",r,!1,void 0,t)}const i1=new RegExp("[~\\*/\\[\\]]");function nc(r,e,t){if(e.search(i1)>=0)throw Ys(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Wi(...e.split("."))._internalPath}catch{throw Ys(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ys(r,e,t,n,i){const s=n&&!n.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let f="";return(s||o)&&(f+=" (found",s&&(f+=` in field ${n}`),o&&(f+=` in document ${i}`),f+=")"),new de(X.INVALID_ARGUMENT,a+r+f)}function Ap(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new jt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new s1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ta("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class s1 extends xp{data(){return super.data()}}function Ta(r,e){return typeof e=="string"?nc(r,e):e instanceof Wi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wp(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new de(X.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ic{}class bp extends ic{}function au(r,e,...t){let n=[];e instanceof ic&&n.push(e),n=n.concat(t),function(s){const o=s.filter(f=>f instanceof sc).length,a=s.filter(f=>f instanceof Ca).length;if(o>1||o>0&&a>0)throw new de(X.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Ca extends bp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ca(e,t,n)}_apply(e){const t=this._parse(e);return Np(e._query,t),new dn(e.firestore,e.converter,Wo(e._query,t))}_parse(e){const t=Yi(e.firestore);return function(s,o,a,f,l,g,w){let y;if(l.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new de(X.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){yh(w,g);const I=[];for(const S of w)I.push(mh(f,s,S));y={arrayValue:{values:I}}}else y=mh(f,s,w)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||yh(w,g),y=n1(a,o,w,g==="in"||g==="not-in");return Tt.create(l,g,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Xs(r,e,t){const n=e,i=Ta("where",r);return Ca._create(i,n,t)}class sc extends ic{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new sc(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:dr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const f of a)Np(o,f),o=Wo(o,f)}(e._query,t),new dn(e.firestore,e.converter,Wo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ac extends bp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ac(e,t)}_apply(e){const t=function(i,s,o){if(i.startAt!==null)throw new de(X.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new de(X.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Li(s,o)}(e._query,this._field,this._direction);return new dn(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new ni(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function Rp(r,e="asc"){const t=e,n=Ta("orderBy",r);return ac._create(n,t)}function mh(r,e,t){if(typeof(t=xt(t))=="string"){if(t==="")throw new de(X.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ad(e)&&t.indexOf("/")!==-1)throw new de(X.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Ye.fromString(t));if(!ye.isDocumentKey(n))throw new de(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Pl(r,new ye(n))}if(t instanceof jt)return Pl(r,t._key);throw new de(X.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ya(t)}.`)}function yh(r,e){if(!Array.isArray(r)||r.length===0)throw new de(X.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Np(r,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new de(X.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new de(X.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class a1{convertValue(e,t="none"){switch(un(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(on(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw _e()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return hn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[qs].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>yt(o.doubleValue));return new Ju(s)}convertGeoPoint(e){return new Xu(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=oa(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Bi(e));default:return null}}convertTimestamp(e){const t=an(e);return new St(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ye.fromString(e);He(Wd(n));const i=new ki(n.get(1),n.get(3)),s=new ye(n.popFirst(5));return i.isEqual(t)||Ur(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oc(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Pp extends xp{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Bs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ta("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Bs extends Pp{data(e={}){return super.data(e)}}class Bp{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ci(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Bs(this._firestore,this._userDataWriter,n.key,n,new Ci(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new de(X.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const f=new Bs(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ci(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:f,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const f=new Bs(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ci(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,g=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),g=o.indexOf(a.doc.key)),{type:o1(a.type),doc:f,oldIndex:l,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function o1(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _e()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uc(r){r=Jt(r,jt);const e=Jt(r.firestore,Fr);return $E($i(e),r._key).then(t=>Lp(e,r,t))}class cc extends a1{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new jt(this.firestore,null,t)}}function u1(r){r=Jt(r,dn);const e=Jt(r.firestore,Fr),t=$i(e),n=new cc(e);return wp(r._query),WE(t,r._query).then(i=>new Bp(e,n,r,i))}function lc(r,e,t){r=Jt(r,jt);const n=Jt(r.firestore,Fr),i=oc(r.converter,e,t);return Ia(n,[Zu(Yi(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Xt.none())])}function Xn(r,e,t,...n){r=Jt(r,jt);const i=Jt(r.firestore,Fr),s=Yi(i);let o;return o=typeof(e=xt(e))=="string"||e instanceof Wi?Cp(s,"updateDoc",r._key,e,t,n):Tp(s,"updateDoc",r._key,e),Ia(i,[o.toMutation(r._key,Xt.exists(!0))])}function kp(r,e){const t=Jt(r.firestore,Fr),n=sr(r),i=oc(r.converter,e);return Ia(t,[Zu(Yi(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,Xt.exists(!1))]).then(()=>n)}function Dp(r,...e){var t,n,i;r=xt(r);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||gh(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(gh(e[o])){const w=e[o];e[o]=(t=w.next)===null||t===void 0?void 0:t.bind(w),e[o+1]=(n=w.error)===null||n===void 0?void 0:n.bind(w),e[o+2]=(i=w.complete)===null||i===void 0?void 0:i.bind(w)}let f,l,g;if(r instanceof jt)l=Jt(r.firestore,Fr),g=ua(r._key.path),f={next:w=>{e[o]&&e[o](Lp(l,r,w))},error:e[o+1],complete:e[o+2]};else{const w=Jt(r,dn);l=Jt(w.firestore,Fr),g=w._query;const y=new cc(l);f={next:p=>{e[o]&&e[o](new Bp(l,y,w,p))},error:e[o+1],complete:e[o+2]},wp(r._query)}return function(y,p,I,S){const A=new Yu(S),d=new $u(p,A,I);return y.asyncQueue.enqueueAndForget(async()=>Hu(await Qs(y),d)),()=>{A.su(),y.asyncQueue.enqueueAndForget(async()=>Gu(await Qs(y),d))}}($i(l),g,a,f)}function Ia(r,e){return function(n,i){const s=new Lr;return n.asyncQueue.enqueueAndForget(async()=>LE(await zE(n),i,s)),s.promise}($i(r),e)}function Lp(r,e,t){const n=t.docs.get(e._key),i=new cc(r);return new Pp(r,i,e._key,n,new Ci(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yi(e)}set(e,t,n){this._verifyNotCommitted();const i=$a(e,this._firestore),s=oc(i.converter,t,n),o=Zu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(o.toMutation(i._key,Xt.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=$a(e,this._firestore);let o;return o=typeof(t=xt(t))=="string"||t instanceof Wi?Cp(this._dataReader,"WriteBatch.update",s._key,t,n,i):Tp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Xt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=$a(e,this._firestore);return this._mutations=this._mutations.concat(new Nu(t._key,Xt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new de(X.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function $a(r,e){if((r=xt(r)).firestore!==e)throw new de(X.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function ou(){return new ec("serverTimestamp")}function vh(...r){return new tc("arrayUnion",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(r){return $i(r=Jt(r,Fr)),new c1(r,e=>Ia(r,e))}(function(e,t=!0){(function(i){ei=i})(Jn),Kn(new En("firestore",(n,{instanceIdentifier:i,options:s})=>{const o=n.getProvider("app").getImmediate(),a=new Fr(new av(n.getProvider("auth-internal")),new cv(o,n.getProvider("app-check-internal")),function(l,g){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new de(X.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ki(l.options.projectId,g)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),en(_l,El,e),en(_l,El,"esm2017")})();const h1={apiKey:"AIzaSyCDnbgpUQ_B9ELCJIm6X_wobNCWAuOnaEU",authDomain:"wydchat-93a30.firebaseapp.com",projectId:"wydchat-93a30",storageBucket:"wydchat-93a30.firebasestorage.app",messagingSenderId:"1050781551000",appId:"1:1050781551000:web:b968c555cd64a37cf883ed"},Vp=vf(h1),Nt=XE(Vp),f1=ev(Vp),uT=async()=>{const r=new Nr;try{const t=(await cy(f1,r)).user,n=sr(Nt,"users",t.uid);return(await uc(n)).exists()||await lc(n,{uid:t.uid,username:t.displayName,email:t.email,photoURL:t.photoURL,createdAt:new Date}),t}catch(e){throw console.error("Error signing in:",e),e}},d1=r=>{let e;const t=new Set,n=(l,g)=>{const w=typeof l=="function"?l(e):l;if(!Object.is(w,e)){const y=e;e=g??(typeof w!="object"||w===null)?w:Object.assign({},e,w),t.forEach(p=>p(e,y))}},i=()=>e,a={setState:n,getState:i,getInitialState:()=>f,subscribe:l=>(t.add(l),()=>t.delete(l))},f=e=r(n,i,a);return a},p1=r=>d1(r),g1=r=>r;function m1(r,e=g1){const t=Dr.useSyncExternalStore(r.subscribe,()=>e(r.getState()),()=>e(r.getInitialState()));return Dr.useDebugValue(t),t}const y1=r=>{const e=p1(r),t=n=>m1(e,n);return Object.assign(t,e),t},v1=r=>y1(r);function _1(r,e){let t;try{t=r()}catch{return}return{getItem:i=>{var s;const o=f=>f===null?null:JSON.parse(f,void 0),a=(s=t.getItem(i))!=null?s:null;return a instanceof Promise?a.then(o):o(a)},setItem:(i,s)=>t.setItem(i,JSON.stringify(s,void 0)),removeItem:i=>t.removeItem(i)}}const uu=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return uu(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return uu(n)(t)}}}},E1=(r,e)=>(t,n,i)=>{let s={storage:_1(()=>localStorage),partialize:S=>S,version:0,merge:(S,A)=>({...A,...S}),...e},o=!1;const a=new Set,f=new Set;let l=s.storage;if(!l)return r((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),t(...S)},n,i);const g=()=>{const S=s.partialize({...n()});return l.setItem(s.name,{state:S,version:s.version})},w=i.setState;i.setState=(S,A)=>{w(S,A),g()};const y=r((...S)=>{t(...S),g()},n,i);i.getInitialState=()=>y;let p;const I=()=>{var S,A;if(!l)return;o=!1,a.forEach(T=>{var x;return T((x=n())!=null?x:y)});const d=((A=s.onRehydrateStorage)==null?void 0:A.call(s,(S=n())!=null?S:y))||void 0;return uu(l.getItem.bind(l))(s.name).then(T=>{if(T)if(typeof T.version=="number"&&T.version!==s.version){if(s.migrate){const x=s.migrate(T.state,T.version);return x instanceof Promise?x.then(k=>[!0,k]):[!0,x]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,T.state];return[!1,void 0]}).then(T=>{var x;const[k,U]=T;if(p=s.merge(U,(x=n())!=null?x:y),t(p,!0),k)return g()}).then(()=>{d?.(p,void 0),p=n(),o=!0,f.forEach(T=>T(p))}).catch(T=>{d?.(void 0,T)})};return i.persist={setOptions:S=>{s={...s,...S},S.storage&&(l=S.storage)},clearStorage:()=>{l?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>I(),hasHydrated:()=>o,onHydrate:S=>(a.add(S),()=>{a.delete(S)}),onFinishHydration:S=>(f.add(S),()=>{f.delete(S)})},s.skipHydration||I(),p||y},T1=E1,Xi=v1(T1(r=>({logedInUser:null,selectedUserOrGroup:null,allUser:null,isGroupChanged:!1,isUpdateLastConversation:!1,setAllUser:e=>r({allUser:e}),setLogedInUser:e=>r({logedInUser:e}),setSelectedUserOrGroup:e=>r({selectedUserOrGroup:e}),setIsGroupChanged:e=>r({isGroupChanged:e}),setIsUpdateLastConversation:e=>r({isUpdateLastConversation:e}),logout:()=>{r({logedInUser:null,selectedUserOrGroup:null,allUser:null,isGroupChanged:!1}),localStorage.removeItem("auth-store")}}),{name:"auth-store",partialize:r=>({logedInUser:r.logedInUser,selectedUserOrGroup:r.selectedUserOrGroup,allUser:r.allUser})}));var Wa,_h;function Ne(){return _h||(_h=1,Wa={options:{usePureJavaScript:!1}}),Wa}var Qa={exports:{}},Ya,Eh;function C1(){if(Eh)return Ya;Eh=1;var r={};Ya=r;var e={};r.encode=function(n,i,s){if(typeof i!="string")throw new TypeError('"alphabet" must be a string.');if(s!==void 0&&typeof s!="number")throw new TypeError('"maxline" must be a number.');var o="";if(!(n instanceof Uint8Array))o=t(n,i);else{var a=0,f=i.length,l=i.charAt(0),g=[0];for(a=0;a<n.length;++a){for(var w=0,y=n[a];w<g.length;++w)y+=g[w]<<8,g[w]=y%f,y=y/f|0;for(;y>0;)g.push(y%f),y=y/f|0}for(a=0;n[a]===0&&a<n.length-1;++a)o+=l;for(a=g.length-1;a>=0;--a)o+=i[g[a]]}if(s){var p=new RegExp(".{1,"+s+"}","g");o=o.match(p).join(`\r
`)}return o},r.decode=function(n,i){if(typeof n!="string")throw new TypeError('"input" must be a string.');if(typeof i!="string")throw new TypeError('"alphabet" must be a string.');var s=e[i];if(!s){s=e[i]=[];for(var o=0;o<i.length;++o)s[i.charCodeAt(o)]=o}n=n.replace(/\s/g,"");for(var a=i.length,f=i.charAt(0),l=[0],o=0;o<n.length;o++){var g=s[n.charCodeAt(o)];if(g===void 0)return;for(var w=0,y=g;w<l.length;++w)y+=l[w]*a,l[w]=y&255,y>>=8;for(;y>0;)l.push(y&255),y>>=8}for(var p=0;n[p]===f&&p<n.length-1;++p)l.push(0);return typeof Buffer<"u"?Buffer.from(l.reverse()):new Uint8Array(l.reverse())};function t(n,i){var s=0,o=i.length,a=i.charAt(0),f=[0];for(s=0;s<n.length();++s){for(var l=0,g=n.at(s);l<f.length;++l)g+=f[l]<<8,f[l]=g%o,g=g/o|0;for(;g>0;)f.push(g%o),g=g/o|0}var w="";for(s=0;n.at(s)===0&&s<n.length()-1;++s)w+=a;for(s=f.length-1;s>=0;--s)w+=i[f[s]];return w}return Ya}var Th;function Ke(){if(Th)return Qa.exports;Th=1;var r=Ne(),e=C1(),t=Qa.exports=r.util=r.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){t.nextTick=process.nextTick,typeof setImmediate=="function"?t.setImmediate=setImmediate:t.setImmediate=t.nextTick;return}if(typeof setImmediate=="function"){t.setImmediate=function(){return setImmediate.apply(void 0,arguments)},t.nextTick=function(h){return setImmediate(h)};return}if(t.setImmediate=function(h){setTimeout(h,0)},typeof window<"u"&&typeof window.postMessage=="function"){let h=function(c){if(c.source===window&&c.data===d){c.stopPropagation();var v=T.slice();T.length=0,v.forEach(function(b){b()})}};var d="forge.setImmediate",T=[];t.setImmediate=function(c){T.push(c),T.length===1&&window.postMessage(d,"*")},window.addEventListener("message",h,!0)}if(typeof MutationObserver<"u"){var x=Date.now(),k=!0,U=document.createElement("div"),T=[];new MutationObserver(function(){var c=T.slice();T.length=0,c.forEach(function(v){v()})}).observe(U,{attributes:!0});var _=t.setImmediate;t.setImmediate=function(c){Date.now()-x>15?(x=Date.now(),_(c)):(T.push(c),T.length===1&&U.setAttribute("a",k=!k))}}t.nextTick=t.setImmediate})(),t.isNodejs=typeof process<"u"&&process.versions&&process.versions.node,t.globalScope=function(){return t.isNodejs?v0:typeof self>"u"?window:self}(),t.isArray=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"},t.isArrayBuffer=function(d){return typeof ArrayBuffer<"u"&&d instanceof ArrayBuffer},t.isArrayBufferView=function(d){return d&&t.isArrayBuffer(d.buffer)&&d.byteLength!==void 0};function n(d){if(!(d===8||d===16||d===24||d===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+d)}t.ByteBuffer=i;function i(d){if(this.data="",this.read=0,typeof d=="string")this.data=d;else if(t.isArrayBuffer(d)||t.isArrayBufferView(d))if(typeof Buffer<"u"&&d instanceof Buffer)this.data=d.toString("binary");else{var T=new Uint8Array(d);try{this.data=String.fromCharCode.apply(null,T)}catch{for(var x=0;x<T.length;++x)this.putByte(T[x])}}else(d instanceof i||typeof d=="object"&&typeof d.data=="string"&&typeof d.read=="number")&&(this.data=d.data,this.read=d.read);this._constructedStringLength=0}t.ByteStringBuffer=i;var s=4096;t.ByteStringBuffer.prototype._optimizeConstructedString=function(d){this._constructedStringLength+=d,this._constructedStringLength>s&&(this.data.substr(0,1),this._constructedStringLength=0)},t.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},t.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},t.ByteStringBuffer.prototype.putByte=function(d){return this.putBytes(String.fromCharCode(d))},t.ByteStringBuffer.prototype.fillWithByte=function(d,T){d=String.fromCharCode(d);for(var x=this.data;T>0;)T&1&&(x+=d),T>>>=1,T>0&&(d+=d);return this.data=x,this._optimizeConstructedString(T),this},t.ByteStringBuffer.prototype.putBytes=function(d){return this.data+=d,this._optimizeConstructedString(d.length),this},t.ByteStringBuffer.prototype.putString=function(d){return this.putBytes(t.encodeUtf8(d))},t.ByteStringBuffer.prototype.putInt16=function(d){return this.putBytes(String.fromCharCode(d>>8&255)+String.fromCharCode(d&255))},t.ByteStringBuffer.prototype.putInt24=function(d){return this.putBytes(String.fromCharCode(d>>16&255)+String.fromCharCode(d>>8&255)+String.fromCharCode(d&255))},t.ByteStringBuffer.prototype.putInt32=function(d){return this.putBytes(String.fromCharCode(d>>24&255)+String.fromCharCode(d>>16&255)+String.fromCharCode(d>>8&255)+String.fromCharCode(d&255))},t.ByteStringBuffer.prototype.putInt16Le=function(d){return this.putBytes(String.fromCharCode(d&255)+String.fromCharCode(d>>8&255))},t.ByteStringBuffer.prototype.putInt24Le=function(d){return this.putBytes(String.fromCharCode(d&255)+String.fromCharCode(d>>8&255)+String.fromCharCode(d>>16&255))},t.ByteStringBuffer.prototype.putInt32Le=function(d){return this.putBytes(String.fromCharCode(d&255)+String.fromCharCode(d>>8&255)+String.fromCharCode(d>>16&255)+String.fromCharCode(d>>24&255))},t.ByteStringBuffer.prototype.putInt=function(d,T){n(T);var x="";do T-=8,x+=String.fromCharCode(d>>T&255);while(T>0);return this.putBytes(x)},t.ByteStringBuffer.prototype.putSignedInt=function(d,T){return d<0&&(d+=2<<T-1),this.putInt(d,T)},t.ByteStringBuffer.prototype.putBuffer=function(d){return this.putBytes(d.getBytes())},t.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},t.ByteStringBuffer.prototype.getInt16=function(){var d=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,d},t.ByteStringBuffer.prototype.getInt24=function(){var d=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,d},t.ByteStringBuffer.prototype.getInt32=function(){var d=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,d},t.ByteStringBuffer.prototype.getInt16Le=function(){var d=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,d},t.ByteStringBuffer.prototype.getInt24Le=function(){var d=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,d},t.ByteStringBuffer.prototype.getInt32Le=function(){var d=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,d},t.ByteStringBuffer.prototype.getInt=function(d){n(d);var T=0;do T=(T<<8)+this.data.charCodeAt(this.read++),d-=8;while(d>0);return T},t.ByteStringBuffer.prototype.getSignedInt=function(d){var T=this.getInt(d),x=2<<d-2;return T>=x&&(T-=x<<1),T},t.ByteStringBuffer.prototype.getBytes=function(d){var T;return d?(d=Math.min(this.length(),d),T=this.data.slice(this.read,this.read+d),this.read+=d):d===0?T="":(T=this.read===0?this.data:this.data.slice(this.read),this.clear()),T},t.ByteStringBuffer.prototype.bytes=function(d){return typeof d>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+d)},t.ByteStringBuffer.prototype.at=function(d){return this.data.charCodeAt(this.read+d)},t.ByteStringBuffer.prototype.setAt=function(d,T){return this.data=this.data.substr(0,this.read+d)+String.fromCharCode(T)+this.data.substr(this.read+d+1),this},t.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},t.ByteStringBuffer.prototype.copy=function(){var d=t.createBuffer(this.data);return d.read=this.read,d},t.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},t.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},t.ByteStringBuffer.prototype.truncate=function(d){var T=Math.max(0,this.length()-d);return this.data=this.data.substr(this.read,T),this.read=0,this},t.ByteStringBuffer.prototype.toHex=function(){for(var d="",T=this.read;T<this.data.length;++T){var x=this.data.charCodeAt(T);x<16&&(d+="0"),d+=x.toString(16)}return d},t.ByteStringBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())};function o(d,T){T=T||{},this.read=T.readOffset||0,this.growSize=T.growSize||1024;var x=t.isArrayBuffer(d),k=t.isArrayBufferView(d);if(x||k){x?this.data=new DataView(d):this.data=new DataView(d.buffer,d.byteOffset,d.byteLength),this.write="writeOffset"in T?T.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,d!=null&&this.putBytes(d),"writeOffset"in T&&(this.write=T.writeOffset)}t.DataBuffer=o,t.DataBuffer.prototype.length=function(){return this.write-this.read},t.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},t.DataBuffer.prototype.accommodate=function(d,T){if(this.length()>=d)return this;T=Math.max(T||this.growSize,d);var x=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),k=new Uint8Array(this.length()+T);return k.set(x),this.data=new DataView(k.buffer),this},t.DataBuffer.prototype.putByte=function(d){return this.accommodate(1),this.data.setUint8(this.write++,d),this},t.DataBuffer.prototype.fillWithByte=function(d,T){this.accommodate(T);for(var x=0;x<T;++x)this.data.setUint8(d);return this},t.DataBuffer.prototype.putBytes=function(d,T){if(t.isArrayBufferView(d)){var x=new Uint8Array(d.buffer,d.byteOffset,d.byteLength),k=x.byteLength-x.byteOffset;this.accommodate(k);var U=new Uint8Array(this.data.buffer,this.write);return U.set(x),this.write+=k,this}if(t.isArrayBuffer(d)){var x=new Uint8Array(d);this.accommodate(x.byteLength);var U=new Uint8Array(this.data.buffer);return U.set(x,this.write),this.write+=x.byteLength,this}if(d instanceof t.DataBuffer||typeof d=="object"&&typeof d.read=="number"&&typeof d.write=="number"&&t.isArrayBufferView(d.data)){var x=new Uint8Array(d.data.byteLength,d.read,d.length());this.accommodate(x.byteLength);var U=new Uint8Array(d.data.byteLength,this.write);return U.set(x),this.write+=x.byteLength,this}if(d instanceof t.ByteStringBuffer&&(d=d.data,T="binary"),T=T||"binary",typeof d=="string"){var _;if(T==="hex")return this.accommodate(Math.ceil(d.length/2)),_=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.hex.decode(d,_,this.write),this;if(T==="base64")return this.accommodate(Math.ceil(d.length/4)*3),_=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.base64.decode(d,_,this.write),this;if(T==="utf8"&&(d=t.encodeUtf8(d),T="binary"),T==="binary"||T==="raw")return this.accommodate(d.length),_=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.raw.decode(_),this;if(T==="utf16")return this.accommodate(d.length*2),_=new Uint16Array(this.data.buffer,this.write),this.write+=t.text.utf16.encode(_),this;throw new Error("Invalid encoding: "+T)}throw Error("Invalid parameter: "+d)},t.DataBuffer.prototype.putBuffer=function(d){return this.putBytes(d),d.clear(),this},t.DataBuffer.prototype.putString=function(d){return this.putBytes(d,"utf16")},t.DataBuffer.prototype.putInt16=function(d){return this.accommodate(2),this.data.setInt16(this.write,d),this.write+=2,this},t.DataBuffer.prototype.putInt24=function(d){return this.accommodate(3),this.data.setInt16(this.write,d>>8&65535),this.data.setInt8(this.write,d>>16&255),this.write+=3,this},t.DataBuffer.prototype.putInt32=function(d){return this.accommodate(4),this.data.setInt32(this.write,d),this.write+=4,this},t.DataBuffer.prototype.putInt16Le=function(d){return this.accommodate(2),this.data.setInt16(this.write,d,!0),this.write+=2,this},t.DataBuffer.prototype.putInt24Le=function(d){return this.accommodate(3),this.data.setInt8(this.write,d>>16&255),this.data.setInt16(this.write,d>>8&65535,!0),this.write+=3,this},t.DataBuffer.prototype.putInt32Le=function(d){return this.accommodate(4),this.data.setInt32(this.write,d,!0),this.write+=4,this},t.DataBuffer.prototype.putInt=function(d,T){n(T),this.accommodate(T/8);do T-=8,this.data.setInt8(this.write++,d>>T&255);while(T>0);return this},t.DataBuffer.prototype.putSignedInt=function(d,T){return n(T),this.accommodate(T/8),d<0&&(d+=2<<T-1),this.putInt(d,T)},t.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},t.DataBuffer.prototype.getInt16=function(){var d=this.data.getInt16(this.read);return this.read+=2,d},t.DataBuffer.prototype.getInt24=function(){var d=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,d},t.DataBuffer.prototype.getInt32=function(){var d=this.data.getInt32(this.read);return this.read+=4,d},t.DataBuffer.prototype.getInt16Le=function(){var d=this.data.getInt16(this.read,!0);return this.read+=2,d},t.DataBuffer.prototype.getInt24Le=function(){var d=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,d},t.DataBuffer.prototype.getInt32Le=function(){var d=this.data.getInt32(this.read,!0);return this.read+=4,d},t.DataBuffer.prototype.getInt=function(d){n(d);var T=0;do T=(T<<8)+this.data.getInt8(this.read++),d-=8;while(d>0);return T},t.DataBuffer.prototype.getSignedInt=function(d){var T=this.getInt(d),x=2<<d-2;return T>=x&&(T-=x<<1),T},t.DataBuffer.prototype.getBytes=function(d){var T;return d?(d=Math.min(this.length(),d),T=this.data.slice(this.read,this.read+d),this.read+=d):d===0?T="":(T=this.read===0?this.data:this.data.slice(this.read),this.clear()),T},t.DataBuffer.prototype.bytes=function(d){return typeof d>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+d)},t.DataBuffer.prototype.at=function(d){return this.data.getUint8(this.read+d)},t.DataBuffer.prototype.setAt=function(d,T){return this.data.setUint8(d,T),this},t.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},t.DataBuffer.prototype.copy=function(){return new t.DataBuffer(this)},t.DataBuffer.prototype.compact=function(){if(this.read>0){var d=new Uint8Array(this.data.buffer,this.read),T=new Uint8Array(d.byteLength);T.set(d),this.data=new DataView(T),this.write-=this.read,this.read=0}return this},t.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},t.DataBuffer.prototype.truncate=function(d){return this.write=Math.max(0,this.length()-d),this.read=Math.min(this.read,this.write),this},t.DataBuffer.prototype.toHex=function(){for(var d="",T=this.read;T<this.data.byteLength;++T){var x=this.data.getUint8(T);x<16&&(d+="0"),d+=x.toString(16)}return d},t.DataBuffer.prototype.toString=function(d){var T=new Uint8Array(this.data,this.read,this.length());if(d=d||"utf8",d==="binary"||d==="raw")return t.binary.raw.encode(T);if(d==="hex")return t.binary.hex.encode(T);if(d==="base64")return t.binary.base64.encode(T);if(d==="utf8")return t.text.utf8.decode(T);if(d==="utf16")return t.text.utf16.decode(T);throw new Error("Invalid encoding: "+d)},t.createBuffer=function(d,T){return T=T||"raw",d!==void 0&&T==="utf8"&&(d=t.encodeUtf8(d)),new t.ByteBuffer(d)},t.fillString=function(d,T){for(var x="";T>0;)T&1&&(x+=d),T>>>=1,T>0&&(d+=d);return x},t.xorBytes=function(d,T,x){for(var k="",U="",_="",h=0,c=0;x>0;--x,++h)U=d.charCodeAt(h)^T.charCodeAt(h),c>=10&&(k+=_,_="",c=0),_+=String.fromCharCode(U),++c;return k+=_,k},t.hexToBytes=function(d){var T="",x=0;for(d.length&!0&&(x=1,T+=String.fromCharCode(parseInt(d[0],16)));x<d.length;x+=2)T+=String.fromCharCode(parseInt(d.substr(x,2),16));return T},t.bytesToHex=function(d){return t.createBuffer(d).toHex()},t.int32ToBytes=function(d){return String.fromCharCode(d>>24&255)+String.fromCharCode(d>>16&255)+String.fromCharCode(d>>8&255)+String.fromCharCode(d&255)};var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],l="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";t.encode64=function(d,T){for(var x="",k="",U,_,h,c=0;c<d.length;)U=d.charCodeAt(c++),_=d.charCodeAt(c++),h=d.charCodeAt(c++),x+=a.charAt(U>>2),x+=a.charAt((U&3)<<4|_>>4),isNaN(_)?x+="==":(x+=a.charAt((_&15)<<2|h>>6),x+=isNaN(h)?"=":a.charAt(h&63)),T&&x.length>T&&(k+=x.substr(0,T)+`\r
`,x=x.substr(T));return k+=x,k},t.decode64=function(d){d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var T="",x,k,U,_,h=0;h<d.length;)x=f[d.charCodeAt(h++)-43],k=f[d.charCodeAt(h++)-43],U=f[d.charCodeAt(h++)-43],_=f[d.charCodeAt(h++)-43],T+=String.fromCharCode(x<<2|k>>4),U!==64&&(T+=String.fromCharCode((k&15)<<4|U>>2),_!==64&&(T+=String.fromCharCode((U&3)<<6|_)));return T},t.encodeUtf8=function(d){return unescape(encodeURIComponent(d))},t.decodeUtf8=function(d){return decodeURIComponent(escape(d))},t.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:e.encode,decode:e.decode}},t.binary.raw.encode=function(d){return String.fromCharCode.apply(null,d)},t.binary.raw.decode=function(d,T,x){var k=T;k||(k=new Uint8Array(d.length)),x=x||0;for(var U=x,_=0;_<d.length;++_)k[U++]=d.charCodeAt(_);return T?U-x:k},t.binary.hex.encode=t.bytesToHex,t.binary.hex.decode=function(d,T,x){var k=T;k||(k=new Uint8Array(Math.ceil(d.length/2))),x=x||0;var U=0,_=x;for(d.length&1&&(U=1,k[_++]=parseInt(d[0],16));U<d.length;U+=2)k[_++]=parseInt(d.substr(U,2),16);return T?_-x:k},t.binary.base64.encode=function(d,T){for(var x="",k="",U,_,h,c=0;c<d.byteLength;)U=d[c++],_=d[c++],h=d[c++],x+=a.charAt(U>>2),x+=a.charAt((U&3)<<4|_>>4),isNaN(_)?x+="==":(x+=a.charAt((_&15)<<2|h>>6),x+=isNaN(h)?"=":a.charAt(h&63)),T&&x.length>T&&(k+=x.substr(0,T)+`\r
`,x=x.substr(T));return k+=x,k},t.binary.base64.decode=function(d,T,x){var k=T;k||(k=new Uint8Array(Math.ceil(d.length/4)*3)),d=d.replace(/[^A-Za-z0-9\+\/\=]/g,""),x=x||0;for(var U,_,h,c,v=0,b=x;v<d.length;)U=f[d.charCodeAt(v++)-43],_=f[d.charCodeAt(v++)-43],h=f[d.charCodeAt(v++)-43],c=f[d.charCodeAt(v++)-43],k[b++]=U<<2|_>>4,h!==64&&(k[b++]=(_&15)<<4|h>>2,c!==64&&(k[b++]=(h&3)<<6|c));return T?b-x:k.subarray(0,b)},t.binary.base58.encode=function(d,T){return t.binary.baseN.encode(d,l,T)},t.binary.base58.decode=function(d,T){return t.binary.baseN.decode(d,l,T)},t.text={utf8:{},utf16:{}},t.text.utf8.encode=function(d,T,x){d=t.encodeUtf8(d);var k=T;k||(k=new Uint8Array(d.length)),x=x||0;for(var U=x,_=0;_<d.length;++_)k[U++]=d.charCodeAt(_);return T?U-x:k},t.text.utf8.decode=function(d){return t.decodeUtf8(String.fromCharCode.apply(null,d))},t.text.utf16.encode=function(d,T,x){var k=T;k||(k=new Uint8Array(d.length*2));var U=new Uint16Array(k.buffer);x=x||0;for(var _=x,h=x,c=0;c<d.length;++c)U[h++]=d.charCodeAt(c),_+=2;return T?_-x:k},t.text.utf16.decode=function(d){return String.fromCharCode.apply(null,new Uint16Array(d.buffer))},t.deflate=function(d,T,x){if(T=t.decode64(d.deflate(t.encode64(T)).rval),x){var k=2,U=T.charCodeAt(1);U&32&&(k=6),T=T.substring(k,T.length-4)}return T},t.inflate=function(d,T,x){var k=d.inflate(t.encode64(T)).rval;return k===null?null:t.decode64(k)};var g=function(d,T,x){if(!d)throw new Error("WebStorage not available.");var k;if(x===null?k=d.removeItem(T):(x=t.encode64(JSON.stringify(x)),k=d.setItem(T,x)),typeof k<"u"&&k.rval!==!0){var U=new Error(k.error.message);throw U.id=k.error.id,U.name=k.error.name,U}},w=function(d,T){if(!d)throw new Error("WebStorage not available.");var x=d.getItem(T);if(d.init)if(x.rval===null){if(x.error){var k=new Error(x.error.message);throw k.id=x.error.id,k.name=x.error.name,k}x=null}else x=x.rval;return x!==null&&(x=JSON.parse(t.decode64(x))),x},y=function(d,T,x,k){var U=w(d,T);U===null&&(U={}),U[x]=k,g(d,T,U)},p=function(d,T,x){var k=w(d,T);return k!==null&&(k=x in k?k[x]:null),k},I=function(d,T,x){var k=w(d,T);if(k!==null&&x in k){delete k[x];var U=!0;for(var _ in k){U=!1;break}U&&(k=null),g(d,T,k)}},S=function(d,T){g(d,T,null)},A=function(d,T,x){var k=null;typeof x>"u"&&(x=["web","flash"]);var U,_=!1,h=null;for(var c in x){U=x[c];try{if(U==="flash"||U==="both"){if(T[0]===null)throw new Error("Flash local storage not available.");k=d.apply(this,T),_=U==="flash"}(U==="web"||U==="both")&&(T[0]=localStorage,k=d.apply(this,T),_=!0)}catch(v){h=v}if(_)break}if(!_)throw h;return k};return t.setItem=function(d,T,x,k,U){A(y,arguments,U)},t.getItem=function(d,T,x,k){return A(p,arguments,k)},t.removeItem=function(d,T,x,k){A(I,arguments,k)},t.clearItems=function(d,T,x){A(S,arguments,x)},t.isEmpty=function(d){for(var T in d)if(d.hasOwnProperty(T))return!1;return!0},t.format=function(d){for(var T=/%./g,x,k,U=0,_=[],h=0;x=T.exec(d);){k=d.substring(h,T.lastIndex-2),k.length>0&&_.push(k),h=T.lastIndex;var c=x[0][1];switch(c){case"s":case"o":U<arguments.length?_.push(arguments[U+++1]):_.push("<?>");break;case"%":_.push("%");break;default:_.push("<%"+c+"?>")}}return _.push(d.substring(h)),_.join("")},t.formatNumber=function(d,T,x,k){var U=d,_=isNaN(T=Math.abs(T))?2:T,h=x===void 0?",":x,c=k===void 0?".":k,v=U<0?"-":"",b=parseInt(U=Math.abs(+U||0).toFixed(_),10)+"",B=b.length>3?b.length%3:0;return v+(B?b.substr(0,B)+c:"")+b.substr(B).replace(/(\d{3})(?=\d)/g,"$1"+c)+(_?h+Math.abs(U-b).toFixed(_).slice(2):"")},t.formatSize=function(d){return d>=1073741824?d=t.formatNumber(d/1073741824,2,".","")+" GiB":d>=1048576?d=t.formatNumber(d/1048576,2,".","")+" MiB":d>=1024?d=t.formatNumber(d/1024,0)+" KiB":d=t.formatNumber(d,0)+" bytes",d},t.bytesFromIP=function(d){return d.indexOf(".")!==-1?t.bytesFromIPv4(d):d.indexOf(":")!==-1?t.bytesFromIPv6(d):null},t.bytesFromIPv4=function(d){if(d=d.split("."),d.length!==4)return null;for(var T=t.createBuffer(),x=0;x<d.length;++x){var k=parseInt(d[x],10);if(isNaN(k))return null;T.putByte(k)}return T.getBytes()},t.bytesFromIPv6=function(d){var T=0;d=d.split(":").filter(function(h){return h.length===0&&++T,!0});for(var x=(8-d.length+T)*2,k=t.createBuffer(),U=0;U<8;++U){if(!d[U]||d[U].length===0){k.fillWithByte(0,x),x=0;continue}var _=t.hexToBytes(d[U]);_.length<2&&k.putByte(0),k.putBytes(_)}return k.getBytes()},t.bytesToIP=function(d){return d.length===4?t.bytesToIPv4(d):d.length===16?t.bytesToIPv6(d):null},t.bytesToIPv4=function(d){if(d.length!==4)return null;for(var T=[],x=0;x<d.length;++x)T.push(d.charCodeAt(x));return T.join(".")},t.bytesToIPv6=function(d){if(d.length!==16)return null;for(var T=[],x=[],k=0,U=0;U<d.length;U+=2){for(var _=t.bytesToHex(d[U]+d[U+1]);_[0]==="0"&&_!=="0";)_=_.substr(1);if(_==="0"){var h=x[x.length-1],c=T.length;!h||c!==h.end+1?x.push({start:c,end:c}):(h.end=c,h.end-h.start>x[k].end-x[k].start&&(k=x.length-1))}T.push(_)}if(x.length>0){var v=x[k];v.end-v.start>0&&(T.splice(v.start,v.end-v.start+1,""),v.start===0&&T.unshift(""),v.end===7&&T.push(""))}return T.join(":")},t.estimateCores=function(d,T){if(typeof d=="function"&&(T=d,d={}),d=d||{},"cores"in t&&!d.update)return T(null,t.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return t.cores=navigator.hardwareConcurrency,T(null,t.cores);if(typeof Worker>"u")return t.cores=1,T(null,t.cores);if(typeof Blob>"u")return t.cores=2,T(null,t.cores);var x=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(h){var c=Date.now(),v=c+4;self.postMessage({st:c,et:v})})}.toString(),")()"],{type:"application/javascript"}));k([],5,16);function k(h,c,v){if(c===0){var b=Math.floor(h.reduce(function(B,R){return B+R},0)/h.length);return t.cores=Math.max(1,b),URL.revokeObjectURL(x),T(null,t.cores)}U(v,function(B,R){h.push(_(v,R)),k(h,c-1,v)})}function U(h,c){for(var v=[],b=[],B=0;B<h;++B){var R=new Worker(x);R.addEventListener("message",function(P){if(b.push(P.data),b.length===h){for(var H=0;H<h;++H)v[H].terminate();c(null,b)}}),v.push(R)}for(var B=0;B<h;++B)v[B].postMessage(B)}function _(h,c){for(var v=[],b=0;b<h;++b)for(var B=c[b],R=v[b]=[],P=0;P<h;++P)if(b!==P){var H=c[P];(B.st>H.st&&B.st<H.et||H.st>B.st&&H.st<B.et)&&R.push(P)}return v.reduce(function(z,W){return Math.max(z,W.length)},0)}},Qa.exports}var Xa,Ch;function hc(){if(Ch)return Xa;Ch=1;var r=Ne();Ke(),Xa=r.cipher=r.cipher||{},r.cipher.algorithms=r.cipher.algorithms||{},r.cipher.createCipher=function(t,n){var i=t;if(typeof i=="string"&&(i=r.cipher.getAlgorithm(i),i&&(i=i())),!i)throw new Error("Unsupported algorithm: "+t);return new r.cipher.BlockCipher({algorithm:i,key:n,decrypt:!1})},r.cipher.createDecipher=function(t,n){var i=t;if(typeof i=="string"&&(i=r.cipher.getAlgorithm(i),i&&(i=i())),!i)throw new Error("Unsupported algorithm: "+t);return new r.cipher.BlockCipher({algorithm:i,key:n,decrypt:!0})},r.cipher.registerAlgorithm=function(t,n){t=t.toUpperCase(),r.cipher.algorithms[t]=n},r.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in r.cipher.algorithms?r.cipher.algorithms[t]:null};var e=r.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};return e.prototype.start=function(t){t=t||{};var n={};for(var i in t)n[i]=t[i];n.decrypt=this._decrypt,this._finish=!1,this._input=r.util.createBuffer(),this.output=t.output||r.util.createBuffer(),this.mode.start(n)},e.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},e.prototype.finish=function(t){t&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(i){return t(this.blockSize,i,!1)},this.mode.unpad=function(i){return t(this.blockSize,i,!0)});var n={};return n.decrypt=this._decrypt,n.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,n)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,n))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,n))},Xa}var Ja={exports:{}},Ih;function Op(){if(Ih)return Ja.exports;Ih=1;var r=Ne();Ke(),r.cipher=r.cipher||{};var e=Ja.exports=r.cipher.modes=r.cipher.modes||{};e.ecb=function(s){s=s||{},this.name="ECB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},e.ecb.prototype.start=function(s){},e.ecb.prototype.encrypt=function(s,o,a){if(s.length()<this.blockSize&&!(a&&s.length()>0))return!0;for(var f=0;f<this._ints;++f)this._inBlock[f]=s.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var f=0;f<this._ints;++f)o.putInt32(this._outBlock[f])},e.ecb.prototype.decrypt=function(s,o,a){if(s.length()<this.blockSize&&!(a&&s.length()>0))return!0;for(var f=0;f<this._ints;++f)this._inBlock[f]=s.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var f=0;f<this._ints;++f)o.putInt32(this._outBlock[f])},e.ecb.prototype.pad=function(s,o){var a=s.length()===this.blockSize?this.blockSize:this.blockSize-s.length();return s.fillWithByte(a,a),!0},e.ecb.prototype.unpad=function(s,o){if(o.overflow>0)return!1;var a=s.length(),f=s.at(a-1);return f>this.blockSize<<2?!1:(s.truncate(f),!0)},e.cbc=function(s){s=s||{},this.name="CBC",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},e.cbc.prototype.start=function(s){if(s.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in s)this._iv=t(s.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")},e.cbc.prototype.encrypt=function(s,o,a){if(s.length()<this.blockSize&&!(a&&s.length()>0))return!0;for(var f=0;f<this._ints;++f)this._inBlock[f]=this._prev[f]^s.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var f=0;f<this._ints;++f)o.putInt32(this._outBlock[f]);this._prev=this._outBlock},e.cbc.prototype.decrypt=function(s,o,a){if(s.length()<this.blockSize&&!(a&&s.length()>0))return!0;for(var f=0;f<this._ints;++f)this._inBlock[f]=s.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var f=0;f<this._ints;++f)o.putInt32(this._prev[f]^this._outBlock[f]);this._prev=this._inBlock.slice(0)},e.cbc.prototype.pad=function(s,o){var a=s.length()===this.blockSize?this.blockSize:this.blockSize-s.length();return s.fillWithByte(a,a),!0},e.cbc.prototype.unpad=function(s,o){if(o.overflow>0)return!1;var a=s.length(),f=s.at(a-1);return f>this.blockSize<<2?!1:(s.truncate(f),!0)},e.cfb=function(s){s=s||{},this.name="CFB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},e.cfb.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=t(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.cfb.prototype.encrypt=function(s,o,a){var f=s.length();if(f===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&f>=this.blockSize){for(var l=0;l<this._ints;++l)this._inBlock[l]=s.getInt32()^this._outBlock[l],o.putInt32(this._inBlock[l]);return}var g=(this.blockSize-f)%this.blockSize;g>0&&(g=this.blockSize-g),this._partialOutput.clear();for(var l=0;l<this._ints;++l)this._partialBlock[l]=s.getInt32()^this._outBlock[l],this._partialOutput.putInt32(this._partialBlock[l]);if(g>0)s.read-=this.blockSize;else for(var l=0;l<this._ints;++l)this._inBlock[l]=this._partialBlock[l];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),g>0&&!a)return o.putBytes(this._partialOutput.getBytes(g-this._partialBytes)),this._partialBytes=g,!0;o.putBytes(this._partialOutput.getBytes(f-this._partialBytes)),this._partialBytes=0},e.cfb.prototype.decrypt=function(s,o,a){var f=s.length();if(f===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&f>=this.blockSize){for(var l=0;l<this._ints;++l)this._inBlock[l]=s.getInt32(),o.putInt32(this._inBlock[l]^this._outBlock[l]);return}var g=(this.blockSize-f)%this.blockSize;g>0&&(g=this.blockSize-g),this._partialOutput.clear();for(var l=0;l<this._ints;++l)this._partialBlock[l]=s.getInt32(),this._partialOutput.putInt32(this._partialBlock[l]^this._outBlock[l]);if(g>0)s.read-=this.blockSize;else for(var l=0;l<this._ints;++l)this._inBlock[l]=this._partialBlock[l];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),g>0&&!a)return o.putBytes(this._partialOutput.getBytes(g-this._partialBytes)),this._partialBytes=g,!0;o.putBytes(this._partialOutput.getBytes(f-this._partialBytes)),this._partialBytes=0},e.ofb=function(s){s=s||{},this.name="OFB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},e.ofb.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=t(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.ofb.prototype.encrypt=function(s,o,a){var f=s.length();if(s.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&f>=this.blockSize){for(var l=0;l<this._ints;++l)o.putInt32(s.getInt32()^this._outBlock[l]),this._inBlock[l]=this._outBlock[l];return}var g=(this.blockSize-f)%this.blockSize;g>0&&(g=this.blockSize-g),this._partialOutput.clear();for(var l=0;l<this._ints;++l)this._partialOutput.putInt32(s.getInt32()^this._outBlock[l]);if(g>0)s.read-=this.blockSize;else for(var l=0;l<this._ints;++l)this._inBlock[l]=this._outBlock[l];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),g>0&&!a)return o.putBytes(this._partialOutput.getBytes(g-this._partialBytes)),this._partialBytes=g,!0;o.putBytes(this._partialOutput.getBytes(f-this._partialBytes)),this._partialBytes=0},e.ofb.prototype.decrypt=e.ofb.prototype.encrypt,e.ctr=function(s){s=s||{},this.name="CTR",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},e.ctr.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=t(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.ctr.prototype.encrypt=function(s,o,a){var f=s.length();if(f===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&f>=this.blockSize)for(var l=0;l<this._ints;++l)o.putInt32(s.getInt32()^this._outBlock[l]);else{var g=(this.blockSize-f)%this.blockSize;g>0&&(g=this.blockSize-g),this._partialOutput.clear();for(var l=0;l<this._ints;++l)this._partialOutput.putInt32(s.getInt32()^this._outBlock[l]);if(g>0&&(s.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),g>0&&!a)return o.putBytes(this._partialOutput.getBytes(g-this._partialBytes)),this._partialBytes=g,!0;o.putBytes(this._partialOutput.getBytes(f-this._partialBytes)),this._partialBytes=0}n(this._inBlock)},e.ctr.prototype.decrypt=e.ctr.prototype.encrypt,e.gcm=function(s){s=s||{},this.name="GCM",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0,this._R=3774873600},e.gcm.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");var o=r.util.createBuffer(s.iv);this._cipherLength=0;var a;if("additionalData"in s?a=r.util.createBuffer(s.additionalData):a=r.util.createBuffer(),"tagLength"in s?this._tagLength=s.tagLength:this._tagLength=128,this._tag=null,s.decrypt&&(this._tag=r.util.createBuffer(s.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var f=o.length();if(f===12)this._j0=[o.getInt32(),o.getInt32(),o.getInt32(),1];else{for(this._j0=[0,0,0,0];o.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[o.getInt32(),o.getInt32(),o.getInt32(),o.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(i(f*8)))}this._inBlock=this._j0.slice(0),n(this._inBlock),this._partialBytes=0,a=r.util.createBuffer(a),this._aDataLength=i(a.length()*8);var l=a.length()%this.blockSize;for(l&&a.fillWithByte(0,this.blockSize-l),this._s=[0,0,0,0];a.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[a.getInt32(),a.getInt32(),a.getInt32(),a.getInt32()])},e.gcm.prototype.encrypt=function(s,o,a){var f=s.length();if(f===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&f>=this.blockSize){for(var l=0;l<this._ints;++l)o.putInt32(this._outBlock[l]^=s.getInt32());this._cipherLength+=this.blockSize}else{var g=(this.blockSize-f)%this.blockSize;g>0&&(g=this.blockSize-g),this._partialOutput.clear();for(var l=0;l<this._ints;++l)this._partialOutput.putInt32(s.getInt32()^this._outBlock[l]);if(g<=0||a){if(a){var w=f%this.blockSize;this._cipherLength+=w,this._partialOutput.truncate(this.blockSize-w)}else this._cipherLength+=this.blockSize;for(var l=0;l<this._ints;++l)this._outBlock[l]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),g>0&&!a)return s.read-=this.blockSize,o.putBytes(this._partialOutput.getBytes(g-this._partialBytes)),this._partialBytes=g,!0;o.putBytes(this._partialOutput.getBytes(f-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),n(this._inBlock)},e.gcm.prototype.decrypt=function(s,o,a){var f=s.length();if(f<this.blockSize&&!(a&&f>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),n(this._inBlock),this._hashBlock[0]=s.getInt32(),this._hashBlock[1]=s.getInt32(),this._hashBlock[2]=s.getInt32(),this._hashBlock[3]=s.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var l=0;l<this._ints;++l)o.putInt32(this._outBlock[l]^this._hashBlock[l]);f<this.blockSize?this._cipherLength+=f%this.blockSize:this._cipherLength+=this.blockSize},e.gcm.prototype.afterFinish=function(s,o){var a=!0;o.decrypt&&o.overflow&&s.truncate(this.blockSize-o.overflow),this.tag=r.util.createBuffer();var f=this._aDataLength.concat(i(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,f);var l=[];this.cipher.encrypt(this._j0,l);for(var g=0;g<this._ints;++g)this.tag.putInt32(this._s[g]^l[g]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),o.decrypt&&this.tag.bytes()!==this._tag&&(a=!1),a},e.gcm.prototype.multiply=function(s,o){for(var a=[0,0,0,0],f=o.slice(0),l=0;l<128;++l){var g=s[l/32|0]&1<<31-l%32;g&&(a[0]^=f[0],a[1]^=f[1],a[2]^=f[2],a[3]^=f[3]),this.pow(f,f)}return a},e.gcm.prototype.pow=function(s,o){for(var a=s[3]&1,f=3;f>0;--f)o[f]=s[f]>>>1|(s[f-1]&1)<<31;o[0]=s[0]>>>1,a&&(o[0]^=this._R)},e.gcm.prototype.tableMultiply=function(s){for(var o=[0,0,0,0],a=0;a<32;++a){var f=a/8|0,l=s[f]>>>(7-a%8)*4&15,g=this._m[a][l];o[0]^=g[0],o[1]^=g[1],o[2]^=g[2],o[3]^=g[3]}return o},e.gcm.prototype.ghash=function(s,o,a){return o[0]^=a[0],o[1]^=a[1],o[2]^=a[2],o[3]^=a[3],this.tableMultiply(o)},e.gcm.prototype.generateHashTable=function(s,o){for(var a=8/o,f=4*a,l=16*a,g=new Array(l),w=0;w<l;++w){var y=[0,0,0,0],p=w/f|0,I=(f-1-w%f)*o;y[p]=1<<o-1<<I,g[w]=this.generateSubHashTable(this.multiply(y,s),o)}return g},e.gcm.prototype.generateSubHashTable=function(s,o){var a=1<<o,f=a>>>1,l=new Array(a);l[f]=s.slice(0);for(var g=f>>>1;g>0;)this.pow(l[2*g],l[g]=[]),g>>=1;for(g=2;g<f;){for(var w=1;w<g;++w){var y=l[g],p=l[w];l[g+w]=[y[0]^p[0],y[1]^p[1],y[2]^p[2],y[3]^p[3]]}g*=2}for(l[0]=[0,0,0,0],g=f+1;g<a;++g){var I=l[g^f];l[g]=[s[0]^I[0],s[1]^I[1],s[2]^I[2],s[3]^I[3]]}return l};function t(s,o){if(typeof s=="string"&&(s=r.util.createBuffer(s)),r.util.isArray(s)&&s.length>4){var a=s;s=r.util.createBuffer();for(var f=0;f<a.length;++f)s.putByte(a[f])}if(s.length()<o)throw new Error("Invalid IV length; got "+s.length()+" bytes and expected "+o+" bytes.");if(!r.util.isArray(s)){for(var l=[],g=o/4,f=0;f<g;++f)l.push(s.getInt32());s=l}return s}function n(s){s[s.length-1]=s[s.length-1]+1&4294967295}function i(s){return[s/4294967296|0,s&4294967295]}return Ja.exports}var Za,Sh;function xn(){if(Sh)return Za;Sh=1;var r=Ne();hc(),Op(),Ke(),Za=r.aes=r.aes||{},r.aes.startEncrypting=function(p,I,S,A){var d=y({key:p,output:S,decrypt:!1,mode:A});return d.start(I),d},r.aes.createEncryptionCipher=function(p,I){return y({key:p,output:null,decrypt:!1,mode:I})},r.aes.startDecrypting=function(p,I,S,A){var d=y({key:p,output:S,decrypt:!0,mode:A});return d.start(I),d},r.aes.createDecryptionCipher=function(p,I){return y({key:p,output:null,decrypt:!0,mode:I})},r.aes.Algorithm=function(p,I){t||l();var S=this;S.name=p,S.mode=new I({blockSize:16,cipher:{encrypt:function(A,d){return w(S._w,A,d,!1)},decrypt:function(A,d){return w(S._w,A,d,!0)}}}),S._init=!1},r.aes.Algorithm.prototype.initialize=function(p){if(!this._init){var I=p.key,S;if(typeof I=="string"&&(I.length===16||I.length===24||I.length===32))I=r.util.createBuffer(I);else if(r.util.isArray(I)&&(I.length===16||I.length===24||I.length===32)){S=I,I=r.util.createBuffer();for(var A=0;A<S.length;++A)I.putByte(S[A])}if(!r.util.isArray(I)){S=I,I=[];var d=S.length();if(d===16||d===24||d===32){d=d>>>2;for(var A=0;A<d;++A)I.push(S.getInt32())}}if(!r.util.isArray(I)||!(I.length===4||I.length===6||I.length===8))throw new Error("Invalid key parameter.");var T=this.mode.name,x=["CFB","OFB","CTR","GCM"].indexOf(T)!==-1;this._w=g(I,p.decrypt&&!x),this._init=!0}},r.aes._expandKey=function(p,I){return t||l(),g(p,I)},r.aes._updateBlock=w,e("AES-ECB",r.cipher.modes.ecb),e("AES-CBC",r.cipher.modes.cbc),e("AES-CFB",r.cipher.modes.cfb),e("AES-OFB",r.cipher.modes.ofb),e("AES-CTR",r.cipher.modes.ctr),e("AES-GCM",r.cipher.modes.gcm);function e(p,I){var S=function(){return new r.aes.Algorithm(p,I)};r.cipher.registerAlgorithm(p,S)}var t=!1,n=4,i,s,o,a,f;function l(){t=!0,o=[0,1,2,4,8,16,32,64,128,27,54];for(var p=new Array(256),I=0;I<128;++I)p[I]=I<<1,p[I+128]=I+128<<1^283;i=new Array(256),s=new Array(256),a=new Array(4),f=new Array(4);for(var I=0;I<4;++I)a[I]=new Array(256),f[I]=new Array(256);for(var S=0,A=0,d,T,x,k,U,_,h,I=0;I<256;++I){k=A^A<<1^A<<2^A<<3^A<<4,k=k>>8^k&255^99,i[S]=k,s[k]=S,U=p[k],d=p[S],T=p[d],x=p[T],_=U<<24^k<<16^k<<8^(k^U),h=(d^T^x)<<24^(S^x)<<16^(S^T^x)<<8^(S^d^x);for(var c=0;c<4;++c)a[c][S]=_,f[c][k]=h,_=_<<24|_>>>8,h=h<<24|h>>>8;S===0?S=A=1:(S=d^p[p[p[d^x]]],A^=p[p[A]])}}function g(p,I){for(var S=p.slice(0),A,d=1,T=S.length,x=T+6+1,k=n*x,U=T;U<k;++U)A=S[U-1],U%T===0?(A=i[A>>>16&255]<<24^i[A>>>8&255]<<16^i[A&255]<<8^i[A>>>24]^o[d]<<24,d++):T>6&&U%T===4&&(A=i[A>>>24]<<24^i[A>>>16&255]<<16^i[A>>>8&255]<<8^i[A&255]),S[U]=S[U-T]^A;if(I){var _,h=f[0],c=f[1],v=f[2],b=f[3],B=S.slice(0);k=S.length;for(var U=0,R=k-n;U<k;U+=n,R-=n)if(U===0||U===k-n)B[U]=S[R],B[U+1]=S[R+3],B[U+2]=S[R+2],B[U+3]=S[R+1];else for(var P=0;P<n;++P)_=S[R+P],B[U+(3&-P)]=h[i[_>>>24]]^c[i[_>>>16&255]]^v[i[_>>>8&255]]^b[i[_&255]];S=B}return S}function w(p,I,S,A){var d=p.length/4-1,T,x,k,U,_;A?(T=f[0],x=f[1],k=f[2],U=f[3],_=s):(T=a[0],x=a[1],k=a[2],U=a[3],_=i);var h,c,v,b,B,R,P;h=I[0]^p[0],c=I[A?3:1]^p[1],v=I[2]^p[2],b=I[A?1:3]^p[3];for(var H=3,z=1;z<d;++z)B=T[h>>>24]^x[c>>>16&255]^k[v>>>8&255]^U[b&255]^p[++H],R=T[c>>>24]^x[v>>>16&255]^k[b>>>8&255]^U[h&255]^p[++H],P=T[v>>>24]^x[b>>>16&255]^k[h>>>8&255]^U[c&255]^p[++H],b=T[b>>>24]^x[h>>>16&255]^k[c>>>8&255]^U[v&255]^p[++H],h=B,c=R,v=P;S[0]=_[h>>>24]<<24^_[c>>>16&255]<<16^_[v>>>8&255]<<8^_[b&255]^p[++H],S[A?3:1]=_[c>>>24]<<24^_[v>>>16&255]<<16^_[b>>>8&255]<<8^_[h&255]^p[++H],S[2]=_[v>>>24]<<24^_[b>>>16&255]<<16^_[h>>>8&255]<<8^_[c&255]^p[++H],S[A?1:3]=_[b>>>24]<<24^_[h>>>16&255]<<16^_[c>>>8&255]<<8^_[v&255]^p[++H]}function y(p){p=p||{};var I=(p.mode||"CBC").toUpperCase(),S="AES-"+I,A;p.decrypt?A=r.cipher.createDecipher(S,p.key):A=r.cipher.createCipher(S,p.key);var d=A.start;return A.start=function(T,x){var k=null;x instanceof r.util.ByteBuffer&&(k=x,x={}),x=x||{},x.output=k,x.iv=T,d.call(A,x)},A}return Za}var eo={exports:{}},to={exports:{}},ro={exports:{}},Ah;function wn(){if(Ah)return ro.exports;Ah=1;var r=Ne();r.pki=r.pki||{};var e=ro.exports=r.pki.oids=r.oids=r.oids||{};function t(i,s){e[i]=s,e[s]=i}function n(i,s){e[i]=s}return t("1.2.840.113549.1.1.1","rsaEncryption"),t("1.2.840.113549.1.1.4","md5WithRSAEncryption"),t("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),t("1.2.840.113549.1.1.7","RSAES-OAEP"),t("1.2.840.113549.1.1.8","mgf1"),t("1.2.840.113549.1.1.9","pSpecified"),t("1.2.840.113549.1.1.10","RSASSA-PSS"),t("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),t("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),t("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),t("1.3.101.112","EdDSA25519"),t("1.2.840.10040.4.3","dsa-with-sha1"),t("1.3.14.3.2.7","desCBC"),t("1.3.14.3.2.26","sha1"),t("1.3.14.3.2.29","sha1WithRSASignature"),t("2.16.840.1.101.3.4.2.1","sha256"),t("2.16.840.1.101.3.4.2.2","sha384"),t("2.16.840.1.101.3.4.2.3","sha512"),t("2.16.840.1.101.3.4.2.4","sha224"),t("2.16.840.1.101.3.4.2.5","sha512-224"),t("2.16.840.1.101.3.4.2.6","sha512-256"),t("1.2.840.113549.2.2","md2"),t("1.2.840.113549.2.5","md5"),t("1.2.840.113549.1.7.1","data"),t("1.2.840.113549.1.7.2","signedData"),t("1.2.840.113549.1.7.3","envelopedData"),t("1.2.840.113549.1.7.4","signedAndEnvelopedData"),t("1.2.840.113549.1.7.5","digestedData"),t("1.2.840.113549.1.7.6","encryptedData"),t("1.2.840.113549.1.9.1","emailAddress"),t("1.2.840.113549.1.9.2","unstructuredName"),t("1.2.840.113549.1.9.3","contentType"),t("1.2.840.113549.1.9.4","messageDigest"),t("1.2.840.113549.1.9.5","signingTime"),t("1.2.840.113549.1.9.6","counterSignature"),t("1.2.840.113549.1.9.7","challengePassword"),t("1.2.840.113549.1.9.8","unstructuredAddress"),t("1.2.840.113549.1.9.14","extensionRequest"),t("1.2.840.113549.1.9.20","friendlyName"),t("1.2.840.113549.1.9.21","localKeyId"),t("1.2.840.113549.1.9.22.1","x509Certificate"),t("1.2.840.113549.1.12.10.1.1","keyBag"),t("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),t("1.2.840.113549.1.12.10.1.3","certBag"),t("1.2.840.113549.1.12.10.1.4","crlBag"),t("1.2.840.113549.1.12.10.1.5","secretBag"),t("1.2.840.113549.1.12.10.1.6","safeContentsBag"),t("1.2.840.113549.1.5.13","pkcs5PBES2"),t("1.2.840.113549.1.5.12","pkcs5PBKDF2"),t("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),t("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),t("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),t("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),t("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),t("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),t("1.2.840.113549.2.7","hmacWithSHA1"),t("1.2.840.113549.2.8","hmacWithSHA224"),t("1.2.840.113549.2.9","hmacWithSHA256"),t("1.2.840.113549.2.10","hmacWithSHA384"),t("1.2.840.113549.2.11","hmacWithSHA512"),t("1.2.840.113549.3.7","des-EDE3-CBC"),t("2.16.840.1.101.3.4.1.2","aes128-CBC"),t("2.16.840.1.101.3.4.1.22","aes192-CBC"),t("2.16.840.1.101.3.4.1.42","aes256-CBC"),t("2.5.4.3","commonName"),t("2.5.4.4","surname"),t("2.5.4.5","serialNumber"),t("2.5.4.6","countryName"),t("2.5.4.7","localityName"),t("2.5.4.8","stateOrProvinceName"),t("2.5.4.9","streetAddress"),t("2.5.4.10","organizationName"),t("2.5.4.11","organizationalUnitName"),t("2.5.4.12","title"),t("2.5.4.13","description"),t("2.5.4.15","businessCategory"),t("2.5.4.17","postalCode"),t("2.5.4.42","givenName"),t("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),t("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),t("2.16.840.1.113730.1.1","nsCertType"),t("2.16.840.1.113730.1.13","nsComment"),n("2.5.29.1","authorityKeyIdentifier"),n("2.5.29.2","keyAttributes"),n("2.5.29.3","certificatePolicies"),n("2.5.29.4","keyUsageRestriction"),n("2.5.29.5","policyMapping"),n("2.5.29.6","subtreesConstraint"),n("2.5.29.7","subjectAltName"),n("2.5.29.8","issuerAltName"),n("2.5.29.9","subjectDirectoryAttributes"),n("2.5.29.10","basicConstraints"),n("2.5.29.11","nameConstraints"),n("2.5.29.12","policyConstraints"),n("2.5.29.13","basicConstraints"),t("2.5.29.14","subjectKeyIdentifier"),t("2.5.29.15","keyUsage"),n("2.5.29.16","privateKeyUsagePeriod"),t("2.5.29.17","subjectAltName"),t("2.5.29.18","issuerAltName"),t("2.5.29.19","basicConstraints"),n("2.5.29.20","cRLNumber"),n("2.5.29.21","cRLReason"),n("2.5.29.22","expirationDate"),n("2.5.29.23","instructionCode"),n("2.5.29.24","invalidityDate"),n("2.5.29.25","cRLDistributionPoints"),n("2.5.29.26","issuingDistributionPoint"),n("2.5.29.27","deltaCRLIndicator"),n("2.5.29.28","issuingDistributionPoint"),n("2.5.29.29","certificateIssuer"),n("2.5.29.30","nameConstraints"),t("2.5.29.31","cRLDistributionPoints"),t("2.5.29.32","certificatePolicies"),n("2.5.29.33","policyMappings"),n("2.5.29.34","policyConstraints"),t("2.5.29.35","authorityKeyIdentifier"),n("2.5.29.36","policyConstraints"),t("2.5.29.37","extKeyUsage"),n("2.5.29.46","freshestCRL"),n("2.5.29.54","inhibitAnyPolicy"),t("1.3.6.1.4.1.11129.2.4.2","timestampList"),t("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),t("1.3.6.1.5.5.7.3.1","serverAuth"),t("1.3.6.1.5.5.7.3.2","clientAuth"),t("1.3.6.1.5.5.7.3.3","codeSigning"),t("1.3.6.1.5.5.7.3.4","emailProtection"),t("1.3.6.1.5.5.7.3.8","timeStamping"),ro.exports}var xh;function Ir(){if(xh)return to.exports;xh=1;var r=Ne();Ke(),wn();var e=to.exports=r.asn1=r.asn1||{};e.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},e.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},e.create=function(o,a,f,l,g){if(r.util.isArray(l)){for(var w=[],y=0;y<l.length;++y)l[y]!==void 0&&w.push(l[y]);l=w}var p={tagClass:o,type:a,constructed:f,composed:f||r.util.isArray(l),value:l};return g&&"bitStringContents"in g&&(p.bitStringContents=g.bitStringContents,p.original=e.copy(p)),p},e.copy=function(o,a){var f;if(r.util.isArray(o)){f=[];for(var l=0;l<o.length;++l)f.push(e.copy(o[l],a));return f}return typeof o=="string"?o:(f={tagClass:o.tagClass,type:o.type,constructed:o.constructed,composed:o.composed,value:e.copy(o.value,a)},a&&!a.excludeBitStringContents&&(f.bitStringContents=o.bitStringContents),f)},e.equals=function(o,a,f){if(r.util.isArray(o)){if(!r.util.isArray(a)||o.length!==a.length)return!1;for(var l=0;l<o.length;++l)if(!e.equals(o[l],a[l]))return!1;return!0}if(typeof o!=typeof a)return!1;if(typeof o=="string")return o===a;var g=o.tagClass===a.tagClass&&o.type===a.type&&o.constructed===a.constructed&&o.composed===a.composed&&e.equals(o.value,a.value);return f&&f.includeBitStringContents&&(g=g&&o.bitStringContents===a.bitStringContents),g},e.getBerValueLength=function(o){var a=o.getByte();if(a!==128){var f,l=a&128;return l?f=o.getInt((a&127)<<3):f=a,f}};function t(o,a,f){if(f>a){var l=new Error("Too few bytes to parse DER.");throw l.available=o.length(),l.remaining=a,l.requested=f,l}}var n=function(o,a){var f=o.getByte();if(a--,f!==128){var l,g=f&128;if(!g)l=f;else{var w=f&127;t(o,a,w),l=o.getInt(w<<3)}if(l<0)throw new Error("Negative length: "+l);return l}};e.fromDer=function(o,a){a===void 0&&(a={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof a=="boolean"&&(a={strict:a,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in a||(a.strict=!0),"parseAllBytes"in a||(a.parseAllBytes=!0),"decodeBitStrings"in a||(a.decodeBitStrings=!0),typeof o=="string"&&(o=r.util.createBuffer(o));var f=o.length(),l=i(o,o.length(),0,a);if(a.parseAllBytes&&o.length()!==0){var g=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw g.byteCount=f,g.remaining=o.length(),g}return l};function i(o,a,f,l){var g;t(o,a,2);var w=o.getByte();a--;var y=w&192,p=w&31;g=o.length();var I=n(o,a);if(a-=g-o.length(),I!==void 0&&I>a){if(l.strict){var S=new Error("Too few bytes to read ASN.1 value.");throw S.available=o.length(),S.remaining=a,S.requested=I,S}I=a}var A,d,T=(w&32)===32;if(T)if(A=[],I===void 0)for(;;){if(t(o,a,2),o.bytes(2)==="\0\0"){o.getBytes(2),a-=2;break}g=o.length(),A.push(i(o,a,f+1,l)),a-=g-o.length()}else for(;I>0;)g=o.length(),A.push(i(o,I,f+1,l)),a-=g-o.length(),I-=g-o.length();if(A===void 0&&y===e.Class.UNIVERSAL&&p===e.Type.BITSTRING&&(d=o.bytes(I)),A===void 0&&l.decodeBitStrings&&y===e.Class.UNIVERSAL&&p===e.Type.BITSTRING&&I>1){var x=o.read,k=a,U=0;if(p===e.Type.BITSTRING&&(t(o,a,1),U=o.getByte(),a--),U===0)try{g=o.length();var _={strict:!0,decodeBitStrings:!0},h=i(o,a,f+1,_),c=g-o.length();a-=c,p==e.Type.BITSTRING&&c++;var v=h.tagClass;c===I&&(v===e.Class.UNIVERSAL||v===e.Class.CONTEXT_SPECIFIC)&&(A=[h])}catch{}A===void 0&&(o.read=x,a=k)}if(A===void 0){if(I===void 0){if(l.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");I=a}if(p===e.Type.BMPSTRING)for(A="";I>0;I-=2)t(o,a,2),A+=String.fromCharCode(o.getInt16()),a-=2;else A=o.getBytes(I),a-=I}var b=d===void 0?null:{bitStringContents:d};return e.create(y,p,T,A,b)}e.toDer=function(o){var a=r.util.createBuffer(),f=o.tagClass|o.type,l=r.util.createBuffer(),g=!1;if("bitStringContents"in o&&(g=!0,o.original&&(g=e.equals(o,o.original))),g)l.putBytes(o.bitStringContents);else if(o.composed){o.constructed?f|=32:l.putByte(0);for(var w=0;w<o.value.length;++w)o.value[w]!==void 0&&l.putBuffer(e.toDer(o.value[w]))}else if(o.type===e.Type.BMPSTRING)for(var w=0;w<o.value.length;++w)l.putInt16(o.value.charCodeAt(w));else o.type===e.Type.INTEGER&&o.value.length>1&&(o.value.charCodeAt(0)===0&&!(o.value.charCodeAt(1)&128)||o.value.charCodeAt(0)===255&&(o.value.charCodeAt(1)&128)===128)?l.putBytes(o.value.substr(1)):l.putBytes(o.value);if(a.putByte(f),l.length()<=127)a.putByte(l.length()&127);else{var y=l.length(),p="";do p+=String.fromCharCode(y&255),y=y>>>8;while(y>0);a.putByte(p.length|128);for(var w=p.length-1;w>=0;--w)a.putByte(p.charCodeAt(w))}return a.putBuffer(l),a},e.oidToDer=function(o){var a=o.split("."),f=r.util.createBuffer();f.putByte(40*parseInt(a[0],10)+parseInt(a[1],10));for(var l,g,w,y,p=2;p<a.length;++p){l=!0,g=[],w=parseInt(a[p],10);do y=w&127,w=w>>>7,l||(y|=128),g.push(y),l=!1;while(w>0);for(var I=g.length-1;I>=0;--I)f.putByte(g[I])}return f},e.derToOid=function(o){var a;typeof o=="string"&&(o=r.util.createBuffer(o));var f=o.getByte();a=Math.floor(f/40)+"."+f%40;for(var l=0;o.length()>0;)f=o.getByte(),l=l<<7,f&128?l+=f&127:(a+="."+(l+f),l=0);return a},e.utcTimeToDate=function(o){var a=new Date,f=parseInt(o.substr(0,2),10);f=f>=50?1900+f:2e3+f;var l=parseInt(o.substr(2,2),10)-1,g=parseInt(o.substr(4,2),10),w=parseInt(o.substr(6,2),10),y=parseInt(o.substr(8,2),10),p=0;if(o.length>11){var I=o.charAt(10),S=10;I!=="+"&&I!=="-"&&(p=parseInt(o.substr(10,2),10),S+=2)}if(a.setUTCFullYear(f,l,g),a.setUTCHours(w,y,p,0),S&&(I=o.charAt(S),I==="+"||I==="-")){var A=parseInt(o.substr(S+1,2),10),d=parseInt(o.substr(S+4,2),10),T=A*60+d;T*=6e4,I==="+"?a.setTime(+a-T):a.setTime(+a+T)}return a},e.generalizedTimeToDate=function(o){var a=new Date,f=parseInt(o.substr(0,4),10),l=parseInt(o.substr(4,2),10)-1,g=parseInt(o.substr(6,2),10),w=parseInt(o.substr(8,2),10),y=parseInt(o.substr(10,2),10),p=parseInt(o.substr(12,2),10),I=0,S=0,A=!1;o.charAt(o.length-1)==="Z"&&(A=!0);var d=o.length-5,T=o.charAt(d);if(T==="+"||T==="-"){var x=parseInt(o.substr(d+1,2),10),k=parseInt(o.substr(d+4,2),10);S=x*60+k,S*=6e4,T==="+"&&(S*=-1),A=!0}return o.charAt(14)==="."&&(I=parseFloat(o.substr(14),10)*1e3),A?(a.setUTCFullYear(f,l,g),a.setUTCHours(w,y,p,I),a.setTime(+a+S)):(a.setFullYear(f,l,g),a.setHours(w,y,p,I)),a},e.dateToUtcTime=function(o){if(typeof o=="string")return o;var a="",f=[];f.push((""+o.getUTCFullYear()).substr(2)),f.push(""+(o.getUTCMonth()+1)),f.push(""+o.getUTCDate()),f.push(""+o.getUTCHours()),f.push(""+o.getUTCMinutes()),f.push(""+o.getUTCSeconds());for(var l=0;l<f.length;++l)f[l].length<2&&(a+="0"),a+=f[l];return a+="Z",a},e.dateToGeneralizedTime=function(o){if(typeof o=="string")return o;var a="",f=[];f.push(""+o.getUTCFullYear()),f.push(""+(o.getUTCMonth()+1)),f.push(""+o.getUTCDate()),f.push(""+o.getUTCHours()),f.push(""+o.getUTCMinutes()),f.push(""+o.getUTCSeconds());for(var l=0;l<f.length;++l)f[l].length<2&&(a+="0"),a+=f[l];return a+="Z",a},e.integerToDer=function(o){var a=r.util.createBuffer();if(o>=-128&&o<128)return a.putSignedInt(o,8);if(o>=-32768&&o<32768)return a.putSignedInt(o,16);if(o>=-8388608&&o<8388608)return a.putSignedInt(o,24);if(o>=-2147483648&&o<2147483648)return a.putSignedInt(o,32);var f=new Error("Integer too large; max is 32-bits.");throw f.integer=o,f},e.derToInteger=function(o){typeof o=="string"&&(o=r.util.createBuffer(o));var a=o.length()*8;if(a>32)throw new Error("Integer too large; max is 32-bits.");return o.getSignedInt(a)},e.validate=function(o,a,f,l){var g=!1;if((o.tagClass===a.tagClass||typeof a.tagClass>"u")&&(o.type===a.type||typeof a.type>"u"))if(o.constructed===a.constructed||typeof a.constructed>"u"){if(g=!0,a.value&&r.util.isArray(a.value))for(var w=0,y=0;g&&y<a.value.length;++y)g=a.value[y].optional||!1,o.value[w]&&(g=e.validate(o.value[w],a.value[y],f,l),g?++w:a.value[y].optional&&(g=!0)),!g&&l&&l.push("["+a.name+'] Tag class "'+a.tagClass+'", type "'+a.type+'" expected value length "'+a.value.length+'", got "'+o.value.length+'"');if(g&&f&&(a.capture&&(f[a.capture]=o.value),a.captureAsn1&&(f[a.captureAsn1]=o),a.captureBitStringContents&&"bitStringContents"in o&&(f[a.captureBitStringContents]=o.bitStringContents),a.captureBitStringValue&&"bitStringContents"in o))if(o.bitStringContents.length<2)f[a.captureBitStringValue]="";else{var p=o.bitStringContents.charCodeAt(0);if(p!==0)throw new Error("captureBitStringValue only supported for zero unused bits");f[a.captureBitStringValue]=o.bitStringContents.slice(1)}}else l&&l.push("["+a.name+'] Expected constructed "'+a.constructed+'", got "'+o.constructed+'"');else l&&(o.tagClass!==a.tagClass&&l.push("["+a.name+'] Expected tag class "'+a.tagClass+'", got "'+o.tagClass+'"'),o.type!==a.type&&l.push("["+a.name+'] Expected type "'+a.type+'", got "'+o.type+'"'));return g};var s=/[^\\u0000-\\u00ff]/;return e.prettyPrint=function(o,a,f){var l="";a=a||0,f=f||2,a>0&&(l+=`
`);for(var g="",w=0;w<a*f;++w)g+=" ";switch(l+=g+"Tag: ",o.tagClass){case e.Class.UNIVERSAL:l+="Universal:";break;case e.Class.APPLICATION:l+="Application:";break;case e.Class.CONTEXT_SPECIFIC:l+="Context-Specific:";break;case e.Class.PRIVATE:l+="Private:";break}if(o.tagClass===e.Class.UNIVERSAL)switch(l+=o.type,o.type){case e.Type.NONE:l+=" (None)";break;case e.Type.BOOLEAN:l+=" (Boolean)";break;case e.Type.INTEGER:l+=" (Integer)";break;case e.Type.BITSTRING:l+=" (Bit string)";break;case e.Type.OCTETSTRING:l+=" (Octet string)";break;case e.Type.NULL:l+=" (Null)";break;case e.Type.OID:l+=" (Object Identifier)";break;case e.Type.ODESC:l+=" (Object Descriptor)";break;case e.Type.EXTERNAL:l+=" (External or Instance of)";break;case e.Type.REAL:l+=" (Real)";break;case e.Type.ENUMERATED:l+=" (Enumerated)";break;case e.Type.EMBEDDED:l+=" (Embedded PDV)";break;case e.Type.UTF8:l+=" (UTF8)";break;case e.Type.ROID:l+=" (Relative Object Identifier)";break;case e.Type.SEQUENCE:l+=" (Sequence)";break;case e.Type.SET:l+=" (Set)";break;case e.Type.PRINTABLESTRING:l+=" (Printable String)";break;case e.Type.IA5String:l+=" (IA5String (ASCII))";break;case e.Type.UTCTIME:l+=" (UTC time)";break;case e.Type.GENERALIZEDTIME:l+=" (Generalized time)";break;case e.Type.BMPSTRING:l+=" (BMP String)";break}else l+=o.type;if(l+=`
`,l+=g+"Constructed: "+o.constructed+`
`,o.composed){for(var y=0,p="",w=0;w<o.value.length;++w)o.value[w]!==void 0&&(y+=1,p+=e.prettyPrint(o.value[w],a+1,f),w+1<o.value.length&&(p+=","));l+=g+"Sub values: "+y+p}else{if(l+=g+"Value: ",o.type===e.Type.OID){var I=e.derToOid(o.value);l+=I,r.pki&&r.pki.oids&&I in r.pki.oids&&(l+=" ("+r.pki.oids[I]+") ")}if(o.type===e.Type.INTEGER)try{l+=e.derToInteger(o.value)}catch{l+="0x"+r.util.bytesToHex(o.value)}else if(o.type===e.Type.BITSTRING){if(o.value.length>1?l+="0x"+r.util.bytesToHex(o.value.slice(1)):l+="(none)",o.value.length>0){var S=o.value.charCodeAt(0);S==1?l+=" (1 unused bit shown)":S>1&&(l+=" ("+S+" unused bits shown)")}}else if(o.type===e.Type.OCTETSTRING)s.test(o.value)||(l+="("+o.value+") "),l+="0x"+r.util.bytesToHex(o.value);else if(o.type===e.Type.UTF8)try{l+=r.util.decodeUtf8(o.value)}catch(A){if(A.message==="URI malformed")l+="0x"+r.util.bytesToHex(o.value)+" (malformed UTF8)";else throw A}else o.type===e.Type.PRINTABLESTRING||o.type===e.Type.IA5String?l+=o.value:s.test(o.value)?l+="0x"+r.util.bytesToHex(o.value):o.value.length===0?l+="[null]":l+=o.value}return l},to.exports}var no={exports:{}},io,wh;function qr(){if(wh)return io;wh=1;var r=Ne();return io=r.md=r.md||{},r.md.algorithms=r.md.algorithms||{},io}var bh;function Ji(){if(bh)return no.exports;bh=1;var r=Ne();qr(),Ke();var e=no.exports=r.hmac=r.hmac||{};return e.create=function(){var t=null,n=null,i=null,s=null,o={};return o.start=function(a,f){if(a!==null)if(typeof a=="string")if(a=a.toLowerCase(),a in r.md.algorithms)n=r.md.algorithms[a].create();else throw new Error('Unknown hash algorithm "'+a+'"');else n=a;if(f===null)f=t;else{if(typeof f=="string")f=r.util.createBuffer(f);else if(r.util.isArray(f)){var l=f;f=r.util.createBuffer();for(var g=0;g<l.length;++g)f.putByte(l[g])}var w=f.length();w>n.blockLength&&(n.start(),n.update(f.bytes()),f=n.digest()),i=r.util.createBuffer(),s=r.util.createBuffer(),w=f.length();for(var g=0;g<w;++g){var l=f.at(g);i.putByte(54^l),s.putByte(92^l)}if(w<n.blockLength)for(var l=n.blockLength-w,g=0;g<l;++g)i.putByte(54),s.putByte(92);t=f,i=i.bytes(),s=s.bytes()}n.start(),n.update(i)},o.update=function(a){n.update(a)},o.getMac=function(){var a=n.digest().bytes();return n.start(),n.update(s),n.update(a),n.digest()},o.digest=o.getMac,o},no.exports}var so={exports:{}},Rh;function fc(){if(Rh)return so.exports;Rh=1;var r=Ne();qr(),Ke();var e=so.exports=r.md5=r.md5||{};r.md.md5=r.md.algorithms.md5=e,e.create=function(){o||a();var l=null,g=r.util.createBuffer(),w=new Array(16),y={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8};return y.start=function(){y.messageLength=0,y.fullMessageLength=y.messageLength64=[];for(var p=y.messageLengthSize/4,I=0;I<p;++I)y.fullMessageLength.push(0);return g=r.util.createBuffer(),l={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},y},y.start(),y.update=function(p,I){I==="utf8"&&(p=r.util.encodeUtf8(p));var S=p.length;y.messageLength+=S,S=[S/4294967296>>>0,S>>>0];for(var A=y.fullMessageLength.length-1;A>=0;--A)y.fullMessageLength[A]+=S[1],S[1]=S[0]+(y.fullMessageLength[A]/4294967296>>>0),y.fullMessageLength[A]=y.fullMessageLength[A]>>>0,S[0]=S[1]/4294967296>>>0;return g.putBytes(p),f(l,w,g),(g.read>2048||g.length()===0)&&g.compact(),y},y.digest=function(){var p=r.util.createBuffer();p.putBytes(g.bytes());var I=y.fullMessageLength[y.fullMessageLength.length-1]+y.messageLengthSize,S=I&y.blockLength-1;p.putBytes(t.substr(0,y.blockLength-S));for(var A,d=0,T=y.fullMessageLength.length-1;T>=0;--T)A=y.fullMessageLength[T]*8+d,d=A/4294967296>>>0,p.putInt32Le(A>>>0);var x={h0:l.h0,h1:l.h1,h2:l.h2,h3:l.h3};f(x,w,p);var k=r.util.createBuffer();return k.putInt32Le(x.h0),k.putInt32Le(x.h1),k.putInt32Le(x.h2),k.putInt32Le(x.h3),k},y};var t=null,n=null,i=null,s=null,o=!1;function a(){t="",t+=r.util.fillString("\0",64),n=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],i=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],s=new Array(64);for(var l=0;l<64;++l)s[l]=Math.floor(Math.abs(Math.sin(l+1))*4294967296);o=!0}function f(l,g,w){for(var y,p,I,S,A,d,T,x,k=w.length();k>=64;){for(p=l.h0,I=l.h1,S=l.h2,A=l.h3,x=0;x<16;++x)g[x]=w.getInt32Le(),d=A^I&(S^A),y=p+d+s[x]+g[x],T=i[x],p=A,A=S,S=I,I+=y<<T|y>>>32-T;for(;x<32;++x)d=S^A&(I^S),y=p+d+s[x]+g[n[x]],T=i[x],p=A,A=S,S=I,I+=y<<T|y>>>32-T;for(;x<48;++x)d=I^S^A,y=p+d+s[x]+g[n[x]],T=i[x],p=A,A=S,S=I,I+=y<<T|y>>>32-T;for(;x<64;++x)d=S^(I|~A),y=p+d+s[x]+g[n[x]],T=i[x],p=A,A=S,S=I,I+=y<<T|y>>>32-T;l.h0=l.h0+p|0,l.h1=l.h1+I|0,l.h2=l.h2+S|0,l.h3=l.h3+A|0,k-=64}}return so.exports}var ao={exports:{}},Nh;function ai(){if(Nh)return ao.exports;Nh=1;var r=Ne();Ke();var e=ao.exports=r.pem=r.pem||{};e.encode=function(i,s){s=s||{};var o="-----BEGIN "+i.type+`-----\r
`,a;if(i.procType&&(a={name:"Proc-Type",values:[String(i.procType.version),i.procType.type]},o+=t(a)),i.contentDomain&&(a={name:"Content-Domain",values:[i.contentDomain]},o+=t(a)),i.dekInfo&&(a={name:"DEK-Info",values:[i.dekInfo.algorithm]},i.dekInfo.parameters&&a.values.push(i.dekInfo.parameters),o+=t(a)),i.headers)for(var f=0;f<i.headers.length;++f)o+=t(i.headers[f]);return i.procType&&(o+=`\r
`),o+=r.util.encode64(i.body,s.maxline||64)+`\r
`,o+="-----END "+i.type+`-----\r
`,o},e.decode=function(i){for(var s=[],o=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,a=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,f=/\r?\n/,l;l=o.exec(i),!!l;){var g=l[1];g==="NEW CERTIFICATE REQUEST"&&(g="CERTIFICATE REQUEST");var w={type:g,procType:null,contentDomain:null,dekInfo:null,headers:[],body:r.util.decode64(l[3])};if(s.push(w),!!l[2]){for(var y=l[2].split(f),p=0;l&&p<y.length;){for(var I=y[p].replace(/\s+$/,""),S=p+1;S<y.length;++S){var A=y[S];if(!/\s/.test(A[0]))break;I+=A,p=S}if(l=I.match(a),l){for(var d={name:l[1],values:[]},T=l[2].split(","),x=0;x<T.length;++x)d.values.push(n(T[x]));if(w.procType)if(!w.contentDomain&&d.name==="Content-Domain")w.contentDomain=T[0]||"";else if(!w.dekInfo&&d.name==="DEK-Info"){if(d.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');w.dekInfo={algorithm:T[0],parameters:T[1]||null}}else w.headers.push(d);else{if(d.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(d.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');w.procType={version:T[0],type:T[1]}}}++p}if(w.procType==="ENCRYPTED"&&!w.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(s.length===0)throw new Error("Invalid PEM formatted message.");return s};function t(i){for(var s=i.name+": ",o=[],a=function(y,p){return" "+p},f=0;f<i.values.length;++f)o.push(i.values[f].replace(/^(\S+\r\n)/,a));s+=o.join(",")+`\r
`;for(var l=0,g=-1,f=0;f<s.length;++f,++l)if(l>65&&g!==-1){var w=s[g];w===","?(++g,s=s.substr(0,g)+`\r
 `+s.substr(g)):s=s.substr(0,g)+`\r
`+w+s.substr(g+1),l=f-g-1,g=-1,++f}else(s[f]===" "||s[f]==="	"||s[f]===",")&&(g=f);return s}function n(i){return i.replace(/^\s+/,"")}return ao.exports}var oo={exports:{}},uo,Ph;function Sa(){if(Ph)return uo;Ph=1;var r=Ne();hc(),Op(),Ke(),uo=r.des=r.des||{},r.des.startEncrypting=function(p,I,S,A){var d=y({key:p,output:S,decrypt:!1,mode:A||(I===null?"ECB":"CBC")});return d.start(I),d},r.des.createEncryptionCipher=function(p,I){return y({key:p,output:null,decrypt:!1,mode:I})},r.des.startDecrypting=function(p,I,S,A){var d=y({key:p,output:S,decrypt:!0,mode:A||(I===null?"ECB":"CBC")});return d.start(I),d},r.des.createDecryptionCipher=function(p,I){return y({key:p,output:null,decrypt:!0,mode:I})},r.des.Algorithm=function(p,I){var S=this;S.name=p,S.mode=new I({blockSize:8,cipher:{encrypt:function(A,d){return w(S._keys,A,d,!1)},decrypt:function(A,d){return w(S._keys,A,d,!0)}}}),S._init=!1},r.des.Algorithm.prototype.initialize=function(p){if(!this._init){var I=r.util.createBuffer(p.key);if(this.name.indexOf("3DES")===0&&I.length()!==24)throw new Error("Invalid Triple-DES key size: "+I.length()*8);this._keys=g(I),this._init=!0}},e("DES-ECB",r.cipher.modes.ecb),e("DES-CBC",r.cipher.modes.cbc),e("DES-CFB",r.cipher.modes.cfb),e("DES-OFB",r.cipher.modes.ofb),e("DES-CTR",r.cipher.modes.ctr),e("3DES-ECB",r.cipher.modes.ecb),e("3DES-CBC",r.cipher.modes.cbc),e("3DES-CFB",r.cipher.modes.cfb),e("3DES-OFB",r.cipher.modes.ofb),e("3DES-CTR",r.cipher.modes.ctr);function e(p,I){var S=function(){return new r.des.Algorithm(p,I)};r.cipher.registerAlgorithm(p,S)}var t=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],n=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],i=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],s=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],o=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],a=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],f=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],l=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function g(p){for(var I=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],S=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],A=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],d=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],T=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],x=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],k=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],U=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],_=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],c=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],v=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],b=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],B=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],R=p.length()>8?3:1,P=[],H=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],z=0,W,te=0;te<R;te++){var ne=p.getInt32(),oe=p.getInt32();W=(ne>>>4^oe)&252645135,oe^=W,ne^=W<<4,W=(oe>>>-16^ne)&65535,ne^=W,oe^=W<<-16,W=(ne>>>2^oe)&858993459,oe^=W,ne^=W<<2,W=(oe>>>-16^ne)&65535,ne^=W,oe^=W<<-16,W=(ne>>>1^oe)&1431655765,oe^=W,ne^=W<<1,W=(oe>>>8^ne)&16711935,ne^=W,oe^=W<<8,W=(ne>>>1^oe)&1431655765,oe^=W,ne^=W<<1,W=ne<<8|oe>>>20&240,ne=oe<<24|oe<<8&16711680|oe>>>8&65280|oe>>>24&240,oe=W;for(var me=0;me<H.length;++me){H[me]?(ne=ne<<2|ne>>>26,oe=oe<<2|oe>>>26):(ne=ne<<1|ne>>>27,oe=oe<<1|oe>>>27),ne&=-15,oe&=-15;var Se=I[ne>>>28]|S[ne>>>24&15]|A[ne>>>20&15]|d[ne>>>16&15]|T[ne>>>12&15]|x[ne>>>8&15]|k[ne>>>4&15],xe=U[oe>>>28]|_[oe>>>24&15]|h[oe>>>20&15]|c[oe>>>16&15]|v[oe>>>12&15]|b[oe>>>8&15]|B[oe>>>4&15];W=(xe>>>16^Se)&65535,P[z++]=Se^W,P[z++]=xe^W<<16}}return P}function w(p,I,S,A){var d=p.length===32?3:9,T;d===3?T=A?[30,-2,-2]:[0,32,2]:T=A?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var x,k=I[0],U=I[1];x=(k>>>4^U)&252645135,U^=x,k^=x<<4,x=(k>>>16^U)&65535,U^=x,k^=x<<16,x=(U>>>2^k)&858993459,k^=x,U^=x<<2,x=(U>>>8^k)&16711935,k^=x,U^=x<<8,x=(k>>>1^U)&1431655765,U^=x,k^=x<<1,k=k<<1|k>>>31,U=U<<1|U>>>31;for(var _=0;_<d;_+=3){for(var h=T[_+1],c=T[_+2],v=T[_];v!=h;v+=c){var b=U^p[v],B=(U>>>4|U<<28)^p[v+1];x=k,k=U,U=x^(n[b>>>24&63]|s[b>>>16&63]|a[b>>>8&63]|l[b&63]|t[B>>>24&63]|i[B>>>16&63]|o[B>>>8&63]|f[B&63])}x=k,k=U,U=x}k=k>>>1|k<<31,U=U>>>1|U<<31,x=(k>>>1^U)&1431655765,U^=x,k^=x<<1,x=(U>>>8^k)&16711935,k^=x,U^=x<<8,x=(U>>>2^k)&858993459,k^=x,U^=x<<2,x=(k>>>16^U)&65535,U^=x,k^=x<<16,x=(k>>>4^U)&252645135,U^=x,k^=x<<4,S[0]=k,S[1]=U}function y(p){p=p||{};var I=(p.mode||"CBC").toUpperCase(),S="DES-"+I,A;p.decrypt?A=r.cipher.createDecipher(S,p.key):A=r.cipher.createCipher(S,p.key);var d=A.start;return A.start=function(T,x){var k=null;x instanceof r.util.ByteBuffer&&(k=x,x={}),x=x||{},x.output=k,x.iv=T,d.call(A,x)},A}return uo}const I1={},S1=Object.freeze(Object.defineProperty({__proto__:null,default:I1},Symbol.toStringTag,{value:"Module"})),dc=_0(S1);var co,Bh;function pc(){if(Bh)return co;Bh=1;var r=Ne();Ji(),qr(),Ke();var e=r.pkcs5=r.pkcs5||{},t;return r.util.isNodejs&&!r.options.usePureJavaScript&&(t=dc),co=r.pbkdf2=e.pbkdf2=function(n,i,s,o,a,f){if(typeof a=="function"&&(f=a,a=null),r.util.isNodejs&&!r.options.usePureJavaScript&&t.pbkdf2&&(a===null||typeof a!="object")&&(t.pbkdf2Sync.length>4||!a||a==="sha1"))return typeof a!="string"&&(a="sha1"),n=Buffer.from(n,"binary"),i=Buffer.from(i,"binary"),f?t.pbkdf2Sync.length===4?t.pbkdf2(n,i,s,o,function(_,h){if(_)return f(_);f(null,h.toString("binary"))}):t.pbkdf2(n,i,s,o,a,function(_,h){if(_)return f(_);f(null,h.toString("binary"))}):t.pbkdf2Sync.length===4?t.pbkdf2Sync(n,i,s,o).toString("binary"):t.pbkdf2Sync(n,i,s,o,a).toString("binary");if((typeof a>"u"||a===null)&&(a="sha1"),typeof a=="string"){if(!(a in r.md.algorithms))throw new Error("Unknown hash algorithm: "+a);a=r.md[a].create()}var l=a.digestLength;if(o>4294967295*l){var g=new Error("Derived key is too long.");if(f)return f(g);throw g}var w=Math.ceil(o/l),y=o-(w-1)*l,p=r.hmac.create();p.start(a,n);var I="",S,A,d;if(!f){for(var T=1;T<=w;++T){p.start(null,null),p.update(i),p.update(r.util.int32ToBytes(T)),S=d=p.digest().getBytes();for(var x=2;x<=s;++x)p.start(null,null),p.update(d),A=p.digest().getBytes(),S=r.util.xorBytes(S,A,l),d=A;I+=T<w?S:S.substr(0,y)}return I}var T=1,x;function k(){if(T>w)return f(null,I);p.start(null,null),p.update(i),p.update(r.util.int32ToBytes(T)),S=d=p.digest().getBytes(),x=2,U()}function U(){if(x<=s)return p.start(null,null),p.update(d),A=p.digest().getBytes(),S=r.util.xorBytes(S,A,l),d=A,++x,r.util.setImmediate(U);I+=T<w?S:S.substr(0,y),++T,k()}k()},co}var _s={exports:{}},lo={exports:{}},kh;function Up(){if(kh)return lo.exports;kh=1;var r=Ne();qr(),Ke();var e=lo.exports=r.sha256=r.sha256||{};r.md.sha256=r.md.algorithms.sha256=e,e.create=function(){n||s();var a=null,f=r.util.createBuffer(),l=new Array(64),g={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return g.start=function(){g.messageLength=0,g.fullMessageLength=g.messageLength64=[];for(var w=g.messageLengthSize/4,y=0;y<w;++y)g.fullMessageLength.push(0);return f=r.util.createBuffer(),a={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},g},g.start(),g.update=function(w,y){y==="utf8"&&(w=r.util.encodeUtf8(w));var p=w.length;g.messageLength+=p,p=[p/4294967296>>>0,p>>>0];for(var I=g.fullMessageLength.length-1;I>=0;--I)g.fullMessageLength[I]+=p[1],p[1]=p[0]+(g.fullMessageLength[I]/4294967296>>>0),g.fullMessageLength[I]=g.fullMessageLength[I]>>>0,p[0]=p[1]/4294967296>>>0;return f.putBytes(w),o(a,l,f),(f.read>2048||f.length()===0)&&f.compact(),g},g.digest=function(){var w=r.util.createBuffer();w.putBytes(f.bytes());var y=g.fullMessageLength[g.fullMessageLength.length-1]+g.messageLengthSize,p=y&g.blockLength-1;w.putBytes(t.substr(0,g.blockLength-p));for(var I,S,A=g.fullMessageLength[0]*8,d=0;d<g.fullMessageLength.length-1;++d)I=g.fullMessageLength[d+1]*8,S=I/4294967296>>>0,A+=S,w.putInt32(A>>>0),A=I>>>0;w.putInt32(A);var T={h0:a.h0,h1:a.h1,h2:a.h2,h3:a.h3,h4:a.h4,h5:a.h5,h6:a.h6,h7:a.h7};o(T,l,w);var x=r.util.createBuffer();return x.putInt32(T.h0),x.putInt32(T.h1),x.putInt32(T.h2),x.putInt32(T.h3),x.putInt32(T.h4),x.putInt32(T.h5),x.putInt32(T.h6),x.putInt32(T.h7),x},g};var t=null,n=!1,i=null;function s(){t="",t+=r.util.fillString("\0",64),i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],n=!0}function o(a,f,l){for(var g,w,y,p,I,S,A,d,T,x,k,U,_,h,c,v=l.length();v>=64;){for(A=0;A<16;++A)f[A]=l.getInt32();for(;A<64;++A)g=f[A-2],g=(g>>>17|g<<15)^(g>>>19|g<<13)^g>>>10,w=f[A-15],w=(w>>>7|w<<25)^(w>>>18|w<<14)^w>>>3,f[A]=g+f[A-7]+w+f[A-16]|0;for(d=a.h0,T=a.h1,x=a.h2,k=a.h3,U=a.h4,_=a.h5,h=a.h6,c=a.h7,A=0;A<64;++A)p=(U>>>6|U<<26)^(U>>>11|U<<21)^(U>>>25|U<<7),I=h^U&(_^h),y=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),S=d&T|x&(d^T),g=c+p+I+i[A]+f[A],w=y+S,c=h,h=_,_=U,U=k+g>>>0,k=x,x=T,T=d,d=g+w>>>0;a.h0=a.h0+d|0,a.h1=a.h1+T|0,a.h2=a.h2+x|0,a.h3=a.h3+k|0,a.h4=a.h4+U|0,a.h5=a.h5+_|0,a.h6=a.h6+h|0,a.h7=a.h7+c|0,v-=64}}return lo.exports}var ho={exports:{}},Dh;function Mp(){if(Dh)return ho.exports;Dh=1;var r=Ne();Ke();var e=null;r.util.isNodejs&&!r.options.usePureJavaScript&&!process.versions["node-webkit"]&&(e=dc);var t=ho.exports=r.prng=r.prng||{};return t.create=function(n){for(var i={plugin:n,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},s=n.md,o=new Array(32),a=0;a<32;++a)o[a]=s.create();i.pools=o,i.pool=0,i.generate=function(y,p){if(!p)return i.generateSync(y);var I=i.plugin.cipher,S=i.plugin.increment,A=i.plugin.formatKey,d=i.plugin.formatSeed,T=r.util.createBuffer();i.key=null,x();function x(k){if(k)return p(k);if(T.length()>=y)return p(null,T.getBytes(y));if(i.generated>1048575&&(i.key=null),i.key===null)return r.util.nextTick(function(){f(x)});var U=I(i.key,i.seed);i.generated+=U.length,T.putBytes(U),i.key=A(I(i.key,S(i.seed))),i.seed=d(I(i.key,i.seed)),r.util.setImmediate(x)}},i.generateSync=function(y){var p=i.plugin.cipher,I=i.plugin.increment,S=i.plugin.formatKey,A=i.plugin.formatSeed;i.key=null;for(var d=r.util.createBuffer();d.length()<y;){i.generated>1048575&&(i.key=null),i.key===null&&l();var T=p(i.key,i.seed);i.generated+=T.length,d.putBytes(T),i.key=S(p(i.key,I(i.seed))),i.seed=A(p(i.key,i.seed))}return d.getBytes(y)};function f(y){if(i.pools[0].messageLength>=32)return g(),y();var p=32-i.pools[0].messageLength<<5;i.seedFile(p,function(I,S){if(I)return y(I);i.collect(S),g(),y()})}function l(){if(i.pools[0].messageLength>=32)return g();var y=32-i.pools[0].messageLength<<5;i.collect(i.seedFileSync(y)),g()}function g(){i.reseeds=i.reseeds===4294967295?0:i.reseeds+1;var y=i.plugin.md.create();y.update(i.keyBytes);for(var p=1,I=0;I<32;++I)i.reseeds%p===0&&(y.update(i.pools[I].digest().getBytes()),i.pools[I].start()),p=p<<1;i.keyBytes=y.digest().getBytes(),y.start(),y.update(i.keyBytes);var S=y.digest().getBytes();i.key=i.plugin.formatKey(i.keyBytes),i.seed=i.plugin.formatSeed(S),i.generated=0}function w(y){var p=null,I=r.util.globalScope,S=I.crypto||I.msCrypto;S&&S.getRandomValues&&(p=function(c){return S.getRandomValues(c)});var A=r.util.createBuffer();if(p)for(;A.length()<y;){var d=Math.max(1,Math.min(y-A.length(),65536)/4),T=new Uint32Array(Math.floor(d));try{p(T);for(var x=0;x<T.length;++x)A.putInt32(T[x])}catch(c){if(!(typeof QuotaExceededError<"u"&&c instanceof QuotaExceededError))throw c}}if(A.length()<y)for(var k,U,_,h=Math.floor(Math.random()*65536);A.length()<y;){U=16807*(h&65535),k=16807*(h>>16),U+=(k&32767)<<16,U+=k>>15,U=(U&2147483647)+(U>>31),h=U&4294967295;for(var x=0;x<3;++x)_=h>>>(x<<3),_^=Math.floor(Math.random()*256),A.putByte(_&255)}return A.getBytes(y)}return e?(i.seedFile=function(y,p){e.randomBytes(y,function(I,S){if(I)return p(I);p(null,S.toString())})},i.seedFileSync=function(y){return e.randomBytes(y).toString()}):(i.seedFile=function(y,p){try{p(null,w(y))}catch(I){p(I)}},i.seedFileSync=w),i.collect=function(y){for(var p=y.length,I=0;I<p;++I)i.pools[i.pool].update(y.substr(I,1)),i.pool=i.pool===31?0:i.pool+1},i.collectInt=function(y,p){for(var I="",S=0;S<p;S+=8)I+=String.fromCharCode(y>>S&255);i.collect(I)},i.registerWorker=function(y){if(y===self)i.seedFile=function(I,S){function A(d){var T=d.data;T.forge&&T.forge.prng&&(self.removeEventListener("message",A),S(T.forge.prng.err,T.forge.prng.bytes))}self.addEventListener("message",A),self.postMessage({forge:{prng:{needed:I}}})};else{var p=function(I){var S=I.data;S.forge&&S.forge.prng&&i.seedFile(S.forge.prng.needed,function(A,d){y.postMessage({forge:{prng:{err:A,bytes:d}}})})};y.addEventListener("message",p)}},i},ho.exports}var Lh;function pr(){if(Lh)return _s.exports;Lh=1;var r=Ne();return xn(),Up(),Mp(),Ke(),function(){if(r.random&&r.random.getBytes){_s.exports=r.random;return}(function(e){var t={},n=new Array(4),i=r.util.createBuffer();t.formatKey=function(y){var p=r.util.createBuffer(y);return y=new Array(4),y[0]=p.getInt32(),y[1]=p.getInt32(),y[2]=p.getInt32(),y[3]=p.getInt32(),r.aes._expandKey(y,!1)},t.formatSeed=function(y){var p=r.util.createBuffer(y);return y=new Array(4),y[0]=p.getInt32(),y[1]=p.getInt32(),y[2]=p.getInt32(),y[3]=p.getInt32(),y},t.cipher=function(y,p){return r.aes._updateBlock(y,p,n,!1),i.putInt32(n[0]),i.putInt32(n[1]),i.putInt32(n[2]),i.putInt32(n[3]),i.getBytes()},t.increment=function(y){return++y[3],y},t.md=r.md.sha256;function s(){var y=r.prng.create(t);return y.getBytes=function(p,I){return y.generate(p,I)},y.getBytesSync=function(p){return y.generate(p)},y}var o=s(),a=null,f=r.util.globalScope,l=f.crypto||f.msCrypto;if(l&&l.getRandomValues&&(a=function(y){return l.getRandomValues(y)}),r.options.usePureJavaScript||!r.util.isNodejs&&!a){if(o.collectInt(+new Date,32),typeof navigator<"u"){var g="";for(var w in navigator)try{typeof navigator[w]=="string"&&(g+=navigator[w])}catch{}o.collect(g),g=null}e&&(e().mousemove(function(y){o.collectInt(y.clientX,16),o.collectInt(y.clientY,16)}),e().keypress(function(y){o.collectInt(y.charCode,8)}))}if(!r.random)r.random=o;else for(var w in o)r.random[w]=o[w];r.random.createInstance=s,_s.exports=r.random})(typeof jQuery<"u"?jQuery:null)}(),_s.exports}var fo,Vh;function Fp(){if(Vh)return fo;Vh=1;var r=Ne();Ke();var e=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],t=[1,2,3,5],n=function(o,a){return o<<a&65535|(o&65535)>>16-a},i=function(o,a){return(o&65535)>>a|o<<16-a&65535};fo=r.rc2=r.rc2||{},r.rc2.expandKey=function(o,a){typeof o=="string"&&(o=r.util.createBuffer(o)),a=a||128;var f=o,l=o.length(),g=a,w=Math.ceil(g/8),y=255>>(g&7),p;for(p=l;p<128;p++)f.putByte(e[f.at(p-1)+f.at(p-l)&255]);for(f.setAt(128-w,e[f.at(128-w)&y]),p=127-w;p>=0;p--)f.setAt(p,e[f.at(p+1)^f.at(p+w)]);return f};var s=function(o,a,f){var l=!1,g=null,w=null,y=null,p,I,S,A,d=[];for(o=r.rc2.expandKey(o,a),S=0;S<64;S++)d.push(o.getInt16Le());f?(p=function(k){for(S=0;S<4;S++)k[S]+=d[A]+(k[(S+3)%4]&k[(S+2)%4])+(~k[(S+3)%4]&k[(S+1)%4]),k[S]=n(k[S],t[S]),A++},I=function(k){for(S=0;S<4;S++)k[S]+=d[k[(S+3)%4]&63]}):(p=function(k){for(S=3;S>=0;S--)k[S]=i(k[S],t[S]),k[S]-=d[A]+(k[(S+3)%4]&k[(S+2)%4])+(~k[(S+3)%4]&k[(S+1)%4]),A--},I=function(k){for(S=3;S>=0;S--)k[S]-=d[k[(S+3)%4]&63]});var T=function(k){var U=[];for(S=0;S<4;S++){var _=g.getInt16Le();y!==null&&(f?_^=y.getInt16Le():y.putInt16Le(_)),U.push(_&65535)}A=f?0:63;for(var h=0;h<k.length;h++)for(var c=0;c<k[h][0];c++)k[h][1](U);for(S=0;S<4;S++)y!==null&&(f?y.putInt16Le(U[S]):U[S]^=y.getInt16Le()),w.putInt16Le(U[S])},x=null;return x={start:function(k,U){k&&typeof k=="string"&&(k=r.util.createBuffer(k)),l=!1,g=r.util.createBuffer(),w=U||new r.util.createBuffer,y=k,x.output=w},update:function(k){for(l||g.putBuffer(k);g.length()>=8;)T([[5,p],[1,I],[6,p],[1,I],[5,p]])},finish:function(k){var U=!0;if(f)if(k)U=k(8,g,!f);else{var _=g.length()===8?8:8-g.length();g.fillWithByte(_,_)}if(U&&(l=!0,x.update()),!f&&(U=g.length()===0,U))if(k)U=k(8,w,!f);else{var h=w.length(),c=w.at(h-1);c>h?U=!1:w.truncate(c)}return U}},x};return r.rc2.startEncrypting=function(o,a,f){var l=r.rc2.createEncryptionCipher(o,128);return l.start(a,f),l},r.rc2.createEncryptionCipher=function(o,a){return s(o,a,!0)},r.rc2.startDecrypting=function(o,a,f){var l=r.rc2.createDecryptionCipher(o,128);return l.start(a,f),l},r.rc2.createDecryptionCipher=function(o,a){return s(o,a,!1)},fo}var po,Oh;function Aa(){if(Oh)return po;Oh=1;var r=Ne();po=r.jsbn=r.jsbn||{};var e;function t(D,V,K){this.data=[],D!=null&&(typeof D=="number"?this.fromNumber(D,V,K):V==null&&typeof D!="string"?this.fromString(D,256):this.fromString(D,V))}r.jsbn.BigInteger=t;function n(){return new t(null)}function i(D,V,K,G,J,re){for(;--re>=0;){var he=V*this.data[D++]+K.data[G]+J;J=Math.floor(he/67108864),K.data[G++]=he&67108863}return J}function s(D,V,K,G,J,re){for(var he=V&32767,ue=V>>15;--re>=0;){var qe=this.data[D]&32767,gt=this.data[D++]>>15,$t=ue*qe+gt*he;qe=he*qe+(($t&32767)<<15)+K.data[G]+(J&1073741823),J=(qe>>>30)+($t>>>15)+ue*gt+(J>>>30),K.data[G++]=qe&1073741823}return J}function o(D,V,K,G,J,re){for(var he=V&16383,ue=V>>14;--re>=0;){var qe=this.data[D]&16383,gt=this.data[D++]>>14,$t=ue*qe+gt*he;qe=he*qe+(($t&16383)<<14)+K.data[G]+J,J=(qe>>28)+($t>>14)+ue*gt,K.data[G++]=qe&268435455}return J}typeof navigator>"u"?(t.prototype.am=o,e=28):navigator.appName=="Microsoft Internet Explorer"?(t.prototype.am=s,e=30):navigator.appName!="Netscape"?(t.prototype.am=i,e=26):(t.prototype.am=o,e=28),t.prototype.DB=e,t.prototype.DM=(1<<e)-1,t.prototype.DV=1<<e;var a=52;t.prototype.FV=Math.pow(2,a),t.prototype.F1=a-e,t.prototype.F2=2*e-a;var f="0123456789abcdefghijklmnopqrstuvwxyz",l=new Array,g,w;for(g=48,w=0;w<=9;++w)l[g++]=w;for(g=97,w=10;w<36;++w)l[g++]=w;for(g=65,w=10;w<36;++w)l[g++]=w;function y(D){return f.charAt(D)}function p(D,V){var K=l[D.charCodeAt(V)];return K??-1}function I(D){for(var V=this.t-1;V>=0;--V)D.data[V]=this.data[V];D.t=this.t,D.s=this.s}function S(D){this.t=1,this.s=D<0?-1:0,D>0?this.data[0]=D:D<-1?this.data[0]=D+this.DV:this.t=0}function A(D){var V=n();return V.fromInt(D),V}function d(D,V){var K;if(V==16)K=4;else if(V==8)K=3;else if(V==256)K=8;else if(V==2)K=1;else if(V==32)K=5;else if(V==4)K=2;else{this.fromRadix(D,V);return}this.t=0,this.s=0;for(var G=D.length,J=!1,re=0;--G>=0;){var he=K==8?D[G]&255:p(D,G);if(he<0){D.charAt(G)=="-"&&(J=!0);continue}J=!1,re==0?this.data[this.t++]=he:re+K>this.DB?(this.data[this.t-1]|=(he&(1<<this.DB-re)-1)<<re,this.data[this.t++]=he>>this.DB-re):this.data[this.t-1]|=he<<re,re+=K,re>=this.DB&&(re-=this.DB)}K==8&&D[0]&128&&(this.s=-1,re>0&&(this.data[this.t-1]|=(1<<this.DB-re)-1<<re)),this.clamp(),J&&t.ZERO.subTo(this,this)}function T(){for(var D=this.s&this.DM;this.t>0&&this.data[this.t-1]==D;)--this.t}function x(D){if(this.s<0)return"-"+this.negate().toString(D);var V;if(D==16)V=4;else if(D==8)V=3;else if(D==2)V=1;else if(D==32)V=5;else if(D==4)V=2;else return this.toRadix(D);var K=(1<<V)-1,G,J=!1,re="",he=this.t,ue=this.DB-he*this.DB%V;if(he-- >0)for(ue<this.DB&&(G=this.data[he]>>ue)>0&&(J=!0,re=y(G));he>=0;)ue<V?(G=(this.data[he]&(1<<ue)-1)<<V-ue,G|=this.data[--he]>>(ue+=this.DB-V)):(G=this.data[he]>>(ue-=V)&K,ue<=0&&(ue+=this.DB,--he)),G>0&&(J=!0),J&&(re+=y(G));return J?re:"0"}function k(){var D=n();return t.ZERO.subTo(this,D),D}function U(){return this.s<0?this.negate():this}function _(D){var V=this.s-D.s;if(V!=0)return V;var K=this.t;if(V=K-D.t,V!=0)return this.s<0?-V:V;for(;--K>=0;)if((V=this.data[K]-D.data[K])!=0)return V;return 0}function h(D){var V=1,K;return(K=D>>>16)!=0&&(D=K,V+=16),(K=D>>8)!=0&&(D=K,V+=8),(K=D>>4)!=0&&(D=K,V+=4),(K=D>>2)!=0&&(D=K,V+=2),(K=D>>1)!=0&&(D=K,V+=1),V}function c(){return this.t<=0?0:this.DB*(this.t-1)+h(this.data[this.t-1]^this.s&this.DM)}function v(D,V){var K;for(K=this.t-1;K>=0;--K)V.data[K+D]=this.data[K];for(K=D-1;K>=0;--K)V.data[K]=0;V.t=this.t+D,V.s=this.s}function b(D,V){for(var K=D;K<this.t;++K)V.data[K-D]=this.data[K];V.t=Math.max(this.t-D,0),V.s=this.s}function B(D,V){var K=D%this.DB,G=this.DB-K,J=(1<<G)-1,re=Math.floor(D/this.DB),he=this.s<<K&this.DM,ue;for(ue=this.t-1;ue>=0;--ue)V.data[ue+re+1]=this.data[ue]>>G|he,he=(this.data[ue]&J)<<K;for(ue=re-1;ue>=0;--ue)V.data[ue]=0;V.data[re]=he,V.t=this.t+re+1,V.s=this.s,V.clamp()}function R(D,V){V.s=this.s;var K=Math.floor(D/this.DB);if(K>=this.t){V.t=0;return}var G=D%this.DB,J=this.DB-G,re=(1<<G)-1;V.data[0]=this.data[K]>>G;for(var he=K+1;he<this.t;++he)V.data[he-K-1]|=(this.data[he]&re)<<J,V.data[he-K]=this.data[he]>>G;G>0&&(V.data[this.t-K-1]|=(this.s&re)<<J),V.t=this.t-K,V.clamp()}function P(D,V){for(var K=0,G=0,J=Math.min(D.t,this.t);K<J;)G+=this.data[K]-D.data[K],V.data[K++]=G&this.DM,G>>=this.DB;if(D.t<this.t){for(G-=D.s;K<this.t;)G+=this.data[K],V.data[K++]=G&this.DM,G>>=this.DB;G+=this.s}else{for(G+=this.s;K<D.t;)G-=D.data[K],V.data[K++]=G&this.DM,G>>=this.DB;G-=D.s}V.s=G<0?-1:0,G<-1?V.data[K++]=this.DV+G:G>0&&(V.data[K++]=G),V.t=K,V.clamp()}function H(D,V){var K=this.abs(),G=D.abs(),J=K.t;for(V.t=J+G.t;--J>=0;)V.data[J]=0;for(J=0;J<G.t;++J)V.data[J+K.t]=K.am(0,G.data[J],V,J,0,K.t);V.s=0,V.clamp(),this.s!=D.s&&t.ZERO.subTo(V,V)}function z(D){for(var V=this.abs(),K=D.t=2*V.t;--K>=0;)D.data[K]=0;for(K=0;K<V.t-1;++K){var G=V.am(K,V.data[K],D,2*K,0,1);(D.data[K+V.t]+=V.am(K+1,2*V.data[K],D,2*K+1,G,V.t-K-1))>=V.DV&&(D.data[K+V.t]-=V.DV,D.data[K+V.t+1]=1)}D.t>0&&(D.data[D.t-1]+=V.am(K,V.data[K],D,2*K,0,1)),D.s=0,D.clamp()}function W(D,V,K){var G=D.abs();if(!(G.t<=0)){var J=this.abs();if(J.t<G.t){V?.fromInt(0),K!=null&&this.copyTo(K);return}K==null&&(K=n());var re=n(),he=this.s,ue=D.s,qe=this.DB-h(G.data[G.t-1]);qe>0?(G.lShiftTo(qe,re),J.lShiftTo(qe,K)):(G.copyTo(re),J.copyTo(K));var gt=re.t,$t=re.data[gt-1];if($t!=0){var mt=$t*(1<<this.F1)+(gt>1?re.data[gt-2]>>this.F2:0),It=this.FV/mt,wr=(1<<this.F1)/mt,Ot=1<<this.F2,Wt=K.t,je=Wt-gt,tr=V??n();for(re.dlShiftTo(je,tr),K.compareTo(tr)>=0&&(K.data[K.t++]=1,K.subTo(tr,K)),t.ONE.dlShiftTo(gt,tr),tr.subTo(re,re);re.t<gt;)re.data[re.t++]=0;for(;--je>=0;){var br=K.data[--Wt]==$t?this.DM:Math.floor(K.data[Wt]*It+(K.data[Wt-1]+Ot)*wr);if((K.data[Wt]+=re.am(0,br,K,je,0,gt))<br)for(re.dlShiftTo(je,tr),K.subTo(tr,K);K.data[Wt]<--br;)K.subTo(tr,K)}V!=null&&(K.drShiftTo(gt,V),he!=ue&&t.ZERO.subTo(V,V)),K.t=gt,K.clamp(),qe>0&&K.rShiftTo(qe,K),he<0&&t.ZERO.subTo(K,K)}}}function te(D){var V=n();return this.abs().divRemTo(D,null,V),this.s<0&&V.compareTo(t.ZERO)>0&&D.subTo(V,V),V}function ne(D){this.m=D}function oe(D){return D.s<0||D.compareTo(this.m)>=0?D.mod(this.m):D}function me(D){return D}function Se(D){D.divRemTo(this.m,null,D)}function xe(D,V,K){D.multiplyTo(V,K),this.reduce(K)}function we(D,V){D.squareTo(V),this.reduce(V)}ne.prototype.convert=oe,ne.prototype.revert=me,ne.prototype.reduce=Se,ne.prototype.mulTo=xe,ne.prototype.sqrTo=we;function ie(){if(this.t<1)return 0;var D=this.data[0];if(!(D&1))return 0;var V=D&3;return V=V*(2-(D&15)*V)&15,V=V*(2-(D&255)*V)&255,V=V*(2-((D&65535)*V&65535))&65535,V=V*(2-D*V%this.DV)%this.DV,V>0?this.DV-V:-V}function Te(D){this.m=D,this.mp=D.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<D.DB-15)-1,this.mt2=2*D.t}function ae(D){var V=n();return D.abs().dlShiftTo(this.m.t,V),V.divRemTo(this.m,null,V),D.s<0&&V.compareTo(t.ZERO)>0&&this.m.subTo(V,V),V}function ut(D){var V=n();return D.copyTo(V),this.reduce(V),V}function be(D){for(;D.t<=this.mt2;)D.data[D.t++]=0;for(var V=0;V<this.m.t;++V){var K=D.data[V]&32767,G=K*this.mpl+((K*this.mph+(D.data[V]>>15)*this.mpl&this.um)<<15)&D.DM;for(K=V+this.m.t,D.data[K]+=this.m.am(0,G,D,V,0,this.m.t);D.data[K]>=D.DV;)D.data[K]-=D.DV,D.data[++K]++}D.clamp(),D.drShiftTo(this.m.t,D),D.compareTo(this.m)>=0&&D.subTo(this.m,D)}function C(D,V){D.squareTo(V),this.reduce(V)}function M(D,V,K){D.multiplyTo(V,K),this.reduce(K)}Te.prototype.convert=ae,Te.prototype.revert=ut,Te.prototype.reduce=be,Te.prototype.mulTo=M,Te.prototype.sqrTo=C;function O(){return(this.t>0?this.data[0]&1:this.s)==0}function m(D,V){if(D>4294967295||D<1)return t.ONE;var K=n(),G=n(),J=V.convert(this),re=h(D)-1;for(J.copyTo(K);--re>=0;)if(V.sqrTo(K,G),(D&1<<re)>0)V.mulTo(G,J,K);else{var he=K;K=G,G=he}return V.revert(K)}function L(D,V){var K;return D<256||V.isEven()?K=new ne(V):K=new Te(V),this.exp(D,K)}t.prototype.copyTo=I,t.prototype.fromInt=S,t.prototype.fromString=d,t.prototype.clamp=T,t.prototype.dlShiftTo=v,t.prototype.drShiftTo=b,t.prototype.lShiftTo=B,t.prototype.rShiftTo=R,t.prototype.subTo=P,t.prototype.multiplyTo=H,t.prototype.squareTo=z,t.prototype.divRemTo=W,t.prototype.invDigit=ie,t.prototype.isEven=O,t.prototype.exp=m,t.prototype.toString=x,t.prototype.negate=k,t.prototype.abs=U,t.prototype.compareTo=_,t.prototype.bitLength=c,t.prototype.mod=te,t.prototype.modPowInt=L,t.ZERO=A(0),t.ONE=A(1);function j(){var D=n();return this.copyTo(D),D}function q(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function ee(){return this.t==0?this.s:this.data[0]<<24>>24}function le(){return this.t==0?this.s:this.data[0]<<16>>16}function ge(D){return Math.floor(Math.LN2*this.DB/Math.log(D))}function Y(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function ce(D){if(D==null&&(D=10),this.signum()==0||D<2||D>36)return"0";var V=this.chunkSize(D),K=Math.pow(D,V),G=A(K),J=n(),re=n(),he="";for(this.divRemTo(G,J,re);J.signum()>0;)he=(K+re.intValue()).toString(D).substr(1)+he,J.divRemTo(G,J,re);return re.intValue().toString(D)+he}function ve(D,V){this.fromInt(0),V==null&&(V=10);for(var K=this.chunkSize(V),G=Math.pow(V,K),J=!1,re=0,he=0,ue=0;ue<D.length;++ue){var qe=p(D,ue);if(qe<0){D.charAt(ue)=="-"&&this.signum()==0&&(J=!0);continue}he=V*he+qe,++re>=K&&(this.dMultiply(G),this.dAddOffset(he,0),re=0,he=0)}re>0&&(this.dMultiply(Math.pow(V,re)),this.dAddOffset(he,0)),J&&t.ZERO.subTo(this,this)}function De(D,V,K){if(typeof V=="number")if(D<2)this.fromInt(1);else for(this.fromNumber(D,K),this.testBit(D-1)||this.bitwiseTo(t.ONE.shiftLeft(D-1),rt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(V);)this.dAddOffset(2,0),this.bitLength()>D&&this.subTo(t.ONE.shiftLeft(D-1),this);else{var G=new Array,J=D&7;G.length=(D>>3)+1,V.nextBytes(G),J>0?G[0]&=(1<<J)-1:G[0]=0,this.fromString(G,256)}}function Ce(){var D=this.t,V=new Array;V[0]=this.s;var K=this.DB-D*this.DB%8,G,J=0;if(D-- >0)for(K<this.DB&&(G=this.data[D]>>K)!=(this.s&this.DM)>>K&&(V[J++]=G|this.s<<this.DB-K);D>=0;)K<8?(G=(this.data[D]&(1<<K)-1)<<8-K,G|=this.data[--D]>>(K+=this.DB-8)):(G=this.data[D]>>(K-=8)&255,K<=0&&(K+=this.DB,--D)),G&128&&(G|=-256),J==0&&(this.s&128)!=(G&128)&&++J,(J>0||G!=this.s)&&(V[J++]=G);return V}function $e(D){return this.compareTo(D)==0}function tt(D){return this.compareTo(D)<0?this:D}function Pe(D){return this.compareTo(D)>0?this:D}function Be(D,V,K){var G,J,re=Math.min(D.t,this.t);for(G=0;G<re;++G)K.data[G]=V(this.data[G],D.data[G]);if(D.t<this.t){for(J=D.s&this.DM,G=re;G<this.t;++G)K.data[G]=V(this.data[G],J);K.t=this.t}else{for(J=this.s&this.DM,G=re;G<D.t;++G)K.data[G]=V(J,D.data[G]);K.t=D.t}K.s=V(this.s,D.s),K.clamp()}function Ge(D,V){return D&V}function We(D){var V=n();return this.bitwiseTo(D,Ge,V),V}function rt(D,V){return D|V}function Ct(D){var V=n();return this.bitwiseTo(D,rt,V),V}function nt(D,V){return D^V}function wt(D){var V=n();return this.bitwiseTo(D,nt,V),V}function bt(D,V){return D&~V}function Pt(D){var V=n();return this.bitwiseTo(D,bt,V),V}function Gt(){for(var D=n(),V=0;V<this.t;++V)D.data[V]=this.DM&~this.data[V];return D.t=this.t,D.s=~this.s,D}function Zt(D){var V=n();return D<0?this.rShiftTo(-D,V):this.lShiftTo(D,V),V}function zt(D){var V=n();return D<0?this.lShiftTo(-D,V):this.rShiftTo(D,V),V}function ar(D){if(D==0)return-1;var V=0;return D&65535||(D>>=16,V+=16),D&255||(D>>=8,V+=8),D&15||(D>>=4,V+=4),D&3||(D>>=2,V+=2),D&1||++V,V}function cr(){for(var D=0;D<this.t;++D)if(this.data[D]!=0)return D*this.DB+ar(this.data[D]);return this.s<0?this.t*this.DB:-1}function er(D){for(var V=0;D!=0;)D&=D-1,++V;return V}function gr(){for(var D=0,V=this.s&this.DM,K=0;K<this.t;++K)D+=er(this.data[K]^V);return D}function Sr(D){var V=Math.floor(D/this.DB);return V>=this.t?this.s!=0:(this.data[V]&1<<D%this.DB)!=0}function or(D,V){var K=t.ONE.shiftLeft(D);return this.bitwiseTo(K,V,K),K}function ct(D){return this.changeBit(D,rt)}function it(D){return this.changeBit(D,bt)}function lt(D){return this.changeBit(D,nt)}function Xe(D,V){for(var K=0,G=0,J=Math.min(D.t,this.t);K<J;)G+=this.data[K]+D.data[K],V.data[K++]=G&this.DM,G>>=this.DB;if(D.t<this.t){for(G+=D.s;K<this.t;)G+=this.data[K],V.data[K++]=G&this.DM,G>>=this.DB;G+=this.s}else{for(G+=this.s;K<D.t;)G+=D.data[K],V.data[K++]=G&this.DM,G>>=this.DB;G+=D.s}V.s=G<0?-1:0,G>0?V.data[K++]=G:G<-1&&(V.data[K++]=this.DV+G),V.t=K,V.clamp()}function ht(D){var V=n();return this.addTo(D,V),V}function Oe(D){var V=n();return this.subTo(D,V),V}function ft(D){var V=n();return this.multiplyTo(D,V),V}function Je(D){var V=n();return this.divRemTo(D,V,null),V}function Ze(D){var V=n();return this.divRemTo(D,null,V),V}function vt(D){var V=n(),K=n();return this.divRemTo(D,V,K),new Array(V,K)}function _t(D){this.data[this.t]=this.am(0,D-1,this,0,0,this.t),++this.t,this.clamp()}function Qe(D,V){if(D!=0){for(;this.t<=V;)this.data[this.t++]=0;for(this.data[V]+=D;this.data[V]>=this.DV;)this.data[V]-=this.DV,++V>=this.t&&(this.data[this.t++]=0),++this.data[V]}}function et(){}function dt(D){return D}function st(D,V,K){D.multiplyTo(V,K)}function pt(D,V){D.squareTo(V)}et.prototype.convert=dt,et.prototype.revert=dt,et.prototype.mulTo=st,et.prototype.sqrTo=pt;function oi(D){return this.exp(D,new et)}function bn(D,V,K){var G=Math.min(this.t+D.t,V);for(K.s=0,K.t=G;G>0;)K.data[--G]=0;var J;for(J=K.t-this.t;G<J;++G)K.data[G+this.t]=this.am(0,D.data[G],K,G,0,this.t);for(J=Math.min(D.t,V);G<J;++G)this.am(0,D.data[G],K,G,0,V-G);K.clamp()}function mr(D,V,K){--V;var G=K.t=this.t+D.t-V;for(K.s=0;--G>=0;)K.data[G]=0;for(G=Math.max(V-this.t,0);G<D.t;++G)K.data[this.t+G-V]=this.am(V-G,D.data[G],K,0,0,this.t+G-V);K.clamp(),K.drShiftTo(1,K)}function Ar(D){this.r2=n(),this.q3=n(),t.ONE.dlShiftTo(2*D.t,this.r2),this.mu=this.r2.divide(D),this.m=D}function es(D){if(D.s<0||D.t>2*this.m.t)return D.mod(this.m);if(D.compareTo(this.m)<0)return D;var V=n();return D.copyTo(V),this.reduce(V),V}function ui(D){return D}function ci(D){for(D.drShiftTo(this.m.t-1,this.r2),D.t>this.m.t+1&&(D.t=this.m.t+1,D.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);D.compareTo(this.r2)<0;)D.dAddOffset(1,this.m.t+1);for(D.subTo(this.r2,D);D.compareTo(this.m)>=0;)D.subTo(this.m,D)}function ts(D,V){D.squareTo(V),this.reduce(V)}function rs(D,V,K){D.multiplyTo(V,K),this.reduce(K)}Ar.prototype.convert=es,Ar.prototype.revert=ui,Ar.prototype.reduce=ci,Ar.prototype.mulTo=rs,Ar.prototype.sqrTo=ts;function ba(D,V){var K=D.bitLength(),G,J=A(1),re;if(K<=0)return J;K<18?G=1:K<48?G=3:K<144?G=4:K<768?G=5:G=6,K<8?re=new ne(V):V.isEven()?re=new Ar(V):re=new Te(V);var he=new Array,ue=3,qe=G-1,gt=(1<<G)-1;if(he[1]=re.convert(this),G>1){var $t=n();for(re.sqrTo(he[1],$t);ue<=gt;)he[ue]=n(),re.mulTo($t,he[ue-2],he[ue]),ue+=2}var mt=D.t-1,It,wr=!0,Ot=n(),Wt;for(K=h(D.data[mt])-1;mt>=0;){for(K>=qe?It=D.data[mt]>>K-qe&gt:(It=(D.data[mt]&(1<<K+1)-1)<<qe-K,mt>0&&(It|=D.data[mt-1]>>this.DB+K-qe)),ue=G;!(It&1);)It>>=1,--ue;if((K-=ue)<0&&(K+=this.DB,--mt),wr)he[It].copyTo(J),wr=!1;else{for(;ue>1;)re.sqrTo(J,Ot),re.sqrTo(Ot,J),ue-=2;ue>0?re.sqrTo(J,Ot):(Wt=J,J=Ot,Ot=Wt),re.mulTo(Ot,he[It],J)}for(;mt>=0&&!(D.data[mt]&1<<K);)re.sqrTo(J,Ot),Wt=J,J=Ot,Ot=Wt,--K<0&&(K=this.DB-1,--mt)}return re.revert(J)}function Rn(D){var V=this.s<0?this.negate():this.clone(),K=D.s<0?D.negate():D.clone();if(V.compareTo(K)<0){var G=V;V=K,K=G}var J=V.getLowestSetBit(),re=K.getLowestSetBit();if(re<0)return V;for(J<re&&(re=J),re>0&&(V.rShiftTo(re,V),K.rShiftTo(re,K));V.signum()>0;)(J=V.getLowestSetBit())>0&&V.rShiftTo(J,V),(J=K.getLowestSetBit())>0&&K.rShiftTo(J,K),V.compareTo(K)>=0?(V.subTo(K,V),V.rShiftTo(1,V)):(K.subTo(V,K),K.rShiftTo(1,K));return re>0&&K.lShiftTo(re,K),K}function ns(D){if(D<=0)return 0;var V=this.DV%D,K=this.s<0?D-1:0;if(this.t>0)if(V==0)K=this.data[0]%D;else for(var G=this.t-1;G>=0;--G)K=(V*K+this.data[G])%D;return K}function li(D){var V=D.isEven();if(this.isEven()&&V||D.signum()==0)return t.ZERO;for(var K=D.clone(),G=this.clone(),J=A(1),re=A(0),he=A(0),ue=A(1);K.signum()!=0;){for(;K.isEven();)K.rShiftTo(1,K),V?((!J.isEven()||!re.isEven())&&(J.addTo(this,J),re.subTo(D,re)),J.rShiftTo(1,J)):re.isEven()||re.subTo(D,re),re.rShiftTo(1,re);for(;G.isEven();)G.rShiftTo(1,G),V?((!he.isEven()||!ue.isEven())&&(he.addTo(this,he),ue.subTo(D,ue)),he.rShiftTo(1,he)):ue.isEven()||ue.subTo(D,ue),ue.rShiftTo(1,ue);K.compareTo(G)>=0?(K.subTo(G,K),V&&J.subTo(he,J),re.subTo(ue,re)):(G.subTo(K,G),V&&he.subTo(J,he),ue.subTo(re,ue))}if(G.compareTo(t.ONE)!=0)return t.ZERO;if(ue.compareTo(D)>=0)return ue.subtract(D);if(ue.signum()<0)ue.addTo(D,ue);else return ue;return ue.signum()<0?ue.add(D):ue}var Bt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],xr=(1<<26)/Bt[Bt.length-1];function hi(D){var V,K=this.abs();if(K.t==1&&K.data[0]<=Bt[Bt.length-1]){for(V=0;V<Bt.length;++V)if(K.data[0]==Bt[V])return!0;return!1}if(K.isEven())return!1;for(V=1;V<Bt.length;){for(var G=Bt[V],J=V+1;J<Bt.length&&G<xr;)G*=Bt[J++];for(G=K.modInt(G);V<J;)if(G%Bt[V++]==0)return!1}return K.millerRabin(D)}function Ra(D){var V=this.subtract(t.ONE),K=V.getLowestSetBit();if(K<=0)return!1;for(var G=V.shiftRight(K),J=is(),re,he=0;he<D;++he){do re=new t(this.bitLength(),J);while(re.compareTo(t.ONE)<=0||re.compareTo(V)>=0);var ue=re.modPow(G,this);if(ue.compareTo(t.ONE)!=0&&ue.compareTo(V)!=0){for(var qe=1;qe++<K&&ue.compareTo(V)!=0;)if(ue=ue.modPowInt(2,this),ue.compareTo(t.ONE)==0)return!1;if(ue.compareTo(V)!=0)return!1}}return!0}function is(){return{nextBytes:function(D){for(var V=0;V<D.length;++V)D[V]=Math.floor(Math.random()*256)}}}return t.prototype.chunkSize=ge,t.prototype.toRadix=ce,t.prototype.fromRadix=ve,t.prototype.fromNumber=De,t.prototype.bitwiseTo=Be,t.prototype.changeBit=or,t.prototype.addTo=Xe,t.prototype.dMultiply=_t,t.prototype.dAddOffset=Qe,t.prototype.multiplyLowerTo=bn,t.prototype.multiplyUpperTo=mr,t.prototype.modInt=ns,t.prototype.millerRabin=Ra,t.prototype.clone=j,t.prototype.intValue=q,t.prototype.byteValue=ee,t.prototype.shortValue=le,t.prototype.signum=Y,t.prototype.toByteArray=Ce,t.prototype.equals=$e,t.prototype.min=tt,t.prototype.max=Pe,t.prototype.and=We,t.prototype.or=Ct,t.prototype.xor=wt,t.prototype.andNot=Pt,t.prototype.not=Gt,t.prototype.shiftLeft=Zt,t.prototype.shiftRight=zt,t.prototype.getLowestSetBit=cr,t.prototype.bitCount=gr,t.prototype.testBit=Sr,t.prototype.setBit=ct,t.prototype.clearBit=it,t.prototype.flipBit=lt,t.prototype.add=ht,t.prototype.subtract=Oe,t.prototype.multiply=ft,t.prototype.divide=Je,t.prototype.remainder=Ze,t.prototype.divideAndRemainder=vt,t.prototype.modPow=ba,t.prototype.modInverse=li,t.prototype.pow=oi,t.prototype.gcd=Rn,t.prototype.isProbablePrime=hi,po}var go={exports:{}},mo={exports:{}},Uh;function Zi(){if(Uh)return mo.exports;Uh=1;var r=Ne();qr(),Ke();var e=mo.exports=r.sha1=r.sha1||{};r.md.sha1=r.md.algorithms.sha1=e,e.create=function(){n||i();var o=null,a=r.util.createBuffer(),f=new Array(80),l={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return l.start=function(){l.messageLength=0,l.fullMessageLength=l.messageLength64=[];for(var g=l.messageLengthSize/4,w=0;w<g;++w)l.fullMessageLength.push(0);return a=r.util.createBuffer(),o={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},l},l.start(),l.update=function(g,w){w==="utf8"&&(g=r.util.encodeUtf8(g));var y=g.length;l.messageLength+=y,y=[y/4294967296>>>0,y>>>0];for(var p=l.fullMessageLength.length-1;p>=0;--p)l.fullMessageLength[p]+=y[1],y[1]=y[0]+(l.fullMessageLength[p]/4294967296>>>0),l.fullMessageLength[p]=l.fullMessageLength[p]>>>0,y[0]=y[1]/4294967296>>>0;return a.putBytes(g),s(o,f,a),(a.read>2048||a.length()===0)&&a.compact(),l},l.digest=function(){var g=r.util.createBuffer();g.putBytes(a.bytes());var w=l.fullMessageLength[l.fullMessageLength.length-1]+l.messageLengthSize,y=w&l.blockLength-1;g.putBytes(t.substr(0,l.blockLength-y));for(var p,I,S=l.fullMessageLength[0]*8,A=0;A<l.fullMessageLength.length-1;++A)p=l.fullMessageLength[A+1]*8,I=p/4294967296>>>0,S+=I,g.putInt32(S>>>0),S=p>>>0;g.putInt32(S);var d={h0:o.h0,h1:o.h1,h2:o.h2,h3:o.h3,h4:o.h4};s(d,f,g);var T=r.util.createBuffer();return T.putInt32(d.h0),T.putInt32(d.h1),T.putInt32(d.h2),T.putInt32(d.h3),T.putInt32(d.h4),T},l};var t=null,n=!1;function i(){t="",t+=r.util.fillString("\0",64),n=!0}function s(o,a,f){for(var l,g,w,y,p,I,S,A,d=f.length();d>=64;){for(g=o.h0,w=o.h1,y=o.h2,p=o.h3,I=o.h4,A=0;A<16;++A)l=f.getInt32(),a[A]=l,S=p^w&(y^p),l=(g<<5|g>>>27)+S+I+1518500249+l,I=p,p=y,y=(w<<30|w>>>2)>>>0,w=g,g=l;for(;A<20;++A)l=a[A-3]^a[A-8]^a[A-14]^a[A-16],l=l<<1|l>>>31,a[A]=l,S=p^w&(y^p),l=(g<<5|g>>>27)+S+I+1518500249+l,I=p,p=y,y=(w<<30|w>>>2)>>>0,w=g,g=l;for(;A<32;++A)l=a[A-3]^a[A-8]^a[A-14]^a[A-16],l=l<<1|l>>>31,a[A]=l,S=w^y^p,l=(g<<5|g>>>27)+S+I+1859775393+l,I=p,p=y,y=(w<<30|w>>>2)>>>0,w=g,g=l;for(;A<40;++A)l=a[A-6]^a[A-16]^a[A-28]^a[A-32],l=l<<2|l>>>30,a[A]=l,S=w^y^p,l=(g<<5|g>>>27)+S+I+1859775393+l,I=p,p=y,y=(w<<30|w>>>2)>>>0,w=g,g=l;for(;A<60;++A)l=a[A-6]^a[A-16]^a[A-28]^a[A-32],l=l<<2|l>>>30,a[A]=l,S=w&y|p&(w^y),l=(g<<5|g>>>27)+S+I+2400959708+l,I=p,p=y,y=(w<<30|w>>>2)>>>0,w=g,g=l;for(;A<80;++A)l=a[A-6]^a[A-16]^a[A-28]^a[A-32],l=l<<2|l>>>30,a[A]=l,S=w^y^p,l=(g<<5|g>>>27)+S+I+3395469782+l,I=p,p=y,y=(w<<30|w>>>2)>>>0,w=g,g=l;o.h0=o.h0+g|0,o.h1=o.h1+w|0,o.h2=o.h2+y|0,o.h3=o.h3+p|0,o.h4=o.h4+I|0,d-=64}}return mo.exports}var Mh;function Kp(){if(Mh)return go.exports;Mh=1;var r=Ne();Ke(),pr(),Zi();var e=go.exports=r.pkcs1=r.pkcs1||{};e.encode_rsa_oaep=function(n,i,s){var o,a,f,l;typeof s=="string"?(o=s,a=arguments[3]||void 0,f=arguments[4]||void 0):s&&(o=s.label||void 0,a=s.seed||void 0,f=s.md||void 0,s.mgf1&&s.mgf1.md&&(l=s.mgf1.md)),f?f.start():f=r.md.sha1.create(),l||(l=f);var g=Math.ceil(n.n.bitLength()/8),w=g-2*f.digestLength-2;if(i.length>w){var y=new Error("RSAES-OAEP input message length is too long.");throw y.length=i.length,y.maxLength=w,y}o||(o=""),f.update(o,"raw");for(var p=f.digest(),I="",S=w-i.length,A=0;A<S;A++)I+="\0";var d=p.getBytes()+I+""+i;if(!a)a=r.random.getBytes(f.digestLength);else if(a.length!==f.digestLength){var y=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw y.seedLength=a.length,y.digestLength=f.digestLength,y}var T=t(a,g-f.digestLength-1,l),x=r.util.xorBytes(d,T,d.length),k=t(x,f.digestLength,l),U=r.util.xorBytes(a,k,a.length);return"\0"+U+x},e.decode_rsa_oaep=function(n,i,s){var o,a,f;typeof s=="string"?(o=s,a=arguments[3]||void 0):s&&(o=s.label||void 0,a=s.md||void 0,s.mgf1&&s.mgf1.md&&(f=s.mgf1.md));var l=Math.ceil(n.n.bitLength()/8);if(i.length!==l){var x=new Error("RSAES-OAEP encoded message length is invalid.");throw x.length=i.length,x.expectedLength=l,x}if(a===void 0?a=r.md.sha1.create():a.start(),f||(f=a),l<2*a.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");o||(o=""),a.update(o,"raw");for(var g=a.digest().getBytes(),w=i.charAt(0),y=i.substring(1,a.digestLength+1),p=i.substring(1+a.digestLength),I=t(p,a.digestLength,f),S=r.util.xorBytes(y,I,y.length),A=t(S,l-a.digestLength-1,f),d=r.util.xorBytes(p,A,p.length),T=d.substring(0,a.digestLength),x=w!=="\0",k=0;k<a.digestLength;++k)x|=g.charAt(k)!==T.charAt(k);for(var U=1,_=a.digestLength,h=a.digestLength;h<d.length;h++){var c=d.charCodeAt(h),v=c&1^1,b=U?65534:0;x|=c&b,U=U&v,_+=U}if(x||d.charCodeAt(_)!==1)throw new Error("Invalid RSAES-OAEP padding.");return d.substring(_+1)};function t(n,i,s){s||(s=r.md.sha1.create());for(var o="",a=Math.ceil(i/s.digestLength),f=0;f<a;++f){var l=String.fromCharCode(f>>24&255,f>>16&255,f>>8&255,f&255);s.start(),s.update(n+l),o+=s.digest().getBytes()}return o.substring(0,i)}return go.exports}var Es={exports:{}},Fh;function qp(){if(Fh)return Es.exports;Fh=1;var r=Ne();return Ke(),Aa(),pr(),function(){if(r.prime){Es.exports=r.prime;return}var e=Es.exports=r.prime=r.prime||{},t=r.jsbn.BigInteger,n=[6,4,2,4,2,4,6,2],i=new t(null);i.fromInt(30);var s=function(y,p){return y|p};e.generateProbablePrime=function(y,p,I){typeof p=="function"&&(I=p,p={}),p=p||{};var S=p.algorithm||"PRIMEINC";typeof S=="string"&&(S={name:S}),S.options=S.options||{};var A=p.prng||r.random,d={nextBytes:function(T){for(var x=A.getBytesSync(T.length),k=0;k<T.length;++k)T[k]=x.charCodeAt(k)}};if(S.name==="PRIMEINC")return o(y,d,S.options,I);throw new Error("Invalid prime generation algorithm: "+S.name)};function o(y,p,I,S){return"workers"in I?l(y,p,I,S):a(y,p,I,S)}function a(y,p,I,S){var A=g(y,p),d=0,T=w(A.bitLength());"millerRabinTests"in I&&(T=I.millerRabinTests);var x=10;"maxBlockTime"in I&&(x=I.maxBlockTime),f(A,y,p,d,T,x,S)}function f(y,p,I,S,A,d,T){var x=+new Date;do{if(y.bitLength()>p&&(y=g(p,I)),y.isProbablePrime(A))return T(null,y);y.dAddOffset(n[S++%8],0)}while(d<0||+new Date-x<d);r.util.setImmediate(function(){f(y,p,I,S,A,d,T)})}function l(y,p,I,S){if(typeof Worker>"u")return a(y,p,I,S);var A=g(y,p),d=I.workers,T=I.workLoad||100,x=T*30/8,k=I.workerScript||"forge/prime.worker.js";if(d===-1)return r.util.estimateCores(function(_,h){_&&(h=2),d=h-1,U()});U();function U(){d=Math.max(1,d);for(var _=[],h=0;h<d;++h)_[h]=new Worker(k);for(var h=0;h<d;++h)_[h].addEventListener("message",v);var c=!1;function v(b){if(!c){var B=b.data;if(B.found){for(var R=0;R<_.length;++R)_[R].terminate();return c=!0,S(null,new t(B.prime,16))}A.bitLength()>y&&(A=g(y,p));var P=A.toString(16);b.target.postMessage({hex:P,workLoad:T}),A.dAddOffset(x,0)}}}}function g(y,p){var I=new t(y,p),S=y-1;return I.testBit(S)||I.bitwiseTo(t.ONE.shiftLeft(S),s,I),I.dAddOffset(31-I.mod(i).byteValue(),0),I}function w(y){return y<=100?27:y<=150?18:y<=200?15:y<=250?12:y<=300?9:y<=350?8:y<=400?7:y<=500?6:y<=600?5:y<=800?4:y<=1250?3:2}}(),Es.exports}var yo,Kh;function xa(){if(Kh)return yo;Kh=1;var r=Ne();if(Ir(),Aa(),wn(),Kp(),qp(),pr(),Ke(),typeof e>"u")var e=r.jsbn.BigInteger;var t=r.util.isNodejs?dc:null,n=r.asn1,i=r.util;r.pki=r.pki||{},yo=r.pki.rsa=r.rsa=r.rsa||{};var s=r.pki,o=[6,4,2,4,2,4,6,2],a={name:"PrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},f={name:"RSAPrivateKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},l={name:"RSAPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},g=r.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},w={name:"DigestInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:n.Class.UNIVERSAL,type:n.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},y=function(h){var c;if(h.algorithm in s.oids)c=s.oids[h.algorithm];else{var v=new Error("Unknown message digest algorithm.");throw v.algorithm=h.algorithm,v}var b=n.oidToDer(c).getBytes(),B=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[]),R=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[]);R.value.push(n.create(n.Class.UNIVERSAL,n.Type.OID,!1,b)),R.value.push(n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,""));var P=n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,h.digest().getBytes());return B.value.push(R),B.value.push(P),n.toDer(B).getBytes()},p=function(h,c,v){if(v)return h.modPow(c.e,c.n);if(!c.p||!c.q)return h.modPow(c.d,c.n);c.dP||(c.dP=c.d.mod(c.p.subtract(e.ONE))),c.dQ||(c.dQ=c.d.mod(c.q.subtract(e.ONE))),c.qInv||(c.qInv=c.q.modInverse(c.p));var b;do b=new e(r.util.bytesToHex(r.random.getBytes(c.n.bitLength()/8)),16);while(b.compareTo(c.n)>=0||!b.gcd(c.n).equals(e.ONE));h=h.multiply(b.modPow(c.e,c.n)).mod(c.n);for(var B=h.mod(c.p).modPow(c.dP,c.p),R=h.mod(c.q).modPow(c.dQ,c.q);B.compareTo(R)<0;)B=B.add(c.p);var P=B.subtract(R).multiply(c.qInv).mod(c.p).multiply(c.q).add(R);return P=P.multiply(b.modInverse(c.n)).mod(c.n),P};s.rsa.encrypt=function(h,c,v){var b=v,B,R=Math.ceil(c.n.bitLength()/8);v!==!1&&v!==!0?(b=v===2,B=I(h,c,v)):(B=r.util.createBuffer(),B.putBytes(h));for(var P=new e(B.toHex(),16),H=p(P,c,b),z=H.toString(16),W=r.util.createBuffer(),te=R-Math.ceil(z.length/2);te>0;)W.putByte(0),--te;return W.putBytes(r.util.hexToBytes(z)),W.getBytes()},s.rsa.decrypt=function(h,c,v,b){var B=Math.ceil(c.n.bitLength()/8);if(h.length!==B){var R=new Error("Encrypted message length is invalid.");throw R.length=h.length,R.expected=B,R}var P=new e(r.util.createBuffer(h).toHex(),16);if(P.compareTo(c.n)>=0)throw new Error("Encrypted message is invalid.");for(var H=p(P,c,v),z=H.toString(16),W=r.util.createBuffer(),te=B-Math.ceil(z.length/2);te>0;)W.putByte(0),--te;return W.putBytes(r.util.hexToBytes(z)),b!==!1?S(W.getBytes(),c,v):W.getBytes()},s.rsa.createKeyPairGenerationState=function(h,c,v){typeof h=="string"&&(h=parseInt(h,10)),h=h||2048,v=v||{};var b=v.prng||r.random,B={nextBytes:function(H){for(var z=b.getBytesSync(H.length),W=0;W<H.length;++W)H[W]=z.charCodeAt(W)}},R=v.algorithm||"PRIMEINC",P;if(R==="PRIMEINC")P={algorithm:R,state:0,bits:h,rng:B,eInt:c||65537,e:new e(null),p:null,q:null,qBits:h>>1,pBits:h-(h>>1),pqState:0,num:null,keys:null},P.e.fromInt(P.eInt);else throw new Error("Invalid key generation algorithm: "+R);return P},s.rsa.stepKeyPairGenerationState=function(h,c){"algorithm"in h||(h.algorithm="PRIMEINC");var v=new e(null);v.fromInt(30);for(var b=0,B=function(ne,oe){return ne|oe},R=+new Date,P,H=0;h.keys===null&&(c<=0||H<c);){if(h.state===0){var z=h.p===null?h.pBits:h.qBits,W=z-1;h.pqState===0?(h.num=new e(z,h.rng),h.num.testBit(W)||h.num.bitwiseTo(e.ONE.shiftLeft(W),B,h.num),h.num.dAddOffset(31-h.num.mod(v).byteValue(),0),b=0,++h.pqState):h.pqState===1?h.num.bitLength()>z?h.pqState=0:h.num.isProbablePrime(T(h.num.bitLength()))?++h.pqState:h.num.dAddOffset(o[b++%8],0):h.pqState===2?h.pqState=h.num.subtract(e.ONE).gcd(h.e).compareTo(e.ONE)===0?3:0:h.pqState===3&&(h.pqState=0,h.p===null?h.p=h.num:h.q=h.num,h.p!==null&&h.q!==null&&++h.state,h.num=null)}else if(h.state===1)h.p.compareTo(h.q)<0&&(h.num=h.p,h.p=h.q,h.q=h.num),++h.state;else if(h.state===2)h.p1=h.p.subtract(e.ONE),h.q1=h.q.subtract(e.ONE),h.phi=h.p1.multiply(h.q1),++h.state;else if(h.state===3)h.phi.gcd(h.e).compareTo(e.ONE)===0?++h.state:(h.p=null,h.q=null,h.state=0);else if(h.state===4)h.n=h.p.multiply(h.q),h.n.bitLength()===h.bits?++h.state:(h.q=null,h.state=0);else if(h.state===5){var te=h.e.modInverse(h.phi);h.keys={privateKey:s.rsa.setPrivateKey(h.n,h.e,te,h.p,h.q,te.mod(h.p1),te.mod(h.q1),h.q.modInverse(h.p)),publicKey:s.rsa.setPublicKey(h.n,h.e)}}P=+new Date,H+=P-R,R=P}return h.keys!==null},s.rsa.generateKeyPair=function(h,c,v,b){if(arguments.length===1?typeof h=="object"?(v=h,h=void 0):typeof h=="function"&&(b=h,h=void 0):arguments.length===2?typeof h=="number"?typeof c=="function"?(b=c,c=void 0):typeof c!="number"&&(v=c,c=void 0):(v=h,b=c,h=void 0,c=void 0):arguments.length===3&&(typeof c=="number"?typeof v=="function"&&(b=v,v=void 0):(b=v,v=c,c=void 0)),v=v||{},h===void 0&&(h=v.bits||2048),c===void 0&&(c=v.e||65537),!r.options.usePureJavaScript&&!v.prng&&h>=256&&h<=16384&&(c===65537||c===3)){if(b){if(x("generateKeyPair"))return t.generateKeyPair("rsa",{modulusLength:h,publicExponent:c,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(H,z,W){if(H)return b(H);b(null,{privateKey:s.privateKeyFromPem(W),publicKey:s.publicKeyFromPem(z)})});if(k("generateKey")&&k("exportKey"))return i.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:h,publicExponent:_(c),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(H){return i.globalScope.crypto.subtle.exportKey("pkcs8",H.privateKey)}).then(void 0,function(H){b(H)}).then(function(H){if(H){var z=s.privateKeyFromAsn1(n.fromDer(r.util.createBuffer(H)));b(null,{privateKey:z,publicKey:s.setRsaPublicKey(z.n,z.e)})}});if(U("generateKey")&&U("exportKey")){var B=i.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:h,publicExponent:_(c),hash:{name:"SHA-256"}},!0,["sign","verify"]);B.oncomplete=function(H){var z=H.target.result,W=i.globalScope.msCrypto.subtle.exportKey("pkcs8",z.privateKey);W.oncomplete=function(te){var ne=te.target.result,oe=s.privateKeyFromAsn1(n.fromDer(r.util.createBuffer(ne)));b(null,{privateKey:oe,publicKey:s.setRsaPublicKey(oe.n,oe.e)})},W.onerror=function(te){b(te)}},B.onerror=function(H){b(H)};return}}else if(x("generateKeyPairSync")){var R=t.generateKeyPairSync("rsa",{modulusLength:h,publicExponent:c,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:s.privateKeyFromPem(R.privateKey),publicKey:s.publicKeyFromPem(R.publicKey)}}}var P=s.rsa.createKeyPairGenerationState(h,c,v);if(!b)return s.rsa.stepKeyPairGenerationState(P,0),P.keys;A(P,v,b)},s.setRsaPublicKey=s.rsa.setPublicKey=function(h,c){var v={n:h,e:c};return v.encrypt=function(b,B,R){if(typeof B=="string"?B=B.toUpperCase():B===void 0&&(B="RSAES-PKCS1-V1_5"),B==="RSAES-PKCS1-V1_5")B={encode:function(H,z,W){return I(H,z,2).getBytes()}};else if(B==="RSA-OAEP"||B==="RSAES-OAEP")B={encode:function(H,z){return r.pkcs1.encode_rsa_oaep(z,H,R)}};else if(["RAW","NONE","NULL",null].indexOf(B)!==-1)B={encode:function(H){return H}};else if(typeof B=="string")throw new Error('Unsupported encryption scheme: "'+B+'".');var P=B.encode(b,v,!0);return s.rsa.encrypt(P,v,!0)},v.verify=function(b,B,R,P){typeof R=="string"?R=R.toUpperCase():R===void 0&&(R="RSASSA-PKCS1-V1_5"),P===void 0&&(P={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in P||(P._parseAllDigestBytes=!0),R==="RSASSA-PKCS1-V1_5"?R={verify:function(z,W){W=S(W,v,!0);var te=n.fromDer(W,{parseAllBytes:P._parseAllDigestBytes}),ne={},oe=[];if(!n.validate(te,w,ne,oe)){var me=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw me.errors=oe,me}var Se=n.derToOid(ne.algorithmIdentifier);if(!(Se===r.oids.md2||Se===r.oids.md5||Se===r.oids.sha1||Se===r.oids.sha224||Se===r.oids.sha256||Se===r.oids.sha384||Se===r.oids.sha512||Se===r.oids["sha512-224"]||Se===r.oids["sha512-256"])){var me=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw me.oid=Se,me}if((Se===r.oids.md2||Se===r.oids.md5)&&!("parameters"in ne))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return z===ne.digest}}:(R==="NONE"||R==="NULL"||R===null)&&(R={verify:function(z,W){return W=S(W,v,!0),z===W}});var H=s.rsa.decrypt(B,v,!0,!1);return R.verify(b,H,v.n.bitLength())},v},s.setRsaPrivateKey=s.rsa.setPrivateKey=function(h,c,v,b,B,R,P,H){var z={n:h,e:c,d:v,p:b,q:B,dP:R,dQ:P,qInv:H};return z.decrypt=function(W,te,ne){typeof te=="string"?te=te.toUpperCase():te===void 0&&(te="RSAES-PKCS1-V1_5");var oe=s.rsa.decrypt(W,z,!1,!1);if(te==="RSAES-PKCS1-V1_5")te={decode:S};else if(te==="RSA-OAEP"||te==="RSAES-OAEP")te={decode:function(me,Se){return r.pkcs1.decode_rsa_oaep(Se,me,ne)}};else if(["RAW","NONE","NULL",null].indexOf(te)!==-1)te={decode:function(me){return me}};else throw new Error('Unsupported encryption scheme: "'+te+'".');return te.decode(oe,z,!1)},z.sign=function(W,te){var ne=!1;typeof te=="string"&&(te=te.toUpperCase()),te===void 0||te==="RSASSA-PKCS1-V1_5"?(te={encode:y},ne=1):(te==="NONE"||te==="NULL"||te===null)&&(te={encode:function(){return W}},ne=1);var oe=te.encode(W,z.n.bitLength());return s.rsa.encrypt(oe,z,ne)},z},s.wrapRsaPrivateKey=function(h){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(0).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(s.oids.rsaEncryption).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,n.toDer(h).getBytes())])},s.privateKeyFromAsn1=function(h){var c={},v=[];if(n.validate(h,a,c,v)&&(h=n.fromDer(r.util.createBuffer(c.privateKey))),c={},v=[],!n.validate(h,f,c,v)){var b=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw b.errors=v,b}var B,R,P,H,z,W,te,ne;return B=r.util.createBuffer(c.privateKeyModulus).toHex(),R=r.util.createBuffer(c.privateKeyPublicExponent).toHex(),P=r.util.createBuffer(c.privateKeyPrivateExponent).toHex(),H=r.util.createBuffer(c.privateKeyPrime1).toHex(),z=r.util.createBuffer(c.privateKeyPrime2).toHex(),W=r.util.createBuffer(c.privateKeyExponent1).toHex(),te=r.util.createBuffer(c.privateKeyExponent2).toHex(),ne=r.util.createBuffer(c.privateKeyCoefficient).toHex(),s.setRsaPrivateKey(new e(B,16),new e(R,16),new e(P,16),new e(H,16),new e(z,16),new e(W,16),new e(te,16),new e(ne,16))},s.privateKeyToAsn1=s.privateKeyToRSAPrivateKey=function(h){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(0).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.n)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.e)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.d)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.p)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.q)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.dP)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.dQ)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.qInv))])},s.publicKeyFromAsn1=function(h){var c={},v=[];if(n.validate(h,g,c,v)){var b=n.derToOid(c.publicKeyOid);if(b!==s.oids.rsaEncryption){var B=new Error("Cannot read public key. Unknown OID.");throw B.oid=b,B}h=c.rsaPublicKey}if(v=[],!n.validate(h,l,c,v)){var B=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw B.errors=v,B}var R=r.util.createBuffer(c.publicKeyModulus).toHex(),P=r.util.createBuffer(c.publicKeyExponent).toHex();return s.setRsaPublicKey(new e(R,16),new e(P,16))},s.publicKeyToAsn1=s.publicKeyToSubjectPublicKeyInfo=function(h){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(s.oids.rsaEncryption).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.BITSTRING,!1,[s.publicKeyToRSAPublicKey(h)])])},s.publicKeyToRSAPublicKey=function(h){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.n)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(h.e))])};function I(h,c,v){var b=r.util.createBuffer(),B=Math.ceil(c.n.bitLength()/8);if(h.length>B-11){var R=new Error("Message is too long for PKCS#1 v1.5 padding.");throw R.length=h.length,R.max=B-11,R}b.putByte(0),b.putByte(v);var P=B-3-h.length,H;if(v===0||v===1){H=v===0?0:255;for(var z=0;z<P;++z)b.putByte(H)}else for(;P>0;){for(var W=0,te=r.random.getBytes(P),z=0;z<P;++z)H=te.charCodeAt(z),H===0?++W:b.putByte(H);P=W}return b.putByte(0),b.putBytes(h),b}function S(h,c,v,b){var B=Math.ceil(c.n.bitLength()/8),R=r.util.createBuffer(h),P=R.getByte(),H=R.getByte();if(P!==0||v&&H!==0&&H!==1||!v&&H!=2||v&&H===0&&typeof b>"u")throw new Error("Encryption block is invalid.");var z=0;if(H===0){z=B-3-b;for(var W=0;W<z;++W)if(R.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(H===1)for(z=0;R.length()>1;){if(R.getByte()!==255){--R.read;break}++z}else if(H===2)for(z=0;R.length()>1;){if(R.getByte()===0){--R.read;break}++z}var te=R.getByte();if(te!==0||z!==B-3-R.length())throw new Error("Encryption block is invalid.");return R.getBytes()}function A(h,c,v){typeof c=="function"&&(v=c,c={}),c=c||{};var b={algorithm:{name:c.algorithm||"PRIMEINC",options:{workers:c.workers||2,workLoad:c.workLoad||100,workerScript:c.workerScript}}};"prng"in c&&(b.prng=c.prng),B();function B(){R(h.pBits,function(H,z){if(H)return v(H);if(h.p=z,h.q!==null)return P(H,h.q);R(h.qBits,P)})}function R(H,z){r.prime.generateProbablePrime(H,b,z)}function P(H,z){if(H)return v(H);if(h.q=z,h.p.compareTo(h.q)<0){var W=h.p;h.p=h.q,h.q=W}if(h.p.subtract(e.ONE).gcd(h.e).compareTo(e.ONE)!==0){h.p=null,B();return}if(h.q.subtract(e.ONE).gcd(h.e).compareTo(e.ONE)!==0){h.q=null,R(h.qBits,P);return}if(h.p1=h.p.subtract(e.ONE),h.q1=h.q.subtract(e.ONE),h.phi=h.p1.multiply(h.q1),h.phi.gcd(h.e).compareTo(e.ONE)!==0){h.p=h.q=null,B();return}if(h.n=h.p.multiply(h.q),h.n.bitLength()!==h.bits){h.q=null,R(h.qBits,P);return}var te=h.e.modInverse(h.phi);h.keys={privateKey:s.rsa.setPrivateKey(h.n,h.e,te,h.p,h.q,te.mod(h.p1),te.mod(h.q1),h.q.modInverse(h.p)),publicKey:s.rsa.setPublicKey(h.n,h.e)},v(null,h.keys)}}function d(h){var c=h.toString(16);c[0]>="8"&&(c="00"+c);var v=r.util.hexToBytes(c);return v.length>1&&(v.charCodeAt(0)===0&&!(v.charCodeAt(1)&128)||v.charCodeAt(0)===255&&(v.charCodeAt(1)&128)===128)?v.substr(1):v}function T(h){return h<=100?27:h<=150?18:h<=200?15:h<=250?12:h<=300?9:h<=350?8:h<=400?7:h<=500?6:h<=600?5:h<=800?4:h<=1250?3:2}function x(h){return r.util.isNodejs&&typeof t[h]=="function"}function k(h){return typeof i.globalScope<"u"&&typeof i.globalScope.crypto=="object"&&typeof i.globalScope.crypto.subtle=="object"&&typeof i.globalScope.crypto.subtle[h]=="function"}function U(h){return typeof i.globalScope<"u"&&typeof i.globalScope.msCrypto=="object"&&typeof i.globalScope.msCrypto.subtle=="object"&&typeof i.globalScope.msCrypto.subtle[h]=="function"}function _(h){for(var c=r.util.hexToBytes(h.toString(16)),v=new Uint8Array(c.length),b=0;b<c.length;++b)v[b]=c.charCodeAt(b);return v}return yo}var vo,qh;function jp(){if(qh)return vo;qh=1;var r=Ne();if(xn(),Ir(),Sa(),qr(),wn(),pc(),ai(),pr(),Fp(),xa(),Ke(),typeof e>"u")var e=r.jsbn.BigInteger;var t=r.asn1,n=r.pki=r.pki||{};vo=n.pbe=r.pbe=r.pbe||{};var i=n.oids,s={name:"EncryptedPrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},o={name:"PBES2Algorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},a={name:"pkcs-12PbeParams",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"iterations"}]};n.encryptPrivateKeyInfo=function(y,p,I){I=I||{},I.saltSize=I.saltSize||8,I.count=I.count||2048,I.algorithm=I.algorithm||"aes128",I.prfAlgorithm=I.prfAlgorithm||"sha1";var S=r.random.getBytesSync(I.saltSize),A=I.count,d=t.integerToDer(A),T,x,k;if(I.algorithm.indexOf("aes")===0||I.algorithm==="des"){var U,_,h;switch(I.algorithm){case"aes128":T=16,U=16,_=i["aes128-CBC"],h=r.aes.createEncryptionCipher;break;case"aes192":T=24,U=16,_=i["aes192-CBC"],h=r.aes.createEncryptionCipher;break;case"aes256":T=32,U=16,_=i["aes256-CBC"],h=r.aes.createEncryptionCipher;break;case"des":T=8,U=8,_=i.desCBC,h=r.des.createEncryptionCipher;break;default:var c=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw c.algorithm=I.algorithm,c}var v="hmacWith"+I.prfAlgorithm.toUpperCase(),b=g(v),B=r.pkcs5.pbkdf2(p,S,A,T,b),R=r.random.getBytesSync(U),P=h(B);P.start(R),P.update(t.toDer(y)),P.finish(),k=P.output.getBytes();var H=w(S,d,T,v);x=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.pkcs5PBES2).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.pkcs5PBKDF2).getBytes()),H]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(_).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,R)])])])}else if(I.algorithm==="3des"){T=24;var z=new r.util.ByteBuffer(S),B=n.pbe.generatePkcs12Key(p,z,1,A,T),R=n.pbe.generatePkcs12Key(p,z,2,A,T),P=r.des.createEncryptionCipher(B);P.start(R),P.update(t.toDer(y)),P.finish(),k=P.output.getBytes(),x=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,S),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,d.getBytes())])])}else{var c=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw c.algorithm=I.algorithm,c}var W=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[x,t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,k)]);return W},n.decryptPrivateKeyInfo=function(y,p){var I=null,S={},A=[];if(!t.validate(y,s,S,A)){var d=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw d.errors=A,d}var T=t.derToOid(S.encryptionOid),x=n.pbe.getCipher(T,S.encryptionParams,p),k=r.util.createBuffer(S.encryptedData);return x.update(k),x.finish()&&(I=t.fromDer(x.output)),I},n.encryptedPrivateKeyToPem=function(y,p){var I={type:"ENCRYPTED PRIVATE KEY",body:t.toDer(y).getBytes()};return r.pem.encode(I,{maxline:p})},n.encryptedPrivateKeyFromPem=function(y){var p=r.pem.decode(y)[0];if(p.type!=="ENCRYPTED PRIVATE KEY"){var I=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw I.headerType=p.type,I}if(p.procType&&p.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return t.fromDer(p.body)},n.encryptRsaPrivateKey=function(y,p,I){if(I=I||{},!I.legacy){var S=n.wrapRsaPrivateKey(n.privateKeyToAsn1(y));return S=n.encryptPrivateKeyInfo(S,p,I),n.encryptedPrivateKeyToPem(S)}var A,d,T,x;switch(I.algorithm){case"aes128":A="AES-128-CBC",T=16,d=r.random.getBytesSync(16),x=r.aes.createEncryptionCipher;break;case"aes192":A="AES-192-CBC",T=24,d=r.random.getBytesSync(16),x=r.aes.createEncryptionCipher;break;case"aes256":A="AES-256-CBC",T=32,d=r.random.getBytesSync(16),x=r.aes.createEncryptionCipher;break;case"3des":A="DES-EDE3-CBC",T=24,d=r.random.getBytesSync(8),x=r.des.createEncryptionCipher;break;case"des":A="DES-CBC",T=8,d=r.random.getBytesSync(8),x=r.des.createEncryptionCipher;break;default:var k=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+I.algorithm+'".');throw k.algorithm=I.algorithm,k}var U=r.pbe.opensslDeriveBytes(p,d.substr(0,8),T),_=x(U);_.start(d),_.update(t.toDer(n.privateKeyToAsn1(y))),_.finish();var h={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:A,parameters:r.util.bytesToHex(d).toUpperCase()},body:_.output.getBytes()};return r.pem.encode(h)},n.decryptRsaPrivateKey=function(y,p){var I=null,S=r.pem.decode(y)[0];if(S.type!=="ENCRYPTED PRIVATE KEY"&&S.type!=="PRIVATE KEY"&&S.type!=="RSA PRIVATE KEY"){var A=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw A.headerType=A,A}if(S.procType&&S.procType.type==="ENCRYPTED"){var d,T;switch(S.dekInfo.algorithm){case"DES-CBC":d=8,T=r.des.createDecryptionCipher;break;case"DES-EDE3-CBC":d=24,T=r.des.createDecryptionCipher;break;case"AES-128-CBC":d=16,T=r.aes.createDecryptionCipher;break;case"AES-192-CBC":d=24,T=r.aes.createDecryptionCipher;break;case"AES-256-CBC":d=32,T=r.aes.createDecryptionCipher;break;case"RC2-40-CBC":d=5,T=function(h){return r.rc2.createDecryptionCipher(h,40)};break;case"RC2-64-CBC":d=8,T=function(h){return r.rc2.createDecryptionCipher(h,64)};break;case"RC2-128-CBC":d=16,T=function(h){return r.rc2.createDecryptionCipher(h,128)};break;default:var A=new Error('Could not decrypt private key; unsupported encryption algorithm "'+S.dekInfo.algorithm+'".');throw A.algorithm=S.dekInfo.algorithm,A}var x=r.util.hexToBytes(S.dekInfo.parameters),k=r.pbe.opensslDeriveBytes(p,x.substr(0,8),d),U=T(k);if(U.start(x),U.update(r.util.createBuffer(S.body)),U.finish())I=U.output.getBytes();else return I}else I=S.body;return S.type==="ENCRYPTED PRIVATE KEY"?I=n.decryptPrivateKeyInfo(t.fromDer(I),p):I=t.fromDer(I),I!==null&&(I=n.privateKeyFromAsn1(I)),I},n.pbe.generatePkcs12Key=function(y,p,I,S,A,d){var T,x;if(typeof d>"u"||d===null){if(!("sha1"in r.md))throw new Error('"sha1" hash algorithm unavailable.');d=r.md.sha1.create()}var k=d.digestLength,U=d.blockLength,_=new r.util.ByteBuffer,h=new r.util.ByteBuffer;if(y!=null){for(x=0;x<y.length;x++)h.putInt16(y.charCodeAt(x));h.putInt16(0)}var c=h.length(),v=p.length(),b=new r.util.ByteBuffer;b.fillWithByte(I,U);var B=U*Math.ceil(v/U),R=new r.util.ByteBuffer;for(x=0;x<B;x++)R.putByte(p.at(x%v));var P=U*Math.ceil(c/U),H=new r.util.ByteBuffer;for(x=0;x<P;x++)H.putByte(h.at(x%c));var z=R;z.putBuffer(H);for(var W=Math.ceil(A/k),te=1;te<=W;te++){var ne=new r.util.ByteBuffer;ne.putBytes(b.bytes()),ne.putBytes(z.bytes());for(var oe=0;oe<S;oe++)d.start(),d.update(ne.getBytes()),ne=d.digest();var me=new r.util.ByteBuffer;for(x=0;x<U;x++)me.putByte(ne.at(x%k));var Se=Math.ceil(v/U)+Math.ceil(c/U),xe=new r.util.ByteBuffer;for(T=0;T<Se;T++){var we=new r.util.ByteBuffer(z.getBytes(U)),ie=511;for(x=me.length()-1;x>=0;x--)ie=ie>>8,ie+=me.at(x)+we.at(x),we.setAt(x,ie&255);xe.putBuffer(we)}z=xe,_.putBuffer(ne)}return _.truncate(_.length()-A),_},n.pbe.getCipher=function(y,p,I){switch(y){case n.oids.pkcs5PBES2:return n.pbe.getCipherForPBES2(y,p,I);case n.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case n.oids["pbewithSHAAnd40BitRC2-CBC"]:return n.pbe.getCipherForPKCS12PBE(y,p,I);default:var S=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw S.oid=y,S.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],S}},n.pbe.getCipherForPBES2=function(y,p,I){var S={},A=[];if(!t.validate(p,o,S,A)){var d=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw d.errors=A,d}if(y=t.derToOid(S.kdfOid),y!==n.oids.pkcs5PBKDF2){var d=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw d.oid=y,d.supportedOids=["pkcs5PBKDF2"],d}if(y=t.derToOid(S.encOid),y!==n.oids["aes128-CBC"]&&y!==n.oids["aes192-CBC"]&&y!==n.oids["aes256-CBC"]&&y!==n.oids["des-EDE3-CBC"]&&y!==n.oids.desCBC){var d=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw d.oid=y,d.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],d}var T=S.kdfSalt,x=r.util.createBuffer(S.kdfIterationCount);x=x.getInt(x.length()<<3);var k,U;switch(n.oids[y]){case"aes128-CBC":k=16,U=r.aes.createDecryptionCipher;break;case"aes192-CBC":k=24,U=r.aes.createDecryptionCipher;break;case"aes256-CBC":k=32,U=r.aes.createDecryptionCipher;break;case"des-EDE3-CBC":k=24,U=r.des.createDecryptionCipher;break;case"desCBC":k=8,U=r.des.createDecryptionCipher;break}var _=l(S.prfOid),h=r.pkcs5.pbkdf2(I,T,x,k,_),c=S.encIv,v=U(h);return v.start(c),v},n.pbe.getCipherForPKCS12PBE=function(y,p,I){var S={},A=[];if(!t.validate(p,a,S,A)){var d=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw d.errors=A,d}var T=r.util.createBuffer(S.salt),x=r.util.createBuffer(S.iterations);x=x.getInt(x.length()<<3);var k,U,_;switch(y){case n.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:k=24,U=8,_=r.des.startDecrypting;break;case n.oids["pbewithSHAAnd40BitRC2-CBC"]:k=5,U=8,_=function(B,R){var P=r.rc2.createDecryptionCipher(B,40);return P.start(R,null),P};break;default:var d=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw d.oid=y,d}var h=l(S.prfOid),c=n.pbe.generatePkcs12Key(I,T,1,x,k,h);h.start();var v=n.pbe.generatePkcs12Key(I,T,2,x,U,h);return _(c,v)},n.pbe.opensslDeriveBytes=function(y,p,I,S){if(typeof S>"u"||S===null){if(!("md5"in r.md))throw new Error('"md5" hash algorithm unavailable.');S=r.md.md5.create()}p===null&&(p="");for(var A=[f(S,y+p)],d=16,T=1;d<I;++T,d+=16)A.push(f(S,A[T-1]+y+p));return A.join("").substr(0,I)};function f(y,p){return y.start().update(p).digest().getBytes()}function l(y){var p;if(!y)p="hmacWithSHA1";else if(p=n.oids[t.derToOid(y)],!p){var I=new Error("Unsupported PRF OID.");throw I.oid=y,I.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],I}return g(p)}function g(y){var p=r.md;switch(y){case"hmacWithSHA224":p=r.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":y=y.substr(8).toLowerCase();break;default:var I=new Error("Unsupported PRF algorithm.");throw I.algorithm=y,I.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],I}if(!p||!(y in p))throw new Error("Unknown hash algorithm: "+y);return p[y].create()}function w(y,p,I,S){var A=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,y),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,p.getBytes())]);return S!=="hmacWithSHA1"&&A.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,r.util.hexToBytes(I.toString(16))),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids[S]).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])),A}return vo}var _o={exports:{}},Eo={exports:{}},jh;function Hp(){if(jh)return Eo.exports;jh=1;var r=Ne();Ir(),Ke();var e=r.asn1,t=Eo.exports=r.pkcs7asn1=r.pkcs7asn1||{};r.pkcs7=r.pkcs7||{},r.pkcs7.asn1=t;var n={name:"ContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};t.contentInfoValidator=n;var i={name:"EncryptedContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};t.envelopedDataValidator={name:"EnvelopedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},t.encryptedDataValidator={name:"EncryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var s={name:"SignerInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};return t.signedDataValidator={name:"SignedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},t.recipientInfoValidator={name:"RecipientInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]},Eo.exports}var To={exports:{}},Co={exports:{}},Hh;function Gp(){if(Hh)return Co.exports;Hh=1;var r=Ne();Ke(),r.mgf=r.mgf||{};var e=Co.exports=r.mgf.mgf1=r.mgf1=r.mgf1||{};return e.create=function(t){var n={generate:function(i,s){for(var o=new r.util.ByteBuffer,a=Math.ceil(s/t.digestLength),f=0;f<a;f++){var l=new r.util.ByteBuffer;l.putInt32(f),t.start(),t.update(i+l.getBytes()),o.putBuffer(t.digest())}return o.truncate(o.length()-s),o.getBytes()}};return n},Co.exports}var Io,Gh;function A1(){if(Gh)return Io;Gh=1;var r=Ne();return Gp(),Io=r.mgf=r.mgf||{},r.mgf.mgf1=r.mgf1,Io}var So={exports:{}},zh;function gc(){if(zh)return So.exports;zh=1;var r=Ne();pr(),Ke();var e=So.exports=r.pss=r.pss||{};return e.create=function(t){arguments.length===3&&(t={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var n=t.md,i=t.mgf,s=n.digestLength,o=t.salt||null;typeof o=="string"&&(o=r.util.createBuffer(o));var a;if("saltLength"in t)a=t.saltLength;else if(o!==null)a=o.length();else throw new Error("Salt length not specified or specific salt not given.");if(o!==null&&o.length()!==a)throw new Error("Given salt length does not match length of given salt.");var f=t.prng||r.random,l={};return l.encode=function(g,w){var y,p=w-1,I=Math.ceil(p/8),S=g.digest().getBytes();if(I<s+a+2)throw new Error("Message is too long to encrypt.");var A;o===null?A=f.getBytesSync(a):A=o.bytes();var d=new r.util.ByteBuffer;d.fillWithByte(0,8),d.putBytes(S),d.putBytes(A),n.start(),n.update(d.getBytes());var T=n.digest().getBytes(),x=new r.util.ByteBuffer;x.fillWithByte(0,I-a-s-2),x.putByte(1),x.putBytes(A);var k=x.getBytes(),U=I-s-1,_=i.generate(T,U),h="";for(y=0;y<U;y++)h+=String.fromCharCode(k.charCodeAt(y)^_.charCodeAt(y));var c=65280>>8*I-p&255;return h=String.fromCharCode(h.charCodeAt(0)&~c)+h.substr(1),h+T+""},l.verify=function(g,w,y){var p,I=y-1,S=Math.ceil(I/8);if(w=w.substr(-S),S<s+a+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(w.charCodeAt(S-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var A=S-s-1,d=w.substr(0,A),T=w.substr(A,s),x=65280>>8*S-I&255;if(d.charCodeAt(0)&x)throw new Error("Bits beyond keysize not zero as expected.");var k=i.generate(T,A),U="";for(p=0;p<A;p++)U+=String.fromCharCode(d.charCodeAt(p)^k.charCodeAt(p));U=String.fromCharCode(U.charCodeAt(0)&~x)+U.substr(1);var _=S-s-a-2;for(p=0;p<_;p++)if(U.charCodeAt(p)!==0)throw new Error("Leftmost octets not zero as expected");if(U.charCodeAt(_)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var h=U.substr(-a),c=new r.util.ByteBuffer;c.fillWithByte(0,8),c.putBytes(g),c.putBytes(h),n.start(),n.update(c.getBytes());var v=n.digest().getBytes();return T===v},l},So.exports}var $h;function mc(){if($h)return To.exports;$h=1;var r=Ne();xn(),Ir(),Sa(),qr(),A1(),wn(),ai(),gc(),xa(),Ke();var e=r.asn1,t=To.exports=r.pki=r.pki||{},n=t.oids,i={};i.CN=n.commonName,i.commonName="CN",i.C=n.countryName,i.countryName="C",i.L=n.localityName,i.localityName="L",i.ST=n.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=n.organizationName,i.organizationName="O",i.OU=n.organizationalUnitName,i.organizationalUnitName="OU",i.E=n.emailAddress,i.emailAddress="E";var s=r.pki.rsa.publicKeyValidator,o={name:"Certificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},a={name:"rsapss",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},f={name:"CertificationRequestInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0}]}]}]},l={name:"CertificationRequest",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[f,{name:"CertificationRequest.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};t.RDNAttributesAsArray=function(_,h){for(var c=[],v,b,B,R=0;R<_.value.length;++R){v=_.value[R];for(var P=0;P<v.value.length;++P)B={},b=v.value[P],B.type=e.derToOid(b.value[0].value),B.value=b.value[1].value,B.valueTagClass=b.value[1].type,B.type in n&&(B.name=n[B.type],B.name in i&&(B.shortName=i[B.name])),h&&(h.update(B.type),h.update(B.value)),c.push(B)}return c},t.CRIAttributesAsArray=function(_){for(var h=[],c=0;c<_.length;++c)for(var v=_[c],b=e.derToOid(v.value[0].value),B=v.value[1].value,R=0;R<B.length;++R){var P={};if(P.type=b,P.value=B[R].value,P.valueTagClass=B[R].type,P.type in n&&(P.name=n[P.type],P.name in i&&(P.shortName=i[P.name])),P.type===n.extensionRequest){P.extensions=[];for(var H=0;H<P.value.length;++H)P.extensions.push(t.certificateExtensionFromAsn1(P.value[H]))}h.push(P)}return h};function g(_,h){typeof h=="string"&&(h={shortName:h});for(var c=null,v,b=0;c===null&&b<_.attributes.length;++b)v=_.attributes[b],(h.type&&h.type===v.type||h.name&&h.name===v.name||h.shortName&&h.shortName===v.shortName)&&(c=v);return c}var w=function(_,h,c){var v={};if(_!==n["RSASSA-PSS"])return v;c&&(v={hash:{algorithmOid:n.sha1},mgf:{algorithmOid:n.mgf1,hash:{algorithmOid:n.sha1}},saltLength:20});var b={},B=[];if(!e.validate(h,a,b,B)){var R=new Error("Cannot read RSASSA-PSS parameter block.");throw R.errors=B,R}return b.hashOid!==void 0&&(v.hash=v.hash||{},v.hash.algorithmOid=e.derToOid(b.hashOid)),b.maskGenOid!==void 0&&(v.mgf=v.mgf||{},v.mgf.algorithmOid=e.derToOid(b.maskGenOid),v.mgf.hash=v.mgf.hash||{},v.mgf.hash.algorithmOid=e.derToOid(b.maskGenHashOid)),b.saltLength!==void 0&&(v.saltLength=b.saltLength.charCodeAt(0)),v},y=function(_){switch(n[_.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return r.md.sha1.create();case"md5WithRSAEncryption":return r.md.md5.create();case"sha256WithRSAEncryption":return r.md.sha256.create();case"sha384WithRSAEncryption":return r.md.sha384.create();case"sha512WithRSAEncryption":return r.md.sha512.create();case"RSASSA-PSS":return r.md.sha256.create();default:var h=new Error("Could not compute "+_.type+" digest. Unknown signature OID.");throw h.signatureOid=_.signatureOid,h}},p=function(_){var h=_.certificate,c;switch(h.signatureOid){case n.sha1WithRSAEncryption:case n.sha1WithRSASignature:break;case n["RSASSA-PSS"]:var v,b;if(v=n[h.signatureParameters.mgf.hash.algorithmOid],v===void 0||r.md[v]===void 0){var B=new Error("Unsupported MGF hash function.");throw B.oid=h.signatureParameters.mgf.hash.algorithmOid,B.name=v,B}if(b=n[h.signatureParameters.mgf.algorithmOid],b===void 0||r.mgf[b]===void 0){var B=new Error("Unsupported MGF function.");throw B.oid=h.signatureParameters.mgf.algorithmOid,B.name=b,B}if(b=r.mgf[b].create(r.md[v].create()),v=n[h.signatureParameters.hash.algorithmOid],v===void 0||r.md[v]===void 0){var B=new Error("Unsupported RSASSA-PSS hash function.");throw B.oid=h.signatureParameters.hash.algorithmOid,B.name=v,B}c=r.pss.create(r.md[v].create(),b,h.signatureParameters.saltLength);break}return h.publicKey.verify(_.md.digest().getBytes(),_.signature,c)};t.certificateFromPem=function(_,h,c){var v=r.pem.decode(_)[0];if(v.type!=="CERTIFICATE"&&v.type!=="X509 CERTIFICATE"&&v.type!=="TRUSTED CERTIFICATE"){var b=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw b.headerType=v.type,b}if(v.procType&&v.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var B=e.fromDer(v.body,c);return t.certificateFromAsn1(B,h)},t.certificateToPem=function(_,h){var c={type:"CERTIFICATE",body:e.toDer(t.certificateToAsn1(_)).getBytes()};return r.pem.encode(c,{maxline:h})},t.publicKeyFromPem=function(_){var h=r.pem.decode(_)[0];if(h.type!=="PUBLIC KEY"&&h.type!=="RSA PUBLIC KEY"){var c=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw c.headerType=h.type,c}if(h.procType&&h.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var v=e.fromDer(h.body);return t.publicKeyFromAsn1(v)},t.publicKeyToPem=function(_,h){var c={type:"PUBLIC KEY",body:e.toDer(t.publicKeyToAsn1(_)).getBytes()};return r.pem.encode(c,{maxline:h})},t.publicKeyToRSAPublicKeyPem=function(_,h){var c={type:"RSA PUBLIC KEY",body:e.toDer(t.publicKeyToRSAPublicKey(_)).getBytes()};return r.pem.encode(c,{maxline:h})},t.getPublicKeyFingerprint=function(_,h){h=h||{};var c=h.md||r.md.sha1.create(),v=h.type||"RSAPublicKey",b;switch(v){case"RSAPublicKey":b=e.toDer(t.publicKeyToRSAPublicKey(_)).getBytes();break;case"SubjectPublicKeyInfo":b=e.toDer(t.publicKeyToAsn1(_)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+h.type+'".')}c.start(),c.update(b);var B=c.digest();if(h.encoding==="hex"){var R=B.toHex();return h.delimiter?R.match(/.{2}/g).join(h.delimiter):R}else{if(h.encoding==="binary")return B.getBytes();if(h.encoding)throw new Error('Unknown encoding "'+h.encoding+'".')}return B},t.certificationRequestFromPem=function(_,h,c){var v=r.pem.decode(_)[0];if(v.type!=="CERTIFICATE REQUEST"){var b=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw b.headerType=v.type,b}if(v.procType&&v.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var B=e.fromDer(v.body,c);return t.certificationRequestFromAsn1(B,h)},t.certificationRequestToPem=function(_,h){var c={type:"CERTIFICATE REQUEST",body:e.toDer(t.certificationRequestToAsn1(_)).getBytes()};return r.pem.encode(c,{maxline:h})},t.createCertificate=function(){var _={};return _.version=2,_.serialNumber="00",_.signatureOid=null,_.signature=null,_.siginfo={},_.siginfo.algorithmOid=null,_.validity={},_.validity.notBefore=new Date,_.validity.notAfter=new Date,_.issuer={},_.issuer.getField=function(h){return g(_.issuer,h)},_.issuer.addField=function(h){S([h]),_.issuer.attributes.push(h)},_.issuer.attributes=[],_.issuer.hash=null,_.subject={},_.subject.getField=function(h){return g(_.subject,h)},_.subject.addField=function(h){S([h]),_.subject.attributes.push(h)},_.subject.attributes=[],_.subject.hash=null,_.extensions=[],_.publicKey=null,_.md=null,_.setSubject=function(h,c){S(h),_.subject.attributes=h,delete _.subject.uniqueId,c&&(_.subject.uniqueId=c),_.subject.hash=null},_.setIssuer=function(h,c){S(h),_.issuer.attributes=h,delete _.issuer.uniqueId,c&&(_.issuer.uniqueId=c),_.issuer.hash=null},_.setExtensions=function(h){for(var c=0;c<h.length;++c)A(h[c],{cert:_});_.extensions=h},_.getExtension=function(h){typeof h=="string"&&(h={name:h});for(var c=null,v,b=0;c===null&&b<_.extensions.length;++b)v=_.extensions[b],(h.id&&v.id===h.id||h.name&&v.name===h.name)&&(c=v);return c},_.sign=function(h,c){_.md=c||r.md.sha1.create();var v=n[_.md.algorithm+"WithRSAEncryption"];if(!v){var b=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw b.algorithm=_.md.algorithm,b}_.signatureOid=_.siginfo.algorithmOid=v,_.tbsCertificate=t.getTBSCertificate(_);var B=e.toDer(_.tbsCertificate);_.md.update(B.getBytes()),_.signature=h.sign(_.md)},_.verify=function(h){var c=!1;if(!_.issued(h)){var v=h.issuer,b=_.subject,B=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw B.expectedIssuer=b.attributes,B.actualIssuer=v.attributes,B}var R=h.md;if(R===null){R=y({signatureOid:h.signatureOid,type:"certificate"});var P=h.tbsCertificate||t.getTBSCertificate(h),H=e.toDer(P);R.update(H.getBytes())}return R!==null&&(c=p({certificate:_,md:R,signature:h.signature})),c},_.isIssuer=function(h){var c=!1,v=_.issuer,b=h.subject;if(v.hash&&b.hash)c=v.hash===b.hash;else if(v.attributes.length===b.attributes.length){c=!0;for(var B,R,P=0;c&&P<v.attributes.length;++P)B=v.attributes[P],R=b.attributes[P],(B.type!==R.type||B.value!==R.value)&&(c=!1)}return c},_.issued=function(h){return h.isIssuer(_)},_.generateSubjectKeyIdentifier=function(){return t.getPublicKeyFingerprint(_.publicKey,{type:"RSAPublicKey"})},_.verifySubjectKeyIdentifier=function(){for(var h=n.subjectKeyIdentifier,c=0;c<_.extensions.length;++c){var v=_.extensions[c];if(v.id===h){var b=_.generateSubjectKeyIdentifier().getBytes();return r.util.hexToBytes(v.subjectKeyIdentifier)===b}}return!1},_},t.certificateFromAsn1=function(_,h){var c={},v=[];if(!e.validate(_,o,c,v)){var b=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw b.errors=v,b}var B=e.derToOid(c.publicKeyOid);if(B!==t.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var R=t.createCertificate();R.version=c.certVersion?c.certVersion.charCodeAt(0):0;var P=r.util.createBuffer(c.certSerialNumber);R.serialNumber=P.toHex(),R.signatureOid=r.asn1.derToOid(c.certSignatureOid),R.signatureParameters=w(R.signatureOid,c.certSignatureParams,!0),R.siginfo.algorithmOid=r.asn1.derToOid(c.certinfoSignatureOid),R.siginfo.parameters=w(R.siginfo.algorithmOid,c.certinfoSignatureParams,!1),R.signature=c.certSignature;var H=[];if(c.certValidity1UTCTime!==void 0&&H.push(e.utcTimeToDate(c.certValidity1UTCTime)),c.certValidity2GeneralizedTime!==void 0&&H.push(e.generalizedTimeToDate(c.certValidity2GeneralizedTime)),c.certValidity3UTCTime!==void 0&&H.push(e.utcTimeToDate(c.certValidity3UTCTime)),c.certValidity4GeneralizedTime!==void 0&&H.push(e.generalizedTimeToDate(c.certValidity4GeneralizedTime)),H.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(H.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(R.validity.notBefore=H[0],R.validity.notAfter=H[1],R.tbsCertificate=c.tbsCertificate,h){R.md=y({signatureOid:R.signatureOid,type:"certificate"});var z=e.toDer(R.tbsCertificate);R.md.update(z.getBytes())}var W=r.md.sha1.create(),te=e.toDer(c.certIssuer);W.update(te.getBytes()),R.issuer.getField=function(me){return g(R.issuer,me)},R.issuer.addField=function(me){S([me]),R.issuer.attributes.push(me)},R.issuer.attributes=t.RDNAttributesAsArray(c.certIssuer),c.certIssuerUniqueId&&(R.issuer.uniqueId=c.certIssuerUniqueId),R.issuer.hash=W.digest().toHex();var ne=r.md.sha1.create(),oe=e.toDer(c.certSubject);return ne.update(oe.getBytes()),R.subject.getField=function(me){return g(R.subject,me)},R.subject.addField=function(me){S([me]),R.subject.attributes.push(me)},R.subject.attributes=t.RDNAttributesAsArray(c.certSubject),c.certSubjectUniqueId&&(R.subject.uniqueId=c.certSubjectUniqueId),R.subject.hash=ne.digest().toHex(),c.certExtensions?R.extensions=t.certificateExtensionsFromAsn1(c.certExtensions):R.extensions=[],R.publicKey=t.publicKeyFromAsn1(c.subjectPublicKeyInfo),R},t.certificateExtensionsFromAsn1=function(_){for(var h=[],c=0;c<_.value.length;++c)for(var v=_.value[c],b=0;b<v.value.length;++b)h.push(t.certificateExtensionFromAsn1(v.value[b]));return h},t.certificateExtensionFromAsn1=function(_){var h={};if(h.id=e.derToOid(_.value[0].value),h.critical=!1,_.value[1].type===e.Type.BOOLEAN?(h.critical=_.value[1].value.charCodeAt(0)!==0,h.value=_.value[2].value):h.value=_.value[1].value,h.id in n){if(h.name=n[h.id],h.name==="keyUsage"){var c=e.fromDer(h.value),v=0,b=0;c.value.length>1&&(v=c.value.charCodeAt(1),b=c.value.length>2?c.value.charCodeAt(2):0),h.digitalSignature=(v&128)===128,h.nonRepudiation=(v&64)===64,h.keyEncipherment=(v&32)===32,h.dataEncipherment=(v&16)===16,h.keyAgreement=(v&8)===8,h.keyCertSign=(v&4)===4,h.cRLSign=(v&2)===2,h.encipherOnly=(v&1)===1,h.decipherOnly=(b&128)===128}else if(h.name==="basicConstraints"){var c=e.fromDer(h.value);c.value.length>0&&c.value[0].type===e.Type.BOOLEAN?h.cA=c.value[0].value.charCodeAt(0)!==0:h.cA=!1;var B=null;c.value.length>0&&c.value[0].type===e.Type.INTEGER?B=c.value[0].value:c.value.length>1&&(B=c.value[1].value),B!==null&&(h.pathLenConstraint=e.derToInteger(B))}else if(h.name==="extKeyUsage")for(var c=e.fromDer(h.value),R=0;R<c.value.length;++R){var P=e.derToOid(c.value[R].value);P in n?h[n[P]]=!0:h[P]=!0}else if(h.name==="nsCertType"){var c=e.fromDer(h.value),v=0;c.value.length>1&&(v=c.value.charCodeAt(1)),h.client=(v&128)===128,h.server=(v&64)===64,h.email=(v&32)===32,h.objsign=(v&16)===16,h.reserved=(v&8)===8,h.sslCA=(v&4)===4,h.emailCA=(v&2)===2,h.objCA=(v&1)===1}else if(h.name==="subjectAltName"||h.name==="issuerAltName"){h.altNames=[];for(var H,c=e.fromDer(h.value),z=0;z<c.value.length;++z){H=c.value[z];var W={type:H.type,value:H.value};switch(h.altNames.push(W),H.type){case 1:case 2:case 6:break;case 7:W.ip=r.util.bytesToIP(H.value);break;case 8:W.oid=e.derToOid(H.value);break}}}else if(h.name==="subjectKeyIdentifier"){var c=e.fromDer(h.value);h.subjectKeyIdentifier=r.util.bytesToHex(c.value)}}return h},t.certificationRequestFromAsn1=function(_,h){var c={},v=[];if(!e.validate(_,l,c,v)){var b=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw b.errors=v,b}var B=e.derToOid(c.publicKeyOid);if(B!==t.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var R=t.createCertificationRequest();if(R.version=c.csrVersion?c.csrVersion.charCodeAt(0):0,R.signatureOid=r.asn1.derToOid(c.csrSignatureOid),R.signatureParameters=w(R.signatureOid,c.csrSignatureParams,!0),R.siginfo.algorithmOid=r.asn1.derToOid(c.csrSignatureOid),R.siginfo.parameters=w(R.siginfo.algorithmOid,c.csrSignatureParams,!1),R.signature=c.csrSignature,R.certificationRequestInfo=c.certificationRequestInfo,h){R.md=y({signatureOid:R.signatureOid,type:"certification request"});var P=e.toDer(R.certificationRequestInfo);R.md.update(P.getBytes())}var H=r.md.sha1.create();return R.subject.getField=function(z){return g(R.subject,z)},R.subject.addField=function(z){S([z]),R.subject.attributes.push(z)},R.subject.attributes=t.RDNAttributesAsArray(c.certificationRequestInfoSubject,H),R.subject.hash=H.digest().toHex(),R.publicKey=t.publicKeyFromAsn1(c.subjectPublicKeyInfo),R.getAttribute=function(z){return g(R,z)},R.addAttribute=function(z){S([z]),R.attributes.push(z)},R.attributes=t.CRIAttributesAsArray(c.certificationRequestInfoAttributes||[]),R},t.createCertificationRequest=function(){var _={};return _.version=0,_.signatureOid=null,_.signature=null,_.siginfo={},_.siginfo.algorithmOid=null,_.subject={},_.subject.getField=function(h){return g(_.subject,h)},_.subject.addField=function(h){S([h]),_.subject.attributes.push(h)},_.subject.attributes=[],_.subject.hash=null,_.publicKey=null,_.attributes=[],_.getAttribute=function(h){return g(_,h)},_.addAttribute=function(h){S([h]),_.attributes.push(h)},_.md=null,_.setSubject=function(h){S(h),_.subject.attributes=h,_.subject.hash=null},_.setAttributes=function(h){S(h),_.attributes=h},_.sign=function(h,c){_.md=c||r.md.sha1.create();var v=n[_.md.algorithm+"WithRSAEncryption"];if(!v){var b=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw b.algorithm=_.md.algorithm,b}_.signatureOid=_.siginfo.algorithmOid=v,_.certificationRequestInfo=t.getCertificationRequestInfo(_);var B=e.toDer(_.certificationRequestInfo);_.md.update(B.getBytes()),_.signature=h.sign(_.md)},_.verify=function(){var h=!1,c=_.md;if(c===null){c=y({signatureOid:_.signatureOid,type:"certification request"});var v=_.certificationRequestInfo||t.getCertificationRequestInfo(_),b=e.toDer(v);c.update(b.getBytes())}return c!==null&&(h=p({certificate:_,md:c,signature:_.signature})),h},_};function I(_){for(var h=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),c,v,b=_.attributes,B=0;B<b.length;++B){c=b[B];var R=c.value,P=e.Type.PRINTABLESTRING;"valueTagClass"in c&&(P=c.valueTagClass,P===e.Type.UTF8&&(R=r.util.encodeUtf8(R))),v=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(c.type).getBytes()),e.create(e.Class.UNIVERSAL,P,!1,R)])]),h.value.push(v)}return h}function S(_){for(var h,c=0;c<_.length;++c){if(h=_[c],typeof h.name>"u"&&(h.type&&h.type in t.oids?h.name=t.oids[h.type]:h.shortName&&h.shortName in i&&(h.name=t.oids[i[h.shortName]])),typeof h.type>"u")if(h.name&&h.name in t.oids)h.type=t.oids[h.name];else{var v=new Error("Attribute type not specified.");throw v.attribute=h,v}if(typeof h.shortName>"u"&&h.name&&h.name in i&&(h.shortName=i[h.name]),h.type===n.extensionRequest&&(h.valueConstructed=!0,h.valueTagClass=e.Type.SEQUENCE,!h.value&&h.extensions)){h.value=[];for(var b=0;b<h.extensions.length;++b)h.value.push(t.certificateExtensionToAsn1(A(h.extensions[b])))}if(typeof h.value>"u"){var v=new Error("Attribute value not specified.");throw v.attribute=h,v}}}function A(_,h){if(h=h||{},typeof _.name>"u"&&_.id&&_.id in t.oids&&(_.name=t.oids[_.id]),typeof _.id>"u")if(_.name&&_.name in t.oids)_.id=t.oids[_.name];else{var c=new Error("Extension ID not specified.");throw c.extension=_,c}if(typeof _.value<"u")return _;if(_.name==="keyUsage"){var v=0,b=0,B=0;_.digitalSignature&&(b|=128,v=7),_.nonRepudiation&&(b|=64,v=6),_.keyEncipherment&&(b|=32,v=5),_.dataEncipherment&&(b|=16,v=4),_.keyAgreement&&(b|=8,v=3),_.keyCertSign&&(b|=4,v=2),_.cRLSign&&(b|=2,v=1),_.encipherOnly&&(b|=1,v=0),_.decipherOnly&&(B|=128,v=7);var R=String.fromCharCode(v);B!==0?R+=String.fromCharCode(b)+String.fromCharCode(B):b!==0&&(R+=String.fromCharCode(b)),_.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,R)}else if(_.name==="basicConstraints")_.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),_.cA&&_.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,"")),"pathLenConstraint"in _&&_.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(_.pathLenConstraint).getBytes()));else if(_.name==="extKeyUsage"){_.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var P=_.value.value;for(var H in _)_[H]===!0&&(H in n?P.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n[H]).getBytes())):H.indexOf(".")!==-1&&P.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(H).getBytes())))}else if(_.name==="nsCertType"){var v=0,b=0;_.client&&(b|=128,v=7),_.server&&(b|=64,v=6),_.email&&(b|=32,v=5),_.objsign&&(b|=16,v=4),_.reserved&&(b|=8,v=3),_.sslCA&&(b|=4,v=2),_.emailCA&&(b|=2,v=1),_.objCA&&(b|=1,v=0);var R=String.fromCharCode(v);b!==0&&(R+=String.fromCharCode(b)),_.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,R)}else if(_.name==="subjectAltName"||_.name==="issuerAltName"){_.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var z,W=0;W<_.altNames.length;++W){z=_.altNames[W];var R=z.value;if(z.type===7&&z.ip){if(R=r.util.bytesFromIP(z.ip),R===null){var c=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw c.extension=_,c}}else z.type===8&&(z.oid?R=e.oidToDer(e.oidToDer(z.oid)):R=e.oidToDer(R));_.value.value.push(e.create(e.Class.CONTEXT_SPECIFIC,z.type,!1,R))}}else if(_.name==="nsComment"&&h.cert){if(!/^[\x00-\x7F]*$/.test(_.comment)||_.comment.length<1||_.comment.length>128)throw new Error('Invalid "nsComment" content.');_.value=e.create(e.Class.UNIVERSAL,e.Type.IA5STRING,!1,_.comment)}else if(_.name==="subjectKeyIdentifier"&&h.cert){var te=h.cert.generateSubjectKeyIdentifier();_.subjectKeyIdentifier=te.toHex(),_.value=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,te.getBytes())}else if(_.name==="authorityKeyIdentifier"&&h.cert){_.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var P=_.value.value;if(_.keyIdentifier){var ne=_.keyIdentifier===!0?h.cert.generateSubjectKeyIdentifier().getBytes():_.keyIdentifier;P.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!1,ne))}if(_.authorityCertIssuer){var oe=[e.create(e.Class.CONTEXT_SPECIFIC,4,!0,[I(_.authorityCertIssuer===!0?h.cert.issuer:_.authorityCertIssuer)])];P.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,oe))}if(_.serialNumber){var me=r.util.hexToBytes(_.serialNumber===!0?h.cert.serialNumber:_.serialNumber);P.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!1,me))}}else if(_.name==="cRLDistributionPoints"){_.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var P=_.value.value,Se=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),xe=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]),z,W=0;W<_.altNames.length;++W){z=_.altNames[W];var R=z.value;if(z.type===7&&z.ip){if(R=r.util.bytesFromIP(z.ip),R===null){var c=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw c.extension=_,c}}else z.type===8&&(z.oid?R=e.oidToDer(e.oidToDer(z.oid)):R=e.oidToDer(R));xe.value.push(e.create(e.Class.CONTEXT_SPECIFIC,z.type,!1,R))}Se.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[xe])),P.push(Se)}if(typeof _.value>"u"){var c=new Error("Extension value not specified.");throw c.extension=_,c}return _}function d(_,h){switch(_){case n["RSASSA-PSS"]:var c=[];return h.hash.algorithmOid!==void 0&&c.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])),h.mgf.algorithmOid!==void 0&&c.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.mgf.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.mgf.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])])),h.saltLength!==void 0&&c.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(h.saltLength).getBytes())])),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,c);default:return e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")}}function T(_){var h=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);if(_.attributes.length===0)return h;for(var c=_.attributes,v=0;v<c.length;++v){var b=c[v],B=b.value,R=e.Type.UTF8;"valueTagClass"in b&&(R=b.valueTagClass),R===e.Type.UTF8&&(B=r.util.encodeUtf8(B));var P=!1;"valueConstructed"in b&&(P=b.valueConstructed);var H=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(b.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,R,P,B)])]);h.value.push(H)}return h}var x=new Date("1950-01-01T00:00:00Z"),k=new Date("2050-01-01T00:00:00Z");function U(_){return _>=x&&_<k?e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(_)):e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(_))}return t.getTBSCertificate=function(_){var h=U(_.validity.notBefore),c=U(_.validity.notAfter),v=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(_.version).getBytes())]),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,r.util.hexToBytes(_.serialNumber)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.siginfo.algorithmOid).getBytes()),d(_.siginfo.algorithmOid,_.siginfo.parameters)]),I(_.issuer),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[h,c]),I(_.subject),t.publicKeyToAsn1(_.publicKey)]);return _.issuer.uniqueId&&v.value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,"\0"+_.issuer.uniqueId)])),_.subject.uniqueId&&v.value.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,"\0"+_.subject.uniqueId)])),_.extensions.length>0&&v.value.push(t.certificateExtensionsToAsn1(_.extensions)),v},t.getCertificationRequestInfo=function(_){var h=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(_.version).getBytes()),I(_.subject),t.publicKeyToAsn1(_.publicKey),T(_)]);return h},t.distinguishedNameToAsn1=function(_){return I(_)},t.certificateToAsn1=function(_){var h=_.tbsCertificate||t.getTBSCertificate(_);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[h,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.signatureOid).getBytes()),d(_.signatureOid,_.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,"\0"+_.signature)])},t.certificateExtensionsToAsn1=function(_){var h=e.create(e.Class.CONTEXT_SPECIFIC,3,!0,[]),c=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);h.value.push(c);for(var v=0;v<_.length;++v)c.value.push(t.certificateExtensionToAsn1(_[v]));return h},t.certificateExtensionToAsn1=function(_){var h=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);h.value.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.id).getBytes())),_.critical&&h.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,""));var c=_.value;return typeof _.value!="string"&&(c=e.toDer(c).getBytes()),h.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,c)),h},t.certificationRequestToAsn1=function(_){var h=_.certificationRequestInfo||t.getCertificationRequestInfo(_);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[h,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.signatureOid).getBytes()),d(_.signatureOid,_.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,"\0"+_.signature)])},t.createCaStore=function(_){var h={certs:{}};h.getIssuer=function(R){var P=c(R.issuer);return P},h.addCertificate=function(R){if(typeof R=="string"&&(R=r.pki.certificateFromPem(R)),v(R.subject),!h.hasCertificate(R))if(R.subject.hash in h.certs){var P=h.certs[R.subject.hash];r.util.isArray(P)||(P=[P]),P.push(R),h.certs[R.subject.hash]=P}else h.certs[R.subject.hash]=R},h.hasCertificate=function(R){typeof R=="string"&&(R=r.pki.certificateFromPem(R));var P=c(R.subject);if(!P)return!1;r.util.isArray(P)||(P=[P]);for(var H=e.toDer(t.certificateToAsn1(R)).getBytes(),z=0;z<P.length;++z){var W=e.toDer(t.certificateToAsn1(P[z])).getBytes();if(H===W)return!0}return!1},h.listAllCertificates=function(){var R=[];for(var P in h.certs)if(h.certs.hasOwnProperty(P)){var H=h.certs[P];if(!r.util.isArray(H))R.push(H);else for(var z=0;z<H.length;++z)R.push(H[z])}return R},h.removeCertificate=function(R){var P;if(typeof R=="string"&&(R=r.pki.certificateFromPem(R)),v(R.subject),!h.hasCertificate(R))return null;var H=c(R.subject);if(!r.util.isArray(H))return P=h.certs[R.subject.hash],delete h.certs[R.subject.hash],P;for(var z=e.toDer(t.certificateToAsn1(R)).getBytes(),W=0;W<H.length;++W){var te=e.toDer(t.certificateToAsn1(H[W])).getBytes();z===te&&(P=H[W],H.splice(W,1))}return H.length===0&&delete h.certs[R.subject.hash],P};function c(R){return v(R),h.certs[R.hash]||null}function v(R){if(!R.hash){var P=r.md.sha1.create();R.attributes=t.RDNAttributesAsArray(I(R),P),R.hash=P.digest().toHex()}}if(_)for(var b=0;b<_.length;++b){var B=_[b];h.addCertificate(B)}return h},t.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},t.verifyCertificateChain=function(_,h,c){typeof c=="function"&&(c={verify:c}),c=c||{},h=h.slice(0);var v=h.slice(0),b=c.validityCheckDate;typeof b>"u"&&(b=new Date);var B=!0,R=null,P=0;do{var H=h.shift(),z=null,W=!1;if(b&&(b<H.validity.notBefore||b>H.validity.notAfter)&&(R={message:"Certificate is not valid yet or has expired.",error:t.certificateError.certificate_expired,notBefore:H.validity.notBefore,notAfter:H.validity.notAfter,now:b}),R===null){if(z=h[0]||_.getIssuer(H),z===null&&H.isIssuer(H)&&(W=!0,z=H),z){var te=z;r.util.isArray(te)||(te=[te]);for(var ne=!1;!ne&&te.length>0;){z=te.shift();try{ne=z.verify(H)}catch{}}ne||(R={message:"Certificate signature is invalid.",error:t.certificateError.bad_certificate})}R===null&&(!z||W)&&!_.hasCertificate(H)&&(R={message:"Certificate is not trusted.",error:t.certificateError.unknown_ca})}if(R===null&&z&&!H.isIssuer(z)&&(R={message:"Certificate issuer is invalid.",error:t.certificateError.bad_certificate}),R===null)for(var oe={keyUsage:!0,basicConstraints:!0},me=0;R===null&&me<H.extensions.length;++me){var Se=H.extensions[me];Se.critical&&!(Se.name in oe)&&(R={message:"Certificate has an unsupported critical extension.",error:t.certificateError.unsupported_certificate})}if(R===null&&(!B||h.length===0&&(!z||W))){var xe=H.getExtension("basicConstraints"),we=H.getExtension("keyUsage");if(we!==null&&(!we.keyCertSign||xe===null)&&(R={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:t.certificateError.bad_certificate}),R===null&&xe!==null&&!xe.cA&&(R={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:t.certificateError.bad_certificate}),R===null&&we!==null&&"pathLenConstraint"in xe){var ie=P-1;ie>xe.pathLenConstraint&&(R={message:"Certificate basicConstraints pathLenConstraint violated.",error:t.certificateError.bad_certificate})}}var Te=R===null?!0:R.error,ae=c.verify?c.verify(Te,P,v):Te;if(ae===!0)R=null;else throw Te===!0&&(R={message:"The application rejected the certificate.",error:t.certificateError.bad_certificate}),(ae||ae===0)&&(typeof ae=="object"&&!r.util.isArray(ae)?(ae.message&&(R.message=ae.message),ae.error&&(R.error=ae.error)):typeof ae=="string"&&(R.error=ae)),R;B=!1,++P}while(h.length>0);return!0},To.exports}var Wh;function zp(){if(Wh)return _o.exports;Wh=1;var r=Ne();Ir(),Ji(),wn(),Hp(),jp(),pr(),xa(),Zi(),Ke(),mc();var e=r.asn1,t=r.pki,n=_o.exports=r.pkcs12=r.pkcs12||{},i={name:"ContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:e.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},s={name:"PFX",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},i,{name:"PFX.macData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:e.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},o={name:"SafeBag",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:e.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},a={name:"Attribute",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,capture:"values"}]},f={name:"CertBag",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:e.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:e.Class.UNIVERSAL,type:e.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function l(S,A,d,T){for(var x=[],k=0;k<S.length;k++)for(var U=0;U<S[k].safeBags.length;U++){var _=S[k].safeBags[U];if(!(T!==void 0&&_.type!==T)){if(A===null){x.push(_);continue}_.attributes[A]!==void 0&&_.attributes[A].indexOf(d)>=0&&x.push(_)}}return x}n.pkcs12FromAsn1=function(S,A,d){typeof A=="string"?(d=A,A=!0):A===void 0&&(A=!0);var T={},x=[];if(!e.validate(S,s,T,x)){var k=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.");throw k.errors=k,k}var U={version:T.version.charCodeAt(0),safeContents:[],getBags:function(z){var W={},te;return"localKeyId"in z?te=z.localKeyId:"localKeyIdHex"in z&&(te=r.util.hexToBytes(z.localKeyIdHex)),te===void 0&&!("friendlyName"in z)&&"bagType"in z&&(W[z.bagType]=l(U.safeContents,null,null,z.bagType)),te!==void 0&&(W.localKeyId=l(U.safeContents,"localKeyId",te,z.bagType)),"friendlyName"in z&&(W.friendlyName=l(U.safeContents,"friendlyName",z.friendlyName,z.bagType)),W},getBagsByFriendlyName:function(z,W){return l(U.safeContents,"friendlyName",z,W)},getBagsByLocalKeyId:function(z,W){return l(U.safeContents,"localKeyId",z,W)}};if(T.version.charCodeAt(0)!==3){var k=new Error("PKCS#12 PFX of version other than 3 not supported.");throw k.version=T.version.charCodeAt(0),k}if(e.derToOid(T.contentType)!==t.oids.data){var k=new Error("Only PKCS#12 PFX in password integrity mode supported.");throw k.oid=e.derToOid(T.contentType),k}var _=T.content.value[0];if(_.tagClass!==e.Class.UNIVERSAL||_.type!==e.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(_=g(_),T.mac){var h=null,c=0,v=e.derToOid(T.macAlgorithm);switch(v){case t.oids.sha1:h=r.md.sha1.create(),c=20;break;case t.oids.sha256:h=r.md.sha256.create(),c=32;break;case t.oids.sha384:h=r.md.sha384.create(),c=48;break;case t.oids.sha512:h=r.md.sha512.create(),c=64;break;case t.oids.md5:h=r.md.md5.create(),c=16;break}if(h===null)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+v);var b=new r.util.ByteBuffer(T.macSalt),B="macIterations"in T?parseInt(r.util.bytesToHex(T.macIterations),16):1,R=n.generateKey(d,b,3,B,c,h),P=r.hmac.create();P.start(h,R),P.update(_.value);var H=P.getMac();if(H.getBytes()!==T.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return w(U,_.value,A,d),U};function g(S){if(S.composed||S.constructed){for(var A=r.util.createBuffer(),d=0;d<S.value.length;++d)A.putBytes(S.value[d].value);S.composed=S.constructed=!1,S.value=A.getBytes()}return S}function w(S,A,d,T){if(A=e.fromDer(A,d),A.tagClass!==e.Class.UNIVERSAL||A.type!==e.Type.SEQUENCE||A.constructed!==!0)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var x=0;x<A.value.length;x++){var k=A.value[x],U={},_=[];if(!e.validate(k,i,U,_)){var h=new Error("Cannot read ContentInfo.");throw h.errors=_,h}var c={encrypted:!1},v=null,b=U.content.value[0];switch(e.derToOid(U.contentType)){case t.oids.data:if(b.tagClass!==e.Class.UNIVERSAL||b.type!==e.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");v=g(b).value;break;case t.oids.encryptedData:v=y(b,T),c.encrypted=!0;break;default:var h=new Error("Unsupported PKCS#12 contentType.");throw h.contentType=e.derToOid(U.contentType),h}c.safeBags=p(v,d,T),S.safeContents.push(c)}}function y(S,A){var d={},T=[];if(!e.validate(S,r.pkcs7.asn1.encryptedDataValidator,d,T)){var x=new Error("Cannot read EncryptedContentInfo.");throw x.errors=T,x}var k=e.derToOid(d.contentType);if(k!==t.oids.data){var x=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.");throw x.oid=k,x}k=e.derToOid(d.encAlgorithm);var U=t.pbe.getCipher(k,d.encParameter,A),_=g(d.encryptedContentAsn1),h=r.util.createBuffer(_.value);if(U.update(h),!U.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return U.output.getBytes()}function p(S,A,d){if(!A&&S.length===0)return[];if(S=e.fromDer(S,A),S.tagClass!==e.Class.UNIVERSAL||S.type!==e.Type.SEQUENCE||S.constructed!==!0)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var T=[],x=0;x<S.value.length;x++){var k=S.value[x],U={},_=[];if(!e.validate(k,o,U,_)){var h=new Error("Cannot read SafeBag.");throw h.errors=_,h}var c={type:e.derToOid(U.bagId),attributes:I(U.bagAttributes)};T.push(c);var v,b,B=U.bagValue.value[0];switch(c.type){case t.oids.pkcs8ShroudedKeyBag:if(B=t.decryptPrivateKeyInfo(B,d),B===null)throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case t.oids.keyBag:try{c.key=t.privateKeyFromAsn1(B)}catch{c.key=null,c.asn1=B}continue;case t.oids.certBag:v=f,b=function(){if(e.derToOid(U.certId)!==t.oids.x509Certificate){var P=new Error("Unsupported certificate type, only X.509 supported.");throw P.oid=e.derToOid(U.certId),P}var H=e.fromDer(U.cert,A);try{c.cert=t.certificateFromAsn1(H,!0)}catch{c.cert=null,c.asn1=H}};break;default:var h=new Error("Unsupported PKCS#12 SafeBag type.");throw h.oid=c.type,h}if(v!==void 0&&!e.validate(B,v,U,_)){var h=new Error("Cannot read PKCS#12 "+v.name);throw h.errors=_,h}b()}return T}function I(S){var A={};if(S!==void 0)for(var d=0;d<S.length;++d){var T={},x=[];if(!e.validate(S[d],a,T,x)){var k=new Error("Cannot read PKCS#12 BagAttribute.");throw k.errors=x,k}var U=e.derToOid(T.oid);if(t.oids[U]!==void 0){A[t.oids[U]]=[];for(var _=0;_<T.values.length;++_)A[t.oids[U]].push(T.values[_].value)}}return A}return n.toPkcs12Asn1=function(S,A,d,T){T=T||{},T.saltSize=T.saltSize||8,T.count=T.count||2048,T.algorithm=T.algorithm||T.encAlgorithm||"aes128","useMac"in T||(T.useMac=!0),"localKeyId"in T||(T.localKeyId=null),"generateLocalKeyId"in T||(T.generateLocalKeyId=!0);var x=T.localKeyId,k;if(x!==null)x=r.util.hexToBytes(x);else if(T.generateLocalKeyId)if(A){var U=r.util.isArray(A)?A[0]:A;typeof U=="string"&&(U=t.certificateFromPem(U));var _=r.md.sha1.create();_.update(e.toDer(t.certificateToAsn1(U)).getBytes()),x=_.digest().getBytes()}else x=r.random.getBytes(20);var h=[];x!==null&&h.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.localKeyId).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,x)])])),"friendlyName"in T&&h.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.friendlyName).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.BMPSTRING,!1,T.friendlyName)])])),h.length>0&&(k=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,h));var c=[],v=[];A!==null&&(r.util.isArray(A)?v=A:v=[A]);for(var b=[],B=0;B<v.length;++B){A=v[B],typeof A=="string"&&(A=t.certificateFromPem(A));var R=B===0?k:void 0,P=t.certificateToAsn1(A),H=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.certBag).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.x509Certificate).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(P).getBytes())])])]),R]);b.push(H)}if(b.length>0){var z=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,b),W=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.data).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(z).getBytes())])]);c.push(W)}var te=null;if(S!==null){var ne=t.wrapRsaPrivateKey(t.privateKeyToAsn1(S));d===null?te=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.keyBag).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[ne]),k]):te=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.pkcs8ShroudedKeyBag).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[t.encryptPrivateKeyInfo(ne,d,T)]),k]);var oe=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[te]),me=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.data).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(oe).getBytes())])]);c.push(me)}var Se=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,c),xe;if(T.useMac){var _=r.md.sha1.create(),we=new r.util.ByteBuffer(r.random.getBytes(T.saltSize)),ie=T.count,S=n.generateKey(d,we,3,ie,20),Te=r.hmac.create();Te.start(_,S),Te.update(e.toDer(Se).getBytes());var ae=Te.getMac();xe=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.sha1).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,ae.getBytes())]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,we.getBytes()),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(ie).getBytes())])}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(3).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(t.oids.data).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(Se).getBytes())])]),xe])},n.generateKey=r.pbe.generatePkcs12Key,_o.exports}var Qh;function $p(){if(Qh)return oo.exports;Qh=1;var r=Ne();Ir(),wn(),jp(),ai(),pc(),zp(),gc(),xa(),Ke(),mc();var e=r.asn1,t=oo.exports=r.pki=r.pki||{};return t.pemToDer=function(n){var i=r.pem.decode(n)[0];if(i.procType&&i.procType.type==="ENCRYPTED")throw new Error("Could not convert PEM to DER; PEM is encrypted.");return r.util.createBuffer(i.body)},t.privateKeyFromPem=function(n){var i=r.pem.decode(n)[0];if(i.type!=="PRIVATE KEY"&&i.type!=="RSA PRIVATE KEY"){var s=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw s.headerType=i.type,s}if(i.procType&&i.procType.type==="ENCRYPTED")throw new Error("Could not convert private key from PEM; PEM is encrypted.");var o=e.fromDer(i.body);return t.privateKeyFromAsn1(o)},t.privateKeyToPem=function(n,i){var s={type:"RSA PRIVATE KEY",body:e.toDer(t.privateKeyToAsn1(n)).getBytes()};return r.pem.encode(s,{maxline:i})},t.privateKeyInfoToPem=function(n,i){var s={type:"PRIVATE KEY",body:e.toDer(n).getBytes()};return r.pem.encode(s,{maxline:i})},oo.exports}var Ao,Yh;function Wp(){if(Yh)return Ao;Yh=1;var r=Ne();Ir(),Ji(),fc(),ai(),$p(),pr(),Zi(),Ke();var e=function(C,M,O,m){var L=r.util.createBuffer(),j=C.length>>1,q=j+(C.length&1),ee=C.substr(0,q),le=C.substr(j,q),ge=r.util.createBuffer(),Y=r.hmac.create();O=M+O;var ce=Math.ceil(m/16),ve=Math.ceil(m/20);Y.start("MD5",ee);var De=r.util.createBuffer();ge.putBytes(O);for(var Ce=0;Ce<ce;++Ce)Y.start(null,null),Y.update(ge.getBytes()),ge.putBuffer(Y.digest()),Y.start(null,null),Y.update(ge.bytes()+O),De.putBuffer(Y.digest());Y.start("SHA1",le);var $e=r.util.createBuffer();ge.clear(),ge.putBytes(O);for(var Ce=0;Ce<ve;++Ce)Y.start(null,null),Y.update(ge.getBytes()),ge.putBuffer(Y.digest()),Y.start(null,null),Y.update(ge.bytes()+O),$e.putBuffer(Y.digest());return L.putBytes(r.util.xorBytes(De.getBytes(),$e.getBytes(),m)),L},t=function(C,M,O){var m=r.hmac.create();m.start("SHA1",C);var L=r.util.createBuffer();return L.putInt32(M[0]),L.putInt32(M[1]),L.putByte(O.type),L.putByte(O.version.major),L.putByte(O.version.minor),L.putInt16(O.length),L.putBytes(O.fragment.bytes()),m.update(L.getBytes()),m.digest().getBytes()},n=function(C,M,O){var m=!1;try{var L=C.deflate(M.fragment.getBytes());M.fragment=r.util.createBuffer(L),M.length=L.length,m=!0}catch{}return m},i=function(C,M,O){var m=!1;try{var L=C.inflate(M.fragment.getBytes());M.fragment=r.util.createBuffer(L),M.length=L.length,m=!0}catch{}return m},s=function(C,M){var O=0;switch(M){case 1:O=C.getByte();break;case 2:O=C.getInt16();break;case 3:O=C.getInt24();break;case 4:O=C.getInt32();break}return r.util.createBuffer(C.getBytes(O))},o=function(C,M,O){C.putInt(O.length(),M<<3),C.putBuffer(O)},a={};a.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}},a.SupportedVersions=[a.Versions.TLS_1_1,a.Versions.TLS_1_0],a.Version=a.SupportedVersions[0],a.MaxFragment=15360,a.ConnectionEnd={server:0,client:1},a.PRFAlgorithm={tls_prf_sha256:0},a.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},a.CipherType={stream:0,block:1,aead:2},a.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},a.CompressionMethod={none:0,deflate:1},a.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24},a.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},a.Alert={},a.Alert.Level={warning:1,fatal:2},a.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},a.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2},a.CipherSuites={},a.getCipherSuite=function(C){var M=null;for(var O in a.CipherSuites){var m=a.CipherSuites[O];if(m.id[0]===C.charCodeAt(0)&&m.id[1]===C.charCodeAt(1)){M=m;break}}return M},a.handleUnexpected=function(C,M){var O=!C.open&&C.entity===a.ConnectionEnd.client;O||C.error(C,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unexpected_message}})},a.handleHelloRequest=function(C,M,O){!C.handshaking&&C.handshakes>0&&(a.queue(C,a.createAlert(C,{level:a.Alert.Level.warning,description:a.Alert.Description.no_renegotiation})),a.flush(C)),C.process()},a.parseHelloMessage=function(C,M,O){var m=null,L=C.entity===a.ConnectionEnd.client;if(O<38)C.error(C,{message:L?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});else{var j=M.fragment,q=j.length();if(m={version:{major:j.getByte(),minor:j.getByte()},random:r.util.createBuffer(j.getBytes(32)),session_id:s(j,1),extensions:[]},L?(m.cipher_suite=j.getBytes(2),m.compression_method=j.getByte()):(m.cipher_suites=s(j,2),m.compression_methods=s(j,1)),q=O-(q-j.length()),q>0){for(var ee=s(j,2);ee.length()>0;)m.extensions.push({type:[ee.getByte(),ee.getByte()],data:s(ee,2)});if(!L)for(var le=0;le<m.extensions.length;++le){var ge=m.extensions[le];if(ge.type[0]===0&&ge.type[1]===0)for(var Y=s(ge.data,2);Y.length()>0;){var ce=Y.getByte();if(ce!==0)break;C.session.extensions.server_name.serverNameList.push(s(Y,2).getBytes())}}}if(C.session.version&&(m.version.major!==C.session.version.major||m.version.minor!==C.session.version.minor))return C.error(C,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}});if(L)C.session.cipherSuite=a.getCipherSuite(m.cipher_suite);else for(var ve=r.util.createBuffer(m.cipher_suites.bytes());ve.length()>0&&(C.session.cipherSuite=a.getCipherSuite(ve.getBytes(2)),C.session.cipherSuite===null););if(C.session.cipherSuite===null)return C.error(C,{message:"No cipher suites in common.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.handshake_failure},cipherSuite:r.util.bytesToHex(m.cipher_suite)});L?C.session.compressionMethod=m.compression_method:C.session.compressionMethod=a.CompressionMethod.none}return m},a.createSecurityParameters=function(C,M){var O=C.entity===a.ConnectionEnd.client,m=M.random.bytes(),L=O?C.session.sp.client_random:m,j=O?m:a.createRandom().getBytes();C.session.sp={entity:C.entity,prf_algorithm:a.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:C.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:L,server_random:j}},a.handleServerHello=function(C,M,O){var m=a.parseHelloMessage(C,M,O);if(!C.fail){if(m.version.minor<=C.version.minor)C.version.minor=m.version.minor;else return C.error(C,{message:"Incompatible TLS version.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}});C.session.version=C.version;var L=m.session_id.bytes();L.length>0&&L===C.session.id?(C.expect=p,C.session.resuming=!0,C.session.sp.server_random=m.random.bytes()):(C.expect=l,C.session.resuming=!1,a.createSecurityParameters(C,m)),C.session.id=L,C.process()}},a.handleClientHello=function(C,M,O){var m=a.parseHelloMessage(C,M,O);if(!C.fail){var L=m.session_id.bytes(),j=null;if(C.sessionCache&&(j=C.sessionCache.getSession(L),j===null?L="":(j.version.major!==m.version.major||j.version.minor>m.version.minor)&&(j=null,L="")),L.length===0&&(L=r.random.getBytes(32)),C.session.id=L,C.session.clientHelloVersion=m.version,C.session.sp={},j)C.version=C.session.version=j.version,C.session.sp=j.sp;else{for(var q,ee=1;ee<a.SupportedVersions.length&&(q=a.SupportedVersions[ee],!(q.minor<=m.version.minor));++ee);C.version={major:q.major,minor:q.minor},C.session.version=C.version}j!==null?(C.expect=U,C.session.resuming=!0,C.session.sp.client_random=m.random.bytes()):(C.expect=C.verifyClient!==!1?T:x,C.session.resuming=!1,a.createSecurityParameters(C,m)),C.open=!0,a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createServerHello(C)})),C.session.resuming?(a.queue(C,a.createRecord(C,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),C.state.pending=a.createConnectionState(C),C.state.current.write=C.state.pending.write,a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createFinished(C)}))):(a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createCertificate(C)})),C.fail||(a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createServerKeyExchange(C)})),C.verifyClient!==!1&&a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createCertificateRequest(C)})),a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createServerHelloDone(C)})))),a.flush(C),C.process()}},a.handleCertificate=function(C,M,O){if(O<3)return C.error(C,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var m=M.fragment,L={certificate_list:s(m,3)},j,q,ee=[];try{for(;L.certificate_list.length()>0;)j=s(L.certificate_list,3),q=r.asn1.fromDer(j),j=r.pki.certificateFromAsn1(q,!0),ee.push(j)}catch(ge){return C.error(C,{message:"Could not parse certificate list.",cause:ge,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}})}var le=C.entity===a.ConnectionEnd.client;(le||C.verifyClient===!0)&&ee.length===0?C.error(C,{message:le?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}}):ee.length===0?C.expect=le?g:x:(le?C.session.serverCertificate=ee[0]:C.session.clientCertificate=ee[0],a.verifyCertificateChain(C,ee)&&(C.expect=le?g:x)),C.process()},a.handleServerKeyExchange=function(C,M,O){if(O>0)return C.error(C,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unsupported_certificate}});C.expect=w,C.process()},a.handleClientKeyExchange=function(C,M,O){if(O<48)return C.error(C,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unsupported_certificate}});var m=M.fragment,L={enc_pre_master_secret:s(m,2).getBytes()},j=null;if(C.getPrivateKey)try{j=C.getPrivateKey(C,C.session.serverCertificate),j=r.pki.privateKeyFromPem(j)}catch(le){C.error(C,{message:"Could not get private key.",cause:le,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}})}if(j===null)return C.error(C,{message:"No private key set.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}});try{var q=C.session.sp;q.pre_master_secret=j.decrypt(L.enc_pre_master_secret);var ee=C.session.clientHelloVersion;if(ee.major!==q.pre_master_secret.charCodeAt(0)||ee.minor!==q.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch{q.pre_master_secret=r.random.getBytes(48)}C.expect=U,C.session.clientCertificate!==null&&(C.expect=k),C.process()},a.handleCertificateRequest=function(C,M,O){if(O<3)return C.error(C,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var m=M.fragment,L={certificate_types:s(m,1),certificate_authorities:s(m,2)};C.session.certificateRequest=L,C.expect=y,C.process()},a.handleCertificateVerify=function(C,M,O){if(O<2)return C.error(C,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var m=M.fragment;m.read-=4;var L=m.bytes();m.read+=4;var j={signature:s(m,2).getBytes()},q=r.util.createBuffer();q.putBuffer(C.session.md5.digest()),q.putBuffer(C.session.sha1.digest()),q=q.getBytes();try{var ee=C.session.clientCertificate;if(!ee.publicKey.verify(q,j.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");C.session.md5.update(L),C.session.sha1.update(L)}catch{return C.error(C,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.handshake_failure}})}C.expect=U,C.process()},a.handleServerHelloDone=function(C,M,O){if(O>0)return C.error(C,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.record_overflow}});if(C.serverCertificate===null){var m={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.insufficient_security}},L=0,j=C.verify(C,m.alert.description,L,[]);if(j!==!0)return(j||j===0)&&(typeof j=="object"&&!r.util.isArray(j)?(j.message&&(m.message=j.message),j.alert&&(m.alert.description=j.alert)):typeof j=="number"&&(m.alert.description=j)),C.error(C,m)}C.session.certificateRequest!==null&&(M=a.createRecord(C,{type:a.ContentType.handshake,data:a.createCertificate(C)}),a.queue(C,M)),M=a.createRecord(C,{type:a.ContentType.handshake,data:a.createClientKeyExchange(C)}),a.queue(C,M),C.expect=A;var q=function(ee,le){ee.session.certificateRequest!==null&&ee.session.clientCertificate!==null&&a.queue(ee,a.createRecord(ee,{type:a.ContentType.handshake,data:a.createCertificateVerify(ee,le)})),a.queue(ee,a.createRecord(ee,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),ee.state.pending=a.createConnectionState(ee),ee.state.current.write=ee.state.pending.write,a.queue(ee,a.createRecord(ee,{type:a.ContentType.handshake,data:a.createFinished(ee)})),ee.expect=p,a.flush(ee),ee.process()};if(C.session.certificateRequest===null||C.session.clientCertificate===null)return q(C,null);a.getClientSignature(C,q)},a.handleChangeCipherSpec=function(C,M){if(M.fragment.getByte()!==1)return C.error(C,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var O=C.entity===a.ConnectionEnd.client;(C.session.resuming&&O||!C.session.resuming&&!O)&&(C.state.pending=a.createConnectionState(C)),C.state.current.read=C.state.pending.read,(!C.session.resuming&&O||C.session.resuming&&!O)&&(C.state.pending=null),C.expect=O?I:_,C.process()},a.handleFinished=function(C,M,O){var m=M.fragment;m.read-=4;var L=m.bytes();m.read+=4;var j=M.fragment.getBytes();m=r.util.createBuffer(),m.putBuffer(C.session.md5.digest()),m.putBuffer(C.session.sha1.digest());var q=C.entity===a.ConnectionEnd.client,ee=q?"server finished":"client finished",le=C.session.sp,ge=12,Y=e;if(m=Y(le.master_secret,ee,m.getBytes(),ge),m.getBytes()!==j)return C.error(C,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.decrypt_error}});C.session.md5.update(L),C.session.sha1.update(L),(C.session.resuming&&q||!C.session.resuming&&!q)&&(a.queue(C,a.createRecord(C,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),C.state.current.write=C.state.pending.write,C.state.pending=null,a.queue(C,a.createRecord(C,{type:a.ContentType.handshake,data:a.createFinished(C)}))),C.expect=q?S:h,C.handshaking=!1,++C.handshakes,C.peerCertificate=q?C.session.serverCertificate:C.session.clientCertificate,a.flush(C),C.isConnected=!0,C.connected(C),C.process()},a.handleAlert=function(C,M){var O=M.fragment,m={level:O.getByte(),description:O.getByte()},L;switch(m.description){case a.Alert.Description.close_notify:L="Connection closed.";break;case a.Alert.Description.unexpected_message:L="Unexpected message.";break;case a.Alert.Description.bad_record_mac:L="Bad record MAC.";break;case a.Alert.Description.decryption_failed:L="Decryption failed.";break;case a.Alert.Description.record_overflow:L="Record overflow.";break;case a.Alert.Description.decompression_failure:L="Decompression failed.";break;case a.Alert.Description.handshake_failure:L="Handshake failure.";break;case a.Alert.Description.bad_certificate:L="Bad certificate.";break;case a.Alert.Description.unsupported_certificate:L="Unsupported certificate.";break;case a.Alert.Description.certificate_revoked:L="Certificate revoked.";break;case a.Alert.Description.certificate_expired:L="Certificate expired.";break;case a.Alert.Description.certificate_unknown:L="Certificate unknown.";break;case a.Alert.Description.illegal_parameter:L="Illegal parameter.";break;case a.Alert.Description.unknown_ca:L="Unknown certificate authority.";break;case a.Alert.Description.access_denied:L="Access denied.";break;case a.Alert.Description.decode_error:L="Decode error.";break;case a.Alert.Description.decrypt_error:L="Decrypt error.";break;case a.Alert.Description.export_restriction:L="Export restriction.";break;case a.Alert.Description.protocol_version:L="Unsupported protocol version.";break;case a.Alert.Description.insufficient_security:L="Insufficient security.";break;case a.Alert.Description.internal_error:L="Internal error.";break;case a.Alert.Description.user_canceled:L="User canceled.";break;case a.Alert.Description.no_renegotiation:L="Renegotiation not supported.";break;default:L="Unknown error.";break}if(m.description===a.Alert.Description.close_notify)return C.close();C.error(C,{message:L,send:!1,origin:C.entity===a.ConnectionEnd.client?"server":"client",alert:m}),C.process()},a.handleHandshake=function(C,M){var O=M.fragment,m=O.getByte(),L=O.getInt24();if(L>O.length())return C.fragmented=M,M.fragment=r.util.createBuffer(),O.read-=4,C.process();C.fragmented=null,O.read-=4;var j=O.bytes(L+4);O.read+=4,m in xe[C.entity][C.expect]?(C.entity===a.ConnectionEnd.server&&!C.open&&!C.fail&&(C.handshaking=!0,C.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:r.md.md5.create(),sha1:r.md.sha1.create()}),m!==a.HandshakeType.hello_request&&m!==a.HandshakeType.certificate_verify&&m!==a.HandshakeType.finished&&(C.session.md5.update(j),C.session.sha1.update(j)),xe[C.entity][C.expect][m](C,M,L)):a.handleUnexpected(C,M)},a.handleApplicationData=function(C,M){C.data.putBuffer(M.fragment),C.dataReady(C),C.process()},a.handleHeartbeat=function(C,M){var O=M.fragment,m=O.getByte(),L=O.getInt16(),j=O.getBytes(L);if(m===a.HeartbeatMessageType.heartbeat_request){if(C.handshaking||L>j.length)return C.process();a.queue(C,a.createRecord(C,{type:a.ContentType.heartbeat,data:a.createHeartbeat(a.HeartbeatMessageType.heartbeat_response,j)})),a.flush(C)}else if(m===a.HeartbeatMessageType.heartbeat_response){if(j!==C.expectedHeartbeatPayload)return C.process();C.heartbeatReceived&&C.heartbeatReceived(C,r.util.createBuffer(j))}C.process()};var f=0,l=1,g=2,w=3,y=4,p=5,I=6,S=7,A=8,d=0,T=1,x=2,k=3,U=4,_=5,h=6,c=a.handleUnexpected,v=a.handleChangeCipherSpec,b=a.handleAlert,B=a.handleHandshake,R=a.handleApplicationData,P=a.handleHeartbeat,H=[];H[a.ConnectionEnd.client]=[[c,b,B,c,P],[c,b,B,c,P],[c,b,B,c,P],[c,b,B,c,P],[c,b,B,c,P],[v,b,c,c,P],[c,b,B,c,P],[c,b,B,R,P],[c,b,B,c,P]],H[a.ConnectionEnd.server]=[[c,b,B,c,P],[c,b,B,c,P],[c,b,B,c,P],[c,b,B,c,P],[v,b,c,c,P],[c,b,B,c,P],[c,b,B,R,P],[c,b,B,c,P]];var z=a.handleHelloRequest,W=a.handleServerHello,te=a.handleCertificate,ne=a.handleServerKeyExchange,oe=a.handleCertificateRequest,me=a.handleServerHelloDone,Se=a.handleFinished,xe=[];xe[a.ConnectionEnd.client]=[[c,c,W,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,te,ne,oe,me,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,c,ne,oe,me,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,c,c,oe,me,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,c,c,c,me,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,Se],[z,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[z,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c]];var we=a.handleClientHello,ie=a.handleClientKeyExchange,Te=a.handleCertificateVerify;xe[a.ConnectionEnd.server]=[[c,we,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,te,c,c,c,c,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,ie,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,Te,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,Se],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c]],a.generateKeys=function(C,M){var O=e,m=M.client_random+M.server_random;C.session.resuming||(M.master_secret=O(M.pre_master_secret,"master secret",m,48).bytes(),M.pre_master_secret=null),m=M.server_random+M.client_random;var L=2*M.mac_key_length+2*M.enc_key_length,j=C.version.major===a.Versions.TLS_1_0.major&&C.version.minor===a.Versions.TLS_1_0.minor;j&&(L+=2*M.fixed_iv_length);var q=O(M.master_secret,"key expansion",m,L),ee={client_write_MAC_key:q.getBytes(M.mac_key_length),server_write_MAC_key:q.getBytes(M.mac_key_length),client_write_key:q.getBytes(M.enc_key_length),server_write_key:q.getBytes(M.enc_key_length)};return j&&(ee.client_write_IV=q.getBytes(M.fixed_iv_length),ee.server_write_IV=q.getBytes(M.fixed_iv_length)),ee},a.createConnectionState=function(C){var M=C.entity===a.ConnectionEnd.client,O=function(){var j={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(q){return!0},compressionState:null,compressFunction:function(q){return!0},updateSequenceNumber:function(){j.sequenceNumber[1]===4294967295?(j.sequenceNumber[1]=0,++j.sequenceNumber[0]):++j.sequenceNumber[1]}};return j},m={read:O(),write:O()};if(m.read.update=function(j,q){return m.read.cipherFunction(q,m.read)?m.read.compressFunction(j,q,m.read)||j.error(j,{message:"Could not decompress record.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.decompression_failure}}):j.error(j,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_record_mac}}),!j.fail},m.write.update=function(j,q){return m.write.compressFunction(j,q,m.write)?m.write.cipherFunction(q,m.write)||j.error(j,{message:"Could not encrypt record.",send:!1,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}):j.error(j,{message:"Could not compress record.",send:!1,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}),!j.fail},C.session){var L=C.session.sp;switch(C.session.cipherSuite.initSecurityParameters(L),L.keys=a.generateKeys(C,L),m.read.macKey=M?L.keys.server_write_MAC_key:L.keys.client_write_MAC_key,m.write.macKey=M?L.keys.client_write_MAC_key:L.keys.server_write_MAC_key,C.session.cipherSuite.initConnectionState(m,C,L),L.compression_algorithm){case a.CompressionMethod.none:break;case a.CompressionMethod.deflate:m.read.compressFunction=i,m.write.compressFunction=n;break;default:throw new Error("Unsupported compression algorithm.")}}return m},a.createRandom=function(){var C=new Date,M=+C+C.getTimezoneOffset()*6e4,O=r.util.createBuffer();return O.putInt32(M),O.putBytes(r.random.getBytes(28)),O},a.createRecord=function(C,M){if(!M.data)return null;var O={type:M.type,version:{major:C.version.major,minor:C.version.minor},length:M.data.length(),fragment:M.data};return O},a.createAlert=function(C,M){var O=r.util.createBuffer();return O.putByte(M.level),O.putByte(M.description),a.createRecord(C,{type:a.ContentType.alert,data:O})},a.createClientHello=function(C){C.session.clientHelloVersion={major:C.version.major,minor:C.version.minor};for(var M=r.util.createBuffer(),O=0;O<C.cipherSuites.length;++O){var m=C.cipherSuites[O];M.putByte(m.id[0]),M.putByte(m.id[1])}var L=M.length(),j=r.util.createBuffer();j.putByte(a.CompressionMethod.none);var q=j.length(),ee=r.util.createBuffer();if(C.virtualHost){var le=r.util.createBuffer();le.putByte(0),le.putByte(0);var ge=r.util.createBuffer();ge.putByte(0),o(ge,2,r.util.createBuffer(C.virtualHost));var Y=r.util.createBuffer();o(Y,2,ge),o(le,2,Y),ee.putBuffer(le)}var ce=ee.length();ce>0&&(ce+=2);var ve=C.session.id,De=ve.length+1+2+4+28+2+L+1+q+ce,Ce=r.util.createBuffer();return Ce.putByte(a.HandshakeType.client_hello),Ce.putInt24(De),Ce.putByte(C.version.major),Ce.putByte(C.version.minor),Ce.putBytes(C.session.sp.client_random),o(Ce,1,r.util.createBuffer(ve)),o(Ce,2,M),o(Ce,1,j),ce>0&&o(Ce,2,ee),Ce},a.createServerHello=function(C){var M=C.session.id,O=M.length+1+2+4+28+2+1,m=r.util.createBuffer();return m.putByte(a.HandshakeType.server_hello),m.putInt24(O),m.putByte(C.version.major),m.putByte(C.version.minor),m.putBytes(C.session.sp.server_random),o(m,1,r.util.createBuffer(M)),m.putByte(C.session.cipherSuite.id[0]),m.putByte(C.session.cipherSuite.id[1]),m.putByte(C.session.compressionMethod),m},a.createCertificate=function(C){var M=C.entity===a.ConnectionEnd.client,O=null;if(C.getCertificate){var m;M?m=C.session.certificateRequest:m=C.session.extensions.server_name.serverNameList,O=C.getCertificate(C,m)}var L=r.util.createBuffer();if(O!==null)try{r.util.isArray(O)||(O=[O]);for(var j=null,q=0;q<O.length;++q){var ee=r.pem.decode(O[q])[0];if(ee.type!=="CERTIFICATE"&&ee.type!=="X509 CERTIFICATE"&&ee.type!=="TRUSTED CERTIFICATE"){var le=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw le.headerType=ee.type,le}if(ee.procType&&ee.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var ge=r.util.createBuffer(ee.body);j===null&&(j=r.asn1.fromDer(ge.bytes(),!1));var Y=r.util.createBuffer();o(Y,3,ge),L.putBuffer(Y)}O=r.pki.certificateFromAsn1(j),M?C.session.clientCertificate=O:C.session.serverCertificate=O}catch(De){return C.error(C,{message:"Could not send certificate list.",cause:De,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}})}var ce=3+L.length(),ve=r.util.createBuffer();return ve.putByte(a.HandshakeType.certificate),ve.putInt24(ce),o(ve,3,L),ve},a.createClientKeyExchange=function(C){var M=r.util.createBuffer();M.putByte(C.session.clientHelloVersion.major),M.putByte(C.session.clientHelloVersion.minor),M.putBytes(r.random.getBytes(46));var O=C.session.sp;O.pre_master_secret=M.getBytes();var m=C.session.serverCertificate.publicKey;M=m.encrypt(O.pre_master_secret);var L=M.length+2,j=r.util.createBuffer();return j.putByte(a.HandshakeType.client_key_exchange),j.putInt24(L),j.putInt16(M.length),j.putBytes(M),j},a.createServerKeyExchange=function(C){var M=r.util.createBuffer();return M},a.getClientSignature=function(C,M){var O=r.util.createBuffer();O.putBuffer(C.session.md5.digest()),O.putBuffer(C.session.sha1.digest()),O=O.getBytes(),C.getSignature=C.getSignature||function(m,L,j){var q=null;if(m.getPrivateKey)try{q=m.getPrivateKey(m,m.session.clientCertificate),q=r.pki.privateKeyFromPem(q)}catch(ee){m.error(m,{message:"Could not get private key.",cause:ee,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}})}q===null?m.error(m,{message:"No private key set.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}):L=q.sign(L,null),j(m,L)},C.getSignature(C,O,M)},a.createCertificateVerify=function(C,M){var O=M.length+2,m=r.util.createBuffer();return m.putByte(a.HandshakeType.certificate_verify),m.putInt24(O),m.putInt16(M.length),m.putBytes(M),m},a.createCertificateRequest=function(C){var M=r.util.createBuffer();M.putByte(1);var O=r.util.createBuffer();for(var m in C.caStore.certs){var L=C.caStore.certs[m],j=r.pki.distinguishedNameToAsn1(L.subject),q=r.asn1.toDer(j);O.putInt16(q.length()),O.putBuffer(q)}var ee=1+M.length()+2+O.length(),le=r.util.createBuffer();return le.putByte(a.HandshakeType.certificate_request),le.putInt24(ee),o(le,1,M),o(le,2,O),le},a.createServerHelloDone=function(C){var M=r.util.createBuffer();return M.putByte(a.HandshakeType.server_hello_done),M.putInt24(0),M},a.createChangeCipherSpec=function(){var C=r.util.createBuffer();return C.putByte(1),C},a.createFinished=function(C){var M=r.util.createBuffer();M.putBuffer(C.session.md5.digest()),M.putBuffer(C.session.sha1.digest());var O=C.entity===a.ConnectionEnd.client,m=C.session.sp,L=12,j=e,q=O?"client finished":"server finished";M=j(m.master_secret,q,M.getBytes(),L);var ee=r.util.createBuffer();return ee.putByte(a.HandshakeType.finished),ee.putInt24(M.length()),ee.putBuffer(M),ee},a.createHeartbeat=function(C,M,O){typeof O>"u"&&(O=M.length);var m=r.util.createBuffer();m.putByte(C),m.putInt16(O),m.putBytes(M);var L=m.length(),j=Math.max(16,L-O-3);return m.putBytes(r.random.getBytes(j)),m},a.queue=function(C,M){if(M&&!(M.fragment.length()===0&&(M.type===a.ContentType.handshake||M.type===a.ContentType.alert||M.type===a.ContentType.change_cipher_spec))){if(M.type===a.ContentType.handshake){var O=M.fragment.bytes();C.session.md5.update(O),C.session.sha1.update(O),O=null}var m;if(M.fragment.length()<=a.MaxFragment)m=[M];else{m=[];for(var L=M.fragment.bytes();L.length>a.MaxFragment;)m.push(a.createRecord(C,{type:M.type,data:r.util.createBuffer(L.slice(0,a.MaxFragment))})),L=L.slice(a.MaxFragment);L.length>0&&m.push(a.createRecord(C,{type:M.type,data:r.util.createBuffer(L)}))}for(var j=0;j<m.length&&!C.fail;++j){var q=m[j],ee=C.state.current.write;ee.update(C,q)&&C.records.push(q)}}},a.flush=function(C){for(var M=0;M<C.records.length;++M){var O=C.records[M];C.tlsData.putByte(O.type),C.tlsData.putByte(O.version.major),C.tlsData.putByte(O.version.minor),C.tlsData.putInt16(O.fragment.length()),C.tlsData.putBuffer(C.records[M].fragment)}return C.records=[],C.tlsDataReady(C)};var ae=function(C){switch(C){case!0:return!0;case r.pki.certificateError.bad_certificate:return a.Alert.Description.bad_certificate;case r.pki.certificateError.unsupported_certificate:return a.Alert.Description.unsupported_certificate;case r.pki.certificateError.certificate_revoked:return a.Alert.Description.certificate_revoked;case r.pki.certificateError.certificate_expired:return a.Alert.Description.certificate_expired;case r.pki.certificateError.certificate_unknown:return a.Alert.Description.certificate_unknown;case r.pki.certificateError.unknown_ca:return a.Alert.Description.unknown_ca;default:return a.Alert.Description.bad_certificate}},ut=function(C){switch(C){case!0:return!0;case a.Alert.Description.bad_certificate:return r.pki.certificateError.bad_certificate;case a.Alert.Description.unsupported_certificate:return r.pki.certificateError.unsupported_certificate;case a.Alert.Description.certificate_revoked:return r.pki.certificateError.certificate_revoked;case a.Alert.Description.certificate_expired:return r.pki.certificateError.certificate_expired;case a.Alert.Description.certificate_unknown:return r.pki.certificateError.certificate_unknown;case a.Alert.Description.unknown_ca:return r.pki.certificateError.unknown_ca;default:return r.pki.certificateError.bad_certificate}};a.verifyCertificateChain=function(C,M){try{var O={};for(var m in C.verifyOptions)O[m]=C.verifyOptions[m];O.verify=function(j,q,ee){var le=ae(j),ge=C.verify(C,j,q,ee);if(ge!==!0){if(typeof ge=="object"&&!r.util.isArray(ge)){var Y=new Error("The application rejected the certificate.");throw Y.send=!0,Y.alert={level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate},ge.message&&(Y.message=ge.message),ge.alert&&(Y.alert.description=ge.alert),Y}ge!==j&&(ge=ut(ge))}return ge},r.pki.verifyCertificateChain(C.caStore,M,O)}catch(j){var L=j;(typeof L!="object"||r.util.isArray(L))&&(L={send:!0,alert:{level:a.Alert.Level.fatal,description:ae(j)}}),"send"in L||(L.send=!0),"alert"in L||(L.alert={level:a.Alert.Level.fatal,description:ae(L.error)}),C.error(C,L)}return!C.fail},a.createSessionCache=function(C,M){var O=null;if(C&&C.getSession&&C.setSession&&C.order)O=C;else{O={},O.cache=C||{},O.capacity=Math.max(M||100,1),O.order=[];for(var m in C)O.order.length<=M?O.order.push(m):delete C[m];O.getSession=function(L){var j=null,q=null;if(L?q=r.util.bytesToHex(L):O.order.length>0&&(q=O.order[0]),q!==null&&q in O.cache){j=O.cache[q],delete O.cache[q];for(var ee in O.order)if(O.order[ee]===q){O.order.splice(ee,1);break}}return j},O.setSession=function(L,j){if(O.order.length===O.capacity){var q=O.order.shift();delete O.cache[q]}var q=r.util.bytesToHex(L);O.order.push(q),O.cache[q]=j}}return O},a.createConnection=function(C){var M=null;C.caStore?r.util.isArray(C.caStore)?M=r.pki.createCaStore(C.caStore):M=C.caStore:M=r.pki.createCaStore();var O=C.cipherSuites||null;if(O===null){O=[];for(var m in a.CipherSuites)O.push(a.CipherSuites[m])}var L=C.server?a.ConnectionEnd.server:a.ConnectionEnd.client,j=C.sessionCache?a.createSessionCache(C.sessionCache):null,q={version:{major:a.Version.major,minor:a.Version.minor},entity:L,sessionId:C.sessionId,caStore:M,sessionCache:j,cipherSuites:O,connected:C.connected,virtualHost:C.virtualHost||null,verifyClient:C.verifyClient||!1,verify:C.verify||function(Y,ce,ve,De){return ce},verifyOptions:C.verifyOptions||{},getCertificate:C.getCertificate||null,getPrivateKey:C.getPrivateKey||null,getSignature:C.getSignature||null,input:r.util.createBuffer(),tlsData:r.util.createBuffer(),data:r.util.createBuffer(),tlsDataReady:C.tlsDataReady,dataReady:C.dataReady,heartbeatReceived:C.heartbeatReceived,closed:C.closed,error:function(Y,ce){ce.origin=ce.origin||(Y.entity===a.ConnectionEnd.client?"client":"server"),ce.send&&(a.queue(Y,a.createAlert(Y,ce.alert)),a.flush(Y));var ve=ce.fatal!==!1;ve&&(Y.fail=!0),C.error(Y,ce),ve&&Y.close(!1)},deflate:C.deflate||null,inflate:C.inflate||null};q.reset=function(Y){q.version={major:a.Version.major,minor:a.Version.minor},q.record=null,q.session=null,q.peerCertificate=null,q.state={pending:null,current:null},q.expect=q.entity===a.ConnectionEnd.client?f:d,q.fragmented=null,q.records=[],q.open=!1,q.handshakes=0,q.handshaking=!1,q.isConnected=!1,q.fail=!(Y||typeof Y>"u"),q.input.clear(),q.tlsData.clear(),q.data.clear(),q.state.current=a.createConnectionState(q)},q.reset();var ee=function(Y,ce){var ve=ce.type-a.ContentType.change_cipher_spec,De=H[Y.entity][Y.expect];ve in De?De[ve](Y,ce):a.handleUnexpected(Y,ce)},le=function(Y){var ce=0,ve=Y.input,De=ve.length();if(De<5)ce=5-De;else{Y.record={type:ve.getByte(),version:{major:ve.getByte(),minor:ve.getByte()},length:ve.getInt16(),fragment:r.util.createBuffer(),ready:!1};var Ce=Y.record.version.major===Y.version.major;Ce&&Y.session&&Y.session.version&&(Ce=Y.record.version.minor===Y.version.minor),Ce||Y.error(Y,{message:"Incompatible TLS version.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}})}return ce},ge=function(Y){var ce=0,ve=Y.input,De=ve.length();if(De<Y.record.length)ce=Y.record.length-De;else{Y.record.fragment.putBytes(ve.getBytes(Y.record.length)),ve.compact();var Ce=Y.state.current.read;Ce.update(Y,Y.record)&&(Y.fragmented!==null&&(Y.fragmented.type===Y.record.type?(Y.fragmented.fragment.putBuffer(Y.record.fragment),Y.record=Y.fragmented):Y.error(Y,{message:"Invalid fragmented record.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unexpected_message}})),Y.record.ready=!0)}return ce};return q.handshake=function(Y){if(q.entity!==a.ConnectionEnd.client)q.error(q,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(q.handshaking)q.error(q,{message:"Handshake already in progress.",fatal:!1});else{q.fail&&!q.open&&q.handshakes===0&&(q.fail=!1),q.handshaking=!0,Y=Y||"";var ce=null;Y.length>0&&(q.sessionCache&&(ce=q.sessionCache.getSession(Y)),ce===null&&(Y="")),Y.length===0&&q.sessionCache&&(ce=q.sessionCache.getSession(),ce!==null&&(Y=ce.id)),q.session={id:Y,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:r.md.md5.create(),sha1:r.md.sha1.create()},ce&&(q.version=ce.version,q.session.sp=ce.sp),q.session.sp.client_random=a.createRandom().getBytes(),q.open=!0,a.queue(q,a.createRecord(q,{type:a.ContentType.handshake,data:a.createClientHello(q)})),a.flush(q)}},q.process=function(Y){var ce=0;return Y&&q.input.putBytes(Y),q.fail||(q.record!==null&&q.record.ready&&q.record.fragment.isEmpty()&&(q.record=null),q.record===null&&(ce=le(q)),!q.fail&&q.record!==null&&!q.record.ready&&(ce=ge(q)),!q.fail&&q.record!==null&&q.record.ready&&ee(q,q.record)),ce},q.prepare=function(Y){return a.queue(q,a.createRecord(q,{type:a.ContentType.application_data,data:r.util.createBuffer(Y)})),a.flush(q)},q.prepareHeartbeatRequest=function(Y,ce){return Y instanceof r.util.ByteBuffer&&(Y=Y.bytes()),typeof ce>"u"&&(ce=Y.length),q.expectedHeartbeatPayload=Y,a.queue(q,a.createRecord(q,{type:a.ContentType.heartbeat,data:a.createHeartbeat(a.HeartbeatMessageType.heartbeat_request,Y,ce)})),a.flush(q)},q.close=function(Y){if(!q.fail&&q.sessionCache&&q.session){var ce={id:q.session.id,version:q.session.version,sp:q.session.sp};ce.sp.keys=null,q.sessionCache.setSession(ce.id,ce)}q.open&&(q.open=!1,q.input.clear(),(q.isConnected||q.handshaking)&&(q.isConnected=q.handshaking=!1,a.queue(q,a.createAlert(q,{level:a.Alert.Level.warning,description:a.Alert.Description.close_notify})),a.flush(q)),q.closed(q)),q.reset(Y)},q},Ao=r.tls=r.tls||{};for(var be in a)typeof a[be]!="function"&&(r.tls[be]=a[be]);return r.tls.prf_tls1=e,r.tls.hmac_sha1=t,r.tls.createSessionCache=a.createSessionCache,r.tls.createConnection=a.createConnection,Ao}var Xh;function x1(){if(Xh)return eo.exports;Xh=1;var r=Ne();xn(),Wp();var e=eo.exports=r.tls;e.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(f){f.bulk_cipher_algorithm=e.BulkCipherAlgorithm.aes,f.cipher_type=e.CipherType.block,f.enc_key_length=16,f.block_length=16,f.fixed_iv_length=16,f.record_iv_length=16,f.mac_algorithm=e.MACAlgorithm.hmac_sha1,f.mac_length=20,f.mac_key_length=20},initConnectionState:t},e.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(f){f.bulk_cipher_algorithm=e.BulkCipherAlgorithm.aes,f.cipher_type=e.CipherType.block,f.enc_key_length=32,f.block_length=16,f.fixed_iv_length=16,f.record_iv_length=16,f.mac_algorithm=e.MACAlgorithm.hmac_sha1,f.mac_length=20,f.mac_key_length=20},initConnectionState:t};function t(f,l,g){var w=l.entity===r.tls.ConnectionEnd.client;f.read.cipherState={init:!1,cipher:r.cipher.createDecipher("AES-CBC",w?g.keys.server_write_key:g.keys.client_write_key),iv:w?g.keys.server_write_IV:g.keys.client_write_IV},f.write.cipherState={init:!1,cipher:r.cipher.createCipher("AES-CBC",w?g.keys.client_write_key:g.keys.server_write_key),iv:w?g.keys.client_write_IV:g.keys.server_write_IV},f.read.cipherFunction=o,f.write.cipherFunction=n,f.read.macLength=f.write.macLength=g.mac_length,f.read.macFunction=f.write.macFunction=e.hmac_sha1}function n(f,l){var g=!1,w=l.macFunction(l.macKey,l.sequenceNumber,f);f.fragment.putBytes(w),l.updateSequenceNumber();var y;f.version.minor===e.Versions.TLS_1_0.minor?y=l.cipherState.init?null:l.cipherState.iv:y=r.random.getBytesSync(16),l.cipherState.init=!0;var p=l.cipherState.cipher;return p.start({iv:y}),f.version.minor>=e.Versions.TLS_1_1.minor&&p.output.putBytes(y),p.update(f.fragment),p.finish(i)&&(f.fragment=p.output,f.length=f.fragment.length(),g=!0),g}function i(f,l,g){if(!g){var w=f-l.length()%f;l.fillWithByte(w-1,w)}return!0}function s(f,l,g){var w=!0;if(g){for(var y=l.length(),p=l.last(),I=y-1-p;I<y-1;++I)w=w&&l.at(I)==p;w&&l.truncate(p+1)}return w}function o(f,l){var g=!1,w;f.version.minor===e.Versions.TLS_1_0.minor?w=l.cipherState.init?null:l.cipherState.iv:w=f.fragment.getBytes(16),l.cipherState.init=!0;var y=l.cipherState.cipher;y.start({iv:w}),y.update(f.fragment),g=y.finish(s);var p=l.macLength,I=r.random.getBytesSync(p),S=y.output.length();S>=p?(f.fragment=y.output.getBytes(S-p),I=y.output.getBytes(p)):f.fragment=y.output.getBytes(),f.fragment=r.util.createBuffer(f.fragment),f.length=f.fragment.length();var A=l.macFunction(l.macKey,l.sequenceNumber,f);return l.updateSequenceNumber(),g=a(l.macKey,I,A)&&g,g}function a(f,l,g){var w=r.hmac.create();return w.start("SHA1",f),w.update(l),l=w.digest().getBytes(),w.start(null,null),w.update(g),g=w.digest().getBytes(),l===g}return eo.exports}var xo={exports:{}},Jh;function Qp(){if(Jh)return xo.exports;Jh=1;var r=Ne();qr(),Ke();var e=xo.exports=r.sha512=r.sha512||{};r.md.sha512=r.md.algorithms.sha512=e;var t=r.sha384=r.sha512.sha384=r.sha512.sha384||{};t.create=function(){return e.create("SHA-384")},r.md.sha384=r.md.algorithms.sha384=t,r.sha512.sha256=r.sha512.sha256||{create:function(){return e.create("SHA-512/256")}},r.md["sha512/256"]=r.md.algorithms["sha512/256"]=r.sha512.sha256,r.sha512.sha224=r.sha512.sha224||{create:function(){return e.create("SHA-512/224")}},r.md["sha512/224"]=r.md.algorithms["sha512/224"]=r.sha512.sha224,e.create=function(l){if(i||a(),typeof l>"u"&&(l="SHA-512"),!(l in o))throw new Error("Invalid SHA-512 algorithm: "+l);for(var g=o[l],w=null,y=r.util.createBuffer(),p=new Array(80),I=0;I<80;++I)p[I]=new Array(2);var S=64;switch(l){case"SHA-384":S=48;break;case"SHA-512/256":S=32;break;case"SHA-512/224":S=28;break}var A={algorithm:l.replace("-","").toLowerCase(),blockLength:128,digestLength:S,messageLength:0,fullMessageLength:null,messageLengthSize:16};return A.start=function(){A.messageLength=0,A.fullMessageLength=A.messageLength128=[];for(var d=A.messageLengthSize/4,T=0;T<d;++T)A.fullMessageLength.push(0);y=r.util.createBuffer(),w=new Array(g.length);for(var T=0;T<g.length;++T)w[T]=g[T].slice(0);return A},A.start(),A.update=function(d,T){T==="utf8"&&(d=r.util.encodeUtf8(d));var x=d.length;A.messageLength+=x,x=[x/4294967296>>>0,x>>>0];for(var k=A.fullMessageLength.length-1;k>=0;--k)A.fullMessageLength[k]+=x[1],x[1]=x[0]+(A.fullMessageLength[k]/4294967296>>>0),A.fullMessageLength[k]=A.fullMessageLength[k]>>>0,x[0]=x[1]/4294967296>>>0;return y.putBytes(d),f(w,p,y),(y.read>2048||y.length()===0)&&y.compact(),A},A.digest=function(){var d=r.util.createBuffer();d.putBytes(y.bytes());var T=A.fullMessageLength[A.fullMessageLength.length-1]+A.messageLengthSize,x=T&A.blockLength-1;d.putBytes(n.substr(0,A.blockLength-x));for(var k,U,_=A.fullMessageLength[0]*8,h=0;h<A.fullMessageLength.length-1;++h)k=A.fullMessageLength[h+1]*8,U=k/4294967296>>>0,_+=U,d.putInt32(_>>>0),_=k>>>0;d.putInt32(_);for(var c=new Array(w.length),h=0;h<w.length;++h)c[h]=w[h].slice(0);f(c,p,d);var v=r.util.createBuffer(),b;l==="SHA-512"?b=c.length:l==="SHA-384"?b=c.length-2:b=c.length-4;for(var h=0;h<b;++h)v.putInt32(c[h][0]),(h!==b-1||l!=="SHA-512/224")&&v.putInt32(c[h][1]);return v},A};var n=null,i=!1,s=null,o=null;function a(){n="",n+=r.util.fillString("\0",128),s=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],o={},o["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],o["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],o["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],o["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],i=!0}function f(l,g,w){for(var y,p,I,S,A,d,T,x,k,U,_,h,c,v,b,B,R,P,H,z,W,te,ne,oe,me,Se,xe,we,ie,Te,ae,ut,be,C,M,O=w.length();O>=128;){for(ie=0;ie<16;++ie)g[ie][0]=w.getInt32()>>>0,g[ie][1]=w.getInt32()>>>0;for(;ie<80;++ie)ut=g[ie-2],Te=ut[0],ae=ut[1],y=((Te>>>19|ae<<13)^(ae>>>29|Te<<3)^Te>>>6)>>>0,p=((Te<<13|ae>>>19)^(ae<<3|Te>>>29)^(Te<<26|ae>>>6))>>>0,C=g[ie-15],Te=C[0],ae=C[1],I=((Te>>>1|ae<<31)^(Te>>>8|ae<<24)^Te>>>7)>>>0,S=((Te<<31|ae>>>1)^(Te<<24|ae>>>8)^(Te<<25|ae>>>7))>>>0,be=g[ie-7],M=g[ie-16],ae=p+be[1]+S+M[1],g[ie][0]=y+be[0]+I+M[0]+(ae/4294967296>>>0)>>>0,g[ie][1]=ae>>>0;for(c=l[0][0],v=l[0][1],b=l[1][0],B=l[1][1],R=l[2][0],P=l[2][1],H=l[3][0],z=l[3][1],W=l[4][0],te=l[4][1],ne=l[5][0],oe=l[5][1],me=l[6][0],Se=l[6][1],xe=l[7][0],we=l[7][1],ie=0;ie<80;++ie)T=((W>>>14|te<<18)^(W>>>18|te<<14)^(te>>>9|W<<23))>>>0,x=((W<<18|te>>>14)^(W<<14|te>>>18)^(te<<23|W>>>9))>>>0,k=(me^W&(ne^me))>>>0,U=(Se^te&(oe^Se))>>>0,A=((c>>>28|v<<4)^(v>>>2|c<<30)^(v>>>7|c<<25))>>>0,d=((c<<4|v>>>28)^(v<<30|c>>>2)^(v<<25|c>>>7))>>>0,_=(c&b|R&(c^b))>>>0,h=(v&B|P&(v^B))>>>0,ae=we+x+U+s[ie][1]+g[ie][1],y=xe+T+k+s[ie][0]+g[ie][0]+(ae/4294967296>>>0)>>>0,p=ae>>>0,ae=d+h,I=A+_+(ae/4294967296>>>0)>>>0,S=ae>>>0,xe=me,we=Se,me=ne,Se=oe,ne=W,oe=te,ae=z+p,W=H+y+(ae/4294967296>>>0)>>>0,te=ae>>>0,H=R,z=P,R=b,P=B,b=c,B=v,ae=p+S,c=y+I+(ae/4294967296>>>0)>>>0,v=ae>>>0;ae=l[0][1]+v,l[0][0]=l[0][0]+c+(ae/4294967296>>>0)>>>0,l[0][1]=ae>>>0,ae=l[1][1]+B,l[1][0]=l[1][0]+b+(ae/4294967296>>>0)>>>0,l[1][1]=ae>>>0,ae=l[2][1]+P,l[2][0]=l[2][0]+R+(ae/4294967296>>>0)>>>0,l[2][1]=ae>>>0,ae=l[3][1]+z,l[3][0]=l[3][0]+H+(ae/4294967296>>>0)>>>0,l[3][1]=ae>>>0,ae=l[4][1]+te,l[4][0]=l[4][0]+W+(ae/4294967296>>>0)>>>0,l[4][1]=ae>>>0,ae=l[5][1]+oe,l[5][0]=l[5][0]+ne+(ae/4294967296>>>0)>>>0,l[5][1]=ae>>>0,ae=l[6][1]+Se,l[6][0]=l[6][0]+me+(ae/4294967296>>>0)>>>0,l[6][1]=ae>>>0,ae=l[7][1]+we,l[7][0]=l[7][0]+xe+(ae/4294967296>>>0)>>>0,l[7][1]=ae>>>0,O-=128}}return xo.exports}var Ts={},Zh;function w1(){if(Zh)return Ts;Zh=1;var r=Ne();Ir();var e=r.asn1;return Ts.privateKeyValidator={name:"PrivateKeyInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},Ts.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]},Ts}var wo,ef;function b1(){if(ef)return wo;ef=1;var r=Ne();Aa(),pr(),Qp(),Ke();var e=w1(),t=e.publicKeyValidator,n=e.privateKeyValidator;if(typeof i>"u")var i=r.jsbn.BigInteger;var s=r.util.ByteBuffer,o=typeof Buffer>"u"?Uint8Array:Buffer;r.pki=r.pki||{},wo=r.pki.ed25519=r.ed25519=r.ed25519||{};var a=r.ed25519;a.constants={},a.constants.PUBLIC_KEY_BYTE_LENGTH=32,a.constants.PRIVATE_KEY_BYTE_LENGTH=64,a.constants.SEED_BYTE_LENGTH=32,a.constants.SIGN_BYTE_LENGTH=64,a.constants.HASH_BYTE_LENGTH=64,a.generateKeyPair=function(C){C=C||{};var M=C.seed;if(M===void 0)M=r.random.getBytesSync(a.constants.SEED_BYTE_LENGTH);else if(typeof M=="string"){if(M.length!==a.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+a.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(M instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');M=f({message:M,encoding:"binary"});for(var O=new o(a.constants.PUBLIC_KEY_BYTE_LENGTH),m=new o(a.constants.PRIVATE_KEY_BYTE_LENGTH),L=0;L<32;++L)m[L]=M[L];return T(O,m),{publicKey:O,privateKey:m}},a.privateKeyFromAsn1=function(C){var M={},O=[],m=r.asn1.validate(C,n,M,O);if(!m){var L=new Error("Invalid Key.");throw L.errors=O,L}var j=r.asn1.derToOid(M.privateKeyOid),q=r.oids.EdDSA25519;if(j!==q)throw new Error('Invalid OID "'+j+'"; OID must be "'+q+'".');var ee=M.privateKey,le=f({message:r.asn1.fromDer(ee).value,encoding:"binary"});return{privateKeyBytes:le}},a.publicKeyFromAsn1=function(C){var M={},O=[],m=r.asn1.validate(C,t,M,O);if(!m){var L=new Error("Invalid Key.");throw L.errors=O,L}var j=r.asn1.derToOid(M.publicKeyOid),q=r.oids.EdDSA25519;if(j!==q)throw new Error('Invalid OID "'+j+'"; OID must be "'+q+'".');var ee=M.ed25519PublicKey;if(ee.length!==a.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return f({message:ee,encoding:"binary"})},a.publicKeyFromPrivateKey=function(C){C=C||{};var M=f({message:C.privateKey,encoding:"binary"});if(M.length!==a.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+a.constants.PRIVATE_KEY_BYTE_LENGTH);for(var O=new o(a.constants.PUBLIC_KEY_BYTE_LENGTH),m=0;m<O.length;++m)O[m]=M[32+m];return O},a.sign=function(C){C=C||{};var M=f(C),O=f({message:C.privateKey,encoding:"binary"});if(O.length===a.constants.SEED_BYTE_LENGTH){var m=a.generateKeyPair({seed:O});O=m.privateKey}else if(O.length!==a.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+a.constants.SEED_BYTE_LENGTH+" or "+a.constants.PRIVATE_KEY_BYTE_LENGTH);var L=new o(a.constants.SIGN_BYTE_LENGTH+M.length);x(L,M,M.length,O);for(var j=new o(a.constants.SIGN_BYTE_LENGTH),q=0;q<j.length;++q)j[q]=L[q];return j},a.verify=function(C){C=C||{};var M=f(C);if(C.signature===void 0)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var O=f({message:C.signature,encoding:"binary"});if(O.length!==a.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+a.constants.SIGN_BYTE_LENGTH);var m=f({message:C.publicKey,encoding:"binary"});if(m.length!==a.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+a.constants.PUBLIC_KEY_BYTE_LENGTH);var L=new o(a.constants.SIGN_BYTE_LENGTH+M.length),j=new o(a.constants.SIGN_BYTE_LENGTH+M.length),q;for(q=0;q<a.constants.SIGN_BYTE_LENGTH;++q)L[q]=O[q];for(q=0;q<M.length;++q)L[q+a.constants.SIGN_BYTE_LENGTH]=M[q];return k(j,L,L.length,m)>=0};function f(C){var M=C.message;if(M instanceof Uint8Array||M instanceof o)return M;var O=C.encoding;if(M===void 0)if(C.md)M=C.md.digest().getBytes(),O="binary";else throw new TypeError('"options.message" or "options.md" not specified.');if(typeof M=="string"&&!O)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if(typeof M=="string"){if(typeof Buffer<"u")return Buffer.from(M,O);M=new s(M,O)}else if(!(M instanceof s))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var m=new o(M.length()),L=0;L<m.length;++L)m[L]=M.at(L);return m}var l=ie(),g=ie([1]),w=ie([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=ie([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),p=ie([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),I=ie([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),S=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),A=ie([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function d(C,M){var O=r.md.sha512.create(),m=new s(C);O.update(m.getBytes(M),"binary");var L=O.digest().getBytes();if(typeof Buffer<"u")return Buffer.from(L,"binary");for(var j=new o(a.constants.HASH_BYTE_LENGTH),q=0;q<64;++q)j[q]=L.charCodeAt(q);return j}function T(C,M){var O=[ie(),ie(),ie(),ie()],m,L=d(M,32);for(L[0]&=248,L[31]&=127,L[31]|=64,oe(O,L),v(C,O),m=0;m<32;++m)M[m+32]=C[m];return 0}function x(C,M,O,m){var L,j,q=new Float64Array(64),ee=[ie(),ie(),ie(),ie()],le=d(m,32);le[0]&=248,le[31]&=127,le[31]|=64;var ge=O+64;for(L=0;L<O;++L)C[64+L]=M[L];for(L=0;L<32;++L)C[32+L]=le[32+L];var Y=d(C.subarray(32),O+32);for(_(Y),oe(ee,Y),v(C,ee),L=32;L<64;++L)C[L]=m[L];var ce=d(C,O+64);for(_(ce),L=32;L<64;++L)q[L]=0;for(L=0;L<32;++L)q[L]=Y[L];for(L=0;L<32;++L)for(j=0;j<32;j++)q[L+j]+=ce[L]*le[j];return U(C.subarray(32),q),ge}function k(C,M,O,m){var L,j,q=new o(32),ee=[ie(),ie(),ie(),ie()],le=[ie(),ie(),ie(),ie()];if(j=-1,O<64||B(le,m))return-1;for(L=0;L<O;++L)C[L]=M[L];for(L=0;L<32;++L)C[L+32]=m[L];var ge=d(C,O);if(_(ge),ne(ee,le,ge),oe(le,M.subarray(32)),h(ee,le),v(q,ee),O-=64,z(M,0,q,0)){for(L=0;L<O;++L)C[L]=0;return-1}for(L=0;L<O;++L)C[L]=M[L+64];return j=O,j}function U(C,M){var O,m,L,j;for(m=63;m>=32;--m){for(O=0,L=m-32,j=m-12;L<j;++L)M[L]+=O-16*M[m]*S[L-(m-32)],O=M[L]+128>>8,M[L]-=O*256;M[L]+=O,M[m]=0}for(O=0,L=0;L<32;++L)M[L]+=O-(M[31]>>4)*S[L],O=M[L]>>8,M[L]&=255;for(L=0;L<32;++L)M[L]-=O*S[L];for(m=0;m<32;++m)M[m+1]+=M[m]>>8,C[m]=M[m]&255}function _(C){for(var M=new Float64Array(64),O=0;O<64;++O)M[O]=C[O],C[O]=0;U(C,M)}function h(C,M){var O=ie(),m=ie(),L=ie(),j=ie(),q=ie(),ee=ie(),le=ie(),ge=ie(),Y=ie();ae(O,C[1],C[0]),ae(Y,M[1],M[0]),be(O,O,Y),Te(m,C[0],C[1]),Te(Y,M[0],M[1]),be(m,m,Y),be(L,C[3],M[3]),be(L,L,y),be(j,C[2],M[2]),Te(j,j,j),ae(q,m,O),ae(ee,j,L),Te(le,j,L),Te(ge,m,O),be(C[0],q,ee),be(C[1],ge,le),be(C[2],le,ee),be(C[3],q,ge)}function c(C,M,O){for(var m=0;m<4;++m)we(C[m],M[m],O)}function v(C,M){var O=ie(),m=ie(),L=ie();Se(L,M[2]),be(O,M[0],L),be(m,M[1],L),b(C,m),C[31]^=te(O)<<7}function b(C,M){var O,m,L,j=ie(),q=ie();for(O=0;O<16;++O)q[O]=M[O];for(xe(q),xe(q),xe(q),m=0;m<2;++m){for(j[0]=q[0]-65517,O=1;O<15;++O)j[O]=q[O]-65535-(j[O-1]>>16&1),j[O-1]&=65535;j[15]=q[15]-32767-(j[14]>>16&1),L=j[15]>>16&1,j[14]&=65535,we(q,j,1-L)}for(O=0;O<16;O++)C[2*O]=q[O]&255,C[2*O+1]=q[O]>>8}function B(C,M){var O=ie(),m=ie(),L=ie(),j=ie(),q=ie(),ee=ie(),le=ie();return me(C[2],g),R(C[1],M),ut(L,C[1]),be(j,L,w),ae(L,L,C[2]),Te(j,C[2],j),ut(q,j),ut(ee,q),be(le,ee,q),be(O,le,L),be(O,O,j),P(O,O),be(O,O,L),be(O,O,j),be(O,O,j),be(C[0],O,j),ut(m,C[0]),be(m,m,j),H(m,L)&&be(C[0],C[0],A),ut(m,C[0]),be(m,m,j),H(m,L)?-1:(te(C[0])===M[31]>>7&&ae(C[0],l,C[0]),be(C[3],C[0],C[1]),0)}function R(C,M){var O;for(O=0;O<16;++O)C[O]=M[2*O]+(M[2*O+1]<<8);C[15]&=32767}function P(C,M){var O=ie(),m;for(m=0;m<16;++m)O[m]=M[m];for(m=250;m>=0;--m)ut(O,O),m!==1&&be(O,O,M);for(m=0;m<16;++m)C[m]=O[m]}function H(C,M){var O=new o(32),m=new o(32);return b(O,C),b(m,M),z(O,0,m,0)}function z(C,M,O,m){return W(C,M,O,m,32)}function W(C,M,O,m,L){var j,q=0;for(j=0;j<L;++j)q|=C[M+j]^O[m+j];return(1&q-1>>>8)-1}function te(C){var M=new o(32);return b(M,C),M[0]&1}function ne(C,M,O){var m,L;for(me(C[0],l),me(C[1],g),me(C[2],g),me(C[3],l),L=255;L>=0;--L)m=O[L/8|0]>>(L&7)&1,c(C,M,m),h(M,C),h(C,C),c(C,M,m)}function oe(C,M){var O=[ie(),ie(),ie(),ie()];me(O[0],p),me(O[1],I),me(O[2],g),be(O[3],p,I),ne(C,O,M)}function me(C,M){var O;for(O=0;O<16;O++)C[O]=M[O]|0}function Se(C,M){var O=ie(),m;for(m=0;m<16;++m)O[m]=M[m];for(m=253;m>=0;--m)ut(O,O),m!==2&&m!==4&&be(O,O,M);for(m=0;m<16;++m)C[m]=O[m]}function xe(C){var M,O,m=1;for(M=0;M<16;++M)O=C[M]+m+65535,m=Math.floor(O/65536),C[M]=O-m*65536;C[0]+=m-1+37*(m-1)}function we(C,M,O){for(var m,L=~(O-1),j=0;j<16;++j)m=L&(C[j]^M[j]),C[j]^=m,M[j]^=m}function ie(C){var M,O=new Float64Array(16);if(C)for(M=0;M<C.length;++M)O[M]=C[M];return O}function Te(C,M,O){for(var m=0;m<16;++m)C[m]=M[m]+O[m]}function ae(C,M,O){for(var m=0;m<16;++m)C[m]=M[m]-O[m]}function ut(C,M){be(C,M,M)}function be(C,M,O){var m,L,j=0,q=0,ee=0,le=0,ge=0,Y=0,ce=0,ve=0,De=0,Ce=0,$e=0,tt=0,Pe=0,Be=0,Ge=0,We=0,rt=0,Ct=0,nt=0,wt=0,bt=0,Pt=0,Gt=0,Zt=0,zt=0,ar=0,cr=0,er=0,gr=0,Sr=0,or=0,ct=O[0],it=O[1],lt=O[2],Xe=O[3],ht=O[4],Oe=O[5],ft=O[6],Je=O[7],Ze=O[8],vt=O[9],_t=O[10],Qe=O[11],et=O[12],dt=O[13],st=O[14],pt=O[15];m=M[0],j+=m*ct,q+=m*it,ee+=m*lt,le+=m*Xe,ge+=m*ht,Y+=m*Oe,ce+=m*ft,ve+=m*Je,De+=m*Ze,Ce+=m*vt,$e+=m*_t,tt+=m*Qe,Pe+=m*et,Be+=m*dt,Ge+=m*st,We+=m*pt,m=M[1],q+=m*ct,ee+=m*it,le+=m*lt,ge+=m*Xe,Y+=m*ht,ce+=m*Oe,ve+=m*ft,De+=m*Je,Ce+=m*Ze,$e+=m*vt,tt+=m*_t,Pe+=m*Qe,Be+=m*et,Ge+=m*dt,We+=m*st,rt+=m*pt,m=M[2],ee+=m*ct,le+=m*it,ge+=m*lt,Y+=m*Xe,ce+=m*ht,ve+=m*Oe,De+=m*ft,Ce+=m*Je,$e+=m*Ze,tt+=m*vt,Pe+=m*_t,Be+=m*Qe,Ge+=m*et,We+=m*dt,rt+=m*st,Ct+=m*pt,m=M[3],le+=m*ct,ge+=m*it,Y+=m*lt,ce+=m*Xe,ve+=m*ht,De+=m*Oe,Ce+=m*ft,$e+=m*Je,tt+=m*Ze,Pe+=m*vt,Be+=m*_t,Ge+=m*Qe,We+=m*et,rt+=m*dt,Ct+=m*st,nt+=m*pt,m=M[4],ge+=m*ct,Y+=m*it,ce+=m*lt,ve+=m*Xe,De+=m*ht,Ce+=m*Oe,$e+=m*ft,tt+=m*Je,Pe+=m*Ze,Be+=m*vt,Ge+=m*_t,We+=m*Qe,rt+=m*et,Ct+=m*dt,nt+=m*st,wt+=m*pt,m=M[5],Y+=m*ct,ce+=m*it,ve+=m*lt,De+=m*Xe,Ce+=m*ht,$e+=m*Oe,tt+=m*ft,Pe+=m*Je,Be+=m*Ze,Ge+=m*vt,We+=m*_t,rt+=m*Qe,Ct+=m*et,nt+=m*dt,wt+=m*st,bt+=m*pt,m=M[6],ce+=m*ct,ve+=m*it,De+=m*lt,Ce+=m*Xe,$e+=m*ht,tt+=m*Oe,Pe+=m*ft,Be+=m*Je,Ge+=m*Ze,We+=m*vt,rt+=m*_t,Ct+=m*Qe,nt+=m*et,wt+=m*dt,bt+=m*st,Pt+=m*pt,m=M[7],ve+=m*ct,De+=m*it,Ce+=m*lt,$e+=m*Xe,tt+=m*ht,Pe+=m*Oe,Be+=m*ft,Ge+=m*Je,We+=m*Ze,rt+=m*vt,Ct+=m*_t,nt+=m*Qe,wt+=m*et,bt+=m*dt,Pt+=m*st,Gt+=m*pt,m=M[8],De+=m*ct,Ce+=m*it,$e+=m*lt,tt+=m*Xe,Pe+=m*ht,Be+=m*Oe,Ge+=m*ft,We+=m*Je,rt+=m*Ze,Ct+=m*vt,nt+=m*_t,wt+=m*Qe,bt+=m*et,Pt+=m*dt,Gt+=m*st,Zt+=m*pt,m=M[9],Ce+=m*ct,$e+=m*it,tt+=m*lt,Pe+=m*Xe,Be+=m*ht,Ge+=m*Oe,We+=m*ft,rt+=m*Je,Ct+=m*Ze,nt+=m*vt,wt+=m*_t,bt+=m*Qe,Pt+=m*et,Gt+=m*dt,Zt+=m*st,zt+=m*pt,m=M[10],$e+=m*ct,tt+=m*it,Pe+=m*lt,Be+=m*Xe,Ge+=m*ht,We+=m*Oe,rt+=m*ft,Ct+=m*Je,nt+=m*Ze,wt+=m*vt,bt+=m*_t,Pt+=m*Qe,Gt+=m*et,Zt+=m*dt,zt+=m*st,ar+=m*pt,m=M[11],tt+=m*ct,Pe+=m*it,Be+=m*lt,Ge+=m*Xe,We+=m*ht,rt+=m*Oe,Ct+=m*ft,nt+=m*Je,wt+=m*Ze,bt+=m*vt,Pt+=m*_t,Gt+=m*Qe,Zt+=m*et,zt+=m*dt,ar+=m*st,cr+=m*pt,m=M[12],Pe+=m*ct,Be+=m*it,Ge+=m*lt,We+=m*Xe,rt+=m*ht,Ct+=m*Oe,nt+=m*ft,wt+=m*Je,bt+=m*Ze,Pt+=m*vt,Gt+=m*_t,Zt+=m*Qe,zt+=m*et,ar+=m*dt,cr+=m*st,er+=m*pt,m=M[13],Be+=m*ct,Ge+=m*it,We+=m*lt,rt+=m*Xe,Ct+=m*ht,nt+=m*Oe,wt+=m*ft,bt+=m*Je,Pt+=m*Ze,Gt+=m*vt,Zt+=m*_t,zt+=m*Qe,ar+=m*et,cr+=m*dt,er+=m*st,gr+=m*pt,m=M[14],Ge+=m*ct,We+=m*it,rt+=m*lt,Ct+=m*Xe,nt+=m*ht,wt+=m*Oe,bt+=m*ft,Pt+=m*Je,Gt+=m*Ze,Zt+=m*vt,zt+=m*_t,ar+=m*Qe,cr+=m*et,er+=m*dt,gr+=m*st,Sr+=m*pt,m=M[15],We+=m*ct,rt+=m*it,Ct+=m*lt,nt+=m*Xe,wt+=m*ht,bt+=m*Oe,Pt+=m*ft,Gt+=m*Je,Zt+=m*Ze,zt+=m*vt,ar+=m*_t,cr+=m*Qe,er+=m*et,gr+=m*dt,Sr+=m*st,or+=m*pt,j+=38*rt,q+=38*Ct,ee+=38*nt,le+=38*wt,ge+=38*bt,Y+=38*Pt,ce+=38*Gt,ve+=38*Zt,De+=38*zt,Ce+=38*ar,$e+=38*cr,tt+=38*er,Pe+=38*gr,Be+=38*Sr,Ge+=38*or,L=1,m=j+L+65535,L=Math.floor(m/65536),j=m-L*65536,m=q+L+65535,L=Math.floor(m/65536),q=m-L*65536,m=ee+L+65535,L=Math.floor(m/65536),ee=m-L*65536,m=le+L+65535,L=Math.floor(m/65536),le=m-L*65536,m=ge+L+65535,L=Math.floor(m/65536),ge=m-L*65536,m=Y+L+65535,L=Math.floor(m/65536),Y=m-L*65536,m=ce+L+65535,L=Math.floor(m/65536),ce=m-L*65536,m=ve+L+65535,L=Math.floor(m/65536),ve=m-L*65536,m=De+L+65535,L=Math.floor(m/65536),De=m-L*65536,m=Ce+L+65535,L=Math.floor(m/65536),Ce=m-L*65536,m=$e+L+65535,L=Math.floor(m/65536),$e=m-L*65536,m=tt+L+65535,L=Math.floor(m/65536),tt=m-L*65536,m=Pe+L+65535,L=Math.floor(m/65536),Pe=m-L*65536,m=Be+L+65535,L=Math.floor(m/65536),Be=m-L*65536,m=Ge+L+65535,L=Math.floor(m/65536),Ge=m-L*65536,m=We+L+65535,L=Math.floor(m/65536),We=m-L*65536,j+=L-1+37*(L-1),L=1,m=j+L+65535,L=Math.floor(m/65536),j=m-L*65536,m=q+L+65535,L=Math.floor(m/65536),q=m-L*65536,m=ee+L+65535,L=Math.floor(m/65536),ee=m-L*65536,m=le+L+65535,L=Math.floor(m/65536),le=m-L*65536,m=ge+L+65535,L=Math.floor(m/65536),ge=m-L*65536,m=Y+L+65535,L=Math.floor(m/65536),Y=m-L*65536,m=ce+L+65535,L=Math.floor(m/65536),ce=m-L*65536,m=ve+L+65535,L=Math.floor(m/65536),ve=m-L*65536,m=De+L+65535,L=Math.floor(m/65536),De=m-L*65536,m=Ce+L+65535,L=Math.floor(m/65536),Ce=m-L*65536,m=$e+L+65535,L=Math.floor(m/65536),$e=m-L*65536,m=tt+L+65535,L=Math.floor(m/65536),tt=m-L*65536,m=Pe+L+65535,L=Math.floor(m/65536),Pe=m-L*65536,m=Be+L+65535,L=Math.floor(m/65536),Be=m-L*65536,m=Ge+L+65535,L=Math.floor(m/65536),Ge=m-L*65536,m=We+L+65535,L=Math.floor(m/65536),We=m-L*65536,j+=L-1+37*(L-1),C[0]=j,C[1]=q,C[2]=ee,C[3]=le,C[4]=ge,C[5]=Y,C[6]=ce,C[7]=ve,C[8]=De,C[9]=Ce,C[10]=$e,C[11]=tt,C[12]=Pe,C[13]=Be,C[14]=Ge,C[15]=We}return wo}var bo,tf;function R1(){if(tf)return bo;tf=1;var r=Ne();Ke(),pr(),Aa(),bo=r.kem=r.kem||{};var e=r.jsbn.BigInteger;r.kem.rsa={},r.kem.rsa.create=function(n,i){i=i||{};var s=i.prng||r.random,o={};return o.encrypt=function(a,f){var l=Math.ceil(a.n.bitLength()/8),g;do g=new e(r.util.bytesToHex(s.getBytesSync(l)),16).mod(a.n);while(g.compareTo(e.ONE)<=0);g=r.util.hexToBytes(g.toString(16));var w=l-g.length;w>0&&(g=r.util.fillString("\0",w)+g);var y=a.encrypt(g,"NONE"),p=n.generate(g,f);return{encapsulation:y,key:p}},o.decrypt=function(a,f,l){var g=a.decrypt(f,"NONE");return n.generate(g,l)},o},r.kem.kdf1=function(n,i){t(this,n,0,i||n.digestLength)},r.kem.kdf2=function(n,i){t(this,n,1,i||n.digestLength)};function t(n,i,s,o){n.generate=function(a,f){for(var l=new r.util.ByteBuffer,g=Math.ceil(f/o)+s,w=new r.util.ByteBuffer,y=s;y<g;++y){w.putInt32(y),i.start(),i.update(a+w.getBytes());var p=i.digest();l.putBytes(p.getBytes(o))}return l.truncate(l.length()-f),l.getBytes()}}return bo}var Ro,rf;function N1(){if(rf)return Ro;rf=1;var r=Ne();Ke(),Ro=r.log=r.log||{},r.log.levels=["none","error","warning","info","debug","verbose","max"];var e={},t=[],n=null;r.log.LEVEL_LOCKED=2,r.log.NO_LEVEL_CHECK=4,r.log.INTERPOLATE=8;for(var i=0;i<r.log.levels.length;++i){var s=r.log.levels[i];e[s]={index:i,name:s.toUpperCase()}}r.log.logMessage=function(y){for(var p=e[y.level].index,I=0;I<t.length;++I){var S=t[I];if(S.flags&r.log.NO_LEVEL_CHECK)S.f(y);else{var A=e[S.level].index;p<=A&&S.f(S,y)}}},r.log.prepareStandard=function(y){"standard"in y||(y.standard=e[y.level].name+" ["+y.category+"] "+y.message)},r.log.prepareFull=function(y){if(!("full"in y)){var p=[y.message];p=p.concat([]),y.full=r.util.format.apply(this,p)}},r.log.prepareStandardFull=function(y){"standardFull"in y||(r.log.prepareStandard(y),y.standardFull=y.standard)};for(var o=["error","warning","info","debug","verbose"],i=0;i<o.length;++i)(function(p){r.log[p]=function(I,S){var A=Array.prototype.slice.call(arguments).slice(2),d={timestamp:new Date,level:p,category:I,message:S,arguments:A};r.log.logMessage(d)}})(o[i]);if(r.log.makeLogger=function(y){var p={flags:0,f:y};return r.log.setLevel(p,"none"),p},r.log.setLevel=function(y,p){var I=!1;if(y&&!(y.flags&r.log.LEVEL_LOCKED))for(var S=0;S<r.log.levels.length;++S){var A=r.log.levels[S];if(p==A){y.level=p,I=!0;break}}return I},r.log.lock=function(y,p){typeof p>"u"||p?y.flags|=r.log.LEVEL_LOCKED:y.flags&=~r.log.LEVEL_LOCKED},r.log.addLogger=function(y){t.push(y)},typeof console<"u"&&"log"in console){var a;if(console.error&&console.warn&&console.info&&console.debug){var f={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},l=function(y,p){r.log.prepareStandard(p);var I=f[p.level],S=[p.standard];S=S.concat(p.arguments.slice()),I.apply(console,S)};a=r.log.makeLogger(l)}else{var l=function(p,I){r.log.prepareStandardFull(I),console.log(I.standardFull)};a=r.log.makeLogger(l)}r.log.setLevel(a,"debug"),r.log.addLogger(a),n=a}else console={log:function(){}};if(n!==null&&typeof window<"u"&&window.location){var g=new URL(window.location.href).searchParams;if(g.has("console.level")&&r.log.setLevel(n,g.get("console.level").slice(-1)[0]),g.has("console.lock")){var w=g.get("console.lock").slice(-1)[0];w=="true"&&r.log.lock(n)}}return r.log.consoleLogger=n,Ro}var No,nf;function P1(){return nf||(nf=1,No=qr(),fc(),Zi(),Up(),Qp()),No}var Po={exports:{}},sf;function B1(){if(sf)return Po.exports;sf=1;var r=Ne();xn(),Ir(),Sa(),wn(),ai(),Hp(),pr(),Ke(),mc();var e=r.asn1,t=Po.exports=r.pkcs7=r.pkcs7||{};t.messageFromPem=function(p){var I=r.pem.decode(p)[0];if(I.type!=="PKCS7"){var S=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw S.headerType=I.type,S}if(I.procType&&I.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var A=e.fromDer(I.body);return t.messageFromAsn1(A)},t.messageToPem=function(p,I){var S={type:"PKCS7",body:e.toDer(p.toAsn1()).getBytes()};return r.pem.encode(S,{maxline:I})},t.messageFromAsn1=function(p){var I={},S=[];if(!e.validate(p,t.asn1.contentInfoValidator,I,S)){var A=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw A.errors=S,A}var d=e.derToOid(I.contentType),T;switch(d){case r.pki.oids.envelopedData:T=t.createEnvelopedData();break;case r.pki.oids.encryptedData:T=t.createEncryptedData();break;case r.pki.oids.signedData:T=t.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+d+" is not (yet) supported.")}return T.fromAsn1(I.content.value[0]),T},t.createSignedData=function(){var p=null;return p={type:r.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(A){if(w(p,A,t.asn1.signedDataValidator),p.certificates=[],p.crls=[],p.digestAlgorithmIdentifiers=[],p.contentInfo=null,p.signerInfos=[],p.rawCapture.certificates)for(var d=p.rawCapture.certificates.value,T=0;T<d.length;++T)p.certificates.push(r.pki.certificateFromAsn1(d[T]))},toAsn1:function(){p.contentInfo||p.sign();for(var A=[],d=0;d<p.certificates.length;++d)A.push(r.pki.certificateToAsn1(p.certificates[d]));var T=[],x=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.digestAlgorithmIdentifiers),p.contentInfo])]);return A.length>0&&x.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,A)),T.length>0&&x.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,T)),x.value[0].value.push(e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.signerInfos)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),x])},addSigner:function(A){var d=A.issuer,T=A.serialNumber;if(A.certificate){var x=A.certificate;typeof x=="string"&&(x=r.pki.certificateFromPem(x)),d=x.issuer.attributes,T=x.serialNumber}var k=A.key;if(!k)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof k=="string"&&(k=r.pki.privateKeyFromPem(k));var U=A.digestAlgorithm||r.pki.oids.sha1;switch(U){case r.pki.oids.sha1:case r.pki.oids.sha256:case r.pki.oids.sha384:case r.pki.oids.sha512:case r.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+U)}var _=A.authenticatedAttributes||[];if(_.length>0){for(var h=!1,c=!1,v=0;v<_.length;++v){var b=_[v];if(!h&&b.type===r.pki.oids.contentType){if(h=!0,c)break;continue}if(!c&&b.type===r.pki.oids.messageDigest){if(c=!0,h)break;continue}}if(!h||!c)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}p.signers.push({key:k,version:1,issuer:d,serialNumber:T,digestAlgorithm:U,signatureAlgorithm:r.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:_,unauthenticatedAttributes:[]})},sign:function(A){if(A=A||{},(typeof p.content!="object"||p.contentInfo===null)&&(p.contentInfo=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(r.pki.oids.data).getBytes())]),"content"in p)){var d;p.content instanceof r.util.ByteBuffer?d=p.content.bytes():typeof p.content=="string"&&(d=r.util.encodeUtf8(p.content)),A.detached?p.detachedContent=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,d):p.contentInfo.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,d)]))}if(p.signers.length!==0){var T=I();S(T)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(A){typeof A=="string"&&(A=r.pki.certificateFromPem(A)),p.certificates.push(A)},addCertificateRevokationList:function(A){throw new Error("PKCS#7 CRL support not yet implemented.")}},p;function I(){for(var A={},d=0;d<p.signers.length;++d){var T=p.signers[d],x=T.digestAlgorithm;x in A||(A[x]=r.md[r.pki.oids[x]].create()),T.authenticatedAttributes.length===0?T.md=A[x]:T.md=r.md[r.pki.oids[x]].create()}p.digestAlgorithmIdentifiers=[];for(var x in A)p.digestAlgorithmIdentifiers.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(x).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]));return A}function S(A){var d;if(p.detachedContent?d=p.detachedContent:(d=p.contentInfo.value[1],d=d.value[0]),!d)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var T=e.derToOid(p.contentInfo.value[0].value),x=e.toDer(d);x.getByte(),e.getBerValueLength(x),x=x.getBytes();for(var k in A)A[k].start().update(x);for(var U=new Date,_=0;_<p.signers.length;++_){var h=p.signers[_];if(h.authenticatedAttributes.length===0){if(T!==r.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{h.authenticatedAttributesAsn1=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var c=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[]),v=0;v<h.authenticatedAttributes.length;++v){var b=h.authenticatedAttributes[v];b.type===r.pki.oids.messageDigest?b.value=A[h.digestAlgorithm].digest():b.type===r.pki.oids.signingTime&&(b.value||(b.value=U)),c.value.push(l(b)),h.authenticatedAttributesAsn1.value.push(l(b))}x=e.toDer(c).getBytes(),h.md.start().update(x)}h.signature=h.key.sign(h.md,"RSASSA-PKCS1-V1_5")}p.signerInfos=f(p.signers)}},t.createEncryptedData=function(){var p=null;return p={type:r.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:r.pki.oids["aes256-CBC"]},fromAsn1:function(I){w(p,I,t.asn1.encryptedDataValidator)},decrypt:function(I){I!==void 0&&(p.encryptedContent.key=I),y(p)}},p},t.createEnvelopedData=function(){var p=null;return p={type:r.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:r.pki.oids["aes256-CBC"]},fromAsn1:function(I){var S=w(p,I,t.asn1.envelopedDataValidator);p.recipients=s(S.recipientInfos.value)},toAsn1:function(){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,o(p.recipients)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,g(p.encryptedContent))])])])},findRecipient:function(I){for(var S=I.issuer.attributes,A=0;A<p.recipients.length;++A){var d=p.recipients[A],T=d.issuer;if(d.serialNumber===I.serialNumber&&T.length===S.length){for(var x=!0,k=0;k<S.length;++k)if(T[k].type!==S[k].type||T[k].value!==S[k].value){x=!1;break}if(x)return d}}return null},decrypt:function(I,S){if(p.encryptedContent.key===void 0&&I!==void 0&&S!==void 0)switch(I.encryptedContent.algorithm){case r.pki.oids.rsaEncryption:case r.pki.oids.desCBC:var A=S.decrypt(I.encryptedContent.content);p.encryptedContent.key=r.util.createBuffer(A);break;default:throw new Error("Unsupported asymmetric cipher, OID "+I.encryptedContent.algorithm)}y(p)},addRecipient:function(I){p.recipients.push({version:0,issuer:I.issuer.attributes,serialNumber:I.serialNumber,encryptedContent:{algorithm:r.pki.oids.rsaEncryption,key:I.publicKey}})},encrypt:function(I,S){if(p.encryptedContent.content===void 0){S=S||p.encryptedContent.algorithm,I=I||p.encryptedContent.key;var A,d,T;switch(S){case r.pki.oids["aes128-CBC"]:A=16,d=16,T=r.aes.createEncryptionCipher;break;case r.pki.oids["aes192-CBC"]:A=24,d=16,T=r.aes.createEncryptionCipher;break;case r.pki.oids["aes256-CBC"]:A=32,d=16,T=r.aes.createEncryptionCipher;break;case r.pki.oids["des-EDE3-CBC"]:A=24,d=8,T=r.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+S)}if(I===void 0)I=r.util.createBuffer(r.random.getBytes(A));else if(I.length()!=A)throw new Error("Symmetric key has wrong length; got "+I.length()+" bytes, expected "+A+".");p.encryptedContent.algorithm=S,p.encryptedContent.key=I,p.encryptedContent.parameter=r.util.createBuffer(r.random.getBytes(d));var x=T(I);if(x.start(p.encryptedContent.parameter.copy()),x.update(p.content),!x.finish())throw new Error("Symmetric encryption failed.");p.encryptedContent.content=x.output}for(var k=0;k<p.recipients.length;++k){var U=p.recipients[k];if(U.encryptedContent.content===void 0)switch(U.encryptedContent.algorithm){case r.pki.oids.rsaEncryption:U.encryptedContent.content=U.encryptedContent.key.encrypt(p.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+U.encryptedContent.algorithm)}}}},p};function n(p){var I={},S=[];if(!e.validate(p,t.asn1.recipientInfoValidator,I,S)){var A=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw A.errors=S,A}return{version:I.version.charCodeAt(0),issuer:r.pki.RDNAttributesAsArray(I.issuer),serialNumber:r.util.createBuffer(I.serial).toHex(),encryptedContent:{algorithm:e.derToOid(I.encAlgorithm),parameter:I.encParameter?I.encParameter.value:void 0,content:I.encKey}}}function i(p){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[r.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,r.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.encryptedContent.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.encryptedContent.content)])}function s(p){for(var I=[],S=0;S<p.length;++S)I.push(n(p[S]));return I}function o(p){for(var I=[],S=0;S<p.length;++S)I.push(i(p[S]));return I}function a(p){var I=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[r.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,r.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.digestAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])]);if(p.authenticatedAttributesAsn1&&I.value.push(p.authenticatedAttributesAsn1),I.value.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.signatureAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])),I.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.signature)),p.unauthenticatedAttributes.length>0){for(var S=e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[]),A=0;A<p.unauthenticatedAttributes.length;++A){var d=p.unauthenticatedAttributes[A];S.values.push(l(d))}I.value.push(S)}return I}function f(p){for(var I=[],S=0;S<p.length;++S)I.push(a(p[S]));return I}function l(p){var I;if(p.type===r.pki.oids.contentType)I=e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.value).getBytes());else if(p.type===r.pki.oids.messageDigest)I=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.value.bytes());else if(p.type===r.pki.oids.signingTime){var S=new Date("1950-01-01T00:00:00Z"),A=new Date("2050-01-01T00:00:00Z"),d=p.value;if(typeof d=="string"){var T=Date.parse(d);isNaN(T)?d.length===13?d=e.utcTimeToDate(d):d=e.generalizedTimeToDate(d):d=new Date(T)}d>=S&&d<A?I=e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(d)):I=e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(d))}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[I])])}function g(p){return[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(r.pki.oids.data).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.algorithm).getBytes()),p.parameter?e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.parameter.getBytes()):void 0]),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.content.getBytes())])]}function w(p,I,S){var A={},d=[];if(!e.validate(I,S,A,d)){var T=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw T.errors=T,T}var x=e.derToOid(A.contentType);if(x!==r.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(A.encryptedContent){var k="";if(r.util.isArray(A.encryptedContent))for(var U=0;U<A.encryptedContent.length;++U){if(A.encryptedContent[U].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");k+=A.encryptedContent[U].value}else k=A.encryptedContent;p.encryptedContent={algorithm:e.derToOid(A.encAlgorithm),parameter:r.util.createBuffer(A.encParameter.value),content:r.util.createBuffer(k)}}if(A.content){var k="";if(r.util.isArray(A.content))for(var U=0;U<A.content.length;++U){if(A.content[U].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");k+=A.content[U].value}else k=A.content;p.content=r.util.createBuffer(k)}return p.version=A.version.charCodeAt(0),p.rawCapture=A,A}function y(p){if(p.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(p.content===void 0){var I;switch(p.encryptedContent.algorithm){case r.pki.oids["aes128-CBC"]:case r.pki.oids["aes192-CBC"]:case r.pki.oids["aes256-CBC"]:I=r.aes.createDecryptionCipher(p.encryptedContent.key);break;case r.pki.oids.desCBC:case r.pki.oids["des-EDE3-CBC"]:I=r.des.createDecryptionCipher(p.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+p.encryptedContent.algorithm)}if(I.start(p.encryptedContent.parameter),I.update(p.encryptedContent.content),!I.finish())throw new Error("Symmetric decryption failed.");p.content=I.output}}return Po.exports}var Bo={exports:{}},af;function k1(){if(af)return Bo.exports;af=1;var r=Ne();xn(),Ji(),fc(),Zi(),Ke();var e=Bo.exports=r.ssh=r.ssh||{};e.privateKeyToPutty=function(s,o,a){a=a||"",o=o||"";var f="ssh-rsa",l=o===""?"none":"aes256-cbc",g="PuTTY-User-Key-File-2: "+f+`\r
`;g+="Encryption: "+l+`\r
`,g+="Comment: "+a+`\r
`;var w=r.util.createBuffer();n(w,f),t(w,s.e),t(w,s.n);var y=r.util.encode64(w.bytes(),64),p=Math.floor(y.length/66)+1;g+="Public-Lines: "+p+`\r
`,g+=y;var I=r.util.createBuffer();t(I,s.d),t(I,s.p),t(I,s.q),t(I,s.qInv);var S;if(!o)S=r.util.encode64(I.bytes(),64);else{var A=I.length()+16-1;A-=A%16;var d=i(I.bytes());d.truncate(d.length()-A+I.length()),I.putBuffer(d);var T=r.util.createBuffer();T.putBuffer(i("\0\0\0\0",o)),T.putBuffer(i("\0\0\0",o));var x=r.aes.createEncryptionCipher(T.truncate(8),"CBC");x.start(r.util.createBuffer().fillWithByte(0,16)),x.update(I.copy()),x.finish();var k=x.output;k.truncate(16),S=r.util.encode64(k.bytes(),64)}p=Math.floor(S.length/66)+1,g+=`\r
Private-Lines: `+p+`\r
`,g+=S;var U=i("putty-private-key-file-mac-key",o),_=r.util.createBuffer();n(_,f),n(_,l),n(_,a),_.putInt32(w.length()),_.putBuffer(w),_.putInt32(I.length()),_.putBuffer(I);var h=r.hmac.create();return h.start("sha1",U),h.update(_.bytes()),g+=`\r
Private-MAC: `+h.digest().toHex()+`\r
`,g},e.publicKeyToOpenSSH=function(s,o){var a="ssh-rsa";o=o||"";var f=r.util.createBuffer();return n(f,a),t(f,s.e),t(f,s.n),a+" "+r.util.encode64(f.bytes())+" "+o},e.privateKeyToOpenSSH=function(s,o){return o?r.pki.encryptRsaPrivateKey(s,o,{legacy:!0,algorithm:"aes128"}):r.pki.privateKeyToPem(s)},e.getPublicKeyFingerprint=function(s,o){o=o||{};var a=o.md||r.md.md5.create(),f="ssh-rsa",l=r.util.createBuffer();n(l,f),t(l,s.e),t(l,s.n),a.start(),a.update(l.getBytes());var g=a.digest();if(o.encoding==="hex"){var w=g.toHex();return o.delimiter?w.match(/.{2}/g).join(o.delimiter):w}else{if(o.encoding==="binary")return g.getBytes();if(o.encoding)throw new Error('Unknown encoding "'+o.encoding+'".')}return g};function t(s,o){var a=o.toString(16);a[0]>="8"&&(a="00"+a);var f=r.util.hexToBytes(a);s.putInt32(f.length),s.putBytes(f)}function n(s,o){s.putInt32(o.length),s.putString(o)}function i(){for(var s=r.md.sha1.create(),o=arguments.length,a=0;a<o;++a)s.update(arguments[a]);return s.digest()}return Bo.exports}var ko,of;function D1(){return of||(of=1,ko=Ne(),xn(),x1(),Ir(),hc(),Sa(),b1(),Ji(),R1(),N1(),P1(),Gp(),pc(),ai(),Kp(),zp(),B1(),$p(),qp(),Mp(),gc(),pr(),Fp(),k1(),Wp(),Ke()),ko}var L1=D1();const ke=E0(L1);function cT(){const r=ke.pki.rsa.generateKeyPair({bits:2048});return{publicKey:ke.pki.publicKeyToPem(r.publicKey),privateKey:ke.pki.privateKeyToPem(r.privateKey)}}function lT(){const r=ke.random.getBytesSync(32);return ke.util.encode64(r)}function hT(r,e){const t=ke.pkcs5.pbkdf2(e,"salt",1e4,32),n=ke.random.getBytesSync(16),i=ke.cipher.createCipher("AES-CBC",t);i.start({iv:n}),i.update(ke.util.createBuffer(r)),i.finish();const s=i.output.getBytes();return ke.util.encode64(n+s)}function fT(r,e){try{const t=ke.pkcs5.pbkdf2(e,"salt",1e4,32),n=ke.util.decode64(r),i=n.slice(0,16),s=n.slice(16),o=ke.cipher.createDecipher("AES-CBC",t);if(o.start({iv:i}),o.update(ke.util.createBuffer(s)),!o.finish())throw new Error("Decryption failed!");return o.output.toString()}catch(t){return console.error("Error decrypting private key:",t),null}}function V1(r,e){try{const n=ke.pki.publicKeyFromPem(e).encrypt(ke.util.decode64(r),"RSA-OAEP");return ke.util.encode64(n)}catch(t){return console.error("Encryption error:",t),null}}function O1(r,e){try{const n=ke.pki.privateKeyFromPem(e).decrypt(ke.util.decode64(r),"RSA-OAEP");return ke.util.encode64(n)}catch(t){return console.error("Decryption error:",t),null}}function Js(r,e){try{const n=ke.pki.publicKeyFromPem(e).encrypt(ke.util.encodeUtf8(r),"RSA-OAEP");return ke.util.encode64(n)}catch(t){return console.error("Encryption error:",t),null}}function U1(r,e){try{const t=ke.pki.privateKeyFromPem(e),n=ke.util.decode64(r),i=t.decrypt(n,"RSA-OAEP");return ke.util.decodeUtf8(i)}catch(t){return console.error("Decryption error:",t),null}}function Yp(r,e){try{const t=ke.util.decode64(e),n=ke.random.getBytesSync(16),i=ke.cipher.createCipher("AES-CBC",t);return i.start({iv:n}),i.update(ke.util.createBuffer(ke.util.encodeUtf8(r))),i.finish(),ke.util.encode64(n+i.output.getBytes())}catch(t){return console.error("AES Encryption error:",t),null}}function M1(r,e){try{const t=ke.util.decode64(e),n=ke.util.decode64(r),i=n.slice(0,16),s=n.slice(16),o=ke.cipher.createDecipher("AES-CBC",t);if(o.start({iv:i}),o.update(ke.util.createBuffer(s)),!o.finish())throw new Error("Decryption failed!");return ke.util.decodeUtf8(o.output.getBytes())}catch(t){return console.error("AES Decryption error:",t),null}}function yc(){return new Promise((r,e)=>{const t=indexedDB.open("ChatAppDB",1);t.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains("keys")||i.createObjectStore("keys",{keyPath:"userId"})},t.onsuccess=()=>r(t.result),t.onerror=n=>e(n.target.error)})}async function dT(r,e){(await yc()).transaction("keys","readwrite").objectStore("keys").put({userId:r,privateKey:e})}async function Xp(r){const e=await yc();return new Promise((t,n)=>{const o=e.transaction("keys","readonly").objectStore("keys").get(r);o.onsuccess=()=>t(o.result?.privateKey||null),o.onerror=a=>n(a.target.error)})}async function pT(r){const e=await yc();return new Promise((t,n)=>{const o=e.transaction("keys","readwrite").objectStore("keys").delete(r);o.onsuccess=()=>t(!0),o.onerror=a=>n(a.target.error)})}var Jp={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},uf=Dr.createContext&&Dr.createContext(Jp),F1=["attr","size","title"];function K1(r,e){if(r==null)return{};var t=q1(r,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function q1(r,e){if(r==null)return{};var t={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}function Zs(){return Zs=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Zs.apply(this,arguments)}function cf(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function ea(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cf(Object(t),!0).forEach(function(n){j1(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):cf(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function j1(r,e,t){return e=H1(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function H1(r){var e=G1(r,"string");return typeof e=="symbol"?e:e+""}function G1(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Zp(r){return r&&r.map((e,t)=>Dr.createElement(e.tag,ea({key:t},e.attr),Zp(e.child)))}function wa(r){return e=>Dr.createElement(z1,Zs({attr:ea({},r.attr)},e),Zp(r.child))}function z1(r){var e=t=>{var{attr:n,size:i,title:s}=r,o=K1(r,F1),a=i||t.size||"1em",f;return t.className&&(f=t.className),r.className&&(f=(f?f+" ":"")+r.className),Dr.createElement("svg",Zs({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,o,{className:f,style:ea(ea({color:r.color||t.color},t.style),r.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),s&&Dr.createElement("title",null,s),r.children)};return uf!==void 0?Dr.createElement(uf.Consumer,null,t=>e(t)):e(Jp)}function $1(r){return wa({tag:"svg",attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"},child:[]}]})(r)}function W1(r){return wa({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(r)}function Q1(r){return wa({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(r)}const Y1=r=>{const[e,t]=Fe.useState(""),[n,i]=Fe.useState(""),[s,o]=Fe.useState(null);return{editText:e,setEditText:t,editingMessageId:s,handleEditMessage:l=>{o(l.id),t(l.text),i(l.text)},handleUpdateMessage:async l=>{if(l.preventDefault(),e.trim()==="")return;if(e===n){t(""),o(null);return}const g=Yp(e,r),w=sr(Nt,"groupMessages",s);try{await Xn(w,{text:g,isEdited:!0}),t(""),o(null)}catch(y){console.error("Error updating message:",y)}}}},e0=()=>({formatMessageDate:Fe.useCallback(e=>{if(!e||typeof e!="object"||!e.seconds)return console.error("Invalid timestamp:",e),"Invalid date";const t=new Date(e.seconds*1e3);if(isNaN(t.getTime()))return console.error("Failed to parse timestamp:",e),"Invalid date";const n=new Date,i=new Date;return i.setDate(n.getDate()-7),t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()?`${t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Kolkata"})}`:t>i?`${t.toLocaleString("en-US",{weekday:"long",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Kolkata"})}`:t.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Kolkata"})},[])}),t0=r=>{const e=Fe.useCallback(t=>{let n=[],i=null;return t.forEach((s,o)=>{const a=new Date(s.createdAt*10).setMilliseconds(0),f=i===a,l=t[o+1],w=(l?new Date(l.createdAt*10).setMilliseconds(0):null)!==a;f?n.push({...s,isFirstOfGroup:!1,isLastOfGroup:w}):(n.push({...s,isFirstOfGroup:!0,isLastOfGroup:w}),i=a)}),n},[]);return Fe.useMemo(()=>e(r),[r,e])},X1=(r,e)=>{const[t,n]=Fe.useState(null);return Fe.useEffect(()=>{(async()=>{if(!r?.groupId||!e?.uid)return;const s=r.encryptedKeys.find(f=>f.uid===e.uid)?.encryptedKey;if(!s){console.error("No encrypted group key for logedInUser!"),n(null);return}const o=await Xp(e.uid);if(!o){console.error("User's private key not found!"),n(null);return}const a=O1(s,o);if(!a){console.error("Failed to decrypt group AES key!"),n(null);return}n(a)})()},[r,e]),t},r0=(r,e)=>{Fe.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e,r])},J1=({selectedGroup:r,onClose:e})=>{const{allUser:t,logedInUser:n,setIsGroupChanged:i,isGroupChanged:s}=Xi(),[o,a]=Fe.useState(!1),f=w=>r.memberIds.includes(w),l=async w=>{if(!w||!w.uid||!w.publicKey){alert("Invalid member selection.");return}a(!0);try{const y=sr(Nt,"groups",r.groupId),p={uid:w.uid,encryptedKey:V1(r.groupKey,w.publicKey)};await Xn(y,{memberIds:vh(w.uid),encryptedKeys:vh(p)}),i(!s)}catch(y){console.error("Failed to add member:",y),alert("Failed to add member.")}finally{a(!1)}},g=async w=>{try{const y=sr(Nt,"groups",r.groupId),p=r.memberIds.filter(S=>S!==w),I=r.encryptedKeys.filter(S=>S.uid!==w);await Xn(y,{memberIds:p,encryptedKeys:I}),i(!s)}catch(y){console.error("Error removing member:",y)}};return fe.jsx("div",{style:zr.modalOverlay,children:fe.jsxs("div",{style:zr.modalContainer,children:[fe.jsx("h3",{style:zr.title,children:"Manage Group Members"}),fe.jsx("ul",{style:zr.userList,children:t.map(w=>fe.jsxs("li",{style:zr.userItem,children:[fe.jsx("span",{children:w.username}),n.uid!==w.uid&&(f(w.uid)?fe.jsx("button",{style:zr.removeButton,onClick:()=>g(w.uid),disabled:o,children:"-"}):fe.jsx("button",{style:zr.addButton,onClick:()=>l(w),disabled:o,children:"+"}))]},w.uid))}),fe.jsx("button",{style:zr.cancelButton,onClick:e,children:"Close"})]})})},zr={modalOverlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalContainer:{backgroundColor:"#1F1F1F",padding:"20px",borderRadius:"10px",textAlign:"center",color:"#fff"},title:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px"},userList:{listStyle:"none",padding:0},userItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid #ddd"},addButton:{backgroundColor:"#4CAF50",color:"white",padding:"6px 11px",border:"none",borderRadius:"4px",cursor:"pointer"},removeButton:{backgroundColor:"#f44336",color:"white",padding:"6px 11px",border:"none",borderRadius:"4px",cursor:"pointer"},cancelButton:{marginTop:"10px",backgroundColor:"#777",color:"white",padding:"8px 14px",border:"none",borderRadius:"4px",cursor:"pointer"}},Z1=({selectedGroup:r,onClose:e})=>{const[t,n]=Fe.useState(r.groupName),{setIsGroupChanged:i,isGroupChanged:s}=Xi(),[o,a]=Fe.useState(!1),f=async()=>{if(t.trim()!==r.newGroupName){a(!0);try{await Xn(sr(Nt,"groups",r.groupId),{groupName:t}),e(),i(!s)}catch(l){console.error("Error updating group name:",l),alert("Failed to update group name")}}};return fe.jsx("div",{style:gn.modalOverlay,children:fe.jsxs("div",{style:gn.modalContainer,children:[fe.jsx("h3",{style:gn.title,children:"Change Group Name"}),fe.jsx("input",{type:"text",value:t,onChange:l=>n(l.target.value),style:gn.input}),fe.jsxs("div",{style:gn.buttonContainer,children:[fe.jsx("button",{onClick:f,style:gn.button,children:"Save"}),fe.jsx("button",{onClick:e,style:gn.cancelButton,children:"Cancel"})]})]})})},gn={modalOverlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalContainer:{backgroundColor:"rgb(51, 51, 51)",padding:"20px",borderRadius:"8px",width:"300px",textAlign:"center",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},title:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px"},input:{width:"-webkit-fill-available",padding:"8px",marginBottom:"10px",border:"1px solid #ccc",borderRadius:"4px"},buttonContainer:{display:"flex",justifyContent:"space-between"},button:{backgroundColor:"#4CAF50",color:"white",padding:"8px 14px",border:"none",borderRadius:"4px",cursor:"pointer"},cancelButton:{backgroundColor:"#f44336",color:"white",padding:"8px 14px",border:"none",borderRadius:"4px",cursor:"pointer"}},eT=({selectedGroup:r,groupMembers:e})=>{const[t,n]=Fe.useState(!1),[i,s]=Fe.useState(!1),[o,a]=Fe.useState(!1);return fe.jsxs("div",{style:$r.header,children:[fe.jsxs("div",{style:$r.subheader,children:[fe.jsx("div",{style:$r.avatar,children:fe.jsx(Q1,{size:22,color:"#fff"})}),fe.jsx("h2",{style:$r.username,children:r?.groupName})]}),fe.jsx("div",{style:$r.menuIcon,onClick:()=>n(!t),children:fe.jsx($1,{size:20,color:"#fff"})}),t&&fe.jsxs("div",{style:$r.menuDropdown,children:[fe.jsx("div",{style:$r.menuItem,onClick:()=>{s(!0),n(!1)},children:"Change Group Name"}),fe.jsx("div",{style:$r.menuItem,onClick:()=>{a(!0),n(!1)},children:"Add New Members"})]}),i&&fe.jsx(Z1,{selectedGroup:r,onClose:()=>s(!1)}),o&&fe.jsx(J1,{selectedGroup:r,usersList:e,onClose:()=>a(!1)})]})},$r={header:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:10,padding:"11px",backgroundColor:"#141414"},subheader:{display:"flex",alignItems:"center"},avatar:{width:"35px",height:"35px",borderRadius:"50%",backgroundColor:"#4CAF50",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"11px",cursor:"pointer"},username:{fontSize:"14px",fontWeight:"500"},menuIcon:{cursor:"pointer"},menuDropdown:{position:"absolute",top:"60px",right:"10px",backgroundColor:"#333",borderRadius:"5px",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.2)",zIndex:1e3,width:"180px",padding:"5px 0"},menuItem:{padding:"10px 14px",color:"#fff",cursor:"pointer",transition:"background 0.3s",fontSize:"13px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},menuItemLast:{borderBottom:"none"}},n0=({sendMessage:r,text:e,setText:t,handleTyping:n})=>fe.jsx("div",{style:Cs.inputContainer,children:fe.jsxs("form",{onSubmit:r,style:Cs.form,children:[fe.jsx("input",{type:"text",value:e,onChange:i=>{t(i.target.value),n()},placeholder:"Type a message...",style:Cs.input}),fe.jsx("button",{type:"submit",style:Cs.button,children:""})]})}),Cs={inputContainer:{padding:"0px 62px 20px 60px"},form:{display:"flex",backgroundColor:"rgb(28 28 28)",borderRadius:"10px",border:"1px solid rgb(85 85 85)"},input:{flex:1,padding:"8px 11px",outline:"none",border:"none",backgroundColor:"transparent",color:"#fff"},button:{padding:"11px 14px",backgroundColor:"transparent",color:"#fff",border:"none",cursor:"pointer",margin:"0px 11px",fontSize:"23px"}},tT=({socket:r})=>{const e=Fe.useRef(null),{setIsUpdateLastConversation:t,logedInUser:n,isUpdateLastConversation:i,selectedUserOrGroup:s,setSelectedUserOrGroup:o}=Xi(),[a,f]=Fe.useState([]),[l,g]=Fe.useState([]),[w,y]=Fe.useState("");r0(e,l);const{formatMessageDate:p}=e0(),I=t0(l),S=X1(s,n),{editText:A,setEditText:d,editingMessageId:T,handleEditMessage:x,handleUpdateMessage:k}=Y1(S);Fe.useEffect(()=>{(async()=>{if(s?.memberIds&&s.memberIds.length>0){const b=au(bi(Nt,"users"),Xs("uid","in",s.memberIds)),R=(await u1(b)).docs.map(P=>P.data());f(R)}})()},[s]),Fe.useEffect(()=>{if(!s?.groupId||!n?.uid||!S)return;const v=au(bi(Nt,"groupMessages"),Xs("groupId","==",s.groupId),Rp("createdAt")),b=Dp(v,async B=>{const R=await Promise.all(B.docs.map(async P=>{const H=P.data(),z=M1(H.text,S);if(H.senderId!==n.uid&&!H.seenBy?.includes(n.uid))try{await Xn(sr(Nt,"groupMessages",P.id),{seenBy:[...H.seenBy||[],n.uid]})}catch(W){console.error("Error updating seenBy:",W)}return{id:P.id,...H,text:z}}));g(R)});return()=>b()},[s,n,S]);const U=async v=>{if(v.preventDefault(),w.trim()===""||!S)return;const b=Yp(w,S);try{await kp(bi(Nt,"groupMessages"),{text:b,senderId:n.uid,senderName:n.displayName,groupId:s.groupId,createdAt:new Date,seenBy:[],isEdited:!1}),await lc(sr(Nt,"lastConversations",s.groupId),{lastMessageAt:ou(),lastMessage:w,participants:[...s.memberIds]},{merge:!0});const B=n.displayName.split(" ")[0],R=s.memberIds;r.emit("sendGroupMessage",{sender:n.uid,senderName:B,groupName:s.groupName,members:R,message:w}),y(""),t(!i)}catch(B){console.error("Error sending message: ",B)}},[_,h]=Fe.useState(!1);Fe.useEffect(()=>(r.on("typing",({sender:v,groupId:b})=>{s.groupId===b&&h(!0)}),r.on("stopTyping",()=>{h(!1)}),()=>{r.off("typing"),r.off("stopTyping")}),[]);const c=()=>{const v=s.memberIds;r.emit("typing",{chatType:"group",sender:n.uid,groupId:s.groupId,members:v}),clearTimeout(window.groupTypingTimeout),window.groupTypingTimeout=setTimeout(()=>{r.emit("stopTyping",{chatType:"group",sender:n.uid,groupId:s.groupId,members:v})},1500)};return s?fe.jsxs("div",{style:ur.chatContainer,children:[fe.jsx(eT,{selectedGroup:s,setSelectedGroup:o,logedInUser:n,groupMembers:a}),fe.jsxs("div",{ref:e,style:ur.chatBox,children:[I.map((v,b)=>{const B=v.senderId===n.uid,R=T===v.id;return fe.jsxs("div",{style:{...ur.messageWrapper,alignSelf:B?"flex-end":"flex-start"},children:[v.isFirstOfGroup&&fe.jsx("div",{style:{...ur.infoContainer,alignSelf:B?"flex-end":"flex-start"},children:B?fe.jsx("p",{style:ur.createdAt,children:p(v.createdAt)}):fe.jsxs(fe.Fragment,{children:[fe.jsx("p",{style:ur.senderName,children:v.senderName}),fe.jsxs("p",{style:ur.createdAt,children:[p(v.createdAt)," ",v.isEdited&&", Edited"]})]})}),fe.jsx("div",{style:{...ur.message,alignSelf:B?"flex-end":"flex-start",backgroundColor:B?"rgb(37 53 46)":"rgb(44 51 48)",cursor:"pointer"},onClick:()=>{v.seenBy.length==0&&x(v)},children:R?fe.jsx("input",{type:"text",value:A,onChange:P=>d(P.target.value),onBlur:k,onKeyDown:P=>{P.key==="Enter"&&k(P)},autoFocus:!0,style:ur.inputBox}):fe.jsx("p",{style:ur.text,title:v.seen?null:"Click for edit",children:v.text})}),v.isLastOfGroup&&B&&v.seenBy&&fe.jsx("div",{style:ur.seenContainer,children:v.seenBy.map((P,H)=>{const z=a.find(W=>W.uid===P);return z?fe.jsx("img",{src:z.photoURL,alt:"Seen",style:ur.seenAvatarOutside},H):null})})]},b)}),_&&fe.jsx("p",{ref:e,style:{fontSize:"13px",color:"#aaa",marginBottom:"0px"},children:"Someone is typing..."})]}),fe.jsx(n0,{sendMessage:U,setText:y,text:w,handleTyping:c})]}):null},ur={chatContainer:{display:"flex",flexDirection:"column",height:"100vh",width:"100%",margin:"0 auto",backgroundColor:"#1F1F1F",color:"#fff"},chatBox:{flex:1,padding:"11px 57px",overflowY:"auto",display:"flex",flexDirection:"column",gap:3},messageWrapper:{display:"flex",flexDirection:"column",width:"fit-content",maxWidth:"80%",position:"relative",marginBottom:0},infoContainer:{display:"flex",marginBottom:"4px"},senderName:{margin:0,fontSize:"11px",color:"#B0B0B0",textTransform:"capitalize"},createdAt:{margin:0,marginLeft:"4px",fontSize:"11px",color:"#B0B0B0"},message:{padding:"11px",maxWidth:"80%",borderRadius:"4px",boxShadow:"0px 2px 4px rgba(0,0,0,0.4)",fontSize:"14px",position:"relative",display:"inline-block",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},text:{margin:0,color:"#fff"},inputBox:{width:"100%",fontSize:"14px",border:"none",outline:"none",backgroundColor:"transparent",color:"#fff"},seenContainer:{display:"flex",flexDirection:"row-reverse",marginTop:"5px",alignItems:"center"},seenAvatarOutside:{width:"13px",height:"13px",borderRadius:"50%",marginRight:"4px"}},rT=(r,e)=>{const[t,n]=Fe.useState(""),[i,s]=Fe.useState(""),[o,a]=Fe.useState(null),f=w=>{a(w.id),n(w.text),s(w.text)},l=async w=>{if(w.preventDefault(),t.trim()==="")return;if(t===i){n(""),a(null);return}const y=await g(r.uid),p=await g(e.uid);if(!y||!p){console.error("Public key missing.");return}const I=Js(t,y),S=Js(t,p),A=sr(Nt,"messages",o);try{await Xn(A,{encryptedTextForRecipient:I,encryptedTextForSender:S,isEdited:!0}),n(""),a(null)}catch(d){console.error("Error updating message:",d)}},g=async w=>{const y=await uc(sr(Nt,"users",w));return y.exists()?y.data().publicKey:null};return{editText:t,setEditText:n,editingMessageId:o,handleEditMessage:f,handleUpdateMessage:l}};function nT(r){return wa({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"},child:[]},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"},child:[]}]})(r)}const iT=({socket:r})=>{const e=Fe.useRef(null),[t,n]=Fe.useState([]),[i,s]=Fe.useState("");r0(e,t);const{formatMessageDate:o}=e0(),a=t0(t),{selectedUserOrGroup:f,setIsUpdateLastConversation:l,logedInUser:g,isUpdateLastConversation:w}=Xi(),{editText:y,setEditText:p,editingMessageId:I,handleEditMessage:S,handleUpdateMessage:A}=rT(f,g);Fe.useEffect(()=>{if(f){const _=au(bi(Nt,"messages"),Xs("senderId","in",[g.uid,f.uid]),Xs("recipientId","in",[g.uid,f.uid]),Rp("createdAt","asc")),h=Dp(_,async c=>{const v=[],b=await Xp(g.uid);if(!b){console.error("User's private key not found!");return}for(const R of c.docs){const P={id:R.id,...R.data()};try{let H;if(P.senderId===g.uid?H=P.encryptedTextForSender:H=P.encryptedTextForRecipient,!H)throw new Error("Encrypted text not found!");P.text=U1(H,b)}catch(H){console.error("Decryption error:",H),P.text=" Encrypted Message (Decryption Failed)"}v.push(P)}n(v);const B=v.filter(R=>R.recipientId===g.uid&&!R.seen);if(B.length>0){const R=l1(Nt);B.forEach(P=>{const H=sr(Nt,"messages",P.id);R.update(H,{seen:!0})}),await R.commit()}});return()=>h()}},[g.uid,f]);const d=async _=>{if(_.preventDefault(),i.trim()!=="")try{const h=await T(f.uid),c=await T(g.uid);if(!h||!c){console.error("Public key missing.");return}const v=Js(i,h),b=Js(i,c);await kp(bi(Nt,"messages"),{encryptedTextForRecipient:v,encryptedTextForSender:b,createdAt:ou(),sender:g.displayName,senderId:g.uid,recipientId:f.uid,seen:!1,isEdited:!1});const B=[g.uid,f.uid].sort().join("_");await lc(sr(Nt,"lastConversations",B),{lastMessageAt:ou(),lastMessage:i,participants:[g.uid,f.uid]},{merge:!0}),r.emit("sendMessage",{sender:g.uid,receiver:f.uid,senderName:g.displayName,message:v}),s(""),l(!w)}catch(h){console.error("Error encrypting message:",h)}},T=async _=>{const h=await uc(sr(Nt,"users",_));return h.exists()?h.data().publicKey:null},[x,k]=Fe.useState(!1);Fe.useEffect(()=>(r.on("typing",({sender:_})=>{_!==g.uid&&k(!0)}),r.on("stopTyping",()=>{k(!1)}),()=>{r.off("typing"),r.off("stopTyping")}),[r]);const U=()=>{r.emit("typing",{chatType:"dm",sender:g.uid,receiver:f.uid}),clearTimeout(window.typingTimeout),window.typingTimeout=setTimeout(()=>{r.emit("stopTyping",{chatType:"dm",receiver:f.uid})},1500)};return f?fe.jsxs("div",{style:nr.chatContainer,children:[fe.jsxs("div",{style:nr.header,children:[fe.jsx("div",{style:nr.avatar,children:f.username.charAt(0).toUpperCase()}),fe.jsxs("h2",{style:nr.username,children:[f.username.charAt(0).toUpperCase()+f.username.slice(1)," "]})]}),fe.jsxs("div",{ref:x?null:e,style:nr.chatBox,children:[a.map((_,h)=>{const c=_.senderId===g.uid&&h===a.length-1,v=I===_.id,b=_.senderId===g.uid;return fe.jsxs("div",{style:{...nr.messageContainer,alignSelf:b?"flex-end":"flex-start"},children:[_.isFirstOfGroup&&fe.jsxs("p",{style:{...nr.messageDate,alignSelf:b?"flex-end":"flex-start"},children:[o(_.createdAt)," ",_.isEdited&&", Edited"]}),fe.jsx("div",{style:{...nr.message,alignSelf:b?"flex-end":"flex-start",backgroundColor:b?"rgb(37 53 46)":"rgb(44 51 48)",cursor:"pointer"},onClick:()=>{_.seen||S(_)},children:v?fe.jsx("input",{type:"text",value:y,onChange:B=>p(B.target.value),onBlur:A,onKeyDown:B=>{B.key==="Enter"&&A(B)},autoFocus:!0,style:nr.inputBox}):fe.jsx("p",{style:nr.text,title:_.seen?null:"Edit",children:_.text})}),c&&fe.jsx("div",{style:nr.seenStatus,title:_.seen?"Seen":"Unseen",children:_.seen?fe.jsx(W1,{style:nr.seen}):fe.jsx(nT,{style:nr.seen})})]},_.id)}),x&&fe.jsxs("p",{ref:e,style:{fontSize:"13px",color:"#aaa",marginBottom:"0px"},children:[f.username," is typing..."]})]}),fe.jsx(n0,{sendMessage:d,setText:s,text:i,handleTyping:U})]}):null},nr={chatContainer:{display:"flex",flexDirection:"column",height:"100vh",width:"100%",margin:"0 auto",backgroundColor:"#1F1F1F",color:"#fff"},header:{display:"flex",alignItems:"center",padding:"11px",backgroundColor:"#141414",color:"#fff"},avatar:{width:"35px",height:"35px",borderRadius:"50%",border:"1px solid #1F1F1F",display:"flex",alignItems:"center",backgroundColor:"#fff",justifyContent:"center",fontSize:"14px",fontWeight:"bold",marginRight:"10px",color:"#141414"},username:{fontSize:"14px",fontWeight:"500"},chatBox:{flex:1,padding:"11px 57px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"0px"},messageContainer:{display:"flex",flexDirection:"column",position:"relative",alignItems:"flex-end",marginBottom:"4px",width:"-webkit-fill-available"},message:{maxWidth:"80%",padding:"11px",borderRadius:"4px",boxShadow:"box-shadow: rgba(255, 255, 255, 0.1) 0px 1px 1px 0px inset, rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px",fontSize:"14px",position:"relative",transition:"background-color 0.3s ease",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},text:{margin:0,color:"#fff"},inputBox:{width:"100%",fontSize:"14px",border:"none",outline:"none",backgroundColor:"transparent",color:"#fff"},messageDate:{fontSize:"11px",color:"#A0A0A0",marginBottom:"1px",alignSelf:"flex-start"},seenStatus:{cursor:"pointer",alignSelf:"flex-end"},editTooltip:{fontSize:"11px",color:"#fff",marginLeft:"8px",opacity:.8},seen:{fontSize:"13px",color:"#7f85f5"}},gT=({socket:r})=>{const{selectedUserOrGroup:e}=Xi();return fe.jsx(fe.Fragment,{children:e.type==="group"?fe.jsx(fe.Fragment,{children:fe.jsx(tT,{socket:r})}):fe.jsx(iT,{socket:r})})};export{gT as C,Q1 as F,wa as G,Nt as a,Xp as b,U1 as c,sr as d,uT as e,lT as f,uc as g,V1 as h,kp as i,fe as j,bi as k,ou as l,u1 as m,f1 as n,cT as o,hT as p,au as q,dT as r,lc as s,fT as t,Xi as u,aT as v,Xs as w,pT as x};
